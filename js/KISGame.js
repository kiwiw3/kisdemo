if(!this.kisgame){kisgame={}}kisgame.getGameStage=function(_,$){var a;if(_&&_.toLowerCase()=="webgl"){a=new kisgame.KISWebGLStage($)}else{a=new kisgame.KISStage($)}return a};;(function(){"use strict";var _={};_.LEFT=2;_.RIGHT=4;_.TOP=8;_.BOTTOM=16;_.CENTER=32;_.MIDDLE=64;_.HORIZONTAL=128;_.VERTICAL=256;_.OFFSET_X=512;_.OFFSET_Y=1024;_.FONT=2048;_.BACK=4096;_.COMBINE=8192;_.SEPARATE=16384;kisgame.DirectionType=_})();kisgame.extend=function(_,$){"use strict";function a(){var b=this;b.constructor=_}a.prototype=$.prototype;return (_.prototype=new a())};kisgame.promote=function(_,$){"use strict";var a=_.prototype,b=(Object.getPrototypeOf&&Object.getPrototypeOf(a))||a.__proto__;if(b){a[($+="_")+"constructor"]=b.constructor;for(var c in b){if(a.hasOwnProperty(c)&&(typeof b[c]=="function" )){a[$+c]=b[c]}}}return _};(function(){"use strict";function _(a,b,c){var d=this;d.type=a;d.target=null;d.currentTarget=null;d.eventPhase=0;d.bubbles=!!b;d.cancelable=!!c;d.timeStamp=(new Date()).getTime();d.defaultPrevented=false;d.propagationStopped=false;d.immediatePropagationStopped=false;d.removed=false}var $=_.prototype;$.preventDefault=function(){var a=this;a.defaultPrevented=a.cancelable&&true};$.stopPropagation=function(){var a=this;a.propagationStopped=true};$.stopImmediatePropagation=function(){var a=this;a.immediatePropagationStopped=a.propagationStopped=true};$.remove=function(){var a=this;a.removed=true};$.clone=function(){var a=this;return new _(a.type,a.bubbles,a.cancelable)};$.set=function(a){var c=this;for(var b in a){c[b]=a[b]}return c};$.toString=function(){var a=this;return "[Event (type="+a.type+")]"};$.stop=function(){var a=this;a.stopImmediatePropagation();a.preventDefault()};kisgame.Event=_}());(function(){"use strict";function _(){var a=this;a._listeners=null;a._captureListeners=null}var $=_.prototype;_.initialize=function(a){a.addEventListener=$.addEventListener;a.on=$.on;a.removeEventListener=$.removeEventListener;a.off=$.off;a.removeAllEventListeners=$.removeAllEventListeners;a.hasEventListener=$.hasEventListener;a.dispatchEvent=$.dispatchEvent;a._dispatchEvent=$._dispatchEvent;a.willTrigger=$.willTrigger};$.addEventListener=function(a,b,c){var e=this;var d;if(c){d=e._captureListeners=e._captureListeners||{}}else{d=e._listeners=e._listeners||{}}var f=d[a];if(f){e.removeEventListener(a,b,c)}f=d[a];if(!f){d[a]=[b]}else{f.push(b);f.sortOn("priority",Array.NUMERIC|Array.DESCENDING)}return b};$.on=function(a,b,c,d,e,f,g){var i=this;var h;if(b.handleEvent){c=c||b;h=b.handleEvent}else{h=b;c=c||i}var j;if(f){j=i._captureListeners=i._captureListeners||{}}else{j=i._listeners=i._listeners||{}}var k=j[a];var l=null;if(k){var m=k.length;for(var n=0;n<m;n++){var o=k[n];if(o.type==a&&o.olistener==b&&o.scope==c){l=o;break}}}else{k=j[a]=[]}if(!l){l={handleEvent:function(p){var i=this;i.listener.call(i.scope,p,i.data);i.once&&p.remove()},once:d,data:e,listener:h,olistener:b,type:a,scope:c,priority:g};k.push(l);k.sortOn("priority",Array.NUMERIC|Array.DESCENDING)}return l};$.off=function(a,b,c,d){var f=this;var e=c?f._captureListeners:f._listeners;if(!e){return}var g=e[a];if(g){var h;if(b.olistener){d=d||b.scope;h=b.olistener}else{h=b;d=d||f}var i=g.length;var j=null;for(var k=0;k<i;k++){var l=g[k];if(l.type==a&&l.olistener==h&&l.scope==d){if(i==1){delete (e[a])}else{g.splice(k,1)}break}}}};$.removeEventListener=function(a,b,c){var e=this;var d=c?e._captureListeners:e._listeners;if(!d){return}var f=d[a];if(!f){return}for(var g=0,h=f.length;g<h;g++){if(f[g]==b){if(h==1){delete (d[a])}else{f.splice(g,1)}break}}};$.removeAllEventListeners=function(a){var b=this;if(!a){b._listeners=b._captureListeners=null}else{if(b._listeners){delete (b._listeners[a])}if(b._captureListeners){delete (b._captureListeners[a])}}};$.dispatchEvent=function(a,b,c){var e=this;if(typeof a=="string"){var d=e._listeners;if(!b&&(!d||!d[a])){return true}a=new kisgame.Event(a,b,c)}else if(a.target&&a.clone){a=a.clone()}a.target=e;if(!a.bubbles||!e.parent){e._dispatchEvent(a,2)}else{var f=e,g=[f];while(f.parent){g.push(f=f.parent)}var h,i=g.length;for(h=i-1;h>=0&&!a.propagationStopped;h--){g[h]._dispatchEvent(a,1+(h==0))}for(h=1;h<i&&!a.propagationStopped;h++){g[h]._dispatchEvent(a,3)}}return !a.defaultPrevented};$.hasEventListener=function(a){var c=this;var b=c._listeners,d=c._captureListeners;return !!((b&&b[a])||(d&&d[a]))};$.willTrigger=function(a){var c=this;var b=c;while(b){if(b.hasEventListener(a)){return true}b=b.parent}return false};$.toString=function(){return "[EventDispatcher]"};$._dispatchEvent=function(a,b){var e=this;var c,d=(b==1)?e._captureListeners:e._listeners;if(a&&d){var f=d[a.type];if(!f||!(c=f.length)){return}a.currentTarget=e;a.eventPhase=b;a.removed=false;f=f.slice();for(var g=0;g<c&&!a.immediatePropagationStopped;g++){var h=f[g];if(h.handleEvent){h.handleEvent(a)}else{h(a)}if(a.removed){e.off(a.type,h,b==1);a.removed=false}}}};$.addETL=$.on;$.removeETL=function(a,b,c){var d=this;d.off(a,b,false,c)};kisgame.EventDispatcher=_}());(function(){"use strict";function _(){throw "Ticker cannot be instantiated."}_.RAF_SYNCHED="synched";_.RAF="raf";_.TIMEOUT="timeout";_.useRAF=false;_.timingMode=null;_.maxDelta=0;_.paused=false;_.removeEventListener=null;_.removeAllEventListeners=null;_.dispatchEvent=null;_.hasEventListener=null;_._listeners=null;kisgame.EventDispatcher.initialize(_);_._addEventListener=_.addEventListener;_.addEventListener=function(){!_._inited&&_.init();return _._addEventListener.apply(_,arguments)};_._on=_.on;_.on=function(){!_._inited&&_.init();return _._on.apply(_,arguments)};_._inited=false;_._startTime=0;_._pausedTime=0;_._ticks=0;_._pausedTicks=0;_._interval=50;_._lastTime=0;_._times=null;_._tickTimes=null;_._timerId=null;_._raf=true;_.setInterval=function(a){_._interval=a;if(!_._inited){return}_._setupTick()};_.getInterval=function(){return _._interval};_.setFPS=function(a){_.setInterval(1000/a)};_.getFPS=function(){return 1000/_._interval};try{Object.defineProperties(_,{interval:{get:_.getInterval,set:_.setInterval},framerate:{get:_.getFPS,set:_.setFPS}})}catch(e){console.log(e)}_.init=function(){if(_._inited){return}_._inited=true;_._times=[];_._tickTimes=[];_._startTime=_._getTime();_._times.push(_._lastTime=0);_.interval=_._interval};_.reset=function(){if(_._raf){var a=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;a&&a(_._timerId)}else{clearTimeout(_._timerId)}_.removeAllEventListeners("tick");_._timerId=_._times=_._tickTimes=null;_._startTime=_._lastTime=_._ticks=0;_._inited=false};_.getMeasuredTickTime=function(a){var b=0,c=_._tickTimes;if(!c||c.length<1){return -1}a=Math.min(c.length,a||(_.getFPS()|0));for(var d=0;d<a;d++){b+=c[d]}return b/a};_.getMeasuredFPS=function(a){var b=_._times;if(!b||b.length<2){return -1}a=Math.min(b.length-1,a||(_.getFPS()|0));return 1000/((b[0]-b[a])/a)};_.setPaused=function(a){_.paused=a};_.getPaused=function(){return _.paused};_.getTime=function(a){return _._startTime?_._getTime()-(a?_._pausedTime:0):-1};_.getEventTime=function(a){return _._startTime?(_._lastTime||_._startTime)-(a?_._pausedTime:0):-1};_.getTicks=function(a){return _._ticks-(a?_._pausedTicks:0)};_._handleSynch=function(){_._timerId=null;_._setupTick();if(_._getTime()-_._lastTime>=(_._interval-1)*0.97){_._tick()}};_._handleRAF=function(){_._timerId=null;_._setupTick();_._tick()};_._handleTimeout=function(){_._timerId=null;_._setupTick();_._tick()};_._setupTick=function(){if(_._timerId!=null){return}var a=_.timingMode||(_.useRAF&&_.RAF_SYNCHED);if(a==_.RAF_SYNCHED||a==_.RAF){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(b){_._timerId=b(a==_.RAF?_._handleRAF:_._handleSynch);_._raf=true;return}}_._raf=false;_._timerId=setTimeout(_._handleTimeout,_._interval)};_._tick=function(){var a=_.paused;var b=_._getTime();var c=b-_._lastTime;_._lastTime=b;_._ticks++;if(a){_._pausedTicks++;_._pausedTime+=c}if(_.hasEventListener("tick")){var d=new kisgame.Event("tick");var e=_.maxDelta;d.delta=(e&&c>e)?e:c;d.paused=a;d.time=b;d.runTime=b-_._pausedTime;_.dispatchEvent(d)}_._tickTimes.unshift(_._getTime()-b);while(_._tickTimes.length>100){_._tickTimes.pop()}_._times.unshift(b);while(_._times.length>100){_._times.pop()}};var $=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);_._getTime=function(){return (($&&$.call(performance))||(new Date().getTime()))-_._startTime};kisgame.Ticker=_}());(function(){"use strict";function _(){throw "UID cannot be instantiated"}_._nextID=0;_.get=function(){return _._nextID++};kisgame.UID=_}());(function(){"use strict";var _=new Object();var $=_;$.ht=[];$.intervalID=-1;$.lastTimer=0;$.framerate=30;$.checkAllFrame=function(){var a=_;var b=a.ht.slice(0);var c=b.length;for(var d=0;d<c;d++){var e=b[d];if(e&&e.length==4){var f=e[3];if(f<=0){var g=e[0];var h=e[1];var i=e[2];e[0]=0;e[1]=0;e[2]=0;e[4]=true;g.apply(h,i)}else{f--;e[3]=f}}}b.splice(0,b.length);var b=a.ht;var c=b.length;for(var d=0;d<c;d++){var e=b[d];if(e&&e.length==5){b.splice(d,1);c--;d--}}if(b.length<=0){a.lastTimer=0;a.intervalID=-1}else{var j=0;if(a.lastTimer>0){j=getTimer()-a.lastTimer}a.lastTimer=getTimer();var k=2000/a.framerate-j;if(k<=5){k=5}a.intervalID=setTimeout(a.checkAllFrame,k)}};$.containTarget=function(a,b){var d=this;var c=d.ht;var e=c.length;for(var f=0;f<e;f++){var g=c[f];if(g[0]==a&&g[1]==b){return g}}return false};$.addOnce=function(a,b,c,d){var f=this;var e=f.containTarget(a,c);if(e){e[2]=d;e[3]=b}else{f.add(a,b,c,d)}};$.add=function(a,b,c,d){var e=this;e.ht.push([a,c,d,b]);if(e.intervalID==-1){e.intervalID=setTimeout(e.checkAllFrame,1000/e.framerate)}};$.remove=function(a,b,c){var e=this;var d=e.ht;var f=d.length;for(var g=0;g<f;g++){var h=d[g];if(h[0]==a&&h[1]==b){d.splice(g,1);h.splice(0,h.length);if(!c){return}}}};$.removeOf=function(a){var c=this;var b=c.ht;var d=b.length;for(var e=0;e<d;e++){var f=b[e];if(f[1]==a){b.splice(e,1);f.splice(0,f.length);e--;d--}}};kiscore.LaterFrameTable=_}());;(function(){function _(){}_.get2PR=function($,a,b,c){var d=c-a;var e=b-$;return Math.sqrt(d*d+e*e)};_.get3PRandian=function($,a,b){var c=0,d=0,e=0;var f=a.x-$.x;var g=a.y-$.y;var h=b.x-$.x;var i=b.y-$.y;c=f*h+g*i;e=(f*f+g*g)*(h*h+i*i);c/=Math.sqrt(e);if(c>=1.0)return 0;if(c<=-1.0)return Math.PI;return Math.acos(c)};_.normalize=function($,a,b){var c=Math.sqrt($*$+a*a);var d=$/c;var e=a/c;return {x:b*d,y:b*e}};_.getBezierControlPoints=function($,a){var b=$[0].x,c=$[0].y;var d=$[1].x,e=$[1].y;var f=$[2].x,g=$[2].y;var h=$[3].x,i=$[3].y;var j=(b+d)/2.0;var k=(c+e)/2.0;var l=(d+f)/2.0;var m=(e+g)/2.0;var n=(f+h)/2.0;var o=(g+i)/2.0;var p=Math.sqrt((d-b)*(d-b)+(e-c)*(e-c));var q=Math.sqrt((f-d)*(f-d)+(g-e)*(g-e));var r=Math.sqrt((h-f)*(h-f)+(i-g)*(i-g));var s=p/(p+q);var t=q/(q+r);var u=j+(l-j)*s;var v=k+(m-k)*s;var w=l+(n-l)*t;var x=m+(o-m)*t;var y=u+(l-u)*a+d-u;var z=v+(m-v)*a+e-v;var A=w+(l-w)*a+f-w;var B=x+(m-x)*a+g-x;return [{x:y,y:z},{x:A,y:B}]};_.get2PRadian=function($,a,b,c){var d=c-a;var e=b-$;if(e==0){if(d<0){return Math.PI*3/2}else{return Math.PI/2}}var f=d/e;var g=Math.atan(f);g=e>=0?d<0?g+Math.PI*2:g:g+Math.PI;return g};_.drawXuline=function($,a,b,c,d,e){var f=_.get2PRadian(a,b,c,d);var g=_.get2PR(a,b,c,d);var h=Math.ceil(g/e);for(var i=0;i<h;i+=2){$.moveTo(a+i*e*Math.cos(f),b+i*e*Math.sin(f));$.lineTo(a+(i+1)*e*Math.cos(f),b+(i+1)*e*Math.sin(f))}$.moveTo(c,d);$.lineTo(c+e/3*Math.cos(f+Math.PI),d+e/3*Math.sin(f+Math.PI))};_.getLine=function($,a,b,c){var d,_b;if(b==$){d=NaN;_b=$}else{d=(c-a)/(b-$);_b=a-d*$}return {k:d,b:_b}};_.getCircle=function($,a,b){return {x:$,y:a,r:b}};_.getLineSamePoint=function($,a){var b=new kisgame.Point();if($.k==a.k||(isNaN($.k)&&isNaN(a.k))){if($.b==a.b){return 1}return null}else if(isNaN($.k)){b.x=$.b;b.y=a.k*b.x+a.b}else if(isNaN(a.k)){b.x=a.b;b.y=$.k*b.x+$.b}else{b.x=(a.b-$.b)/($.k-a.k);b.y=(a.k*$.b-$.k*a.b)/(a.k-$.k)}return b};_.getCircleLineSamePoint=function($,a){var b=$.x;var c=$.y;var d=$.r;var e=a.k;var f=a.b;var g=Math.pow(2*(b-e*f+c*e)/(1+e*e),2)+4*(d*d-b*b-c*c-f*f+2*c*f)/(1+e*e);if(g<0){return null}else if(g>0){var h=new Array(2);h[0]=new kisgame.Point();h[0].x=(b-e*f+c*e)/(1+e*e)+Math.sqrt((d*d-b*b-c*c-f*f+2*c*f)/(1+e*e)+Math.pow((b-e*f+c*e)/(1+e*e),2));h[0].y=e*h[0].x+f;h[1]=new kisgame.Point();h[1].x=(b-e*f+c*e)/(1+e*e)-Math.sqrt((d*d-b*b-c*c-f*f+2*c*f)/(1+e*e)+Math.pow((b-e*f+c*e)/(1+e*e),2));h[1].y=e*h[1].x+f;return h}return null};kisgame.GeomUtils=_}());(function(){var $=this;var _=$.kisgame.ColorUtils=new Object();_.alpha=1;_.str2Color=function(a){var $=this;$.alpha=1;var b=a.toLowerCase();if(b=="black"){a="#000000"}else if(b=="red"){a="#ff0000"}else if(b=="green"){a="#008000"}else if(b=="blue"){a="#0000ff"}else if(b=="yellow"){a="#ffff00"}else if(b=="gray"){a="#808080"}else if(b=="brown"){a="#A52A2A"}else if(b=="white"){a="#ffffff"}else{var c=a.substr(1);if(c.length==3){a="#"+c.charAt(0)+c.charAt(0)+c.charAt(1)+c.charAt(1)+c.charAt(2)+c.charAt(2)}else{c=a.substr(0,4);if(c=="rgba"){c=a.substr(5,a.length-6);var d=c.split(",");var e=d.length;for(var f=0;f<e;f++){var g;if(f<e-1){g=parseInt(d[f]);var h=g.toString(16);if(h.length==1){d[f]="0"+h}else{d[f]=h}}else{$.alpha=Number(d[f])}}a="#"+d[0]+d[1]+d[2]}}}return a}}());(function(){"use strict";var _={};_.create=function(){var $=new Float32Array(2);$[0]=0;$[1]=0;return $};_.clone=function($){var a=new Float32Array(2);a[0]=$[0];a[1]=$[1];return a};_.fromValues=function($,a){var b=new Float32Array(2);b[0]=$;b[1]=a;return b};_.copy=function($,a){$[0]=a[0];$[1]=a[1];return $};_.set=function($,a,b){$[0]=a;$[1]=b;return $};_.add=function($,a,b){$[0]=a[0]+b[0];$[1]=a[1]+b[1];return $};_.subtract=function($,a,b){$[0]=a[0]-b[0];$[1]=a[1]-b[1];return $};_.sub=_.subtract;_.multiply=function($,a,b){$[0]=a[0]*b[0];$[1]=a[1]*b[1];return $};_.mul=_.multiply;_.divide=function($,a,b){$[0]=a[0]/b[0];$[1]=a[1]/b[1];return $};_.div=_.divide;_.ceil=function($,a){$[0]=Math.ceil(a[0]);$[1]=Math.ceil(a[1]);return $};_.floor=function($,a){$[0]=Math.floor(a[0]);$[1]=Math.floor(a[1]);return $};_.min=function($,a,b){$[0]=Math.min(a[0],b[0]);$[1]=Math.min(a[1],b[1]);return $};_.max=function($,a,b){$[0]=Math.max(a[0],b[0]);$[1]=Math.max(a[1],b[1]);return $};_.round=function($,a){$[0]=Math.round(a[0]);$[1]=Math.round(a[1]);return $};_.scale=function($,a,b){$[0]=a[0]*b;$[1]=a[1]*b;return $};_.scaleAndAdd=function($,a,b,c){$[0]=a[0]+(b[0]*c);$[1]=a[1]+(b[1]*c);return $};_.distance=function($,a){var b=a[0]-$[0],c=a[1]-$[1];return Math.sqrt(b*b+c*c)};_.dist=_.distance;_.squaredDistance=function($,a){var b=a[0]-$[0],c=a[1]-$[1];return b*b+c*c};_.sqrDist=_.squaredDistance;_.length=function($){var a=$[0],b=$[1];return Math.sqrt(a*a+b*b)};_.len=_.length;_.squaredLength=function($){var a=$[0],b=$[1];return a*a+b*b};_.sqrLen=_.squaredLength;_.negate=function($,a){$[0]=-a[0];$[1]=-a[1];return $};_.inverse=function($,a){$[0]=1.0/a[0];$[1]=1.0/a[1];return $};_.normalize=function($,a){var b=a[0],c=a[1];var d=b*b+c*c;if(d>0){d=1/Math.sqrt(d);$[0]=a[0]*d;$[1]=a[1]*d}return $};_.dot=function($,a){return $[0]*a[0]+$[1]*a[1]};_.cross=function($,a,b){var c=a[0]*b[1]-a[1]*b[0];$[0]=$[1]=0;$[2]=c;return $};_.lerp=function($,a,b,c){var d=a[0],e=a[1];$[0]=d+c*(b[0]-d);$[1]=e+c*(b[1]-e);return $};_.random=function($,a){a=a||1.0;var b=glMatrix.RANDOM()*2.0*Math.PI;$[0]=Math.cos(b)*a;$[1]=Math.sin(b)*a;return $};_.transformMat2=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[2]*d;$[1]=b[1]*c+b[3]*d;return $};_.transformMat2d=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[2]*d+b[4];$[1]=b[1]*c+b[3]*d+b[5];return $};_.transformMat3=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[3]*d+b[6];$[1]=b[1]*c+b[4]*d+b[7];return $};_.transformMat4=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[4]*d+b[12];$[1]=b[1]*c+b[5]*d+b[13];return $};_.forEach=(function(){var $=_.create();return function(a,b,c,d,e,f){var g,l;if(!b){b=2}if(!c){c=0}if(d){l=Math.min((d*b)+c,a.length)}else{l=a.length}for(g=c;g<l;g+=b){$[0]=a[g];$[1]=a[g+1];e($,$,f);a[g]=$[0];a[g+1]=$[1]}return a}})();_.str=function($){return 'Vector2D('+$[0]+', '+$[1]+')'};_.exactEquals=function($,a){return $[0]===a[0]&&$[1]===a[1]};_.equals=function($,a){var b=$[0],c=$[1];var d=a[0],e=a[1];return (Math.abs(b-d)<=glMatrix.EPSILON*Math.max(1.0,Math.abs(b),Math.abs(d))&&Math.abs(c-e)<=glMatrix.EPSILON*Math.max(1.0,Math.abs(c),Math.abs(e)))};kisgame.Vector2D=_}());(function(){"use strict";var _={};_.XAxis=new Float32Array([1,0,0]);_.YAxis=new Float32Array([0,1,0]);_.ZAxis=new Float32Array([0,0,1]);_.create=function($,a,b){if($==undefined)$=0;if(a==undefined)a=0;if(b==undefined)b=0;var c=new Float32Array(3);c[0]=$;c[1]=a;c[2]=b;return c};_.clone=function($){var a=new Float32Array(3);a[0]=$[0];a[1]=$[1];a[2]=$[2];return a};_.fromValues=function($,a,b){var c=new Float32Array(3);c[0]=$;c[1]=a;c[2]=b;return c};_.copy=function($,a){$[0]=a[0];$[1]=a[1];$[2]=a[2];return $};_.set=function($,a,b,c){$[0]=a;$[1]=b;$[2]=c;return $};_.add=function($,a,b){$[0]=a[0]+b[0];$[1]=a[1]+b[1];$[2]=a[2]+b[2];return $};_.addValue=function($,a,b,c){$[0]+=a;$[1]+=b;$[2]+=c;return $};_.subtract=function($,a,b){$[0]=a[0]-b[0];$[1]=a[1]-b[1];$[2]=a[2]-b[2];return $};_.subtractValue=function($,a,b,c){$[0]-=a;$[1]-=b;$[2]-=c;return $};_.sub=_.subtract;_.multiply=function($,a,b){$[0]=a[0]*b[0];$[1]=a[1]*b[1];$[2]=a[2]*b[2];return $};_.mul=_.multiply;_.divide=function($,a,b){$[0]=a[0]/b[0];$[1]=a[1]/b[1];$[2]=a[2]/b[2];return $};_.div=_.divide;_.ceil=function($,a){$[0]=Math.ceil(a[0]);$[1]=Math.ceil(a[1]);$[2]=Math.ceil(a[2]);return $};_.floor=function($,a){$[0]=Math.floor(a[0]);$[1]=Math.floor(a[1]);$[2]=Math.floor(a[2]);return $};_.min=function($,a,b){$[0]=Math.min(a[0],b[0]);$[1]=Math.min(a[1],b[1]);$[2]=Math.min(a[2],b[2]);return $};_.max=function($,a,b){$[0]=Math.max(a[0],b[0]);$[1]=Math.max(a[1],b[1]);$[2]=Math.max(a[2],b[2]);return $};_.round=function($,a){$[0]=Math.round(a[0]);$[1]=Math.round(a[1]);$[2]=Math.round(a[2]);return $};_.scale=function($,a,b){$[0]=a[0]*b;$[1]=a[1]*b;$[2]=a[2]*b;return $};_.scaleAndAdd=function($,a,b,c){$[0]=a[0]+(b[0]*c);$[1]=a[1]+(b[1]*c);$[2]=a[2]+(b[2]*c);return $};_.distance=function($,a){var b=a[0]-$[0],c=a[1]-$[1],d=a[2]-$[2];return Math.sqrt(b*b+c*c+d*d)};_.dist=_.distance;_.squaredDistance=function($,a){var b=a[0]-$[0],c=a[1]-$[1],d=a[2]-$[2];return b*b+c*c+d*d};_.sqrDist=_.squaredDistance;_.length=function($){var a=$[0],b=$[1],c=$[2];return Math.sqrt(a*a+b*b+c*c)};_.len=_.length;_.squaredLength=function($){var a=$[0],b=$[1],c=$[2];return a*a+b*b+c*c};_.sqrLen=_.squaredLength;_.negate=function($,a){$[0]=-a[0];$[1]=-a[1];$[2]=-a[2];return $};_.inverse=function($,a){$[0]=1.0/a[0];$[1]=1.0/a[1];$[2]=1.0/a[2];return $};_.normalize=function($,a){var b=a[0],c=a[1],d=a[2];var e=b*b+c*c+d*d;if(e>0){e=1/Math.sqrt(e);$[0]=b*e;$[1]=c*e;$[2]=d*e}return $};_.dot=function($,a){return $[0]*a[0]+$[1]*a[1]+$[2]*a[2]};_.cross=function($,a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];$[0]=d*h-e*g;$[1]=e*f-c*h;$[2]=c*g-d*f;return $};_.lerp=function($,a,b,c){var d=a[0],e=a[1],f=a[2];$[0]=d+c*(b[0]-d);$[1]=e+c*(b[1]-e);$[2]=f+c*(b[2]-f);return $};_.hermite=function($,a,b,c,d,e){var f=e*e,g=f*(2*e-3)+1,h=f*(e-2)+e,i=f*(e-1),j=f*(3-2*e);$[0]=a[0]*g+b[0]*h+c[0]*i+d[0]*j;$[1]=a[1]*g+b[1]*h+c[1]*i+d[1]*j;$[2]=a[2]*g+b[2]*h+c[2]*i+d[2]*j;return $};_.bezier=function($,a,b,c,d,e){var f=1-e,g=f*f,h=e*e,i=g*f,j=3*e*g,k=3*h*f,m=h*e;$[0]=a[0]*i+b[0]*j+c[0]*k+d[0]*m;$[1]=a[1]*i+b[1]*j+c[1]*k+d[1]*m;$[2]=a[2]*i+b[2]*j+c[2]*k+d[2]*m;return $};_.random=function($,a){a=a||1.0;var b=glMatrix.RANDOM()*2.0*Math.PI;var c=(glMatrix.RANDOM()*2.0)-1.0;var d=Math.sqrt(1.0-c*c)*a;$[0]=Math.cos(b)*d;$[1]=Math.sin(b)*d;$[2]=c*a;return $};_.transformMat4=function($,a,b){var c=a[0],d=a[1],e=a[2],f=b[3]*c+b[7]*d+b[11]*e+b[15];f=f||1.0;$[0]=(b[0]*c+b[4]*d+b[8]*e+b[12])/f;$[1]=(b[1]*c+b[5]*d+b[9]*e+b[13])/f;$[2]=(b[2]*c+b[6]*d+b[10]*e+b[14])/f;return $};_.transformMat3=function($,a,b){var c=a[0],d=a[1],e=a[2];$[0]=c*b[0]+d*b[3]+e*b[6];$[1]=c*b[1]+d*b[4]+e*b[7];$[2]=c*b[2]+d*b[5]+e*b[8];return $};_.transformQuat=function($,a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2],i=b[3],j=i*c+g*e-h*d,k=i*d+h*c-f*e,m=i*e+f*d-g*c,n=-f*c-g*d-h*e;$[0]=j*i+n*-f+k*-h-m*-g;$[1]=k*i+n*-g+m*-f-j*-h;$[2]=m*i+n*-h+j*-g-k*-f;return $};_.rotateX=function($,a,b,c){var d=[],e=[];d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];e[0]=d[0];e[1]=d[1]*Math.cos(c)-d[2]*Math.sin(c);e[2]=d[1]*Math.sin(c)+d[2]*Math.cos(c);$[0]=e[0]+b[0];$[1]=e[1]+b[1];$[2]=e[2]+b[2];return $};_.rotateY=function($,a,b,c){var d=[],e=[];d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];e[0]=d[2]*Math.sin(c)+d[0]*Math.cos(c);e[1]=d[1];e[2]=d[2]*Math.cos(c)-d[0]*Math.sin(c);$[0]=e[0]+b[0];$[1]=e[1]+b[1];$[2]=e[2]+b[2];return $};_.rotateZ=function($,a,b,c){var d=[],e=[];d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];e[0]=d[0]*Math.cos(c)-d[1]*Math.sin(c);e[1]=d[0]*Math.sin(c)+d[1]*Math.cos(c);e[2]=d[2];$[0]=e[0]+b[0];$[1]=e[1]+b[1];$[2]=e[2]+b[2];return $};_.forEach=(function(){var $=_.create();return function(a,b,c,d,e,f){var g,l;if(!b){b=3}if(!c){c=0}if(d){l=Math.min((d*b)+c,a.length)}else{l=a.length}for(g=c;g<l;g+=b){$[0]=a[g];$[1]=a[g+1];$[2]=a[g+2];e($,$,f);a[g]=$[0];a[g+1]=$[1];a[g+2]=$[2]}return a}})();_.angle=function($,a){var b=_.fromValues($[0],$[1],$[2]);var c=_.fromValues(a[0],a[1],a[2]);_.normalize(b,b);_.normalize(c,c);var d=_.dot(b,c);if(d>1.0){return 0}else if(d<-1.0){return Math.PI}else{return Math.acos(d)}};_.str=function($){return 'Vector3D('+$[0]+', '+$[1]+', '+$[2]+')'};_.exactEquals=function($,a){return $[0]===a[0]&&$[1]===a[1]&&$[2]===a[2]};_.equals=function($,a){var b=$[0],c=$[1],d=$[2];var e=a[0],f=a[1],g=a[2];return (Math.abs(b-e)<=glMatrix.EPSILON*Math.max(1.0,Math.abs(b),Math.abs(e))&&Math.abs(c-f)<=glMatrix.EPSILON*Math.max(1.0,Math.abs(c),Math.abs(f))&&Math.abs(d-g)<=glMatrix.EPSILON*Math.max(1.0,Math.abs(d),Math.abs(g)))};_.subtractByIndex=function($,a,b,c,d,e){$[c]=a[d]-b[e];$[c+1]=a[d+1]-b[e+1];$[c+2]=a[d+2]-b[e+2];return $};_.normalizeByIndex=function($,a,b,c){var d=$[b],e=$[b+1],f=$[b+2];var g=d*d+e*e+f*f;if(g>0){g=1/Math.sqrt(g);a[c]=$[b]*g;a[c+1]=$[b+1]*g;a[c+2]=$[b+2]*g}return a};_.addByIndex=function($,a,b,c,d,e){$[c]=a[d]+b[e];$[c+1]=a[d+1]+b[e+1];$[c+2]=a[d+2]+b[e+2];return $};_.XYZLength=function($,a,b){return Math.sqrt($*$+a*a+b*b)};kisgame.Vector3D=_}());(function(){"use strict";function _(a,b,c,d,e,f){var g=this;g.setValues(a,b,c,d,e,f)}var $=_.prototype;_.DEG_TO_RAD=Math.PI/180;_.identity=null;$.setValues=function(a,b,c,d,e,f){var g=this;g.a=(a==null)?1:a;g.b=b||0;g.c=c||0;g.d=(d==null)?1:d;g.tx=e||0;g.ty=f||0;return g};$.append=function(a,b,c,d,e,f){var h=this;var g=h.a;var i=h.b;var j=h.c;var k=h.d;if(a!=1||b!=0||c!=0||d!=1){h.a=g*a+j*b;h.b=i*a+k*b;h.c=g*c+j*d;h.d=i*c+k*d}h.tx=g*e+j*f+h.tx;h.ty=i*e+k*f+h.ty;return h};$.prepend=function(a,b,c,d,e,f){var h=this;var g=h.a;var i=h.c;var j=h.tx;h.a=a*g+c*h.b;h.b=b*g+d*h.b;h.c=a*i+c*h.d;h.d=b*i+d*h.d;h.tx=a*j+c*h.ty+e;h.ty=b*j+d*h.ty+f;return h};$.appendMatrix=function(a){var b=this;return b.append(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.prependMatrix=function(a){var b=this;return b.prepend(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.appendTransform=function(a,b,c,d,e,f,g,h,i){var m=this;if(e%360){var j=e*_.DEG_TO_RAD;var k=Math.cos(j);var l=Math.sin(j)}else{k=1;l=0}if(f||g){f*=_.DEG_TO_RAD;g*=_.DEG_TO_RAD;m.append(Math.cos(g),Math.sin(g),-Math.sin(f),Math.cos(f),a,b);m.append(k*c,l*c,-l*d,k*d,0,0)}else{m.append(k*c,l*c,-l*d,k*d,a,b)}if(h||i){m.tx-=h*m.a+i*m.c;m.ty-=h*m.b+i*m.d}return m};$.prependTransform=function(a,b,c,d,e,f,g,h,i){var m=this;if(e%360){var j=e*_.DEG_TO_RAD;var k=Math.cos(j);var l=Math.sin(j)}else{k=1;l=0}if(h||i){m.tx-=h;m.ty-=i}if(f||g){f*=_.DEG_TO_RAD;g*=_.DEG_TO_RAD;m.prepend(k*c,l*c,-l*d,k*d,0,0);m.prepend(Math.cos(g),Math.sin(g),-Math.sin(f),Math.cos(f),a,b)}else{m.prepend(k*c,l*c,-l*d,k*d,a,b)}return m};$.rotate=function(a){var e=this;a=a*_.DEG_TO_RAD;var b=Math.cos(a);var c=Math.sin(a);var d=e.a;var f=e.b;e.a=d*b+e.c*c;e.b=f*b+e.d*c;e.c=-d*c+e.c*b;e.d=-f*c+e.d*b;return e};$.skew=function(a,b){var c=this;a=a*_.DEG_TO_RAD;b=b*_.DEG_TO_RAD;c.append(Math.cos(b),Math.sin(b),-Math.sin(a),Math.cos(a),0,0);return c};$.scale=function(a,b){var c=this;c.a*=a;c.b*=a;c.c*=b;c.d*=b;return c};$.translate=function(a,b){var c=this;c.tx+=c.a*a+c.c*b;c.ty+=c.b*a+c.d*b;return c};$.identity=function(){var a=this;a.a=a.d=1;a.b=a.c=a.tx=a.ty=0;return a};$.invert=function(){var b=this;var a=b.a;var c=b.b;var d=b.c;var e=b.d;var f=b.tx;var g=a*e-c*d;b.a=e/g;b.b=-c/g;b.c=-d/g;b.d=a/g;b.tx=(d*b.ty-e*f)/g;b.ty=-(a*b.ty-c*f)/g;return b};$.isIdentity=function(){var a=this;return a.tx===0&&a.ty===0&&a.a===1&&a.b===0&&a.c===0&&a.d===1};$.equals=function(a){var b=this;return b.tx===a.tx&&b.ty===a.ty&&b.a===a.a&&b.b===a.b&&b.c===a.c&&b.d===a.d};$.transformPoint=function(a,b,c){var d=this;c=c||{};c.x=a*d.a+b*d.c+d.tx;c.y=a*d.b+b*d.d+d.ty;return c};$.decompose=function(a){var b=this;if(a==null){a={}}a.x=b.tx;a.y=b.ty;a.scaleX=Math.sqrt(b.a*b.a+b.b*b.b);a.scaleY=Math.sqrt(b.c*b.c+b.d*b.d);var c=Math.atan2(-b.c,b.d);var d=Math.atan2(b.b,b.a);var e=Math.abs(1-c/d);if(e<0.00001){a.rotation=d/_.DEG_TO_RAD;if(b.a<0&&b.d>=0){a.rotation+=(a.rotation<=0)?180:-180}a.skewX=a.skewY=0}else{a.skewX=c/_.DEG_TO_RAD;a.skewY=d/_.DEG_TO_RAD}return a};$.copy=function(a){var b=this;return b.setValues(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.clone=function(){var a=this;return new _(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.toString=function(){var a=this;return "[Matrix2D (a="+a.a+" b="+a.b+" c="+a.c+" d="+a.d+" tx="+a.tx+" ty="+a.ty+")]"};_.identity=new _();kisgame.Matrix2D=_}());(function(){"use strict";var _=kisgame.Vector3D;var $={};var a=$;a.multiply=function(c,a,d){d=d||new Float32Array(16);var e=a[0*4+0];var f=a[0*4+1];var g=a[0*4+2];var h=a[0*4+3];var i=a[1*4+0];var j=a[1*4+1];var k=a[1*4+2];var l=a[1*4+3];var m=a[2*4+0];var n=a[2*4+1];var o=a[2*4+2];var p=a[2*4+3];var q=a[3*4+0];var r=a[3*4+1];var s=a[3*4+2];var t=a[3*4+3];var u=c[0*4+0];var v=c[0*4+1];var w=c[0*4+2];var x=c[0*4+3];var y=c[1*4+0];var z=c[1*4+1];var A=c[1*4+2];var B=c[1*4+3];var C=c[2*4+0];var D=c[2*4+1];var E=c[2*4+2];var F=c[2*4+3];var G=c[3*4+0];var H=c[3*4+1];var I=c[3*4+2];var J=c[3*4+3];d[0]=e*u+f*y+g*C+h*G;d[1]=e*v+f*z+g*D+h*H;d[2]=e*w+f*A+g*E+h*I;d[3]=e*x+f*B+g*F+h*J;d[4]=i*u+j*y+k*C+l*G;d[5]=i*v+j*z+k*D+l*H;d[6]=i*w+j*A+k*E+l*I;d[7]=i*x+j*B+k*F+l*J;d[8]=m*u+n*y+o*C+p*G;d[9]=m*v+n*z+o*D+p*H;d[10]=m*w+n*A+o*E+p*I;d[11]=m*x+n*B+o*F+p*J;d[12]=q*u+r*y+s*C+t*G;d[13]=q*v+r*z+s*D+t*H;d[14]=q*w+r*A+s*E+t*I;d[15]=q*x+r*B+s*F+t*J;return d};a.identity=function(c){c=c||new Float32Array(16);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.transpose=function(c,d){d=d||new Float32Array(16);d[0]=c[0];d[1]=c[4];d[2]=c[8];d[3]=c[12];d[4]=c[1];d[5]=c[5];d[6]=c[9];d[7]=c[13];d[8]=c[2];d[9]=c[6];d[10]=c[10];d[11]=c[14];d[12]=c[3];d[13]=c[7];d[14]=c[11];d[15]=c[15];return d};a.lookAt=function(c,d,e,f){f=f||new Float32Array(16);var g=_.create();_.subtract(g,d,c);if(_.squaredLength(g)===0){g[2]=1}_.normalize(g,g);var h=_.create();_.cross(h,e,g);if(_.squaredLength(h)===0){if(Math.abs(e[2])===1){g[0]+=0.0001}else{g[2]+=0.0001}_.normalize(g,g);_.cross(h,e,g)}_.normalize(h,h);var i=_.create();_.cross(i,g,h);_.normalize(i,i);f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=0;f[4]=i[0];f[5]=i[1];f[6]=i[2];f[7]=0;f[8]=g[0];f[9]=g[1];f[10]=g[2];f[11]=0;f[12]=c[0];f[13]=c[1];f[14]=c[2];f[15]=1;return f};a.orthographic=function(c,d,e,f,g,h,i){i=i||new Float32Array(16);i[0]=2/(d-c);i[1]=0;i[2]=0;i[3]=0;i[4]=0;i[5]=2/(f-e);i[6]=0;i[7]=0;i[8]=0;i[9]=0;i[10]=2/(g-h);i[11]=0;i[12]=(c+d)/(c-d);i[13]=(e+f)/(e-f);i[14]=(g+h)/(g-h);i[15]=1;return i};a.frustum=function(c,d,e,f,g,h,i){var j=d-c;var k=f-e;var l=h-g;i[0]=2*g/j;i[1]=0;i[2]=0;i[3]=0;i[4]=0;i[5]=2*g/k;i[6]=0;i[7]=0;i[8]=(c+d)/j;i[9]=(f+e)/k;i[10]=-(h+g)/l;i[11]=-1;i[12]=0;i[13]=0;i[14]=-2*g*h/l;i[15]=0;return i};a.translation=function(c,d,e,f){f=f||new Float32Array(16);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=c;f[13]=d;f[14]=e;f[15]=1;return f};a.translate=function(c,d,e,f,g){g=g||new Float32Array(16);var h=c[0];var i=c[1];var j=c[2];var k=c[3];var l=c[1*4+0];var m=c[1*4+1];var n=c[1*4+2];var o=c[1*4+3];var p=c[2*4+0];var q=c[2*4+1];var r=c[2*4+2];var s=c[2*4+3];var t=c[3*4+0];var u=c[3*4+1];var v=c[3*4+2];var w=c[3*4+3];if(c!==g){g[0]=h;g[1]=i;g[2]=j;g[3]=k;g[4]=l;g[5]=m;g[6]=n;g[7]=o;g[8]=p;g[9]=q;g[10]=r;g[11]=s}g[12]=h*d+l*e+p*f+t;g[13]=i*d+m*e+q*f+u;g[14]=j*d+n*e+r*f+v;g[15]=k*d+o*e+s*f+w;return g};a.xRotation=function(c,d){d=d||new Float32Array(16);var e=Math.cos(c);var f=Math.sin(c);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=e;d[6]=f;d[7]=0;d[8]=0;d[9]=-f;d[10]=e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.xRotate=function(c,d,e){e=e||new Float32Array(16);var f=c[4];var g=c[5];var h=c[6];var i=c[7];var j=c[8];var k=c[9];var l=c[10];var m=c[11];var n=Math.cos(d);var o=Math.sin(d);e[4]=n*f+o*j;e[5]=n*g+o*k;e[6]=n*h+o*l;e[7]=n*i+o*m;e[8]=n*j-o*f;e[9]=n*k-o*g;e[10]=n*l-o*h;e[11]=n*m-o*i;if(c!==e){e[0]=c[0];e[1]=c[1];e[2]=c[2];e[3]=c[3];e[12]=c[12];e[13]=c[13];e[14]=c[14];e[15]=c[15]}return e};a.yRotation=function(c,d){d=d||new Float32Array(16);var e=Math.cos(c);var f=Math.sin(c);d[0]=e;d[1]=0;d[2]=-f;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=f;d[9]=0;d[10]=e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.yRotate=function(c,d,e){e=e||new Float32Array(16);var f=c[0*4+0];var g=c[0*4+1];var h=c[0*4+2];var i=c[0*4+3];var j=c[2*4+0];var k=c[2*4+1];var l=c[2*4+2];var m=c[2*4+3];var n=Math.cos(d);var o=Math.sin(d);e[0]=n*f-o*j;e[1]=n*g-o*k;e[2]=n*h-o*l;e[3]=n*i-o*m;e[8]=n*j+o*f;e[9]=n*k+o*g;e[10]=n*l+o*h;e[11]=n*m+o*i;if(c!==e){e[4]=c[4];e[5]=c[5];e[6]=c[6];e[7]=c[7];e[12]=c[12];e[13]=c[13];e[14]=c[14];e[15]=c[15]}return e};a.zRotation=function(c,d){d=d||new Float32Array(16);var e=Math.cos(c);var f=Math.sin(c);d[0]=e;d[1]=f;d[2]=0;d[3]=0;d[4]=-f;d[5]=e;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.zRotate=function(c,d,e){e=e||new Float32Array(16);var f=c[0*4+0];var g=c[0*4+1];var h=c[0*4+2];var i=c[0*4+3];var j=c[1*4+0];var k=c[1*4+1];var l=c[1*4+2];var m=c[1*4+3];var n=Math.cos(d);var o=Math.sin(d);e[0]=n*f+o*j;e[1]=n*g+o*k;e[2]=n*h+o*l;e[3]=n*i+o*m;e[4]=n*j-o*f;e[5]=n*k-o*g;e[6]=n*l-o*h;e[7]=n*m-o*i;if(c!==e){e[8]=c[8];e[9]=c[9];e[10]=c[10];e[11]=c[11];e[12]=c[12];e[13]=c[13];e[14]=c[14];e[15]=c[15]}return e};a.axisRotation=function(c,d,e){e=e||new Float32Array(16);var f=c[0];var g=c[1];var h=c[2];var i=Math.sqrt(f*f+g*g+h*h);f/=i;g/=i;h/=i;var j=f*f;var k=g*g;var l=h*h;var m=Math.cos(d);var n=Math.sin(d);var o=1-m;e[0]=j+(1-j)*m;e[1]=f*g*o+h*n;e[2]=f*h*o-g*n;e[3]=0;e[4]=f*g*o-h*n;e[5]=k+(1-k)*m;e[6]=g*h*o+f*n;e[7]=0;e[8]=f*h*o+g*n;e[9]=g*h*o-f*n;e[10]=l+(1-l)*m;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};a.axisRotate=function(c,d,e,f){f=f||new Float32Array(16);var g=d[0];var h=d[1];var i=d[2];var j=Math.sqrt(g*g+h*h+i*i);g/=j;h/=j;i/=j;var k=g*g;var l=h*h;var m=i*i;var n=Math.cos(e);var o=Math.sin(e);var p=1-n;var q=k+(1-k)*n;var r=g*h*p+i*o;var s=g*i*p-h*o;var t=g*h*p-i*o;var u=l+(1-l)*n;var v=h*i*p+g*o;var w=g*i*p+h*o;var x=h*i*p-g*o;var y=m+(1-m)*n;var z=c[0];var A=c[1];var B=c[2];var C=c[3];var D=c[4];var E=c[5];var F=c[6];var G=c[7];var H=c[8];var I=c[9];var J=c[10];var K=c[11];f[0]=q*z+r*D+s*H;f[1]=q*A+r*E+s*I;f[2]=q*B+r*F+s*J;f[3]=q*C+r*G+s*K;f[4]=t*z+u*D+v*H;f[5]=t*A+u*E+v*I;f[6]=t*B+u*F+v*J;f[7]=t*C+u*G+v*K;f[8]=w*z+x*D+y*H;f[9]=w*A+x*E+y*I;f[10]=w*B+x*F+y*J;f[11]=w*C+x*G+y*K;if(c!==f){f[12]=c[12];f[13]=c[13];f[14]=c[14];f[15]=c[15]}return f};a.scaling=function(c,d,e,f){f=f||new Float32Array(16);f[0]=c;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=d;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=e;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};a.scale=function(c,d,e,f,g){g=g||new Float32Array(16);g[0]=d*c[0*4+0];g[1]=d*c[0*4+1];g[2]=d*c[0*4+2];g[3]=d*c[0*4+3];g[4]=e*c[1*4+0];g[5]=e*c[1*4+1];g[6]=e*c[1*4+2];g[7]=e*c[1*4+3];g[8]=f*c[2*4+0];g[9]=f*c[2*4+1];g[10]=f*c[2*4+2];g[11]=f*c[2*4+3];if(c!==g){g[12]=c[12];g[13]=c[13];g[14]=c[14];g[15]=c[15]}return g};a.unscale=function(c,d){var e=0;var f=_.create();_.set(f,c[e+0],c[e+1],c[e+2]);_.normalize(f,f);d[e+0]=f[0];d[e+1]=f[1];d[e+2]=f[2];e+=4;_.set(f,c[e+0],c[e+1],c[e+2]);_.normalize(f,f);d[e+0]=f[0];d[e+1]=f[1];d[e+2]=f[2];e+=4;_.set(f,c[e+0],c[e+1],c[e+2]);_.normalize(f,f);d[e+0]=f[0];d[e+1]=f[1];d[e+2]=f[2];return d};a.changeAxis=function(c,d,e,f){f=f||new Float32Array(16);var g=0;var h=0;if(d==_.YAxis){g=4}else if(d==_.ZAxis){g=8}if(e==_.YAxis){h=4}else if(e==_.ZAxis){h=8}var i=c[g+0];var j=c[g+1];var k=c[g+2];var l=c[g+3];var m=c[h+0];var n=c[h+1];var o=c[h+2];var p=c[h+3];f[g+0]=m;f[g+1]=n;f[g+2]=o;f[g+3]=p;f[h+0]=i;f[h+1]=j;f[h+2]=k;f[h+3]=l};a.inverse=function(c,d){d=d||new Float32Array(16);var e=c[0*4+0];var f=c[0*4+1];var g=c[0*4+2];var h=c[0*4+3];var i=c[1*4+0];var j=c[1*4+1];var k=c[1*4+2];var l=c[1*4+3];var m=c[2*4+0];var n=c[2*4+1];var o=c[2*4+2];var p=c[2*4+3];var q=c[3*4+0];var r=c[3*4+1];var s=c[3*4+2];var t=c[3*4+3];var u=o*t;var v=s*p;var w=k*t;var x=s*l;var y=k*p;var z=o*l;var A=g*t;var B=s*h;var C=g*p;var D=o*h;var E=g*l;var F=k*h;var G=m*r;var H=q*n;var I=i*r;var J=q*j;var K=i*n;var L=m*j;var M=e*r;var N=q*f;var O=e*n;var P=m*f;var Q=e*j;var R=i*f;var S=(u*j+x*n+y*r)-(v*j+w*n+z*r);var T=(v*f+A*n+D*r)-(u*f+B*n+C*r);var U=(w*f+B*j+E*r)-(x*f+A*j+F*r);var V=(z*f+C*j+F*n)-(y*f+D*j+E*n);var W=1.0/(e*S+i*T+m*U+q*V);d[0]=W*S;d[1]=W*T;d[2]=W*U;d[3]=W*V;d[4]=W*((v*i+w*m+z*q)-(u*i+x*m+y*q));d[5]=W*((u*e+B*m+C*q)-(v*e+A*m+D*q));d[6]=W*((x*e+A*i+F*q)-(w*e+B*i+E*q));d[7]=W*((y*e+D*i+E*m)-(z*e+C*i+F*m));d[8]=W*((G*l+J*p+K*t)-(H*l+I*p+L*t));d[9]=W*((H*h+M*p+P*t)-(G*h+N*p+O*t));d[10]=W*((I*h+N*l+Q*t)-(J*h+M*l+R*t));d[11]=W*((L*h+O*l+R*p)-(K*h+P*l+Q*p));d[12]=W*((I*o+L*s+H*k)-(K*s+G*k+J*o));d[13]=W*((O*s+G*g+N*o)-(M*o+P*s+H*g));d[14]=W*((M*k+R*s+J*g)-(Q*s+I*g+N*k));d[15]=W*((Q*o+K*g+P*k)-(O*k+R*o+L*g));return d};a.transformVector=function(c,d,e){e=e||new Float32Array(4);for(var f=0;f<4;++f){e[f]=0.0;for(var g=0;g<4;++g){e[f]+=d[g]*c[g*4+f]}}return e};a.transformPoint=function(c,d,e){e=e||new Float32Array(3);var f=d[0];var g=d[1];var h=d[2];var i=f*c[0*4+3]+g*c[1*4+3]+h*c[2*4+3]+c[3*4+3];e[0]=(f*c[0*4+0]+g*c[1*4+0]+h*c[2*4+0]+c[3*4+0])/i;e[1]=(f*c[0*4+1]+g*c[1*4+1]+h*c[2*4+1]+c[3*4+1])/i;e[2]=(f*c[0*4+2]+g*c[1*4+2]+h*c[2*4+2]+c[3*4+2])/i;return e};a.transformXYZ=function(c,d,e,f,g,h){g=g||new Float32Array(3);if(h==undefined)h=0;var i=d;var j=e;var k=f;var l=i*c[0*4+3]+j*c[1*4+3]+k*c[2*4+3]+c[3*4+3];g[h+0]=(i*c[0*4+0]+j*c[1*4+0]+k*c[2*4+0]+c[3*4+0])/l;g[h+1]=(i*c[0*4+1]+j*c[1*4+1]+k*c[2*4+1]+c[3*4+1])/l;g[h+2]=(i*c[0*4+2]+j*c[1*4+2]+k*c[2*4+2]+c[3*4+2])/l;return g};a.transformDirection=function(c,d,e){e=e||new Float32Array(3);var f=d[0];var g=d[1];var h=d[2];e[0]=f*c[0*4+0]+g*c[1*4+0]+h*c[2*4+0];e[1]=f*c[0*4+1]+g*c[1*4+1]+h*c[2*4+1];e[2]=f*c[0*4+2]+g*c[1*4+2]+h*c[2*4+2];return e};a.transformNormal=function(c,d,e){var g=this;e=e||new Float32Array(3);var f=g.inverse(c);var h=d[0];var i=d[1];var j=d[2];e[0]=h*f[0*4+0]+i*f[0*4+1]+j*f[0*4+2];e[1]=h*f[1*4+0]+i*f[1*4+1]+j*f[1*4+2];e[2]=h*f[2*4+0]+i*f[2*4+1]+j*f[2*4+2];return e};a.copy=function(c,d){d=d||new Float32Array(16);d[0]=c[0];d[1]=c[1];d[2]=c[2];d[3]=c[3];d[4]=c[4];d[5]=c[5];d[6]=c[6];d[7]=c[7];d[8]=c[8];d[9]=c[9];d[10]=c[10];d[11]=c[11];d[12]=c[12];d[13]=c[13];d[14]=c[14];d[15]=c[15];return d};var b=Math.PI/180;a.appendTransform=function(c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;p=p||new Float32Array(16);if(d||e||f)q.translate(c,d,e,f,p);if(j)q.xRotate(p,j*b,p);if(k)q.yRotate(p,k*b,p);if(l)q.zRotate(p,l*b,p);q.scale(p,g,h,i,p);if(m||n||o)q.translate(p,m,n,o,p);return p};a.EMPTY_MATRIX3D=a.identity();a.append2D=function(c,d,a,e,f,g,h,i){var k=this;var j=k.identity();j[0]=d;j[1]=a;j[4]=e;j[5]=f;j[12]=g;j[13]=h;return k.multiply(c,j,i)};a.setValues2D=function(c,d,a,e,f,g,h,i){var k=this;var j=k.identity();j[0]=d;j[1]=a;j[4]=e;j[5]=f;j[12]=g;j[13]=h;return k.multiply(c,j,i)};a.transformPointByIndex=function(c,d,e,f,g){f=f||new Float32Array(3);var h=d[e];var i=d[e+1];var j=d[e+2];var k=h*c[0*4+3]+i*c[1*4+3]+j*c[2*4+3]+c[3*4+3];f[g]=(h*c[0*4+0]+i*c[1*4+0]+j*c[2*4+0]+c[3*4+0])/k;f[g+1]=(h*c[0*4+1]+i*c[1*4+1]+j*c[2*4+1]+c[3*4+1])/k;f[g+2]=(h*c[0*4+2]+i*c[1*4+2]+j*c[2*4+2]+c[3*4+2])/k;return f};a.clearPosition=function(c){c[12]=0;c[13]=0;c[14]=0};a.perspective=function(c,d,e,f,g){var h=e*c;var i=h*d;var j=i*2,a=h*2,k=f-e;g[0]=e*2/j;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=e*2/a;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-(f+e)/k;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(f*e*2)/k;g[15]=0;return g};a.determinant=function(c){var d=c[0],e=c[4],f=c[8],g=c[12];var h=c[1],i=c[5],j=c[9],k=c[13];var l=c[2],m=c[6],n=c[10],o=c[14];var p=c[3],q=c[7],r=c[11],s=c[15];return (p*(+g*j*m-f*k*m-g*i*n+e*k*n+f*i*o-e*j*o)+q*(+d*j*o-d*k*n+g*h*n-f*h*o+f*k*l-g*j*l)+r*(+d*k*m-d*i*o-g*h*m+e*h*o+g*i*l-e*k*l)+s*(-f*i*l-d*j*m+d*i*n+f*h*m-e*h*n+e*j*l))};a.decompose=function(c,d,e,f){var z=this;var g=f;var h=_.XYZLength(g[0],g[1],g[2]);var i=_.XYZLength(g[4],g[5],g[6]);var j=_.XYZLength(g[8],g[9],g[10]);var k=$.determinant(g);if(k<0)h=-h;_.set(c,g[12],g[13],g[14]);var l=1/h;var m=1/i;var n=1/j;var o=g[0]*l,p=g[4]*m,q=g[8]*n,r=g[1]*l,s=g[5]*m,t=g[9]*n,u=g[2]*l,v=g[6]*m,w=g[10]*n;var x=o+s+w;var y;if(x>0){y=0.5/Math.sqrt(x+1.0);_.set(d,(v-t)*y,(q-u)*y,(r-p)*y)}else if(o>s&&o>w){y=2.0*Math.sqrt(1.0+o-s-w);_.set(d,0.25*y,(p+r)*y,(q+u)*y)}else if(s>w){y=2.0*Math.sqrt(1.0+s-o-w);_.set(d,(p+r)/y,0.25*y,(t+v)*y)}else{y=2.0*Math.sqrt(1.0+w-o-s);z._x=(q+u)/y;z._y=(t+v)/y;z._z=0.25*y;_.set(d,(q+u)/y,(t+v)/y,0.25*y)}_.set(e,h,i,j)};a.traceDecompose=function(c){var g=this;var d=_.create();var e=_.create();var f=_.create();g.decompose(d,e,f,c);trace("position:"+d.toString());trace("rotation:"+e.toString());trace("scale:"+f.toString())};kisgame.Matrix3D=$}());(function(){var _=kisgame.GeomUtils;var $=Math.PI/180;var a=Math.PI*2;var b=kisgame.Matrix3D;function c(e){var f=this;f.globalAlpha=1;f.target=e;f.lineWidth=1;f.fillStyle='#fff';f.strokeStyle='#000';f.textAlign="left";f.textBaseline="top";f.matrix3d=kisgame.Matrix3D.identity();f.store_arr=[];f.camera_arr=[];f.light_arr=[];f.curCamera=null;f.path_arr=[];f.path=[]}var d=c.prototype;d.reset=function(e){var f=this;f.globalAlpha=1;f.fillStyle='#fff';f.strokeStyle='#000';var g=f.path_arr;var h=g.length;for(var i=0;i<h;i++){g[i].splice(0)}g.splice(0);g=f.store_arr;var h=g.length;for(var i=0;i<h;i++){var j=g[i];for(var k in j){delete j[k]}}g.splice(0);g=f.camera_arr;g.splice(0);g=f.light_arr;g.splice(0);f.curCamera=null;if(e){kisgame.Matrix3D.copy(e,f.matrix3d)}else{kisgame.Matrix3D.identity(f.matrix3d)}};d.transform=function(e,d,f,g,h,i){var j=this;b.append2D(j.matrix3d,e,d,f,g,h,i,j.matrix3d)};d.setTransform=function(e,d,f,g,h,i){var j=this;b.setValues2D(j.matrix3d,e,d,f,g,h,i,j.matrix3d)};d.getTransform=function(){var e=this;return b.copy(e.matrix3d)};d.scale=function(e,d){var f=this;b.scale(f.matrix3d,e,d,1,f.matrix3d)};d.rotate=function(e){var f=this;b.zRotate(f.matrix3d,e,f.matrix3d)};d.translate=function(e,f){var g=this;b.translate(g.matrix3d,e,f,0,g.matrix3d)};d.save=function(){var f=this;var e=f.matrix3d;f.store_arr.push({matrix:e,alpha:f.globalAlpha});f.matrix3d=b.copy(e)};d.setCamera=function(e,f){var g=this;e.refreshMVPMatrix();g.curCamera=e;g.target.setCamera(e,f)};d.setLights=function(e){var i=this;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(i.light_arr.indexOf(h)==-1){i.light_arr.push(h)}}i.target.setLights(i.light_arr)};d.removeLights=function(e){var i=this;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(i.light_arr.indexOf(h)!=-1){i.light_arr.splice(g,1)}}};d.restore=function(){var f=this;var e=f.store_arr;if(e.length){var g=e.pop();f.matrix3d=g.matrix;f.globalAlpha=g.alpha||1;if(g.scissor){f.target.scissorRect(g.scissor.original)}else if(g.clip){f.target.stopMask();f.globalAlpha=g.calpha}}};d.getTransformRect=function(e,f){var g=f[0],d=f[1],h=f[4],i=f[5],j=f[12],k=f[13];var l=e.length;var m,y1;var n,b1;for(var o=0;o<l;o+=4){var p=e[o];var q=e[o+1];if(o==0){m=p*g+q*h+j;y1=p*d+q*i+k}else{n=p*g+q*h+j;b1=p*d+q*i+k}}return {x:m,y:y1,r:n,b:b1}};d.clip=function(){var f=this;var e=f.path_arr;var g=e.length;if(g==0){return}else if(g==1&&e[0].length==0){return}var h=f.store_arr;if(!h.length){f.save()}h=f.store_arr;var i=h.length;var j=h[i-1];if(g==1&&e[0].rect){var k=f.getTransformRect(e[0],f.matrix3d);var l=[k.x,k.y,k.r-k.x,k.b-k.y];for(var m=i-2;m>=0;m--){var n=h[m];if(n.scissor){var o=n.scissor.box;if(k.r<o.x||k.x>o.r||k.y>o.b||k.b<o.y){l[2]=0;l[3]=0;break}else{if(k.x<o.x){k.x=o.x}if(k.r>o.r){k.r=o.r}if(k.y<o.y){k.y=o.y}if(k.b>o.b){k.b=o.b}}}}if(l[2]!=0&&l[3]!=0){l[0]=k.x;l[1]=k.y;l[2]=k.r-k.x;l[3]=k.b-k.y}j.scissor={box:k};j.scissor.original=f.target.scissorRect(l,true)}else{j.calpha=f.globalAlpha;j.clip=1;f.target.startMask(e,f.matrix3d,f.globalAlpha)}f.beginPath()};d.createPattern=function(e,f){var h=this;var g=h.target.graphics_2d_ctx.createPattern(e,f);g.type=1;g.image=e;g.repeat=f;return g};d.createLinearGradient=function(e,f,g,h){var n=this;var i=g-e;var j=h-f;var k=parseInt(Math.sqrt(i*i+j*j));var l=Math.atan2(j,i);var m=n.target.graphics_2d_ctx.createLinearGradient(e,f,g,h);m.ori_addColorStop=m.addColorStop;m.type=2;m.x=e;m.y=f;m.width=k;m.height=2;m.r=l;m.x1=g;m.y1=h;m.addColorStop=n.addColorStop;m.colors=[];return m};d.addColorStop=function(e,f){var g=this;g.colors.push(e,f);g.ori_addColorStop(e,f)};d.createRadialGradient=function(e,f,g,h,i,j){var p=this;var k=e-g;if(h-j<k){k=h-j}var l=f-g;if(i-j<l){l=i-j}var m=e+g;if(h+j>m){m=h+j}var n=f+g;if(i+j>n){n=i+j}var o=p.target.graphics_2d_ctx.createRadialGradient(e,f,g,h,i,j);o.ori_addColorStop=o.addColorStop;o.type=3;o.x=k;o.y=l;o.width=m-k;o.height=n-l;o.x0=e-k;o.y0=f-l;o.r0=g;o.x1=h-k;o.y1=i-l;o.r1=j;o.addColorStop=p.addColorStop;o.colors=[];return o};d.drawImage=function(e,f,g,h,i,j,k,l,m){var n=this;if(j==undefined&&k==undefined&&l==undefined&&m==undefined){j=f;k=g;f=0;g=0;l=h;m=i}if(f==undefined||g==undefined){f=g=0}if(h==undefined||i==undefined){h=e.width;i=e.height}if(j==undefined||k==undefined){j=f;k=g}if(l==undefined||m==undefined){l=e.width;m=e.height}n.target.drawImage(e,n.matrix3d,n.globalAlpha,f,g,h,i,j,k,l,m,"")};d.rect=function(e,f,g,h){var j=this;var i=[e,f,e+g,f,e+g,f+h,e,f+h];i.rect=1;i.matrix=j.matrix3d;j.path_arr.push(i)};d.clearRect=function(e,f,g,h){var j=this;var i=j.getTransformRect([e,f,0,0,e+g,f+h,0,0],j.matrix3d);j.target.clearRect(i.x,i.y,i.r-i.x,i.b-i.y)};d.measureText=function(e){var f=this;return f.target.measureText(f.font,e)};d.strokeText=function(e,f,g,h){var i=this;i.target.fillText(e,f,g,h,i.font,i.textAlign,i.textBaseline,i.fillStyle,i.matrix3d,i.globalAlpha)};d.fillText=function(e,f,g,h){var i=this;i.target.fillText(e,f,g,h,i.font,i.textAlign,i.textBaseline,i.fillStyle,i.matrix3d,i.globalAlpha)};d.fill=function(){var f=this;var e=f.fillStyle;var g=f.globalAlpha;if(e.type==1){}else if(e.type==2){}else if(e.type==3){}else{e=kisgame.ColorUtils.str2Color(e);g*=kisgame.ColorUtils.alpha}f.target.fillPath(f.path_arr,e,f.matrix3d,g)};d.fillRect=function(e,f,g,h){var k=this;var i=[e,f,e+g,f,e+g,f+h,e,f+h];var j=k.fillStyle;var l=k.globalAlpha;j=kisgame.ColorUtils.str2Color(j);l*=kisgame.ColorUtils.alpha;k.target.fillPath([i],j,k.matrix3d,l)};d.stroke=function(){var f=this;var e=f.strokeStyle;var g=f.globalAlpha;e=kisgame.ColorUtils.str2Color(e);g*=kisgame.ColorUtils.alpha;f.target.drawPath(f.path_arr,e,f.matrix3d,g,f.lineWidth)};d.beginPath=function(){var e=this;e.path_arr.splice(0)};d.closePath=function(){var f=this;var e=f.path_arr;if(e.length){var g=e[e.length-1];if(g.length>1)g.push(g[0],g[1])}};d.isPointInPath=function(e,f){};d.getEndPath=function(){var f=this;var e=f.path_arr;if(e.length){return e[e.length-1]}var g=[];g.matrix=f.matrix3d;e.push(g);return g};d.moveTo=function(e,f){var h=this;var g=h.path_arr;var i=[e,f];i.matrix=h.matrix3d;g.push(i)};d.lineTo=function(e,f){var h=this;var g=h.getEndPath();g.push(e,f)};d.arc=function(e,f,g,h,i,j){var l=this;var k=l.getEndPath();var m=$;var n=a;h=h||0;i=i||n;var o=h%n,p=i;if(p!=n)p=p%n;if(j){p-=n;m=-m}var q=o;var r=true;while(r){if(m>0){if(q>=p){q=p;r=false}}else{if(q<=p){q=p;r=false}}var s=e+g*Math.cos(q);var t=f+g*Math.sin(q);k.push(s,t);q+=m}};d.arcTo=function(e,f,g,h,i){var k=this;var j=k.getEndPath();var l={x:0,y:0},m={x:e,y:f},n={x:g,y:h},o={x:0,y:0};if(j.length){l.x=j[j.length-2];l.y=j[j.length-1]}var p=Math.PI;var q=_.get3PRandian(m,l,n)/2;var d=p/2-q;var r=p/2;var s=i;var t=s/Math.cos(d);var u=t*Math.cos(q);var v=_.normalize;var w=l.x-m.x;var x=l.y-m.y;var y=v(w,x,u);var z=y.x+m.x;var A=y.y+m.y;var B=n.x-m.x;var C=n.y-m.y;var D=v(B,C,u);var E=D.x+m.x;var F=D.y+m.y;var G=z+(E-z)/2;var H=A+(F-A)/2;var I=v(G-m.x,H-m.y,t);o.x=I.x+m.x;o.y=I.y+m.y;var J=Math.atan2(A-o.y,z-o.x);var K=Math.atan2(F-o.y,E-o.x);var L;if(J>K){L=J;J=K;K=L}if(K-J>p){L=J;J=K-a;K=L}var M=$;for(var N=J;N<=K;N+=M){var e=o.x+s*Math.cos(N);var f=o.y+s*Math.sin(N);j.push(e,f)}};d.bezierCurveTo=function(e,f,g,h,i,j){var l=this;var k=l.getEndPath();var m=0,n=0;if(k.length){m=k[k.length-2];n=k[k.length-1]}var o=_.get2PR;var p=(o(m,n,e,f)+o(e,f,g,h)+o(g,h,i,j))/5;var q=1.0/p;for(var r=0;r<p;r++){var s=r*q;var t,bx,cx,ay,by,cy;var u,ttt;cx=3.0*(e-m);bx=3.0*(g-e)-cx;t=i-m-cx-bx;cy=3.0*(f-n);by=3.0*(h-f)-cy;ay=j-n-cy-by;u=s*s;ttt=u*s;var v=(t*ttt)+(bx*u)+(cx*s)+m;var w=(ay*ttt)+(by*u)+(cy*s)+n;k.push(v,w)}};d.quadraticCurveTo=function(e,f,g,h){var j=this;var i=j.getEndPath();var k=0,l=0;if(i.length){k=i[i.length-2];l=i[i.length-1]}var m=_.get2PR;var n=(m(k,l,e,f)+m(e,f,g,h))/5;var o=1.0/n;for(var p=0;p<n;p++){var q=p*o;var r,bx,cx,ay,by,cy;var s;cx=2.0*(e-k);bx=g-k-cx;cy=2.0*(f-l);by=h-l-cy;s=q*q;var t=(bx*s)+(cx*q)+k;var u=(by*s)+(cy*q)+l;i.push(t,u)}};d.appendMatrix3D=function(e){var f=this;b.multiply(f.matrix3d,e,f.matrix3d)};d.drawMergeGeometry=function(e,f){var g=this;g.target.drawMergeGeometry(e,f,g.matrix3d,g.globalAlpha,g.curCamera)};d.drawGeometry=function(e,f){var g=this;g.target.drawGeometry(e,f,g.matrix3d,g.globalAlpha,g.curCamera)};kisgame.SimulateDrawer=c}());var HitTestUtils=(function(){function _(){}_.hitTestPoints=function($,a,b){if(b){if(_.checkInside($,a)){return true}else if(_.checkInside(a,$)){return true}}var c=$.length;var d=a.length;var e=[];for(var f=0;f<d-1;f++){var g=a[f].x;var h=a[f].y;var i=a[f+1].x;var j=a[f+1].y;var k=new Object();if(i==g){k.k=NaN;k.b=g}else{k.k=(j-h)/(i-g);k.b=h-k.k*g}if(g>i){var l=g;g=i;i=l}if(h>j){l=h;h=j;j=l}k.x1=g;k.x2=i;k.y1=h;k.y2=j;e.push(k)}d=e.length;for(f=0;f<c-1;f++){g=$[f].x;h=$[f].y;i=$[f+1].x;j=$[f+1].y;if(i==g){var m=NaN;var n=g}else{m=(j-h)/(i-g);n=h-m*g}if(g>i){l=g;g=i;i=l}if(h>j){l=h;h=j;j=l}for(var o=0;o<d;o++){k=e[o];if(i<k.x1||k.x2<g){continue}if(j<k.y1||k.y2<h){continue}if(m==k.k||(isNaN(m)&&isNaN(k.k))){if(n==k.b){trace("重合");if(isNaN(m)){if(j<k.y1||k.y2<h){continue}var p=h;if(p<k.y1){p=k.y1}var q=j;if(q>k.y2){q=k.y2}return true}else{if(i<k.x1||k.x2<g){continue}p=g;if(p<k.x1){p=k.x1}q=i;if(q>k.x2){q=k.x2}return true}}}else{if(isNaN(m)){var r=n;var s=k.k*n+k.b}else if(isNaN(k.k)){r=k.b;s=m*k.b+n}else{r=(k.b-n)/(m-k.k);s=(k.k*n-m*k.b)/(k.k-m)}if(r-g<-0.01||r-k.x1<-0.01||r-i>0.01||r-k.x2>0.01||s-h<-0.01||s-k.y1<-0.01||s-j>0.01||s-k.y2>0.01){continue}return true}}}return false};_.checkInside=function($,a){var b=$.length;for(var c=0;c<b-1;c++){if(!_.isPointInside($[c].x,$[c].y,a)){return false}}return true};_.isPointInside=function($,a,b){var c,Y1,X2,Y2,X3,Y3,r1,min_l;var d=b.length;for(var e=0;e<d-1;e++){var f=b[e].x;var g=b[e].y;var h=b[e+1].x;var i=b[e+1].y;if(h==f){var j=NaN;var k=h}else{j=(i-g)/(h-f);k=g-j*f}var l=i-g;var m=h-f;if(m==0){if(l<0){n=Math.PI*3/2}else{n=Math.PI/2}}else{var n=Math.atan(l/m);n=m>=0?l<0?n+Math.PI*2:n:n+Math.PI}var o=$+10*Math.cos(n-Math.PI/2);var p=a+10*Math.sin(n-Math.PI/2);if(o==$){var q=NaN;var r=o}else{q=(p-a)/(o-$);r=a-q*$}var s,y4;var t=false;if((j==q)||(isNaN(j)&&isNaN(q))){if(k==r){}}else if(isNaN(j)){s=k;y4=q*s+r;t=true}else if(isNaN(q)){s=r;y4=j*s+k;t=true}else{s=(r-k)/(j-q);y4=(q*k-j*r)/(q-j);t=true}if(t){var u=Math.sqrt((y4-a)*(y4-a)+(s-$)*(s-$));if(isNaN(min_l)||u<min_l){min_l=u;r1=n;c=f;Y1=g;X2=h;Y2=i;X3=s;Y3=y4}}}if(!isNaN(min_l)){l=a-Y1;m=$-c;if(m==0){if(l<0){v=Math.PI*3/2}else{v=Math.PI/2}}else{var v=Math.atan(l/m);v=m>=0?l<0?v+Math.PI*2:v:v+Math.PI}var w=v-r1;if(w<0){w+=Math.PI*2}if(w>Math.PI){return false}var x=c<X2?c:X2;var y=c>X2?c:X2;var z=Y1<Y2?Y1:Y2;var A=Y1>Y2?Y1:Y2;if(X3-x<-0.01||X3-y>0.01||Y3-z<-0.01||Y3-A>0.01){return false}return true}return false};return _})();(function(){"use strict";function _(){throw "Touch cannot be instantiated"}_.isSupported=function(){return !!(('ontouchstart' in window)||(window.navigator['msPointerEnabled']&&window.navigator['msMaxTouchPoints']>0)||(window.navigator['pointerEnabled']&&window.navigator['maxTouchPoints']>0))};_.enable=function($,a,b){if(!$||!$.canvas||!_.isSupported()){return false}if($.__touch){return true}$.__touch={pointers:{},multitouch:!a,preventDefault:!b,count:0};if('ontouchstart' in window){_._IOS_enable($)}else if(window.navigator['msPointerEnabled']||window.navigator["pointerEnabled"]){_._IE_enable($)}return true};_.disable=function($){if(!$){return}if('ontouchstart' in window){_._IOS_disable($)}else if(window.navigator['msPointerEnabled']||window.navigator["pointerEnabled"]){_._IE_disable($)}delete $.__touch};_._IOS_enable=function($){var a=$.canvas;var b=$.__touch.f=function(c){_._IOS_handleEvent($,c)};a.addEventListener("touchstart",b,false);a.addEventListener("touchmove",b,false);a.addEventListener("touchend",b,false);a.addEventListener("touchcancel",b,false)};_._IOS_disable=function($){var a=$.canvas;if(!a){return}var b=$.__touch.f;a.removeEventListener("touchstart",b,false);a.removeEventListener("touchmove",b,false);a.removeEventListener("touchend",b,false);a.removeEventListener("touchcancel",b,false)};_._IOS_handleEvent=function($,a){var h=this;if(!$){return}if($.__touch.preventDefault){a.preventDefault&&a.preventDefault()}var b=a.changedTouches;var c=a.type;for(var d=0,e=b.length;d<e;d++){var f=b[d];var g=f.identifier;if(f.target!=$.canvas){continue}if(c=="touchstart"){h._handleStart($,g,a,f.pageX,f.pageY)}else if(c=="touchmove"){h._handleMove($,g,a,f.pageX,f.pageY)}else if(c=="touchend"||c=="touchcancel"){h._handleEnd($,g,a)}}};_._IE_enable=function($){var a=$.canvas;var b=$.__touch.f=function(c){_._IE_handleEvent($,c)};if(window.navigator["pointerEnabled"]===undefined){a.addEventListener("MSPointerDown",b,false);window.addEventListener("MSPointerMove",b,false);window.addEventListener("MSPointerUp",b,false);window.addEventListener("MSPointerCancel",b,false);if($.__touch.preventDefault){a.style.msTouchAction="none"}}else{a.addEventListener("pointerdown",b,false);window.addEventListener("pointermove",b,false);window.addEventListener("pointerup",b,false);window.addEventListener("pointercancel",b,false);if($.__touch.preventDefault){a.style.touchAction="none"}}$.__touch.activeIDs={}};_._IE_disable=function($){var a=$.__touch.f;if(window.navigator["pointerEnabled"]===undefined){window.removeEventListener("MSPointerMove",a,false);window.removeEventListener("MSPointerUp",a,false);window.removeEventListener("MSPointerCancel",a,false);if($.canvas){$.canvas.removeEventListener("MSPointerDown",a,false)}}else{window.removeEventListener("pointermove",a,false);window.removeEventListener("pointerup",a,false);window.removeEventListener("pointercancel",a,false);if($.canvas){$.canvas.removeEventListener("pointerdown",a,false)}}};_._IE_handleEvent=function($,a){var e=this;if(!$){return}if($.__touch.preventDefault){a.preventDefault&&a.preventDefault()}var b=a.type;var c=a.pointerId;var d=$.__touch.activeIDs;if(b=="MSPointerDown"||b=="pointerdown"){if(a.srcElement!=$.canvas){return}d[c]=true;e._handleStart($,c,a,a.pageX,a.pageY)}else if(d[c]){if(b=="MSPointerMove"||b=="pointermove"){e._handleMove($,c,a,a.pageX,a.pageY)}else if(b=="MSPointerUp"||b=="MSPointerCancel"||b=="pointerup"||b=="pointercancel"){delete (d[c]);e._handleEnd($,c,a)}}};_._handleStart=function($,a,b,c,d){var e=$.__touch;if(!e.multitouch&&e.count){return}var f=e.pointers;if(f[a]){return}f[a]=true;e.count++;$._handlePointerDown(a,b,c,d)};_._handleMove=function($,a,b,c,d){if(!$.__touch.pointers[a]){return}$._handlePointerMove(a,b,c,d)};_._handleEnd=function($,a,b){var c=$.__touch;var d=c.pointers;if(!d[a]){return}c.count--;$._handlePointerUp(a,b,true);delete (d[a])};kisgame.Touch=_}());;(function(){var _=kisgame.GeomUtils;var $=Math.PI/180;var a=Math.PI*2;function b(){}var c=b.prototype;c.reset=function(){var d=this;d.reseted=true;d.lineWidth=1;d.minX=0;d.maxX=0;d.minY=0;d.maxY=0;d.m_p_x=0;d.m_p_y=0;d.offset=0};c.checkRectSize=function(){var h=this;var d=arguments.length;for(var e=0;e<d;e+=2){var f=arguments[e];var g=arguments[e+1];if(e==0&&h.reseted){h.minX=f;h.maxX=f;h.minY=g;h.maxY=g;h.reseted=false}if(f<h.minX){h.minX=f-h.offset}else if(f>h.maxX){h.maxX=f+h.offset}if(g<h.minY){h.minY=g-h.offset}else if(g>h.maxY){h.maxY=g+h.offset}}};c.transform=function(d,c,e,f,g,h){};c.setTransform=function(d,c,e,f,g,h){};c.scale=function(d,c){};c.rotate=function(d){};c.translate=function(d,e){};c.save=function(){};c.restore=function(){};c.clip=function(){};c.createPattern=function(d,e){};c.createLinearGradient=function(d,e,f,g){};c.createRadialGradient=function(d,e,f,g,h,i){};c.drawImage=function(d,e,f,g,h,i,j,k,l){};c.rect=function(d,e,f,g){var h=this;h.checkRectSize(d,e,d+f,e,d+f,e+g,d,e+g)};c.clearRect=function(d,e,f,g){};c.fillText=function(d,e,f,g){};c.fillRect=function(d,e,f,g){var h=this;h.checkRectSize(d,e,d+f,e,d+f,e+g,d,e+g)};c.fill=function(){var d=this;d.offset=0};c.stroke=function(){var d=this;d.offset=d.lineWidth+1};c.beginPath=function(){};c.closePath=function(){};c.isPointInPath=function(d,e){};c.moveTo=function(d,e){var f=this;f.m_p_x=d;f.m_p_y=e};c.lineTo=function(d,e){var f=this;f.checkRectSize(f.m_p_x,f.m_p_y,d,e);f.m_p_x=d;f.m_p_y=e};c.arc=function(d,e,f,g,h,i){var r=this;var j=$;var k=a;g=g||0;h=h||k;var l=g%k,m=h;if(m!=k)m=m%k;if(i){m-=k;j=-j}var n=l;var o=true;while(o){if(j>0){if(n>=m){n=m;o=false}}else{if(n<=m){n=m;o=false}}var p=d+f*Math.cos(n);var q=e+f*Math.sin(n);r.checkRectSize(p,q);r.m_p_x=p;r.m_p_y=q;n+=j}};c.arcTo=function(d,e,f,g,h){var j=this;var i={x:j.m_p_x,y:j.m_p_y},k={x:d,y:e},l={x:f,y:g},m={x:0,y:0};var n=Math.PI;var o=_.get3PRandian(k,i,l)/2;var c=n/2-o;var p=n/2;var q=h;var r=q/Math.cos(c);var s=r*Math.cos(o);var t=_.normalize;var u=i.x-k.x;var v=i.y-k.y;var w=t(u,v,s);var x=w.x+k.x;var y=w.y+k.y;var z=l.x-k.x;var A=l.y-k.y;var B=t(z,A,s);var C=B.x+k.x;var D=B.y+k.y;var E=x+(C-x)/2;var F=y+(D-y)/2;var G=t(E-k.x,F-k.y,r);m.x=G.x+k.x;m.y=G.y+k.y;var H=Math.atan2(y-m.y,x-m.x);var I=Math.atan2(D-m.y,C-m.x);var J;if(H>I){J=H;H=I;I=J}if(I-H>n){J=H;H=I-a;I=J}var K=$;for(var L=H;L<=I;L+=K){var d=m.x+q*Math.cos(L);var e=m.y+q*Math.sin(L);j.checkRectSize(d,e);if(L==I){j.m_p_x=d;j.m_p_y=e}}};c.bezierCurveTo=function(d,e,f,g,h,i){var k=this;var j=k.m_p_x,l=k.m_p_y;var m=_.get2PR;var n=(m(j,l,d,e)+m(d,e,f,g)+m(f,g,h,i))/5;var o=1.0/n;for(var p=0;p<n;p++){var q=p*o;var r,bx,cx,ay,by,cy;var s,ttt;cx=3.0*(d-j);bx=3.0*(f-d)-cx;r=h-j-cx-bx;cy=3.0*(e-l);by=3.0*(g-e)-cy;ay=i-l-cy-by;s=q*q;ttt=s*q;var t=(r*ttt)+(bx*s)+(cx*q)+j;var u=(ay*ttt)+(by*s)+(cy*q)+l;k.checkRectSize(t,u);if(p==n-1){k.m_p_x=t;k.m_p_y=u}}};c.quadraticCurveTo=function(d,e,f,g){var i=this;var h=i.m_p_x,j=i.m_p_y;var k=_.get2PR;var l=(k(h,j,d,e)+k(d,e,f,g))/5;var m=1.0/l;for(var n=0;n<l;n++){var o=n*m;var p,bx,cx,ay,by,cy;var q;cx=2.0*(d-h);bx=f-h-cx;cy=2.0*(e-j);by=g-j-cy;q=o*o;var r=(bx*q)+(cx*o)+h;var s=(by*q)+(cy*o)+j;i.checkRectSize(r,s);if(n==l-1){i.m_p_x=r;i.m_p_y=s}}};kisgame.SimulateGraphics=b}());(function(){"use strict";function _(){throw "Ease cannot be instantiated."}_.linear=function($){return $};_.none=_.linear;_.get=function($){if($<-1){$=-1}if($>1){$=1}return function(a){if($==0){return a}if($<0){return a*(a*-$+1+$)}return a*((2-a)*$+(1-$))}};_.getPowIn=function($){return function(a){return Math.pow(a,$)}};_.getPowOut=function($){return function(a){return 1-Math.pow(1-a,$)}};_.getPowInOut=function($){return function(a){if((a*=2)<1)return 0.5*Math.pow(a,$);return 1-0.5*Math.abs(Math.pow(2-a,$))}};_.quadIn=_.getPowIn(2);_.quadOut=_.getPowOut(2);_.quadInOut=_.getPowInOut(2);_.cubicIn=_.getPowIn(3);_.cubicOut=_.getPowOut(3);_.cubicInOut=_.getPowInOut(3);_.quartIn=_.getPowIn(4);_.quartOut=_.getPowOut(4);_.quartInOut=_.getPowInOut(4);_.quintIn=_.getPowIn(5);_.quintOut=_.getPowOut(5);_.quintInOut=_.getPowInOut(5);_.sineIn=function($){return 1-Math.cos($*Math.PI/2)};_.sineOut=function($){return Math.sin($*Math.PI/2)};_.sineInOut=function($){return -0.5*(Math.cos(Math.PI*$)-1)};_.getBackIn=function($){return function(a){return a*a*(($+1)*a-$)}};_.backIn=_.getBackIn(1.7);_.getBackOut=function($){return function(a){return (--a*a*(($+1)*a+$)+1)}};_.backOut=_.getBackOut(1.7);_.getBackInOut=function($){$*=1.525;return function(a){if((a*=2)<1)return 0.5*(a*a*(($+1)*a-$));return 0.5*((a-=2)*a*(($+1)*a+$)+2)}};_.backInOut=_.getBackInOut(1.7);_.circIn=function($){return -(Math.sqrt(1-$*$)-1)};_.circOut=function($){return Math.sqrt(1-(--$)*$)};_.circInOut=function($){if(($*=2)<1)return -0.5*(Math.sqrt(1-$*$)-1);return 0.5*(Math.sqrt(1-($-=2)*$)+1)};_.bounceIn=function($){return 1-_.bounceOut(1-$)};_.bounceOut=function($){if($<1/2.75){return (7.5625*$*$)}else if($<2/2.75){return (7.5625*($-=1.5/2.75)*$+0.75)}else if($<2.5/2.75){return (7.5625*($-=2.25/2.75)*$+0.9375)}else{return (7.5625*($-=2.625/2.75)*$+0.984375)}};_.bounceInOut=function($){if($<0.5)return _.bounceIn($*2)*.5;return _.bounceOut($*2-1)*0.5+0.5};_.getElasticIn=function($,a){var b=Math.PI*2;return function(c){if(c==0||c==1)return c;var d=a/b*Math.asin(1/$);return -($*Math.pow(2,10*(c-=1))*Math.sin((c-d)*b/a))}};_.elasticIn=_.getElasticIn(1,0.3);_.getElasticOut=function($,a){var b=Math.PI*2;return function(c){if(c==0||c==1)return c;var d=a/b*Math.asin(1/$);return ($*Math.pow(2,-10*c)*Math.sin((c-d)*b/a)+1)}};_.elasticOut=_.getElasticOut(1,0.3);_.getElasticInOut=function($,a){var b=Math.PI*2;return function(c){var d=a/b*Math.asin(1/$);if((c*=2)<1)return -0.5*($*Math.pow(2,10*(c-=1))*Math.sin((c-d)*b/a));return $*Math.pow(2,-10*(c-=1))*Math.sin((c-d)*b/a)*0.5+1}};_.elasticInOut=_.getElasticInOut(1,0.3*1.5);kisgame.Ease=_}());(function(){"use strict";function _(){throw ("MotionGuidePlugin cannot be instantiated.")}_.priority=0;_._rotOffS;_._rotOffE;_._rotNormS;_._rotNormE;_.install=function(){kisgame.Tween.installPlugin(_,["guide","x","y","rotation"]);return kisgame.Tween.IGNORE};_.init=function($,a,b){var c=$.target;if(!c.hasOwnProperty("x")){c.x=0}if(!c.hasOwnProperty("y")){c.y=0}if(!c.hasOwnProperty("rotation")){c.rotation=0}if(a=="rotation"){$.__needsRot=true}return a=="guide"?null:b};_.step=function($,a,b,c,d){if(a=="rotation"){$.__rotGlobalS=b;$.__rotGlobalE=c;_.testRotData($,d)}if(a!="guide"){return c}var e,f=c;if(!f.hasOwnProperty("path")){f.path=[]}var g=f.path;if(!f.hasOwnProperty("end")){f.end=1}if(!f.hasOwnProperty("start")){f.start=(b&&b.hasOwnProperty("end")&&b.path===g)?b.end:0}if(f.hasOwnProperty("_segments")&&f._length){return c}var h=g.length;var i=10;if(h>=6&&(h-2)%4==0){f._segments=[];f._length=0;for(var j=2;j<h;j+=4){var k=g[j-2],l=g[j-1];var m=g[j+0],n=g[j+1];var o=g[j+2],p=g[j+3];var q=k,r=l;var s,tempY,t=0;var u=[];for(var v=1;v<=i;v++){var w=v/i;var x=1-w;s=x*x*k+2*x*w*m+w*w*o;tempY=x*x*l+2*x*w*n+w*w*p;t+=u[u.push(Math.sqrt((e=s-q)*e+(e=tempY-r)*e))-1];q=s;r=tempY}f._segments.push(t);f._segments.push(u);f._length+=t}}else{throw ("invalid 'path' data, please see documentation for valid paths")}e=f.orient;f.orient=true;var y={};_.calc(f,f.start,y);$.__rotPathS=Number(y.rotation.toFixed(5));_.calc(f,f.end,y);$.__rotPathE=Number(y.rotation.toFixed(5));f.orient=false;_.calc(f,f.end,d);f.orient=e;if(!f.orient){return c}$.__guideData=f;_.testRotData($,d);return c};_.testRotData=function($,a){if($.__rotGlobalS===undefined||$.__rotGlobalE===undefined){if($.__needsRot){return}if($._curQueueProps.rotation!==undefined){$.__rotGlobalS=$.__rotGlobalE=$._curQueueProps.rotation}else{$.__rotGlobalS=$.__rotGlobalE=a.rotation=$.target.rotation||0}}if($.__guideData===undefined){return}var b=$.__guideData;var c=$.__rotGlobalE-$.__rotGlobalS;var d=$.__rotPathE-$.__rotPathS;var e=c-d;if(b.orient=="auto"){if(e>180){e-=360}else if(e<-180){e+=360}}else if(b.orient=="cw"){while(e<0){e+=360}if(e==0&&c>0&&c!=180){e+=360}}else if(b.orient=="ccw"){e=c-((d>180)?(360-d):(d));while(e>0){e-=360}if(e==0&&c<0&&c!=-180){e-=360}}b.rotDelta=e;b.rotOffS=$.__rotGlobalS-$.__rotPathS;$.__rotGlobalS=$.__rotGlobalE=$.__guideData=$.__needsRot=undefined};_.tween=function($,a,b,c,d,e,f,g){var h=d.guide;if(h==undefined||h===c.guide){return b}if(h.lastRatio!=e){var i=((h.end-h.start)*(f?h.end:e)+h.start);_.calc(h,i,$.target);switch(h.orient){case "cw":case "ccw":case "auto":$.target.rotation+=h.rotOffS+h.rotDelta*e;break;case "fixed":default:$.target.rotation+=h.rotOffS;break}h.lastRatio=e}if(a=="rotation"&&((!h.orient)||h.orient=="false")){return b}return $.target[a]};_.calc=function($,a,b){if($._segments==undefined){throw ("Missing critical pre-calculated information, please file a bug")}if(b==undefined){b={x:0,y:0,rotation:0}}var c=$._segments;var d=$.path;var e=$._length*a;var f=c.length-2;var g=0;while(e>c[g]&&g<f){e-=c[g];g+=2}var h=c[g+1];var i=0;f=h.length-1;while(e>h[i]&&i<f){e-=h[i];i++}var j=(i/++f)+(e/(f*h[i]));g=(g*2)+2;var k=1-j;b.x=k*k*d[g-2]+2*k*j*d[g+0]+j*j*d[g+2];b.y=k*k*d[g-1]+2*k*j*d[g+1]+j*j*d[g+3];if($.orient){b.rotation=57.2957795*Math.atan2((d[g+1]-d[g-1])*k+(d[g+3]-d[g+1])*j,(d[g+0]-d[g-2])*k+(d[g+2]-d[g+0])*j)}return b};kisgame.MotionGuidePlugin=_}());(function(){"use strict";function _(){throw ("SamplePlugin cannot be instantiated.")}_.priority=0;_.install=function(){kisgame.Tween.installPlugin(_,["test"])};_.init=function($,a,b){console.log("init",a,b);return b};_.step=function($,a,b,c,d){console.log("to: ",a,b,c)};_.tween=function($,a,b,c,d,e,f,g){console.log("tween",a,b,e,f,g);return b};kisgame.SamplePlugin=_}());(function(){"use strict";function _(a,b,c){var d=this;d.EventDispatcher_constructor();d.ignoreGlobalPause=false;d.duration=0;d.loop=false;d.position=null;d._paused=false;d._tweens=[];d._labels=null;d._labelList=null;d._prevPosition=0;d._prevPos=-1;d._useTicks=false;d._registered=false;if(c){d._useTicks=c.useTicks;d.loop=c.loop;d.ignoreGlobalPause=c.ignoreGlobalPause;c.onChange&&d.addEventListener("change",c.onChange)}if(a){d.addTween.apply(d,a)}d.setLabels(b);if(c&&c.paused){d._paused=true}else{kisgame.Tween._register(d,true)}if(c&&c.position!=null){d.setPosition(c.position,kisgame.Tween.NONE)}}var $=kisgame.extend(_,kisgame.EventDispatcher);$.addTween=function(a){var d=this;var b=arguments.length;if(b>1){for(var c=0;c<b;c++){d.addTween(arguments[c])}return arguments[0]}else if(b==0){return null}d.removeTween(a);d._tweens.push(a);a.setPaused(true);a._paused=false;a._useTicks=d._useTicks;if(a.duration>d.duration){d.duration=a.duration}if(d._prevPos>=0){a.setPosition(d._prevPos,kisgame.Tween.NONE)}return a};$.removeTween=function(a){var e=this;var b=arguments.length;if(b>1){var c=true;for(var d=0;d<b;d++){c=c&&e.removeTween(arguments[d])}return c}else if(b==0){return false}var f=e._tweens;var d=f.length;while(d--){if(f[d]==a){f.splice(d,1);if(a.duration>=e.duration){e.updateDuration()}return true}}return false};$.addLabel=function(a,b){var c=this;c._labels[a]=b;var d=c._labelList;if(d){for(var e=0,f=d.length;e<f;e++){if(b<d[e].position){break}}d.splice(e,0,{label:a,position:b})}};$.setLabels=function(a){var b=this;b._labels=a?a:{}};$.getLabels=function(){var b=this;var a=b._labelList;if(!a){a=b._labelList=[];var c=b._labels;for(var d in c){a.push({label:d,position:c[d]})}a.sort(function(e,f){return e.position-f.position})}return a};$.getCurrentLabel=function(){var b=this;var a=b.getLabels();var c=b.position;var d=a.length;if(d){for(var e=0;e<d;e++){if(c<a[e].position){break}}return (e==0)?null:a[e-1].label}return null};$.gotoAndPlay=function(a){var b=this;b.setPaused(false);b._goto(a)};$.gotoAndStop=function(a){var b=this;b.setPaused(true);b._goto(a)};$.setPosition=function(a,b){var d=this;var c=d._calcPosition(a);var e=!d.loop&&a>=d.duration;if(c==d._prevPos){return e}d._prevPosition=a;d.position=d._prevPos=c;for(var f=0,g=d._tweens.length;f<g;f++){d._tweens[f].setPosition(c,b);if(c!=d._prevPos){return false}}if(e){d.setPaused(true)}d.dispatchEvent("change");return e};$.setPaused=function(a){var b=this;b._paused=!!a;kisgame.Tween._register(b,!a)};$.updateDuration=function(){var a=this;a.duration=0;for(var b=0,c=a._tweens.length;b<c;b++){var d=a._tweens[b];if(d.duration>a.duration){a.duration=d.duration}}};$.tick=function(a){var b=this;b.setPosition(b._prevPosition+a)};$.resolve=function(a){var c=this;var b=Number(a);if(isNaN(b)){b=c._labels[a]}return b};$.toString=function(){return "[Timeline]"};$.clone=function(){throw ("Timeline can not be cloned.")};$._goto=function(a){var c=this;var b=c.resolve(a);if(b!=null){c.setPosition(b)}};$._calcPosition=function(a){var b=this;if(a<0){return 0}if(a<b.duration){return a}return b.loop?a%b.duration:b.duration};kisgame.Timeline=kisgame.promote(_,"EventDispatcher")}());(function(){"use strict";function _(a,b,c){var d=this;d.ignoreGlobalPause=false;d.loop=false;d.duration=0;d.pluginData=c||{};d.target=a;d.position=null;d.passive=false;d._paused=false;d._curQueueProps={};d._initQueueProps={};d._steps=[];d._actions=[];d._prevPosition=0;d._stepPosition=0;d._prevPos=-1;d._target=a;d._useTicks=false;d._inited=false;d._registered=false;if(b){d._useTicks=b.useTicks;d.ignoreGlobalPause=b.ignoreGlobalPause;d.loop=b.loop;b.onChange&&d.addEventListener("change",b.onChange);if(b.override){_.removeTweens(a)}}if(b&&b.paused){d._paused=true}else{kisgame.Tween._register(d,true)}if(b&&b.position!=null){d.setPosition(b.position,_.NONE)}}var $=kisgame.extend(_,kisgame.EventDispatcher);_.NONE=0;_.LOOP=1;_.REVERSE=2;_.IGNORE={};_._tweens=[];_._plugins={};_.get=function(a,b,c,d){if(d){_.removeTweens(a)}return new _(a,b,c)};_.tick=function(a,b){var c=_._tweens.slice();for(var d=c.length-1;d>=0;d--){var e=c[d];if((b&&!e.ignoreGlobalPause)||e._paused){continue}e.tick(e._useTicks?1:a)}};_.handleEvent=function(a){var b=this;if(a.type=="tick"){b.tick(a.delta,a.paused)}};_.removeTweens=function(a){if(!a.tweenjs_count){return}var b=_._tweens;for(var c=b.length-1;c>=0;c--){var d=b[c];if(d._target==a){d._paused=true;b.splice(c,1)}}a.tweenjs_count=0};_.removeAllTweens=function(){var a=_._tweens;for(var b=0,c=a.length;b<c;b++){var d=a[b];d._paused=true;d.target&&(d.target.tweenjs_count=0)}a.length=0};_.hasActiveTweens=function(a){if(a){return a.tweenjs_count!=null&&!!a.tweenjs_count}return _._tweens&&!!_._tweens.length};_.installPlugin=function(a,b){var c=a.priority;if(c==null){a.priority=c=0}for(var d=0,e=b.length,$=_._plugins;d<e;d++){var f=b[d];if(!$[f]){$[f]=[a]}else{var g=$[f];for(var h=0,j=g.length;h<j;h++){if(c<g[h].priority){break}}$[f].splice(h,0,a)}}};_._register=function(a,b){var c=a._target;var d=_._tweens;if(b&&!a._registered){if(c){c.tweenjs_count=c.tweenjs_count?c.tweenjs_count+1:1}d.push(a);if(!_._inited&&kisgame.Ticker){kisgame.Ticker.addEventListener("tick",_);_._inited=true}}else if(!b&&a._registered){if(c){c.tweenjs_count--}var e=d.length;while(e--){if(d[e]==a){d.splice(e,1);break}}}a._registered=b};$.wait=function(a,b){var c=this;if(a==null||a<=0){return c}var d=c._cloneProps(c._curQueueProps);return c._addStep({d:a,p0:d,e:c._linearEase,p1:d,v:b})};$.to=function(a,b,c){var d=this;if(isNaN(b)||b<0){b=0}return d._addStep({d:b||0,p0:d._cloneProps(d._curQueueProps),e:c,p1:d._cloneProps(d._appendQueueProps(a))})};$.call=function(a,b,c){var d=this;return d._addAction({f:a,p:b?b:[d],o:c?c:d._target})};$.set=function(a,b){var c=this;return c._addAction({f:c._set,o:c,p:[a,b?b:c._target]})};$.play=function(a){var b=this;if(!a){a=b}return b.call(a.setPaused,[false],a)};$.pause=function(a){var b=this;if(!a){a=b}return b.call(a.setPaused,[true],a)};$.setPosition=function(a,b){var e=this;if(a<0){a=0}if(b==null){b=1}var c=a;var d=false;if(c>=e.duration){if(e.loop){c=c%e.duration}else{c=e.duration;d=true}}if(c==e._prevPos){return d}var f=e._prevPos;e.position=e._prevPos=c;e._prevPosition=a;if(e._target){if(d){e._updateTargetProps(null,1)}else if(e._steps.length>0){for(var g=0,h=e._steps.length;g<h;g++){if(e._steps[g].t>c){break}}var j=e._steps[g-1];e._updateTargetProps(j,(e._stepPosition=c-j.t)/j.d)}}if(b!=0&&e._actions.length>0){if(e._useTicks){e._runActions(c,c)}else if(b==1&&c<f){if(f!=e.duration){e._runActions(f,e.duration)}e._runActions(0,c,true)}else{e._runActions(f,c)}}if(d){e.setPaused(true)}e.dispatchEvent("change");return d};$.tick=function(a){var b=this;if(b._paused){return}b.setPosition(b._prevPosition+a)};$.setPaused=function(a){var b=this;if(b._paused===!!a){return b}b._paused=!!a;_._register(b,!a);return b};$.w=$.wait;$.t=$.to;$.c=$.call;$.s=$.set;$.toString=function(){return "[Tween]"};$.clone=function(){throw ("Tween can not be cloned.")};$._updateTargetProps=function(a,b){var d=this;var c,p1,v,v0,v1,arr;if(!a&&b==1){d.passive=false;c=p1=d._curQueueProps}else{d.passive=!!a.v;if(d.passive){return}if(a.e){b=a.e(b,0,1,1)}c=a.p0;p1=a.p1}for(var e in d._initQueueProps){if((v0=c[e])==null){c[e]=v0=d._initQueueProps[e]}if((v1=p1[e])==null){p1[e]=v1=v0}if(v0==v1||b==0||b==1||(typeof (v0)!="number")){v=b==1?v1:v0}else{v=v0+(v1-v0)*b}var f=false;if(arr=_._plugins[e]){for(var g=0,h=arr.length;g<h;g++){var j=arr[g].tween(d,e,v,c,p1,b,!!a&&c==p1,!a);if(j==_.IGNORE){f=true}else{v=j}}}if(!f){d._target[e]=v}}};$._runActions=function(a,b,c){var h=this;var d=a;var e=b;var f=-1;var g=h._actions.length;var j=1;if(a>b){d=b;e=a;f=g;g=j=-1}while((f+=j)!=g){var k=h._actions[f];var l=k.t;if(l==e||(l>d&&l<e)||(c&&l==a)){k.f.apply(k.o,k.p)}}};$._appendQueueProps=function(a){var d=this;var b,oldValue,i,e,injectProps;for(var c in a){if(d._initQueueProps[c]===undefined){oldValue=d._target[c];if(b=_._plugins[c]){for(i=0,e=b.length;i<e;i++){oldValue=b[i].init(d,c,oldValue)}}d._initQueueProps[c]=d._curQueueProps[c]=(oldValue===undefined)?null:oldValue}else{oldValue=d._curQueueProps[c]}}for(var c in a){oldValue=d._curQueueProps[c];if(b=_._plugins[c]){injectProps=injectProps||{};for(i=0,e=b.length;i<e;i++){if(b[i].step){b[i].step(d,c,oldValue,a[c],injectProps)}}}d._curQueueProps[c]=a[c]}if(injectProps){d._appendQueueProps(injectProps)}return d._curQueueProps};$._cloneProps=function(a){var b={};for(var c in a){b[c]=a[c]}return b};$._addStep=function(a){var b=this;if(a.d>0){b._steps.push(a);a.t=b.duration;b.duration+=a.d}return b};$._addAction=function(a){var b=this;a.t=b.duration;b._actions.push(a);return b};$._set=function(a,b){for(var c in a){b[c]=a[c]}};kisgame.Tween=kisgame.promote(_,"EventDispatcher")}());(function(){"use strict";function _(a,b,c,d,e){var f=this;f.setValues(a,b,c,d,e)}var $=_.prototype;$.setValues=function(a,b,c,d,e){var f=this;f.visible=a==null?true:!!a;f.alpha=b==null?1:b;f.shadow=c;f.compositeOperation=d;f.matrix=e||(f.matrix&&f.matrix.identity())||new kisgame.Matrix2D();return f};$.append=function(a,b,c,d,e){var f=this;f.alpha*=b;f.shadow=c||f.shadow;f.compositeOperation=d||f.compositeOperation;f.visible=f.visible&&a;e&&f.matrix.appendMatrix(e);return f};$.prepend=function(a,b,c,d,e){var f=this;f.alpha*=b;f.shadow=f.shadow||c;f.compositeOperation=f.compositeOperation||d;f.visible=f.visible&&a;e&&f.matrix.prependMatrix(e);return f};$.identity=function(){var a=this;a.visible=true;a.alpha=1;a.shadow=a.compositeOperation=null;a.matrix.identity();return a};$.clone=function(){var a=this;return new _(a.alpha,a.shadow,a.compositeOperation,a.visible,a.matrix.clone())};kisgame.DisplayProps=_}());(function(){"use strict";var _=kisgame.DirectionType;function $(){var d=this;d.EventDispatcher_constructor();d.cacheImage=null;d.cacheID=0;d.id=kisgame.UID.get();d.mouseEnabled=true;d.tickEnabled=true;d.name=null;d.regX=0;d.regY=0;d.skewX=0;d.skewY=0;d.shadow=null;d.visible=true;d.x=0;d.y=0;d.parent=null;d.rotation=0;d.scaleX=1;d.scaleY=1;d.alpha=1;d.transformMatrix=null;d.compositeOperation=null;d.snapToPixel=true;d.filters=null;d.mask=null;d.hitArea=null;d.cursor=null;d._cacheOffsetX=0;d._cacheOffsetY=0;d._filterOffsetX=0;d._filterOffsetY=0;d._cacheScale=1;d._cacheDataURLID=0;d._cacheDataURL=null;d._props=new kisgame.DisplayProps();d._rectangle=new kisgame.Rectangle();d._bounds=null}var a=kisgame.extend($,kisgame.EventDispatcher);$._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"];$.suppressCrossDomainErrors=false;$._snapToPixelEnabled=false;$._dragtable=new Array();var c=document.createElement("canvas");$._hitTestCanvas=c;$._hitTestContext=c.getContext("2d");c.width=c.height=1;$._nextCacheID=1;a._setRefObj=function(d){var e=this;e.stage=d?d.stage:null;e.root=d?d.root:null};if(kisgame.enableDirty){Object.defineProperties(a,{parent:{get:function(){var d=this;return d.kis_parent},set:function(d){var e=this;if(e.kis_parent!=d){e.invaliate();e.kis_parent=d}}},visible:{get:function(){var d=this;return d.kis_visible},set:function(d){var e=this;if(e.kis_visible!=d){e.invaliate();e.kis_visible=d}}},alpha:{get:function(){var d=this;return d.kis_alpha},set:function(d){var e=this;if(e.kis_alpha!=d){e.invaliate();e.kis_alpha=d}}},rotation:{get:function(){var d=this;return d.kis_rotation},set:function(d){var e=this;if(e.kis_rotation!=d){e.invaliate();e.kis_rotation=d}}},x:{get:function(){var d=this;return d.kis_x},set:function(d){var e=this;if(e.kis_x!=d){e.invaliate();e.kis_x=d}}},y:{get:function(){var d=this;return d.kis_y},set:function(d){var e=this;if(e.kis_y!=d){e.invaliate();e.kis_y=d}}},scaleX:{get:function(){var d=this;return d.kis_scaleX},set:function(d){var e=this;if(e.kis_scaleX!=d){e.invaliate();e.kis_scaleX=d}}},scaleY:{get:function(){var d=this;return d.kis_scaleY},set:function(d){var e=this;if(e.kis_scaleY!=d){e.invaliate();e.kis_scaleY=d}}},skewX:{get:function(){var d=this;return d.kis_skewX},set:function(d){var e=this;if(e.kis_skewX!=d){e.invaliate();e.kis_skewX=d}}},skewY:{get:function(){var d=this;return d.kis_skewY},set:function(d){var e=this;if(e.kis_skewY!=d){e.invaliate();e.kis_skewY=d}}}})}a.isVisible=function(){var d=this;if(d.destoryed)return false;var e=d.scrollRect;if(e&&(e.width<=0||e.height<=0)){return false}return !!(d.visible&&d.alpha>0&&d.scaleX!=0&&d.scaleY!=0)};a.draw=function(d,e){var g=this;var f=g.cacheImage;if(e||!f){return false}var h=g._cacheScale;if(f.width&&f.complete){d.drawImage(f,g._cacheOffsetX+g._filterOffsetX,g._cacheOffsetY+g._filterOffsetY,f.width/h,f.height/h)}return true};a.updateContext=function(d){var f=this;var e=f.scrollRect;var g=f,h=g.mask,i=g._props.matrix;if(h&&h.graphics&&!h.graphics.isEmpty()){h.getMatrix(i);d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);h.graphics.drawAsPath(d);d.clip();i.invert();d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}f.getMatrix(i);if(e){var j=i.tx,k=i.ty;if(kisgame.DisplayObject._snapToPixelEnabled&&g.snapToPixel){j=j+(j<0?-0.5:0.5)|0;k=k+(k<0?-0.5:0.5)|0;i.tx=j;i.ty=k}d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);d.beginPath();d.rect(0,0,e.width,e.height);d.clip();i.invert();d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}f.getMatrix(i);if(e){i.translate(-e.x,-e.y)}var j=i.tx,k=i.ty;if(kisgame.DisplayObject._snapToPixelEnabled&&g.snapToPixel){j=j+(j<0?-0.5:0.5)|0;k=k+(k<0?-0.5:0.5)|0}d.transform(i.a,i.b,i.c,i.d,j,k);d.globalAlpha*=g.alpha;if(g.compositeOperation){d.globalCompositeOperation=g.compositeOperation}if(g.shadow){f._applyShadow(d,g.shadow)}};a.cache=function(d,e,f,g,h){var i=this;h=h||1;i._cacheWidth=f;i._cacheHeight=g;i._cacheOffsetX=d;i._cacheOffsetY=e;i._cacheScale=h;i.updateCache()};a.updateCache=function(d){var g=this;var e=kisgame.cacheCanvas;var f=g._cacheScale,h=g._cacheOffsetX*f,i=g._cacheOffsetY*f;var j=g._cacheWidth,k=g._cacheHeight,l=e.getContext("2d");var m=g._getFilterBounds();h+=(g._filterOffsetX=m.x);i+=(g._filterOffsetY=m.y);j=Math.ceil(j*f)+m.width;k=Math.ceil(k*f)+m.height;if(j!=e.width||k!=e.height){e.width=j;e.height=k}l.clearRect(0,0,j+1,k+1);if(d){var n=g.cacheImage;if(n){l.drawImage(n,0,0)}}l.save();l.globalCompositeOperation=d;l.setTransform(f,0,0,f,-h,-i);g.draw(l,true);g._applyFilters(l,j,k);l.restore();var n=g.cacheImage;if(!n){n=g.cacheImage=new Image()}n.updateTextureOnce=true;n.width=j;n.height=k;n.src=e.toDataURL();g.cacheID=$._nextCacheID++};a.uncache=function(){var d=this;if(d.cacheImage){var e=d.cacheImage.__webgl_texture;if(e){e._sourceImage=null;d.cacheImage.__webgl_texture=null;e._webGLContext.deleteTexture(e);e._webGLContext=null}}d._cacheDataURL=d.cacheImage=null;d.cacheID=d._cacheOffsetX=d._cacheOffsetY=d._filterOffsetX=d._filterOffsetY=0;d._cacheScale=1};a.getCacheDataURL=function(){var d=this;if(!d.cacheImage){return null}if(d.cacheID!=d._cacheDataURLID){d._cacheDataURL=d.cacheImage.src}return d._cacheDataURL};a.localToGlobal=function(d,e,f,g){var i=this;var h=i.getConcatenatedMatrix();if(g){var j=[];var k=g.length;for(var l=0;l<k;l++){var m=g[l];j.push(h.transformPoint(m.x,m.y))}return j}else{return h.transformPoint(d,e,f||new kisgame.Point())}};a.globalToLocal=function(d,e,f,g){var i=this;var h=i.getConcatenatedMatrix().invert();if(g){var j=[];var k=g.length;for(var l=0;l<k;l++){var m=g[l];j.push(h.transformPoint(m.x,m.y))}return j}else{return h.transformPoint(d,e,f||new kisgame.Point())}};a.local2Target=function(d,e,f){var h=this;if(f){var g=h.getConcatenatedMatrix();var i=d.getConcatenatedMatrix().invert();g.prependMatrix(i);var j=[];var k=f.length;for(var l=0;l<k;l++){var m=f[l];j.push(g.transformPoint(m.x,m.y))}return j}else{if(!e){e={x:0,y:0}}var n=h.localToGlobal(e.x,e.y,e);return d.globalToLocal(n.x,n.y,e)}};a.localToLocal=function(d,e,f,g){var h=this;g=h.localToGlobal(d,e,g);return f.globalToLocal(g.x,g.y,g)};a.roundRegTransform=function(d,e,f,g,h,i){var k=this;var j=k,l=d&&d.identity()||new kisgame.Matrix2D();j.transformMatrix?l.copy(j.transformMatrix):l.appendTransform(j.x,j.y,j.scaleX,j.scaleY,j.rotation,j.skewX,j.skewY,h,i);l.rotate(g);l.scale(e,f);return m};a.setTransform=function(d,e,f,g,h,i,j,k,l){var m=this;m.x=d||0;m.y=e||0;m.scaleX=f==null?1:f;m.scaleY=g==null?1:g;m.rotation=h||0;m.skewX=i||0;m.skewY=j||0;m.regX=k||0;m.regY=l||0;return m};a.getMatrix=function(d){var f=this;var e=f,g=d&&d.identity()||new kisgame.Matrix2D();return e.transformMatrix?g.copy(e.transformMatrix):g.appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY)};a.getConcatenatedMatrix=function(d,e){var g=this;var f=g,h=g.getMatrix(d);var i=f.scrollRect;if(i){h.translate(-i.x,-i.y)}if(e){h=e.clone().prependMatrix(h)}while(f=f.parent){var i=f.scrollRect;if(i){h.translate(-i.x,-i.y)}h.prependMatrix(f.getMatrix(f._props.matrix))}return h};a.getConcatenatedDisplayProps=function(d){var f=this;d=d?d.identity():new kisgame.DisplayProps();var e=f,g=e.getMatrix(d.matrix);do{d.prepend(e.visible,e.alpha,e.shadow,e.compositeOperation);var h=e.scrollRect;if(h){g.translate(-h.x,-h.y)}if(e!=f){g.prependMatrix(e.getMatrix(e._props.matrix))}}while(e=e.parent);return d};a.hitTest=function(d,e){var g=this;var f=$._hitTestContext;f.setTransform(1,0,0,1,0,0);f.clearRect(0,0,2,2);f.setTransform(1,0,0,1,-d,-e);g.draw(f);var h=g._testHit(f);return h};a._hitTestSelf=function(d,e,f){var h=this;var g=h.hitArea;var i=h.getConcatenatedDisplayProps(h._props);var j=i.matrix;if(g){j.appendMatrix(g.getMatrix(g._props.matrix));i.alpha=g.alpha}d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,2,2);d.globalAlpha=i.alpha;d.setTransform(j.a,j.b,j.c,j.d,j.tx-e,j.ty-f);(g||h).draw(d);if(!h._testHit(d)){return false}return true};a.hitTestPoint=function(a,d){var e=this;if(d){return e.hitTest(a.x,a.y)}else{var f=e.hitAreaRectangle||e.getBounds();if(f.isFull){return true}else{var a=e.globalToLocal(a.x,a.y,a);if(f.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>f.radius){return false}else if(a.x<f.x||a.y<f.y||a.x>f.x+f.width||a.y>f.y+f.height){return false}}}return true};a.hitTestObject=function(d){var h=this;var e=d.hitAreaRectangle||d.getBounds();var f=d.localToGlobal(0,0,null,[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]);var g=h.hitAreaRectangle||h.getBounds();var i=h.localToGlobal(0,0,null,[{x:g.x,y:g.y},{x:g.x+g.width,y:g.y},{x:g.x+g.width,y:g.y+g.height},{x:g.x,y:g.y+g.height}]);f.push(f[0]);i.push(i[0]);return HitTestUtils.hitTestPoints(f,i,true)};a.set=function(d){var f=this;for(var e in d){f[e]=d[e]}return f};a.getBounds=function(d,e,f){var g=this;if(g._bounds){return g._rectangle.copy(g._bounds)}var h=g.cacheImage;if(h){var i=g._cacheScale;return g._rectangle.setValues(g._cacheOffsetX,g._cacheOffsetY,h.width/i,h.height/i)}return null};a.getBorderBounds=function(d){var e=this;return e.getBounds(d,true,true)};a.getSizeBounds=function(d){var e=this;return e.getBounds(d,true,false)};a.setBounds=function(d,e,f,g){var h=this;if(d==null){h._bounds=d}h._bounds=(h._bounds||new kisgame.Rectangle()).setValues(d,e,f,g)};a.clone=function(){var d=this;return d._cloneProps(new $())};a.toString=function(){var d=this;return "[DisplayObject (name="+d.name+")]"};a._cloneProps=function(d){var e=this;d.alpha=e.alpha;d.mouseEnabled=e.mouseEnabled;d.tickEnabled=e.tickEnabled;d.name=e.name;d.regX=e.regX;d.regY=e.regY;d.rotation=e.rotation;d.scaleX=e.scaleX;d.scaleY=e.scaleY;d.shadow=e.shadow;d.skewX=e.skewX;d.skewY=e.skewY;d.visible=e.visible;d.x=e.x;d.y=e.y;d.compositeOperation=e.compositeOperation;d.snapToPixel=e.snapToPixel;d.filters=e.filters==null?null:e.filters.slice(0);d.mask=e.mask;d.hitArea=e.hitArea;d.cursor=e.cursor;d._bounds=e._bounds;return d};a._applyShadow=function(d,e){e=e||Shadow.identity;d.shadowColor=e.color;d.shadowOffsetX=e.offsetX;d.shadowOffsetY=e.offsetY;d.shadowBlur=e.blur};a._tick=function(d){var f=this;var e=f._listeners;if(e&&e["tick"]){d.target=null;d.propagationStopped=d.immediatePropagationStopped=false;f.dispatchEvent(d)}};a._testHit=function(d){try{var e=d.getImageData(0,0,1,1).data[3]>1}catch(e){if(!$.suppressCrossDomainErrors){throw "An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}}return e};a._applyFilters=function(d,e,f){var g=this;if(!d)return;if(!g.filters||g.filters.length==0){return}var h=g.filters.length;for(var i=0;i<h;i++){g.filters[i].applyFilter(d,0,0,e,f)}};a._getFilterBounds=function(d){var g=this;var e,f=g.filters,h=g._rectangle.setValues(0,0,0,0);if(!f||!(e=f.length)){return h}for(var i=0;i<e;i++){var j=g.filters[i];j.getBounds&&j.getBounds(h)}return h};a._getBounds=function(d,e,f){var h=this;var g=h.getBounds();return h._transformBounds(g?g.clone():null,d,e)};a._transformBounds=function(d,e,f){var l=this;if(!d){return d}var g=d.x,h=d.y,i=d.width,j=d.height,k=l._props.matrix;k=f?k.identity():l.getMatrix(k);if(g||h){k.appendTransform(0,0,1,1,0,0,0,-g,-h)}if(e){k.prependMatrix(e)}var m=i*k.a,n=i*k.b;var o=j*k.c,p=j*k.d;var q=k.tx,r=k.ty;var s=q,u=q,v=r,w=r;if((g=m+q)<s){s=g}else if(g>u){u=g}if((g=m+o+q)<s){s=g}else if(g>u){u=g}if((g=o+q)<s){s=g}else if(g>u){u=g}if((h=n+r)<v){v=h}else if(h>w){w=h}if((h=n+p+r)<v){v=h}else if(h>w){w=h}if((h=p+r)<v){v=h}else if(h>w){w=h}return d.setValues(s,v,u-s,w-v)};a._hasMouseEventListener=function(){var g=this;var d=$._MOUSE_EVENTS;for(var e=0,f=d.length;e<f;e++){if(g.hasEventListener(d[e])){return true}}return !!g.cursor};a.removeSelf=function(){var d=this;if(d.parent)d.parent.removeChild(d)};a.initRRect=function(d,e,f){var g=this;if(!d){if(g.parent){if(!isNaN(g.parent._width)&&!isNaN(g.parent._height)){d=new kisgame.Rectangle(g.parent.x,g.parent.y,g.parent._width,g.parent._height)}else{d=g.parent.getBounds()}}}var h=e;if(!h){h=g.getBounds(g.parent);h.width+=h.x-g.x;h.height+=h.y-g.y}if(d){if(h){g.bottom=d.height-g.y-h.height;g.right=d.width-g.x-h.width}}g.left=g.x;g.top=g.y;if(h){g.oriWidth=g._width=g.width=h.width;g.oriHeight=g._height=g.height=h.height}};a.alignSize=function(d,e,f,g,h){var k=this;var i=NaN;var j=NaN;if((f&_.CENTER)>0){i=(d-k._width)/2}else if((f&_.RIGHT)>0){i=d-k.right-k._width}if((f&_.MIDDLE)>0){j=(e-k._height)/2}else if((f&_.BOTTOM)>0){j=e-k.bottom-k._height}if(!isNaN(i)||!isNaN(j)){if(h){h.x=i;h.y=j}else{k.move(i,j)}}var l=NaN;var m=NaN;if((f&_.HORIZONTAL)>0){l=d-k.left-k.right}if((f&_.VERTICAL)>0){m=e-k.bottom-k.top}if(!isNaN(l)||!isNaN(m)){if(h){h.width=l;h.height=m}else{k.setSize(l,m,g)}}};a.alignTarget=function(d,e,f){var i=this;var g=NaN;var h=NaN;if((e&_.LEFT)>0){g=d._x+d._width+i.left-d.left-d.oriWidth}else if((e&_.RIGHT)>0){g=d._x+i.left-d.left}if((e&_.TOP)>0){h=d._y+d._height+i.top-d.top-d.oriHeight}else if((e&_.BOTTOM)>0){h=d._y+i.top-d.top}if((e&_.OFFSET_X)>0){g=d._x+i.left-d.left}if((e&_.OFFSET_Y)>0){h=d._y+i.top-d.top}if(!isNaN(g)||!isNaN(h)){if(f){f.x=g;f.y=h}else{i.move(g,h)}}};a.invaliate=function(){var e=this;var d=e.stage;d&&!d.autoUpdate&&d.invaliate(e)};a.updateUI=function(){};a.setSize=function(d,e,f){var h=this;var g;if(!isNaN(d)){h.width=d;h._width=d;if(f){var i=h.oriWidth;if(i==undefined){g=h.getBounds();i=g.width}h.scaleX=d/i}}if(!isNaN(e)){h.height=e;h._height=e;if(f){var j=h.oriHeight;if(j==undefined){g=g||h.getBounds();j=g.height}h.scaleY=e/j}}};a.move=function(d,e){var f=this;if(!isNaN(d)){f.x=d;f._x=d}if(!isNaN(e)){f.y=e;f._y=e}};a.startDrag=function(d,e,f,g){var i=this;if(typeof d==="undefined"){d=false}if(typeof e==="undefined"){e=null}if(typeof f==="undefined"){f=null}var h=i.stage;var j=$._dragtable;var k=j.length;var l=null;for(var m=0;m<k;m++){var n=j[m];if(n[0]==i){l=n;break}}var o=i.parent.getConcatenatedMatrix().invert().clone();if(!l){l=new Array();l[0]=i;j.push(l);if(!d){var p=h.mouseX;var q=h.mouseY;if(g){p=g.stageX;q=g.stageY}var a=o.transformPoint(p,q,new kisgame.Point());l[3]=a;a.x-=i.x;a.y-=i.y}}l[1]=d;l[2]=e;l[4]=f;l[6]=o;l[7]=new kisgame.Point();l[8]={x:i.x,y:i.y};l[9]=g?g.pointerID:-1;h.on("stagemousemove",$._dragRectHandler,$,false)};$._dragRectHandler=function(d){var e=$._dragtable;var f=e.length;for(var g=0;g<f;g++){var h=e[g];var i=h[0];var j=h[1];var k=h[2];var l=h[4];var m=h[9];if(d.pointerID!=m){continue}var n;var o;var p=h[6];var q=h[7];var a=p.transformPoint(d.stageX,d.stageY,q);if(j){n=a.x;o=a.y}else{n=a.x-h[3].x;o=a.y-h[3].y}if(k){var r,t,rr,b;r=k.x;t=k.y;rr=k.x+k.width;b=k.y+k.height;if(n<r){n=r}else if(n>rr){n=rr}if(o<t){o=t}else if(o>b){o=b}}if(l){var s=l.scope||i;if(l.dragfun){var a=l.dragfun.apply(s,[n,o]);if(a){n=a.x;o=a.y}}if(!l.nomove){i.move(n,o)}if(!l.dragmoved&&(l.minmoveoft==0||kisgame.GeomUtils.get2PR(h[8].x,h[8].y,n,o)>(l.minmoveoft||4))){l.dragmoved=true}if(l.endfun){l.endfun.apply(s,[n,o])}}else{i.move(n,o)}}};a.isDragging=function(){var h=this;var d=$._dragtable;var e=d.length;for(var f=0;f<e;f++){var g=d[f];if(g&&g[0]==h){return true;break}}return false};a.stopDrag=function(){var h=this;var d=$._dragtable;var e=d.length;for(var f=0;f<e;f++){var g=d[f];if(g&&g[0]==h){d.splice(f,1);f--;e--}}if(d.length==0){var i=h.stage;i.off("stagemousemove",$._dragRectHandler,false,$)}};a.fixPosSize=function(d,e,f){var i=this;var g={l:d.left,r:d.right,t:d.top,b:d.bottom};var h=KISU.percent;if(e>0){g.l=h(g.l,e);g.r=h(g.r,e)}if(f>0){g.t=h(g.t,f);g.b=h(g.b,f)}var a={x:i.x,y:i.y,w:i.width,h:i.height};if(!isNaN(g.l)&&!isNaN(g.r)){a.x=g.l;if(e>0){a.w=e-g.r-g.l}else{a.w=-1}}else{if(!isNaN(g.l)){a.x=g.l}else if(!isNaN(g.r)){if(e>0){a.x=e-i.width-g.r}else{a.x=0}}}if(!isNaN(g.t)&&!isNaN(g.b)){a.y=g.t;if(f>0){a.h=f-g.b-g.t}else{a.h=-1}}else{if(!isNaN(g.t)){a.y=g.t}else if(!isNaN(g.b)){if(f>0){a.y=f-i.height-g.b}else{a.y=0}}}return a};a.destory=function(){var d=this;d.removeAllEventListeners();d.uncache();if(d.parent){d.parent.removeChild(d)}d.destoryed=true};a.local2TargetRect=function(d,e){var g=this;e=e.clone();var f=g.local2Target(d,null,[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]);var h=f[0].x,i=f[0].y;var j=h,k=i;var l=f.length;for(var m=1;m<l;m++){var a=f[m];if(a.x<h){h=a.x}if(a.x>j){j=a.x}if(a.y<i){i=a.y}if(a.y>k){k=a.y}}e.setValues(h,i,j-h,k-i);return e};a.setHitTestRect=function(d){var e=this;e.hitAreaRectangle=(d==null?null:(d||e.getBounds().clone()))};a.setProData=function(d){var e=this;e.i_pro_data=d};a.getProData=function(d){var e=this;var a;if(e.i_pro_data){a=e.i_pro_data}else if(e.root&&e.root.i_pro_data){a=e.root.i_pro_data}return a};a.getRPath=function(d,e){var f=this;var a;if(f.i_pro_data){a=f.i_pro_data}else if(f.root&&f.root.i_pro_data){a=f.root.i_pro_data}if(a){if(d.charAt(0)=="#"){if(e==1){return a.sFolder+d.substr(1)}else if(e==2){return a.folder+d.substr(1)}else{return a.rFolder+d.substr(1)}}}return d};kisgame.cacheCanvas=document.createElement("canvas");kisgame.DisplayObject=kisgame.promote($,"EventDispatcher")}());(function(){"use strict";var _=kisgame.DirectionType;function $(){var b=this;b.DisplayObject_constructor();b.children=[];b.mouseChildren=true;b.isContainer=true;b.tickChildren=true}var a=kisgame.extend($,kisgame.DisplayObject);a.getNumChildren=function(){var b=this;return b.children.length};try{Object.defineProperties(a,{numChildren:{get:a.getNumChildren}})}catch(e){}a.initialize=$;a.isVisible=function(){var b=this;if(b.destoryed)return false;var c=b.scrollRect;if(c&&(c.width<=0||c.height<=0)){return false}var d=b.cacheImage||b.children.length;return !!(b.visible&&b.alpha>0&&b.scaleX!=0&&b.scaleY!=0&&d)};a.draw=function(b,c){var d=this;if(d.DisplayObject_draw(b,c)){return true}var e=d.children.slice();for(var f=0,g=e.length;f<g;f++){var h=e[f];if(!h.isVisible()){continue}b.save();h.updateContext(b);h.draw(b);b.restore()}return true};a.addChild=function(b){var e=this;if(b==null){return b}var c=arguments.length;if(c>1){for(var d=0;d<c;d++){e.addChild(arguments[d])}return arguments[c-1]}if(b.parent){b.parent.removeChild(b)}b.parent=e;b._setRefObj(e);e.children.push(b);b.dispatchEvent("added");return b};a._setRefObj=function(b){var e=this;var c=b?b.stage:null;var d=b?b.root:null;e.stage=c;e.root=d;var f=e.children;if(!f)return;var g=f.length;for(var h=0;h<g;h++){var i=f[h];if(i._setRefObj){i._setRefObj(b)}else{i.stage=c;i.root=d}}};a.addChildAt=function(b,c){var f=this;var d=arguments.length;var e=arguments[d-1];if(e<0||e>f.children.length){return arguments[d-2]}if(d>2){for(var g=0;g<d-1;g++){f.addChildAt(arguments[g],e+g)}return arguments[d-2]}if(b.parent){b.parent.removeChild(b)}b.parent=f;if(!b._setRefObj)trace(b,b.MCTarget.type);b._setRefObj(f);f.children.splice(c,0,b);b.dispatchEvent("added");return b};a.removeChild=function(b){var f=this;var c=arguments.length;if(c>1){var d=true;for(var e=0;e<c;e++){d=d&&f.removeChild(arguments[e])}return d}return f.removeChildAt(f.children.indexOf(b))};a.removeChildAt=function(b){var g=this;var c=arguments.length;if(c>1){var d=[];for(var e=0;e<c;e++){d[e]=arguments[e]}d.sort(function(d,i){return i-d});var f=true;for(var e=0;e<c;e++){f=f&&g.removeChildAt(d[e])}return f}if(b<0||b>g.children.length-1){return false}var h=g.children[b];if(h){h.parent=null;h._setRefObj(null)}g.children.splice(b,1);h.dispatchEvent("removed");return true};a.removeAllChildren=function(){var b=this;b.invaliate();var c=b.children;while(c.length){b.removeChildAt(0)}};a.getChildAt=function(b){var c=this;return c.children[b]};a.getChildByName=function(b){var d=this;var c=d.children;for(var e=0,f=c.length;e<f;e++){if(c[e].name==b){return c[e]}}return null};a.sortChildren=function(b){var c=this;c.invaliate();c.children.sort(b)};a.getChildIndex=function(b){var c=this;return c.children.indexOf(b)};a.swapChildrenAt=function(b,c){var e=this;var d=e.children;var f=d[b];var g=d[c];if(!f||!g){return}g.invaliate();f.invaliate();d[b]=g;d[c]=f};a.swapChildren=function(b,c){var e=this;b.invaliate();c.invaliate();var d=e.children;var f,index2;for(var g=0,h=d.length;g<h;g++){if(d[g]==b){f=g}if(d[g]==c){index2=g}if(f!=null&&index2!=null){break}}if(g==h){return}d[f]=c;d[index2]=b};a.setChildIndex=function(b,c){var e=this;b.invaliate();var d=e.children,f=d.length;if(b.parent!=e||c<0||c>=f){return}for(var g=0;g<f;g++){if(d[g]==b){break}}if(g==f||g==c){return}d.splice(g,1);d.splice(c,0,b)};a.contains=function(b){var c=this;while(b){if(b==c){return true}b=b.parent}return false};a.hitTest=function(b,c){var d=this;return (d.getObjectUnderPoint(b,c)!=null)};a.getObjectsUnderPoint=function(b,c,d){var g=this;var e=[];var f=g.localToGlobal(b,c);g._getObjectsUnderPoint(f.x,f.y,e,d>0,d==1);return e};a.getObjectUnderPoint=function(b,c,d){var f=this;var e=f.localToGlobal(b,c);return f._getObjectsUnderPoint(e.x,e.y,null,d>0,d==1)};a.clone=function(b){var d=this;var c=d._cloneProps(new $());if(b){d._cloneChildren(c)}return c};a.toString=function(){var b=this;return "[Container (name="+b.name+")]"};a._tick=function(b){var c=this;if(c.tickChildren){for(var d=c.children.length-1;d>=0;d--){var e=c.children[d];if(e.tickEnabled&&e._tick){e._tick(b)}}}c.DisplayObject__tick(b)};a._cloneChildren=function(b){var f=this;if(b.children.length){b.removeAllChildren()}var c=b.children;for(var d=0,e=f.children.length;d<e;d++){var g=f.children[d].clone(true);g.parent=b;g.stage=b.stage;c.push(g)}};a._getObjectsUnderPoint=function(b,c,d,e,f,g){var h=this;g=g||0;if(!g&&!h._testMask(h,b,c)){return null}f=f||(e&&h._hasMouseEventListener());var i=kisgame.DisplayObject._hitTestContext;var j=h.children,k=j.length;for(var l=k-1;l>=0;l--){var m=j[l];var n=m.hitArea;var o=m.hitAreaRectangle;if(!m.visible||(!n&&!o&&!m.isVisible())||(e&&(!m.mouseEnabled||(m.mouseIgnoreSelf&&!m.mouseChildren)))){continue}if(!n&&!o&&!h._testMask(m,b,c)){continue}if((m.mouseIgnoreSelf||!n&&(!o||o.isBottom))&&m.isContainer){var p=m._getObjectsUnderPoint(b,c,d,e,f,g+1);if(!p&&o&&o.isBottom&&!m.mouseIgnoreSelf){if(o.isFull){}else{var a=m.globalToLocal(b,c);if(o.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>o.radius){continue}else if(a.x<o.x||a.y<o.y||a.x>o.x+o.width||a.y>o.y+o.height){continue}}if(d){d.push(m)}else{return (e&&!h.mouseChildren)?h:m}}else if(!d&&p){return (e&&!h.mouseChildren)?h:p}}else{if(e&&!f&&!m._hasMouseEventListener()){continue}if(o){if(o.isFull){}else{var a=m.globalToLocal(b,c);if(o.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>o.radius){continue}else if(a.x<o.x||a.y<o.y||a.x>o.x+o.width||a.y>o.y+o.height){continue}}}else{if(!m._hitTestSelf(i,b,c)){continue}}if(d){d.push(m)}else{return (e&&!h.mouseChildren)?h:m}}}return null};a._testMask=function(b,c,d){var g=this;var e=b.scrollRect;if(e){var f=g._props.matrix,h=b.parent;f=h?h.getConcatenatedMatrix(f):f.identity();f=b.getMatrix(b._props.matrix).prependMatrix(f);var i=kisgame.DisplayObject._hitTestContext;i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,2,2);i.setTransform(f.a,f.b,f.c,f.d,f.tx-c,f.ty-d);i.beginPath();i.rect(0,0,e.width,e.height);i.fillStyle="#000";i.fill();if(!g._testHit(i)){return false}return true}var j=b.mask;if(!j||!j.graphics||j.graphics.isEmpty()){return true}var f=g._props.matrix,h=b.parent;f=h?h.getConcatenatedMatrix(f):f.identity();f=j.getMatrix(j._props.matrix).prependMatrix(f);var i=kisgame.DisplayObject._hitTestContext;i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,2,2);i.setTransform(f.a,f.b,f.c,f.d,f.tx-c,f.ty-d);j.graphics.drawAsPath(i);i.fillStyle="#000";i.fill();if(!g._testHit(i)){return false}return true};a.initChildsRect=function(b){var c=this;if(!b){b=c.children}var d=b.length;for(var e=0;e<d;e++){var f=b[e];if(f){f.initRRect()}}};a.alignDirection=function(b,c,d,e){var f=this;if(isNaN(f._width)||isNaN(f._height)){var g=f.getBounds();if(g){f._width=g.width;f._height=g.height}}var h=NaN;var i=NaN;if((c&_.CENTER)>0){h=(f._width-b._width)/2}else if((c&_.RIGHT)>0){h=f._width-b.right-b._width}if((c&_.MIDDLE)>0){i=(f._height-b._height)/2}else if((c&_.BOTTOM)>0){i=f._height-b.bottom-b._height}if(!isNaN(h)||!isNaN(i)){if(e){if(!isNaN(h))e.x=h;if(!isNaN(i))e.y=i}else{b.move(h,i)}}var j=NaN;var k=NaN;if((c&_.HORIZONTAL)>0){j=f._width-b.left-b.right}if((c&_.VERTICAL)>0){k=f._height-b.bottom-b.top}if(!isNaN(j)||!isNaN(k)){if(e){e.width=j;e.height=k}else{b.setSize(j,k,d)}}};a.destory=function(b){var c=this;c.removeAllEventListeners();if(b){var d=c.children.slice(0);var e=d.length;for(var f=0;f<e;f++){d[f].destory(b)}d.splice(0)}c._kis_last_props=null;c.uncache();c.destoryed=true;if(c.parent){c.parent.removeChild(c)}};a.getBounds=function(b,c,d){var f=this;var e=f._getBounds(null,true,c,d);if(b&&e){return f.local2TargetRect(b,e)}return e};a._getBounds=function(b,c,d,e){var g=this;var f=g.DisplayObject_getBounds();if(f){return g._transformBounds(f,b,c)}var h=g._props.matrix;h=c?h.identity():g.getMatrix(h);if(b){h.prependMatrix(b)}var i=g.children.length,j=null;for(var k=0;k<i;k++){var l=g.children[k];if(!l.visible||!(f=l._getBounds(h,false,d,e))){continue}if(j){j.extend(f.x,f.y,f.width,f.height)}else{j=f.clone()}}return j};kisgame.Container=kisgame.promote($,"DisplayObject")}());(function(){"use strict";function _(){var c=this;c.command=null;c._stroke=null;c._strokeStyle=null;c._oldStrokeStyle=null;c._strokeDash=null;c._oldStrokeDash=null;c._strokeIgnoreScale=false;c._fill=null;c._instructions=[];c._commitIndex=0;c._activeInstructions=[];c._dirty=false;c._storeIndex=0;c.dirtyDraw=false;c.changeSize=false;c.clear()}var $=_.prototype;var a=_;_.getRGB=function(c,d,e,f){if(c!=null&&e==null){f=d;e=c&0xFF;d=c>>8&0xFF;c=c>>16&0xFF}if(f==null){return "rgb("+c+","+d+","+e+")"}else{return "rgba("+c+","+d+","+e+","+f+")"}};_.getHSL=function(c,d,e,f){if(f==null){return "hsl("+(c%360)+","+d+"%,"+e+"%)"}else{return "hsla("+(c%360)+","+d+"%,"+e+"%,"+f+")"}};_.BASE_64={"A":0,"B":1,"C":2,"D":3,"E":4,"F":5,"G":6,"H":7,"I":8,"J":9,"K":10,"L":11,"M":12,"N":13,"O":14,"P":15,"Q":16,"R":17,"S":18,"T":19,"U":20,"V":21,"W":22,"X":23,"Y":24,"Z":25,"a":26,"b":27,"c":28,"d":29,"e":30,"f":31,"g":32,"h":33,"i":34,"j":35,"k":36,"l":37,"m":38,"n":39,"o":40,"p":41,"q":42,"r":43,"s":44,"t":45,"u":46,"v":47,"w":48,"x":49,"y":50,"z":51,"0":52,"1":53,"2":54,"3":55,"4":56,"5":57,"6":58,"7":59,"8":60,"9":61,"+":62,"/":63};_.STROKE_CAPS_MAP=["butt","round","square"];_.STROKE_JOINTS_MAP=["miter","round","bevel"];var b=(kisgame.createCanvas?kisgame.createCanvas():document.createElement("canvas"));if(b.getContext){_._ctx=b.getContext("2d");b.width=b.height=1}$.getInstructions=function(){var c=this;c._updateInstructions();return c._instructions};try{Object.defineProperties($,{instructions:{get:$.getInstructions}})}catch(e){}$.isEmpty=function(){var c=this;return !(c._instructions.length||c._activeInstructions.length)};$.draw=function(c,d,e){var f=this;f._updateInstructions();var g=f._instructions;for(var h=f._storeIndex,i=g.length;h<i;h++){g[h].exec(c,d)}f.dirtyDraw=false;if(e){f.changeSize=false}};$.drawAsPath=function(c){var d=this;d._updateInstructions();var e,f=d._instructions;for(var g=d._storeIndex,h=f.length;g<h;g++){if((e=f[g]).path!==false){e.exec(c)}}};$.moveTo=function(c,d){var e=this;return e.append(new a.MoveTo(c,d),true)};$.lineTo=function(c,d){var e=this;return e.append(new a.LineTo(c,d))};$.arcTo=function(c,d,e,f,g){var h=this;return h.append(new a.ArcTo(c,d,e,f,g))};$.arc=function(c,d,e,f,g,h){var i=this;return i.append(new a.Arc(c,d,e,f,g,h))};$.quadraticCurveTo=function(c,d,e,f){var g=this;return g.append(new a.QuadraticCurveTo(c,d,e,f))};$.bezierCurveTo=function(c,d,e,f,g,h){var i=this;return i.append(new a.BezierCurveTo(c,d,e,f,g,h))};$.rect=function(c,d,e,f){var g=this;return g.append(new a.Rect(c,d,e,f))};$.closePath=function(){var c=this;return c._activeInstructions.length?c.append(new a.ClosePath()):c};$.clear=function(){var c=this;c._instructions.length=c._activeInstructions.length=c._commitIndex=0;c._strokeStyle=c._oldStrokeStyle=c._stroke=c._fill=c._strokeDash=c._oldStrokeDash=null;c._dirty=c._strokeIgnoreScale=false;c.dirtyDraw=true;c.changeSize=true;return c};$.beginFill=function(c){var d=this;return d._setFill(c?new a.Fill(c):null)};$.beginLinearGradientFill=function(c,d,e,f,g,h){var i=this;return i._setFill(new a.Fill().linearGradient(c,d,e,f,g,h))};$.beginRadialGradientFill=function(c,d,e,f,g,h,i,j){var k=this;return k._setFill(new a.Fill().radialGradient(c,d,e,f,g,h,i,j))};$.beginBitmapFill=function(c,d,e){var f=this;return f._setFill(new a.Fill(null,e).bitmap(c,d))};$.endFill=function(){var c=this;return c.beginFill()};$.setStrokeStyle=function(c,d,e,f,g){var h=this;h._updateInstructions(true);h._strokeStyle=h.command=new a.StrokeStyle(c,d,e,f,g);if(h._stroke){h._stroke.ignoreScale=g}h._strokeIgnoreScale=g;return h};$.setStrokeDash=function(c,d){var e=this;e._updateInstructions(true);e._strokeDash=e.command=new a.StrokeDash(c,d);return e};$.beginStroke=function(c){var d=this;return d._setStroke(c?new a.Stroke(c):null)};$.beginLinearGradientStroke=function(c,d,e,f,g,h){var i=this;return i._setStroke(new a.Stroke().linearGradient(c,d,e,f,g,h))};$.beginRadialGradientStroke=function(c,d,e,f,g,h,i,j){var k=this;return k._setStroke(new a.Stroke().radialGradient(c,d,e,f,g,h,i,j))};$.beginBitmapStroke=function(c,d){var e=this;return e._setStroke(new a.Stroke().bitmap(c,d))};$.endStroke=function(){var c=this;return c.beginStroke()};$.curveTo=$.quadraticCurveTo;$.drawRect=$.rect;$.drawRoundRect=function(c,d,e,f,g){var h=this;return h.drawRoundRectComplex(c,d,e,f,g,g,g,g)};$.drawRoundRectComplex=function(c,d,e,f,g,h,i,j){var k=this;return k.append(new a.RoundRect(c,d,e,f,g,h,i,j))};$.drawCircle=function(c,d,e){var f=this;return f.append(new a.Circle(c,d,e))};$.drawEllipse=function(c,d,e,f){var g=this;return g.append(new a.Ellipse(c,d,e,f))};$.drawPolyStar=function(c,d,e,f,g,h){var i=this;return i.append(new a.PolyStar(c,d,e,f,g,h))};$.append=function(c,d){var e=this;e._activeInstructions.push(c);e.command=c;if(!d){e._dirty=e.dirtyDraw=e.changeSize=true}return e};$.decodePath=function(c){var e=this;var d=[e.moveTo,e.lineTo,e.quadraticCurveTo,e.bezierCurveTo,e.closePath];var f=[2,2,4,6,0];var g=0,h=c.length;var i=[];var j=0,k=0;var l=_.BASE_64;while(g<h){var m=c.charAt(g);var n=l[m];var o=n>>3;var p=d[o];if(!p||(n&3)){throw ("bad path data (@"+g+"): "+m)}var q=f[o];if(!o){j=k=0}i.length=0;g++;var r=(n>>2&1)+2;for(var $=0;$<q;$++){var s=l[c.charAt(g)];var t=(s>>5)?-1:1;s=((s&31)<<6)|(l[c.charAt(g+1)]);if(r==3){s=(s<<6)|(l[c.charAt(g+2)])}s=t*s/10;if($%2){j=(s+=j)}else{k=(s+=k)}i[$]=s;g+=r}p.apply(e,i)}return e};$.store=function(){var c=this;c._updateInstructions(true);c._storeIndex=c._instructions.length;return c};$.unstore=function(){var c=this;c._storeIndex=0;return c};$.clone=function(){var d=this;var c=new _();c.command=d.command;c._stroke=d._stroke;c._strokeStyle=d._strokeStyle;c._strokeDash=d._strokeDash;c._strokeIgnoreScale=d._strokeIgnoreScale;c._fill=d._fill;c._instructions=d._instructions.slice();c._commitIndex=d._commitIndex;c._activeInstructions=d._activeInstructions.slice();c._dirty=d._dirty;c.dirtyDraw=true;c.changeSize=true;c._storeIndex=d._storeIndex;return c};$.toString=function(){return "[Graphics]"};$.mt=$.moveTo;$.lt=$.lineTo;$.at=$.arcTo;$.bt=$.bezierCurveTo;$.qt=$.quadraticCurveTo;$.a=$.arc;$.r=$.rect;$.cp=$.closePath;$.c=$.clear;$.f=$.beginFill;$.lf=$.beginLinearGradientFill;$.rf=$.beginRadialGradientFill;$.bf=$.beginBitmapFill;$.ef=$.endFill;$.ss=$.setStrokeStyle;$.sd=$.setStrokeDash;$.s=$.beginStroke;$.ls=$.beginLinearGradientStroke;$.rs=$.beginRadialGradientStroke;$.bs=$.beginBitmapStroke;$.es=$.endStroke;$.dr=$.drawRect;$.rr=$.drawRoundRect;$.rc=$.drawRoundRectComplex;$.dc=$.drawCircle;$.de=$.drawEllipse;$.dp=$.drawPolyStar;$.p=$.decodePath;$._updateInstructions=function(c){var e=this;var d=e._instructions,f=e._activeInstructions,g=e._commitIndex;if(e._dirty&&f.length){d.length=g;d.push(_.beginCmd);var h=f.length,i=d.length;d.length=i+h;for(var j=0;j<h;j++){d[j+i]=f[j]}if(e._fill){d.push(e._fill)}if(e._stroke){if(e._strokeDash!==e._oldStrokeDash){e._oldStrokeDash=e._strokeDash;d.push(e._strokeDash)}if(e._strokeStyle!==e._oldStrokeStyle){e._oldStrokeStyle=e._strokeStyle;d.push(e._strokeStyle)}d.push(e._stroke)}e._dirty=false}if(c){f.length=0;e._commitIndex=d.length}};$._setFill=function(c){var d=this;d._updateInstructions(true);d.command=d._fill=c;return d};$._setStroke=function(c){var d=this;d._updateInstructions(true);if(d.command=d._stroke=c){c.ignoreScale=d._strokeIgnoreScale}return d};(a.LineTo=function(c,d){var e=this;e.x=c;e.y=d}).prototype.exec=function(c){var d=this;c.lineTo(d.x,d.y)};(a.MoveTo=function(c,d){var e=this;e.x=c;e.y=d}).prototype.exec=function(c){var d=this;c.moveTo(d.x,d.y)};(a.ArcTo=function(c,d,e,f,g){var h=this;h.x1=c;h.y1=d;h.x2=e;h.y2=f;h.radius=g}).prototype.exec=function(c){var d=this;c.arcTo(d.x1,d.y1,d.x2,d.y2,d.radius)};(a.Arc=function(c,d,e,f,g,h){var i=this;i.x=c;i.y=d;i.radius=e;i.startAngle=f;i.endAngle=g;i.anticlockwise=!!h}).prototype.exec=function(c){var d=this;c.arc(d.x,d.y,d.radius,d.startAngle,d.endAngle,d.anticlockwise)};(a.QuadraticCurveTo=function(c,d,e,f){var g=this;g.cpx=c;g.cpy=d;g.x=e;g.y=f}).prototype.exec=function(c){var d=this;c.quadraticCurveTo(d.cpx,d.cpy,d.x,d.y)};(a.BezierCurveTo=function(c,d,e,f,g,h){var i=this;i.cp1x=c;i.cp1y=d;i.cp2x=e;i.cp2y=f;i.x=g;i.y=h}).prototype.exec=function(c){var d=this;c.bezierCurveTo(d.cp1x,d.cp1y,d.cp2x,d.cp2y,d.x,d.y)};(a.Rect=function(c,d,e,f){var g=this;g.x=c;g.y=d;g.w=e;g.h=f}).prototype.exec=function(c){var d=this;c.rect(d.x,d.y,d.w,d.h)};(a.ClosePath=function(){}).prototype.exec=function(c){c.closePath()};(a.BeginPath=function(){}).prototype.exec=function(c){c.beginPath()};$=(a.Fill=function(c,d){var e=this;e.style=c;e.matrix=d}).prototype;$.exec=function(c){var d=this;if(!d.style){return}c.fillStyle=d.style;var e=d.matrix;if(e){c.save();c.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)}c.fill();if(e){c.restore()}};$.linearGradient=function(c,d,e,f,g,h){var j=this;var i=j.style=_._ctx.createLinearGradient(e,f,g,h);for(var k=0,l=c.length;k<l;k++){i.addColorStop(d[k],c[k])}i.props={colors:c,ratios:d,x0:e,y0:f,x1:g,y1:h,type:"linear"};return j};$.radialGradient=function(c,d,e,f,g,h,i,j){var l=this;var k=l.style=_._ctx.createRadialGradient(e,f,g,h,i,j);for(var m=0,n=c.length;m<n;m++){k.addColorStop(d[m],c[m])}k.props={colors:c,ratios:d,x0:e,y0:f,r0:g,x1:h,y1:i,r1:j,type:"radial"};return l};$.bitmap=function(c,d){var f=this;if(c.naturalWidth||c.getContext||c.readyState>=2){var e=f.style=_._ctx.createPattern(c,d||"");e.props={image:c,repetition:d,type:"bitmap"}}return f};$.path=false;$=(a.Stroke=function(c,d){var e=this;e.style=c;e.ignoreScale=d}).prototype;$.exec=function(c){var d=this;if(!d.style){return}c.strokeStyle=d.style;if(d.ignoreScale){c.save();c.setTransform(1,0,0,1,0,0)}c.stroke();if(d.ignoreScale){c.restore()}};$.linearGradient=a.Fill.prototype.linearGradient;$.radialGradient=a.Fill.prototype.radialGradient;$.bitmap=a.Fill.prototype.bitmap;$.path=false;$=(a.StrokeStyle=function(c,d,e,f,g){var h=this;h.width=c;h.caps=d;h.joints=e;h.miterLimit=f;h.ignoreScale=g}).prototype;$.exec=function(c){var d=this;c.lineWidth=(d.width==null?"1":d.width);c.lineCap=(d.caps==null?"butt":(isNaN(d.caps)?d.caps:_.STROKE_CAPS_MAP[d.caps]));c.lineJoin=(d.joints==null?"miter":(isNaN(d.joints)?d.joints:_.STROKE_JOINTS_MAP[d.joints]));c.miterLimit=(d.miterLimit==null?"10":d.miterLimit);c.ignoreScale=(d.ignoreScale==null?false:d.ignoreScale)};$.path=false;(a.StrokeDash=function(c,d){var e=this;e.segments=c;e.offset=d||0}).prototype.exec=function(c){var d=this;if(c.setLineDash){c.setLineDash(d.segments||a.StrokeDash.EMPTY_SEGMENTS);c.lineDashOffset=d.offset||0}};a.StrokeDash.EMPTY_SEGMENTS=[];(a.RoundRect=function(c,d,e,f,g,h,i,j){var k=this;k.x=c;k.y=d;k.w=e;k.h=f;k.radiusTL=g;k.radiusTR=h;k.radiusBR=i;k.radiusBL=j}).prototype.exec=function(c){var j=this;var d=(l<m?l:m)/2;var e=0,f=0,g=0,h=0;var i=j.x,k=j.y,l=j.w,m=j.h;var n=j.radiusTL,o=j.radiusTR,p=j.radiusBR,q=j.radiusBL;if(n<0){n*=(e=-1)}if(n>d){n=d}if(o<0){o*=(f=-1)}if(o>d){o=d}if(p<0){p*=(g=-1)}if(p>d){p=d}if(q<0){q*=(h=-1)}if(q>d){q=d}c.moveTo(i+l-o,k);c.arcTo(i+l+o*f,k-o*f,i+l,k+o,o);c.lineTo(i+l,k+m-p);c.arcTo(i+l+p*g,k+m+p*g,i+l-p,k+m,p);c.lineTo(i+q,k+m);c.arcTo(i-q*h,k+m+q*h,i,k+m-q,q);c.lineTo(i,k+n);c.arcTo(i-n*e,k-n*e,i+n,k,n);c.closePath()};(a.Circle=function(c,d,e){var f=this;f.x=c;f.y=d;f.radius=e}).prototype.exec=function(c){var d=this;c.arc(d.x,d.y,d.radius,0,Math.PI*2)};(a.Ellipse=function(c,d,e,f){var g=this;g.x=c;g.y=d;g.w=e;g.h=f}).prototype.exec=function(c){var e=this;var d=e.x,f=e.y;var g=e.w,h=e.h;var i=0.5522848;var j=(g/2)*i;var k=(h/2)*i;var l=d+g;var m=f+h;var n=d+g/2;var o=f+h/2;c.moveTo(d,o);c.bezierCurveTo(d,o-k,n-j,f,n,f);c.bezierCurveTo(n+j,f,l,o-k,l,o);c.bezierCurveTo(l,o+k,n+j,m,n,m);c.bezierCurveTo(n-j,m,d,o+k,d,o)};(a.PolyStar=function(c,d,e,f,g,h){var i=this;i.x=c;i.y=d;i.radius=e;i.sides=f;i.pointSize=g;i.angle=h}).prototype.exec=function(c){var e=this;var d=e.x,f=e.y;var g=e.radius;var h=(e.angle||0)/180*Math.PI;var i=e.sides;var j=1-(e.pointSize||0);var k=Math.PI/i;c.moveTo(d+Math.cos(h)*g,f+Math.sin(h)*g);for(var l=0;l<i;l++){h+=k;if(j!=1){c.lineTo(d+Math.cos(h)*g*j,f+Math.sin(h)*g*j)}h+=k;c.lineTo(d+Math.cos(h)*g,f+Math.sin(h)*g)}c.closePath()};_.beginCmd=new a.BeginPath();kisgame.Graphics=_}());(function(){"use strict";function _(b,c,d,e){var f=this;f.Container_constructor();!_.inited&&_.init();f.mode=b||_.INDEPENDENT;f.startPosition=c||0;f.loop=d;f.currentFrame=0;f.timeline=new kisgame.Timeline(null,e,{paused:true,position:c,useTicks:true});f.actionsEnabled=true;f.autoReset=true;f.frameBounds=f.frameBounds||null;f.framerate=null;f._synchOffset=0;f._prevPos=-1;f._prevPosition=0;f._t=0;f._managed={}}var $=kisgame.extend(_,kisgame.Container);_.INDEPENDENT="independent";_.SINGLE_FRAME="single";_.SYNCHED="synched";_.inited=false;_.init=function(){if(_.inited){return}a.install();_.inited=true};$.getLabels=function(){var b=this;return b.timeline.getLabels()};$.getCurrentLabel=function(){var b=this;b._updateTimeline();return b.timeline.getCurrentLabel()};$.getDuration=function(){var b=this;return b.timeline.duration};try{Object.defineProperties($,{labels:{get:$.getLabels},currentLabel:{get:$.getCurrentLabel},totalFrames:{get:$.getDuration},duration:{get:$.getDuration}})}catch(e){}$.initialize=_;$.isVisible=function(){var b=this;return !!(b.visible&&b.alpha>0&&b.scaleX!=0&&b.scaleY!=0)};$.draw=function(b,c){var d=this;if(d.DisplayObject_draw(b,c)){return true}d._updateTimeline();d.Container_draw(b,c);return true};$.play=function(){var b=this;b.once2Stop=false;b.paused=false};$.playOnce=function(b,c){var d=this;d.once2StartFrame=b;d.once2StopFrame=c;if(!isNaN(b)){d.gotoAndPlay(b)}else{d.play()}d.once2Stop=true};$.stop=function(){var b=this;b.once2Stop=false;b.paused=true};$.gotoAndPlay=function(b){var c=this;c.once2Stop=false;c.paused=false;c._goto(b)};$.gotoAndStop=function(b){var c=this;c.once2Stop=false;c.paused=true;c._goto(b)};$.advance=function(b){var d=this;var c=_.INDEPENDENT;if(d.mode!=c){return}var e=d,f=e.framerate;while((e=e.parent)&&f==null){if(e.mode==c){f=e._framerate}}d._framerate=f;var g=(f!=null&&f!=-1&&b!=null)?b/(1000/f)+d._t:1;var h=g|0;d._t=g-h;while(!d.paused&&h--){d._prevPosition=(d._prevPos<0)?0:d._prevPosition+1;d._updateTimeline()}};$.clone=function(){throw ("MovieClip cannot be cloned.")};$.toString=function(){var b=this;return "[MovieClip (name="+b.name+")]"};$._tick=function(b){var c=this;c.advance(b&&b.delta);c.Container__tick(b)};$._goto=function(b){var c=this;c.invaliate();var d=c.timeline.resolve(b);if(d==null){return}if(c._prevPos==-1){c._prevPos=NaN}c._prevPosition=d;c._t=0;c._updateTimeline()};$._reset=function(){var b=this;b._prevPos=-1;b._t=b.currentFrame=0;b.paused=false};$._updateTimeline=function(){var c=this;var b=c.timeline;var d=c.mode!=_.INDEPENDENT;b.loop=(c.loop==null)?true:c.loop;var e=d?c.startPosition+(c.mode==_.SINGLE_FRAME?0:c._synchOffset):(c._prevPos<0?0:c._prevPosition);var f=d||!c.actionsEnabled?kisgame.Tween.NONE:null;c.currentFrame=b._calcPosition(e);if(c.once2Stop){if(isNaN(c.once2StopFrame)&&c.currentFrame+1==c.totalFrames){c.gotoAndStop(c.once2StartFrame);return}else if(c.currentFrame==c.once2StopFrame){c.stop()}}b.setPosition(e,f);c._prevPosition=b._prevPosition;if(c._prevPos==b._prevPos){return}c.currentFrame=c._prevPos=b._prevPos;for(var g in c._managed){c._managed[g]=1}var h=b._tweens;for(var i=0,j=h.length;i<j;i++){var k=h[i];var l=k._target;if(l==c||k.passive){continue}var m=k._stepPosition;if(l instanceof kisgame.DisplayObject){c._addManagedChild(l,m)}else{c._setState(l.state,m)}}var n=c.children;for(i=n.length-1;i>=0;i--){var o=n[i].id;if(c._managed[o]==1){c.removeChildAt(i);delete (c._managed[o])}}};$._setState=function(b,c){var i=this;if(!b){return}for(var d=b.length-1;d>=0;d--){var e=b[d];var f=e.t;var g=e.p;for(var h in g){f[h]=g[h]}i._addManagedChild(f,c)}};$._addManagedChild=function(b,c){var d=this;if(b._off){return}d.addChildAt(b,0);if(b instanceof _){b._synchOffset=c;if(b.mode==_.INDEPENDENT&&b.autoReset&&!d._managed[b.id]){b._reset()}}d._managed[b.id]=2};$._getBounds=function(b,c,d,e){var g=this;var f=g.DisplayObject_getBounds();if(!f){g._updateTimeline();if(g.frameBounds){f=g._rectangle.copy(g.frameBounds[g.currentFrame])}}if(f){return g._transformBounds(f,b,c)}return g.Container__getBounds(b,c,d,e)};kisgame.MovieClip=kisgame.promote(_,"Container");function a(){throw ("MovieClipPlugin cannot be instantiated.")}a.priority=100;a.install=function(){kisgame.Tween.installPlugin(a,["startPosition"])};a.init=function(b,c,d){return d};a.step=function(){};a.tween=function(b,c,d,e,f,g,h,i){if(!(b.target instanceof _)){return d}return (g==1?f[c]:e[c])}}());(function(){"use strict";function _(a,b,c,d){var e=this;e.color=a||"black";e.offsetX=b||0;e.offsetY=c||0;e.blur=d||0}var $=_.prototype;_.identity=new _("transparent",0,0,0);$.toString=function(){return "[Shadow]"};$.clone=function(){var a=this;return new _(a.color,a.offsetX,a.offsetY,a.blur)};kisgame.Shadow=_}());(function(){"use strict";function _(a){var b=this;b.DisplayObject_constructor();b.graphics=a?a:new kisgame.Graphics()}var $=kisgame.extend(_,kisgame.DisplayObject);_.Graphics_bound_ctx=new kisgame.SimulateGraphics();$.isVisible=function(){var b=this;var a=b.cacheImage||(b.graphics&&!b.graphics.isEmpty());return !!(b.visible&&b.alpha>0&&b.scaleX!=0&&b.scaleY!=0&&a)};$.draw=function(a,b){var d=this;var c=d.graphics;var e=c.changeSize;if(!e&&d.DisplayObject_draw(a,b)){return true}if(d.autoCache&&!b){var c=d.graphics;if(e){var f=d.updateGraphicsBound(e);d.cache(f.x,f.y,f.width,f.height);d.DisplayObject_draw(a,false);return true}}c.draw(a,d,true);return true};$.clone=function(a){var c=this;var b=(a&&c.graphics)?c.graphics.clone():c.graphics;return c._cloneProps(new _(b))};$.toString=function(){var a=this;return "[Shape (name="+a.name+")]"};$.getBounds=function(a){var b=this;if(b._bounds){return b._rectangle.copy(b._bounds)}var c=b.cacheImage;var d=null;var e=b.graphics;if(e.dirtyDraw){d=b.updateGraphicsBound(true)}else if(c){var f=b._cacheScale;d=b._rectangle.setValues(b._cacheOffsetX,b._cacheOffsetY,c.width/f,c.height/f)}else if(b._graphics_bound){d=b._graphics_bound}if(a&&d){return b.local2TargetRect(a,d)}return d};$.clear=function(){var a=this;a.invaliate();a.graphics.clear()};$.updateGraphicsBound=function(a){var c=this;var b=c.graphics;var d=c._graphics_bound;if(!d){d=c._graphics_bound=new kisgame.Rectangle()}if(b.isEmpty()){d.setValues(0,0,0,0)}else if(b.dirtyDraw||a){var e=_.Graphics_bound_ctx;e.reset();b.draw(e,c);d.x=e.minX;d.y=e.minY;d.width=e.maxX-e.minX;d.height=e.maxY-e.minY}return d};kisgame.Shape=kisgame.promote(_,"DisplayObject")}());(function(){"use strict";function _(a,b){var c=this;c.DisplayObject_constructor();c.currentFrame=0;c.currentAnimation=null;c.paused=true;c.spriteSheet=a;c.currentAnimationFrame=0;c.framerate=0;c._animation=null;c._currentFrame=null;c._skipAdvance=false;if(b!=null){c.gotoAndPlay(b)}}var $=kisgame.extend(_,kisgame.DisplayObject);$.initialize=_;$.isVisible=function(){var b=this;var a=b.cacheImage||b.spriteSheet.complete;return !!(b.visible&&b.alpha>0&&b.scaleX!=0&&b.scaleY!=0&&a)};$.draw=function(a,b){var c=this;if(c.DisplayObject_draw(a,b)){return true}c._normalizeFrame();var d=c.spriteSheet.getFrame(c._currentFrame|0);if(!d){return false}var e=d.rect;if(e.width&&e.height){a.drawImage(d.image,e.x,e.y,e.width,e.height,-d.regX,-d.regY,e.width,e.height)}return true};$.play=function(){var a=this;a.paused=false};$.playOnce=function(a,b){var c=this;c.once2Stop=true;c.once2StartFrame=a;c.once2StopFrame=b;if(!isNaN(a)){c.gotoAndPlay(a)}else{c.play()}};$.stop=function(){var a=this;a.paused=true};$.gotoAndPlay=function(a){var b=this;b.paused=false;b._skipAdvance=true;b._goto(a)};$.gotoAndStop=function(a){var b=this;b.paused=true;b._goto(a)};$.advance=function(a){var c=this;var b=c.framerate||c.spriteSheet.framerate;var d=(b&&a!=null)?a/(1000/b):1;c._normalizeFrame(d)};$.getBounds=function(){var a=this;return a.DisplayObject_getBounds()||a.spriteSheet.getFrameBounds(a.currentFrame,a._rectangle)};$.clone=function(){var a=this;return a._cloneProps(new _(a.spriteSheet))};$.toString=function(){var a=this;return "[Sprite (name="+a.name+")]"};$._cloneProps=function(a){var b=this;b.DisplayObject__cloneProps(a);a.currentFrame=b.currentFrame;a.currentAnimation=b.currentAnimation;a.paused=b.paused;a.currentAnimationFrame=b.currentAnimationFrame;a.framerate=b.framerate;a._animation=b._animation;a._currentFrame=b._currentFrame;a._skipAdvance=b._skipAdvance;return a};$._tick=function(a){var b=this;if(!b.paused){if(!b._skipAdvance){b.advance(a&&a.delta)}b._skipAdvance=false}b.DisplayObject__tick(a)};$._normalizeFrame=function(a){var c=this;var b=c.paused;a=a||0;var d=c._animation;var e=c._currentFrame;var f;if(d){var g=d.speed||1;var h=c.currentAnimationFrame;f=d.frames.length;if(h+a*g>=f){var i=d.next;if(c._dispatchAnimationEnd(d,e,b,i,f-1)){c._dirty=true;return}else if(i){c._dirty=true;return c._goto(i,a-(f-h)/g)}else{c.paused=true;h=d.frames.length-1}}else{h+=a*g}c.currentAnimationFrame=h;c._currentFrame=d.frames[h|0]}else{e=(c._currentFrame+=a);f=c.spriteSheet.getNumFrames();if(e>=f&&f>0){if(!c._dispatchAnimationEnd(d,e,b,f-1)){if((c._currentFrame-=f)>=f){return c._normalizeFrame()}}}}e=c._currentFrame|0;if(c.currentFrame!=e){c._dirty=true;c.currentFrame=e;c.dispatchEvent("change")}};$._dispatchAnimationEnd=function(a,b,c,d,e){var g=this;var f=a?a.name:null;if(g.hasEventListener("animationend")){var h=new kisgame.Event("animationend");h.name=f;h.next=d;g.dispatchEvent(h)}var i=(g._animation!=a||g._currentFrame!=b);if(!i&&!c&&g.paused){g.currentAnimationFrame=e;i=true}return i};$._goto=function(a,b){var c=this;c.invaliate();c.currentAnimationFrame=0;if(isNaN(a)){var d=c.spriteSheet.getAnimation(a);if(d){c._animation=d;c.currentAnimation=a;c._normalizeFrame(b)}}else{c.currentAnimation=c._animation=null;c._currentFrame=a;c._normalizeFrame()}};kisgame.Sprite=kisgame.promote(_,"DisplayObject")}());;(function(){"use strict";function _(b){var c=this;c.EventDispatcher_constructor();c.complete=true;c.framerate=0;c._animations=null;c._frames=null;c._images=null;c._data=null;c._loadCount=0;c._frameHeight=0;c._frameWidth=0;c._numFrames=0;c._regX=0;c._regY=0;c._spacing=0;c._margin=0;c._parseData(b)}var $=kisgame.extend(_,kisgame.EventDispatcher);$.getAnimations=function(){var b=this;return b._animations.slice()};try{Object.defineProperties($,{animations:{get:$.getAnimations}})}catch(e){}$.getNumFrames=function(b){var c=this;if(b==null){return c._frames?c._frames.length:c._numFrames||0}else{var d=c._data[b];if(d==null){return 0}else{return d.frames.length}}};$.getAnimation=function(b){var c=this;return c._data[b]};$.getFrame=function(b){var d=this;var c;if(d._frames&&(c=d._frames[b])){return c}return null};$.getFrameBounds=function(b,c){var e=this;var d=e.getFrame(b);return d?(c||new kisgame.Rectangle()).setValues(-d.regX,-d.regY,d.rect.width,d.rect.height):null};$.toString=function(){return "[SpriteSheet]"};$.clone=function(){throw ("SpriteSheet cannot be cloned.")};$._parseData=function(b){var d=this;var c,f,o,a;if(b==null){return}d.framerate=b.framerate||0;if(b.images&&(f=b.images.length)>0){a=d._images=[];for(c=0;c<f;c++){var e=b.images[c];if(typeof e=="string"){e=kisgame.RManager.getImage(e,d,true)}a.push(e);if(!e.getContext&&!e.naturalWidth){d._loadCount++;d.complete=false;d.on("fileload",d._handleImageLoad,d)}}}if(b.frames==null){}else if(b.frames instanceof Array){d._frames=[];a=b.frames;for(c=0,f=a.length;c<f;c++){var g=a[c];d._frames.push({image:d._images[g[4]?g[4]:0],rect:new kisgame.Rectangle(g[0],g[1],g[2],g[3]),regX:g[5]||0,regY:g[6]||0})}}else{o=b.frames;d._frameWidth=o.width;d._frameHeight=o.height;d._regX=o.regX||0;d._regY=o.regY||0;d._spacing=o.spacing||0;d._margin=o.margin||0;d._numFrames=o.count;if(d._loadCount==0){d._calculateFrames()}}d._animations=[];if((o=b.animations)!=null){d._data={};var h;for(h in o){var i={name:h};var j=o[h];if(typeof j=="number"){a=i.frames=[j]}else if(j instanceof Array){if(j.length==1){i.frames=[j[0]]}else{i.speed=j[3];i.next=j[2];a=i.frames=[];for(c=j[0];c<=j[1];c++){a.push(c)}}}else{i.speed=j.speed;i.next=j.next;var k=j.frames;a=i.frames=(typeof k=="number")?[k]:k.slice(0)}if(i.next===true||i.next===undefined){i.next=h}if(i.next===false||(a.length<2&&i.next==h)){i.next=null}if(!i.speed){i.speed=1}d._animations.push(h);d._data[h]=i}}};$._handleImageLoad=function(b){var c=this;if(--c._loadCount==0){c._calculateFrames();c.complete=true;c.dispatchEvent("complete")}};$._handleImageError=function(b){var d=this;var c=new kisgame.Event("error");c.src=b;d.dispatchEvent(c);if(--d._loadCount==0){d.dispatchEvent("complete")}};$._calculateFrames=function(){var b=this;if(b._frames||b._frameWidth==0){return}b._frames=[];var c=b._numFrames||100000;var d=0,e=b._frameWidth,f=b._frameHeight;var g=b._spacing,h=b._margin;imgLoop:for(var i=0,j=b._images;i<j.length;i++){var k=j[i],m=k.width,n=k.height;var p=h;while(p<=n-h-f){var q=h;while(q<=m-h-e){if(d>=c){breakimgLoop}d++;b._frames.push({image:k,rect:new kisgame.Rectangle(q,p,e,f),regX:b._regX,regY:b._regY});q+=e+g}p+=f+g}}b._numFrames=d};kisgame.SpriteSheet=kisgame.promote(_,"EventDispatcher")}());(function(){"use strict";function _(a){var b=this;b.Container_constructor();b.stage=b;b.autoClear=true;b.canvas=(typeof a=="string")?document.getElementById(a):a;b.mouseX=0;b.mouseY=0;b.drawRect=null;b.snapToPixelEnabled=false;b.mouseInBounds=false;b.tickOnUpdate=true;b.mouseMoveOutside=false;b.preventSelection=true;b._pointerData={};b._pointerCount=0;b._primaryPointerID=null;b._mouseOverIntervalID=null;b._nextStage=null;b._prevStage=null;b.enableDOMEvents(true)}var $=kisgame.extend(_,kisgame.Container);$._get_nextStage=function(){var a=this;return a._nextStage};$._set_nextStage=function(a){var b=this;if(b._nextStage){b._nextStage._prevStage=null}if(a){a._prevStage=b}b._nextStage=a};try{Object.defineProperties($,{nextStage:{get:$._get_nextStage,set:$._set_nextStage}})}catch(e){}$.update=function(a){var b=this;if(!b.canvas){return}if(b.tickOnUpdate){b.tick(a)}if(b.dispatchEvent("drawstart",false,true)===false){return}kisgame.DisplayObject._snapToPixelEnabled=b.snapToPixelEnabled;var c=b.drawRectArr,d=b.canvas.getContext("2d");d.setTransform(1,0,0,1,0,0);if(b.autoClear){if(c){var e=c.length;for(var f=0;f<e;f++){var g=c[f];d.clearRect(g.x,g.y,g.width,g.height)}}else{d.clearRect(0,0,b.canvas.width+1,b.canvas.height+1)}}d.save();if(c){d.beginPath();var e=c.length;for(var f=0;f<e;f++){var g=c[f];d.rect(g.x,g.y,g.width,g.height)}d.closePath();d.clip()}b.updateContext(d);b.draw(d,false);d.restore();b.dispatchEvent("drawend")};$.tick=function(a){var b=this;if(!b.tickEnabled||b.dispatchEvent("tickstart",false,true)===false){return}var c=new kisgame.Event("tick");if(a){for(var d in a){if(a.hasOwnProperty(d)){c[d]=a[d]}}}b._tick(c);b.dispatchEvent("tickend")};$.handleEvent=function(a){var b=this;if(a.type=="tick"){b.update(a)}};$.clear=function(){var a=this;if(!a.canvas){return}var b=a.canvas.getContext("2d");b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,a.canvas.width+1,a.canvas.height+1)};$.toDataURL=function(a,b){var e=this;var c,d=e.canvas.getContext('2d'),f=e.canvas.width,g=e.canvas.height;if(a){c=d.getImageData(0,0,f,g);var h=d.globalCompositeOperation;d.globalCompositeOperation="destination-over";d.fillStyle=a;d.fillRect(0,0,f,g)}var j=e.canvas.toDataURL(b||"image/png");if(a){d.putImageData(c,0,0);d.globalCompositeOperation=h}return j};$.enableMouseOver=function(a){var b=this;if(b._mouseOverIntervalID){clearInterval(b._mouseOverIntervalID);b._mouseOverIntervalID=null;if(a==0){b._testMouseOver(true)}}if(a==null){a=20}else if(a<=0){return}var c=b;b._mouseOverIntervalID=setInterval(function(){c._testMouseOver()},1000/Math.min(50,a))};$.enableDOMEvents=function(a){var d=this;if(a==null){a=true}var b,o,c=d._eventListeners;if(!a&&c){for(b in c){o=c[b];o.t.removeEventListener(b,o.f,false)}d._eventListeners=null}else if(a&&!c&&d.canvas){var e=window.addEventListener?window:document;var f=d;c=d._eventListeners={};c[KISU.mu]={t:e,f:function(g){f._handleMouseUp(g)}};c[KISU.mm]={t:e,f:function(g){f._handleMouseMove(g)}};c[KISU.dk]={t:d.canvas,f:function(g){f._handleDoubleClick(g)}};c[KISU.md]={t:d.canvas,f:function(g){f._handleMouseDown(g)}};c[KISU.mw]={t:d.canvas,f:function(g){f._handleMouseWheel(g)}};for(b in c){o=c[b];o.t.addEventListener(b,o.f,false)}}};$.clone=function(){throw ("Stage cannot be cloned.")};$.toString=function(){var a=this;return "[Stage (name="+a.name+")]"};$._getElementRect=function(a){var b;try{b=a.getBoundingClientRect()}catch(err){b={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}}var c=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0);var d=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0);var e=window.getComputedStyle?getComputedStyle(a,null):a.currentStyle;var f=parseInt(e.paddingLeft)+parseInt(e.borderLeftWidth);var g=parseInt(e.paddingTop)+parseInt(e.borderTopWidth);var h=parseInt(e.paddingRight)+parseInt(e.borderRightWidth);var j=parseInt(e.paddingBottom)+parseInt(e.borderBottomWidth);return {left:b.left+c+f,right:b.right+c-h,top:b.top+d+g,bottom:b.bottom+d-j}};$._getPointerData=function(a){var c=this;var b=c._pointerData[a];if(!b){b=c._pointerData[a]={x:0,y:0}}return b};$._handleMouseMove=function(a){var b=this;if(!a){a=window.event}b._handlePointerMove(-1,a,a.pageX,a.pageY)};$._handlePointerMove=function(a,b,c,d,e){var f=this;if(f._prevStage&&e===undefined){return}if(!f.canvas){return}var g=f._nextStage,h=f._getPointerData(a);var j=h.inBounds;f._updatePointerPosition(a,b,c,d);if(j||h.inBounds||f.mouseMoveOutside){if(a===-1&&h.inBounds==!j){f._dispatchMouseEvent(f,(j?"mouseleave":"mouseenter"),false,a,h,b)}f._dispatchMouseEvent(f,"stagemousemove",false,a,h,b);f._dispatchMouseEvent(h.target,"pressmove",true,a,h,b);f._dispatchMouseEvent(h.target||f,KISU.mm,true,a,h,b)}g&&g._handlePointerMove(a,b,c,d,null)};$._updatePointerPosition=function(a,b,c,d){var f=this;var e=f._getElementRect(f.canvas);c-=e.left;d-=e.top;var g=f.canvas.width;var h=f.canvas.height;c/=(e.right-e.left)/g;d/=(e.bottom-e.top)/h;var j=f._getPointerData(a);if(j.inBounds=(c>=0&&d>=0&&c<=g-1&&d<=h-1)){j.x=c;j.y=d}else if(f.mouseMoveOutside){j.x=c<0?0:(c>g-1?g-1:c);j.y=d<0?0:(d>h-1?h-1:d)}j.posEvtObj=b;j.rawX=c;j.rawY=d;if(a===f._primaryPointerID||a===-1){f.mouseX=j.x;f.mouseY=j.y;f.mouseInBounds=j.inBounds}};$._handleMouseUp=function(a){var b=this;b._handlePointerUp(-1,a,false)};$._handlePointerUp=function(a,b,c,d){var f=this;var e=f._nextStage,g=f._getPointerData(a);if(f._prevStage&&d===undefined){return}var h=null,j=g.target;if(!d&&(j||e)){h=f._getObjectsUnderPoint(g.x,g.y,null,true)}if(g.down){f._dispatchMouseEvent(f,"stagemouseup",false,a,g,b,h);g.down=false}if(h==j){f._dispatchMouseEvent(j,"click",true,a,g,b)}if(j&&!j.stage){j=null;var k=g.targetParentList;var l=k.length;for(var m=0;m<l;m++){var n=k[m];if(n.stage){j=n;break}}}g.targetParentList&&g.targetParentList.splice(0);f._dispatchMouseEvent(j,"pressup",true,a,g,b);f._dispatchMouseEvent(h||f,KISU.mu,true,a,g,b);if(c){if(a==f._primaryPointerID){f._primaryPointerID=null}delete (f._pointerData[a])}else{g.target=null}e&&e._handlePointerUp(a,b,c,d||h&&f)};$._handleMouseDown=function(a){var b=this;b._handlePointerDown(-1,a,a.pageX,a.pageY)};$._handlePointerDown=function(a,b,c,d,e){var f=this;if(f.preventSelection){b.preventDefault()}if(f._primaryPointerID==null||a===-1){f._primaryPointerID=a}if(d!=null){f._updatePointerPosition(a,b,c,d)}var g=null,h=f._nextStage,j=f._getPointerData(a);if(!e){g=j.target=f._getObjectsUnderPoint(j.x,j.y,null,true)}if(g&&g.stage){var k=j.targetParentList;if(!k){k=j.targetParentList=[]}else{k.splice(0)}var l=g.parent;while(l&&l!=g.stage){k.push(l);l=l.parent}}if(j.inBounds){f._dispatchMouseEvent(f,"stagemousedown",false,a,j,b,g);j.down=true}f._dispatchMouseEvent(g||f,KISU.md,true,a,j,b);h&&h._handlePointerDown(a,b,c,d,e||g&&f)};$._handleMouseWheel=function(a){var b=this;b._handlePointerWheel(-1,a,a.pageX,a.pageY)};$._handlePointerWheel=function(a,b,c,d,e){var f=this;if(f.preventSelection){b.preventDefault()}if(f._primaryPointerID==null||a===-1){f._primaryPointerID=a}if(d!=null){f._updatePointerPosition(a,b,c,d)}var g=null,h=f._nextStage,j=f._getPointerData(a);if(!e){g=j.target=f._getObjectsUnderPoint(j.x,j.y,null,true)}if(g&&g.stage){var k=j.targetParentList;if(!k){k=j.targetParentList=[]}else{k.splice(0)}var l=g.parent;while(l&&l!=g.stage){k.push(l);l=l.parent}}if(j.inBounds){f._dispatchMouseEvent(f,"stagemousewheel",false,a,j,b,g);j.down=true}f._dispatchMouseEvent(g||f,KISU.mw,true,a,j,b);h&&h._handlePointerWheel(a,b,c,d,e||g&&f)};$._testMouseOver=function(a,b,c){var d=this;if(d._prevStage&&b===undefined){return}var e=d._nextStage;if(!d._mouseOverIntervalID){e&&e._testMouseOver(a,b,c);return}var f=d._getPointerData(-1);if(!f||(!a&&d.mouseX==d._mouseOverX&&d.mouseY==d._mouseOverY&&d.mouseInBounds)){return}var g=f.posEvtObj;var h=c||g&&(g.target==d.canvas);var j=null,k=-1,l="",t,i,q;if(!b&&(a||d.mouseInBounds&&h)){j=d._getObjectsUnderPoint(d.mouseX,d.mouseY,null,true);d._mouseOverX=d.mouseX;d._mouseOverY=d.mouseY}var m=d._mouseOverTarget||[];var n=m[m.length-1];var p=d._mouseOverTarget=[];t=j;while(t){p.unshift(t);if(!l){l=t.cursor}t=t.parent}d.canvas.style.cursor=l;if(!b&&c){c.canvas.style.cursor=l}for(i=0,q=p.length;i<q;i++){if(p[i]!=m[i]){break}k=i}if(n!=j){d._dispatchMouseEvent(n,"mouseout",true,-1,f,g,j)}for(i=m.length-1;i>k;i--){d._dispatchMouseEvent(m[i],"rollout",false,-1,f,g,j)}for(i=p.length-1;i>k;i--){d._dispatchMouseEvent(p[i],"rollover",false,-1,f,g,n)}if(n!=j){d._dispatchMouseEvent(j,"mouseover",true,-1,f,g,n)}e&&e._testMouseOver(a,b||j&&d,c||h&&d)};$._handleDoubleClick=function(a,b){var e=this;var c=null,d=e._nextStage,f=e._getPointerData(-1);if(!b){c=e._getObjectsUnderPoint(f.x,f.y,null,true);e._dispatchMouseEvent(c,"dblclick",true,-1,f,a)}d&&d._handleDoubleClick(a,b||c&&e)};$._dispatchMouseEvent=function(a,b,c,d,e,f,g){var j=this;if(!a||(!c&&!a.hasEventListener(b))){return}var h=new kisgame.MouseEvent(b,c,false,e.x,e.y,f,d,d===j._primaryPointerID||d===-1,e.rawX,e.rawY,g);a.dispatchEvent(h)};kisgame.Stage=kisgame.promote(_,"Container")}());(function(){"use strict";function _(b,c,d){var e=this;e.DisplayObject_constructor();e.text=b;e.font=c;e.color=d;e.textAlign="left";e.textBaseline="top";e.maxWidth=null;e.outline=0;e.lineHeight=0;e.lineWidth=null}var $=kisgame.extend(_,kisgame.DisplayObject);var a=(kisgame.createCanvas?kisgame.createCanvas():document.createElement("canvas"));if(a.getContext){_._workingContext=a.getContext("2d");a.width=a.height=1}_.H_OFFSETS={start:0,left:0,center:-0.5,end:-1,right:-1};_.V_OFFSETS={top:0,hanging:-0.01,middle:-0.4,alphabetic:-0.8,ideographic:-0.85,bottom:-1};$.isVisible=function(){var c=this;var b=c.cacheImage||(c.text!=null&&c.text!=="");return !!(c.visible&&c.alpha>0&&c.scaleX!=0&&c.scaleY!=0&&b)};$.draw=function(b,c){var d=this;if(d.DisplayObject_draw(b,c)){return true}var e=d.color||"#000";if(d.outline){b.strokeStyle=e;b.lineWidth=d.outline*1}else{b.fillStyle=e}d._drawText(d._prepContext(b));return true};$.getMeasuredWidth=function(){var b=this;return b._getMeasuredWidth(b.text)};$.getMeasuredLineHeight=function(){var b=this;return b._getMeasuredWidth("M")*1.2};$.getMeasuredHeight=function(){var b=this;return b._drawText(null,{}).height};$.getBounds=function(){var c=this;var b=c.DisplayObject_getBounds();if(b){return b}if(c.text==null||c.text===""){return null}var d=c._drawText(null,{});var e=(c.maxWidth&&c.maxWidth<d.width)?c.maxWidth:d.width;var f=e*_.H_OFFSETS[c.textAlign||"left"];var g=c.lineHeight||c.getMeasuredLineHeight();var h=g*_.V_OFFSETS[c.textBaseline||"top"];return c._rectangle.setValues(f,h,e,d.height)};$.getMetrics=function(){var c=this;var b={lines:[]};b.lineHeight=c.lineHeight||c.getMeasuredLineHeight();b.vOffset=b.lineHeight*_.V_OFFSETS[c.textBaseline||"top"];return c._drawText(null,b,b.lines)};$.clone=function(){var b=this;return b._cloneProps(new _(b.text,b.font,b.color))};$.toString=function(){var b=this;return "[Text (text="+(b.text.length>20?b.text.substr(0,17)+"...":b.text)+")]"};$._cloneProps=function(b){var c=this;c.DisplayObject__cloneProps(b);b.textAlign=c.textAlign;b.textBaseline=c.textBaseline;b.maxWidth=c.maxWidth;b.outline=c.outline;b.lineHeight=c.lineHeight;b.lineWidth=c.lineWidth;return b};$._prepContext=function(b){var c=this;b.font=c.font||"10px sans-serif";b.textAlign=c.textAlign||"left";b.textBaseline=c.textBaseline||"top";return b};$._drawText=function(b,c,d){var f=this;var e=!!b;if(!e){b=_._workingContext;b.save();f._prepContext(b)}var g=f.lineHeight||f.getMeasuredLineHeight();var h=0,i=0;var j=String(f.text).split(/(?:\r\n|\r|\n)(?:\r\n|\r|\n)/);for(var k=0,l=j.length;k<l;k++){var m=j[k];var n=null;if(f.lineWidth!=null&&(n=b.measureText(m).width)>f.lineWidth){var o=m.split(/(\s)(\s)/);m=o[0];n=b.measureText(m).width;for(var p=1,q=o.length;p<q;p+=2){var r=b.measureText(o[p]+o[p+1]).width;if(n+r>f.lineWidth){if(e){f._drawTextLine(b,m,i*g)}if(d){d.push(m)}if(n>h){h=n}m=o[p+1];n=b.measureText(m).width;i++}else{m+=o[p]+o[p+1];n+=r}}}if(e){f._drawTextLine(b,m,i*g)}if(d){d.push(m)}if(c&&n==null){n=b.measureText(m).width}if(n>h){h=n}i++}if(c){c.width=h;c.height=i*g}if(!e){b.restore()}return c};$._drawTextLine=function(b,c,d){var e=this;if(e.outline){b.strokeText(c,0,d,e.maxWidth||0xFFFF)}else{b.fillText(c,0,d,e.maxWidth||0xFFFF)}};$._getMeasuredWidth=function(b){var e=this;var c=_._workingContext;c.save();var d=e._prepContext(c).measureText(b).width;c.restore();return d};kisgame.Text=kisgame.promote(_,"DisplayObject")}());;(function(){var _=kisgame.DirectionType;function $(){var b=this;b.last_y=0;b.last_last_y=0;b.down_y=0;b.last_x=0;b.last_last_x=0;b.down_x=0;b.last_time=0;b.last_value=0;b.rate_scrol=1;b.maxValue=0;b.tValue=0;b.limitScrollValue=false;b.pageMode=true;b.pageIndex=0;b.pageMin=0;b.pageCell=0;b.pageMax=0;b.pageSize=1;b.vscrollTweenObj=new Object();b.vscrollTweenObj.velocity=0;b.hotDownMatrix}var a=$.prototype;a.valiateValue=function(b,c){var d=this;if(typeof c==="undefined"){c=false}if(d.limitScrollValue||c){if(b<0){b=0}else if(b>d.maxValue){b=d.maxValue}}return b};a.reset=function(){var b=this;b.pageIndex=0;b.setValue(0)};a.setParam=function(b,c,d,e,f){var g=this;g.container_mc=b;g.maxValue=c;g.direction=d;g.viewRect=e;g.pageMode=false;b.scrollRect=e;if(g.hot_mc&&g.hot_mc!=f){g.hot_mc.off("mousedown",g.onMouseDown,false,g)}g.hot_mc=f;g.hot_mc.on("mousedown",g.onMouseDown,g)};a.setParamPage=function(b,c,d,e,f,g,h,i,j){var k=this;if(typeof g==="undefined"){g=0}if(typeof h==="undefined"){h=0}if(typeof i==="undefined"){i=1}if(typeof j==="undefined"){j=0}k.pageCell=g||(d==_.HORIZONTAL?e.width:e.height);k.pageMax=h;k.pageSize=i;k.pageMin=j;k.setParam(b,c,d,e,f);k.pageMode=true};a.onMouseDown=function(b){var c=this;c.hotDownMatrix=c.hot_mc.parent.getConcatenatedMatrix().invert().clone();var d=c.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());if(c.direction==_.HORIZONTAL){var e=d.x;c.last_last_x=e;c.last_x=e;c.down_x=e}else{var f=d.y;c.last_last_y=f;c.last_y=f;c.down_y=f}c.stopScrollTween();c.last_time=getTimer();c.last_value=c.tValue;var g=c.vscrollTweenObj;g.endTValue=NaN;if(c.isOverflow()){c.container_mc.stage.on("pressmove",c.onStageMouseMove,c);c.container_mc.stage.on("pressup",c.onStageMouseUp,c);g.time=getTimer()}else{c.container_mc.stage.off("pressmove",c.onStageMouseMove,false,c);c.container_mc.stage.off("pressup",c.onStageMouseUp,false,c)}};a.isOverflow=function(){return true};a.setValue=function(b){var c=this;b=c.valiateValue(b);c.tValue=b;if(c.direction==_.HORIZONTAL){c.viewRect.x=c.getScrollLength()*b/c.maxValue}else{c.viewRect.y=c.getScrollLength()*b/c.maxValue}c.container_mc.scrollRect=c.viewRect;c.container_mc.dispatchEvent(new kisgame.Event("updateScroll"))};a.getScrollLength=function(){var d=this;var b;var c=d.maxValue;var e;if(d.direction==_.HORIZONTAL){e=d.viewRect.width;b=(c-e>0?c-e:e)}else{e=d.viewRect.height;b=(c-e>0?c-e:e)}return b};a.getValue=function(){var b=this;return b.tValue};a.getValiateValue=function(){var b=this;return b.valiateValue(b.tValue,true)};a.stopScrollTween=function(){var b=this;TweenMotion.killTweensOf(b.vscrollTweenObj)};a.onStageMouseMove=function(b){var d=this;var c=d.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());var e=d.vscrollTweenObj;var f=0;if(d.direction==_.HORIZONTAL){var g=c.x;f=g-d.last_x}else{var h=c.y;f=h-d.last_y}if(d.isOverflow()){var i=f>0?-1:1;if(e.sign!=i){e.velocity=0}e.tValue=d.tValue;e.sign=i;var j=d.tValue-f;e.endTValue=NaN;e.tValue=j;d.updateVScrollHandler2()}d.last_last_y=d.last_y;d.last_last_x=d.last_x;if(d.direction==_.HORIZONTAL){d.last_x=g}else{d.last_y=h}d.last_time=getTimer()};a.updateVScrollHandler3=function(){var b=this;b.vscrollTweenObj.endTValue=NaN;b.updateVScrollHandler2()};a.updateVScrollHandler2=function(){var b=this;b.setValue(b.vscrollTweenObj.tValue)};a.onStageMouseUp=function(b){var c=this;c.container_mc.stage.off("pressmove",c.onStageMouseMove,false,c);c.container_mc.stage.off("pressup",c.onStageMouseUp,false,c);if(c.pageMode){c.onPageMUP(b)}else{c.onUnPageMUP(b)}};a.removeMEvents=function(){var b=this;b.container_mc.stage.off("pressmove",b.onStageMouseMove,false,b);b.container_mc.stage.off("pressup",b.onStageMouseUp,false,b)};a.onUnPageMUP=function(b){var d=this;var c=d.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());var e=d.vscrollTweenObj;var f=d.tValue;var g=Math.abs(f-d.last_value)>0.05;var h=c.x-d.last_last_x;var i=c.y-d.last_last_y;var j=0;if(d.direction==_.HORIZONTAL){j=h}else{j=i}var k=Math.sqrt(h*h+i*i);var l=(getTimer()-e.time)/1000;var m=d.maxValue;if(d.isOverflow()&&g){if(l>0.5&&f<m&&f>0){e.velocity=0}if(l>0.4){l=0.9;e.velocity=0}if(d.getScrollLength()>m){e.velocity+=k*1.5}else if(f<m&&f>0){if(l<=0.5){e.velocity+=k*4*(1-l)}}else{e.velocity=1}if(e.velocity>100){e.velocity=100}e.sign=j>0?-1:1;e.damping=k*0.05;e.endTValue=NaN;TweenMotion.to(e,100,{overwrite:1,forceAdd:true,apply:d}).tick(d.updateVScrollHandler)}};a.onPageMUP=function(b){var d=this;var c=d.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());var e=d.vscrollTweenObj;var f=0;if(d.direction==_.HORIZONTAL){var g=c.x;f=g-d.down_x}else{var h=c.y;f=h-d.down_y}var i=(getTimer()-d.last_time)/1000;var j=f>0?-1:1;var k=Math.abs(d.tValue-d.last_value)>0.05;if((i<0.1&&k)||Math.abs(f)>d.pageCell*1/3){if(j>0){d.setPageIndex(d.pageIndex+d.pageSize)}else{d.setPageIndex(d.pageIndex-d.pageSize)}}else{d.setPageIndex(d.pageIndex)}e.velocity=0;e.damping=0;e.endTValue=NaN};a.updateVScrollHandler=function(){var c=this;var b=c.vscrollTweenObj;var d=c.maxValue;var e=false;if(b.velocity<=0.005){b.velocity=0;if(f>d||(c.getScrollLength()>d&&f>0)){c.setValue(d)}else if(f<0){c.setValue(0)}c.stopScrollTween()}else{var f=c.tValue+b.sign*b.velocity;var g=0;if(f>d){b.sign=-1;if(c.getScrollLength()>d){g=f}else{g=d-f}e=true}else if(f<0){e=true;b.sign=1;g=-f}else if(f>0&&(c.getScrollLength()>d)){b.sign=-1;g=f;e=true}if(e){b.velocity=Math.abs(g)*0.3;b.damping=Math.abs(g)*0.05}c.setValue(f);b.velocity-=b.damping;if(b.damping>1){b.damping*=0.05}}};a.easeCircOut=function(b,a,c,d){return c*Math.sqrt(1-(b=b/d-1)*b)+a};a.setPageIndex=function(b,c){var e=this;if(typeof c==="undefined"){c=false}var d=e.pageIndex;if(b<e.pageMin){d=e.pageMin}else if(b>e.pageMax){d=e.pageMax}else{d=b}e.pageIndex=d;var f=d*e.pageCell*e.maxValue/e.getScrollLength();if(Math.abs(f-e.tValue)>10&&!c){e.vscrollTweenObj.tValue=e.tValue;TweenMotion.to(e.vscrollTweenObj,0.5,{overwrite:1,tValue:f,ease:e.easeCircOut,apply:e}).tick(e.updateVScrollHandler4).call(e.updateVScrollHandler4)}else{if(c){e.stopScrollTween()}e.vscrollTweenObj.tValue=f;e.updateVScrollHandler4()}var g=new kisgame.Event("changepage",false,true);g.data=e.pageIndex;e.container_mc.dispatchEvent(g)};a.isScrolling=function(){var b=this;return TweenMotion.containTweens(b.vscrollTweenObj)};a.updateVScrollHandler4=function(){var b=this;b.setValue(b.vscrollTweenObj.tValue)};kisgame.TouchScrollHelper=$}());(function(){"use strict";function _(a,b){var c=this;c.setValues(a,b)}var $=_.prototype;$.setValues=function(a,b){var c=this;c.x=a||0;c.y=b||0;return c};$.copy=function(a){var b=this;b.x=a.x;b.y=a.y;return b};$.clone=function(){var a=this;return new _(a.x,a.y)};$.toString=function(){var a=this;return "[Point (x="+a.x+" y="+a.y+")]"};kisgame.Point=_}());(function(){"use strict";function _(a,b,c,d){var e=this;e.setValues(a,b,c,d)}var $=_.prototype;$.setValues=function(a,b,c,d){var e=this;e.x=a||0;e.y=b||0;e.width=c||0;e.height=d||0;return e};$.extend=function(a,b,c,d){var e=this;c=c||0;d=d||0;if(a+c>e.x+e.width){e.width=a+c-e.x}if(b+d>e.y+e.height){e.height=b+d-e.y}if(a<e.x){e.width+=e.x-a;e.x=a}if(b<e.y){e.height+=e.y-b;e.y=b}return e};$.pad=function(a,b,c,d){var e=this;e.x-=b;e.y-=a;e.width+=b+d;e.height+=a+c;return e};$.copy=function(a){var b=this;return b.setValues(a.x,a.y,a.width,a.height)};$.contains=function(a,b,c,d){var e=this;c=c||0;d=d||0;return (a>=e.x&&a+c<=e.x+e.width&&b>=e.y&&b+d<=e.y+e.height)};$.union=function(a){var b=this;return b.clone().extend(a.x,a.y,a.width,a.height)};$.intersection=function(a){var f=this;var b=a.x,c=a.y,d=b+a.width,e=c+a.height;if(f.x>b){b=f.x}if(f.y>c){c=f.y}if(f.x+f.width<d){d=f.x+f.width}if(f.y+f.height<e){e=f.y+f.height}return (d<=b||e<=c)?null:new _(b,c,d-b,e-c)};$.intersects=function(a){var b=this;return (a.x<=b.x+b.width&&b.x<=a.x+a.width&&a.y<=b.y+b.height&&b.y<=a.y+a.height)};$.isEmpty=function(){var a=this;return a.width<=0||a.height<=0};$.clone=function(){var a=this;return new _(a.x,a.y,a.width,a.height)};$.toString=function(){var a=this;return "[Rectangle (x="+a.x+" y="+a.y+" width="+a.width+" height="+a.height+")]"};$.mix=function(a,b,c,d,e){var j=this;var f=false;var g=a+c;var h=b+d;var i=j.x;var k=j.y;var l=j.x+j.width;var m=j.y+j.height;if(a<=l&&i<=g&&b<=m&&k<=h){f=true}else if(a>=i&&g<=l&&b>=k&&h<=m||i>=a&&l<=g&&k>=b&&m<=h){return true}else{if(Math.abs(i-g)<e&&Math.abs(k-h)<e||Math.abs(a-l)<e&&Math.abs(b-m)<e){f=true}}if(f){j.extend(a,b,c,d)}return f};$.ceil=function(){var a=this;a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.width=Math.ceil(a.width);a.height=Math.ceil(a.height)};$.equals=function(a){var b=this;return b.x==a.x&&b.y==a.y&&b.width==a.width&&b.height==a.height};kisgame.Rectangle=_}());(function(){"use strict";function _(a,b,c,d,e,f,g){var h=this;if(!a.addEventListener){return}h.target=a;h.overLabel=c==null?"over":c;h.outLabel=b==null?"out":b;h.downLabel=d==null?"down":d;h.play=e;h._isPressed=false;h._isOver=false;h._enabled=false;a.mouseChildren=false;h.enabled=true;h.handleEvent({});if(f){if(g){f.actionsEnabled=false;f.gotoAndStop&&f.gotoAndStop(g)}a.hitArea=f}}var $=_.prototype;$.setEnabled=function(a){var b=this;if(a==b._enabled){return}var c=b.target;b._enabled=a;if(a){c.cursor="pointer";c.addEventListener("rollover",b);c.addEventListener("rollout",b);c.addEventListener("mousedown",b);c.addEventListener("pressup",b);if(c._reset){c.__reset=c._reset;c._reset=b._reset}}else{c.cursor=null;c.removeEventListener("rollover",b);c.removeEventListener("rollout",b);c.removeEventListener("mousedown",b);c.removeEventListener("pressup",b);if(c.__reset){c._reset=c.__reset;delete (c.__reset)}}};$.getEnabled=function(){var a=this;return a._enabled};try{Object.defineProperties($,{enabled:{get:$.getEnabled,set:$.setEnabled}})}catch(e){}$.toString=function(){return "[ButtonHelper]"};$.handleEvent=function(a){var d=this;var b,c=d.target,e=a.type;if(e=="mousedown"){d._isPressed=true;b=d.downLabel}else if(e=="pressup"){d._isPressed=false;b=d._isOver?d.overLabel:d.outLabel}else if(e=="rollover"){d._isOver=true;b=d._isPressed?d.downLabel:d.overLabel}else{d._isOver=false;b=d._isPressed?d.overLabel:d.outLabel}if(d.play){c.gotoAndPlay&&c.gotoAndPlay(b)}else{c.gotoAndStop&&c.gotoAndStop(b)}};$._reset=function(){var a=this;var $=a.paused;a.__reset();a.paused=$};kisgame.ButtonHelper=_}());(function(){"use strict";function _(a,b,c){var d=this;d.EventDispatcher_constructor();var $=d;$.paused=true;$.complete=false;$._taskLoadingList=[];$._tasklist=[];$._taskTaglist=[];$._tasktotallist=[];$.maxThread=2}var $=kisgame.extend(_,kisgame.EventDispatcher);_._totallist=[];$.getSize=function(){var a=this;return a._tasktotallist.length};$.reset=function(){var a=this;a._taskLoadingList.splice(0);trace("LoaderList reset");a._tasklist.splice(0);a._taskTaglist.splice(0);a._tasktotallist.splice(0);a.complete=false;a.paused=true};$.getItem=function(a){if(!a)return;var b=_._totallist;var c=b.length;for(var d=0;d<c;d++){var e=b[d];if(e.id==a||e.src==a||e.url==a){return e}}return null};$.getBlobUrl=function(a){var c=this;if(!a)return;var b=c.getItem(a);if(b){return b.bloburl}return null};$.getResult=function(a){var c=this;if(!a)return;var b=c.getItem(a);if(b&&b._loader&&b._loader._tag&&b._loader._tag.loaded){return b._loader._tag}return null};$.handleTagLoad=function(a){var b=a.currentTarget;var c=b.manager;b.removeEventListener("load",c.handleTagLoad);b.removeEventListener("error",c.handleTagError);var d=b.item;c._removeLoadingItem(d);var e=new kisgame.Event("fileload");e.item=d;e.result=b;b.manager=null;b.item=null;b.loaded=true;var f=c._taskTaglist.indexOf(d);if(f!=-1){c._taskTaglist.splice(f,1)}c.dispatchEvent(e);if(!c.paused){c._nextTaskLoop()}};$.handleTagError=function(a){var b=a.currentTarget;var c=b.manager;b.removeEventListener("load",c.handleTagLoad);b.removeEventListener("error",c.handleTagError);var d=b.item;c._removeLoadingItem(d);var e=new kisgame.Event("fileerror");e.item=d;b.manager=null;b.item=null;b.loaded=false;var f=c._taskTaglist.indexOf(d);if(f!=-1){c._taskTaglist.splice(f,1)}c.dispatchEvent(e);if(!c.paused){c._nextTaskLoop()}};$.handleFileLoad=function(a){var c=this;var b=c;var d=a.currentTarget;var e=d.item;if(!e)return;c._removeLoadingItem(e);d.item=null;var f=d.data;if(f){var g=URL.createObjectURL(f);var h=e._loader._tag;e.bloburl=g;if(h){b._addLoadingItem(e);h.manager=c;h.item=e;h.addEventListener("load",c.handleTagLoad);h.addEventListener("error",c.handleTagError);h.src=g;if(b._taskTaglist.indexOf(e)==-1)b._taskTaglist.push(e)}else{var i=new kisgame.Event("fileload");i.item=e;b.dispatchEvent(i);if(!b.paused){b._nextTaskLoop()}}return}};$.handleFileProgress=function(a){var c=this;var b=c;var d=a.currentTarget;var e=d.item;e.progress=a.loaded/a.total;var f=new kisgame.Event("progress");f.loaded=c._getProgress();f.total=c._tasktotallist.length;b.dispatchEvent(f)};$.handleFileError=function(a){var c=this;var b=c;var d=a.currentTarget;var e=d.item;b._removeLoadingItem(e);var f=new kisgame.Event("fileerror");f.item=e;if(!b.paused){b._nextTaskLoop()}};$.setPaused=function(a){var b=this;b.paused=a};$.loadFile=function(a,b,c){var f=this;if(b==undefined){b=true}if(typeof (a)=="string"){a={id:a,src:a}}var d=(a.basePath||c||"")+a.src;var e=f.getItem(a.id||a.src);if(e&&a.src==e.src){if(e.bloburl){return e}var g=f._tasklist.indexOf(e);if(g!=-1){f._tasklist.splice(g,1);f._tasklist.unshift(e)}}else{if(e){f._deleteItem(e)}var h=f._tasklist;var i={};for(var j in a){i[j]=a[j]}i.url=d;i.progress=0;if(c&&!i.basePath){i.basePath=c}if(!i.type){var k=[".png",".jpg","jpeg",".gif"];var l=[".mp3",".wav"];var m=d.substr(-4);if(k.indexOf(m)!=-1){i.type="image"}else if(l.indexOf(m)!=-1){i.type="sound"}}h.unshift(i);f._addItem(i)}if(b){f._nextTaskLoop()}};$._removeLoadingItem=function(a){var c=this;var b=c._taskLoadingList.indexOf(a);if(b!=-1){c._taskLoadingList.splice(b,1)}};$._addLoadingItem=function(a){var c=this;var b=c._taskLoadingList.indexOf(a);if(b!=-1){c._taskLoadingList.splice(b,1)}c._taskLoadingList.push(a)};$._addItem=function(a){var d=this;var b=_._totallist;var c=b.indexOf(a);if(c==-1){b.push(a);d._tasktotallist.push(a)}};$._deleteItem=function(a){var d=this;if(a._loader){a._loader._tag=null;a._loader.item=null}var b=_._totallist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._tasktotallist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._tasklist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._taskTaglist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._taskLoadingList;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}};$._getProgress=function(){var b=this;var a=b._tasktotallist;var c=a.length;var d=0;for(var e=0;e<c;e++){var f=a[e];d+=f.progress}return d};$.loadManifest=function(a,b,c){var f=this;if(b==undefined){b=true}if(typeof (a)=="string"){}else{var d=a.length;for(var e=d-1;e>=0;e--){f.loadFile(a[e],false,c)}if(b&&f.paused){f._nextTaskLoop()}}};$._prependItemTag=function(a){var c=this;var b=c;if(!a._loader){a._loader={};if(a.type=="image"){a._loader._tag=new Image()}}};$._loadFileBase=function(a){var c=this;var b=c;var d=new URLRequest(a.url);if(a.method)d.method=a.method||"GET";if(a.params)d.data=a.params;b._prependItemTag(a);b.paused=false;b._addLoadingItem(a);var e=new URLLoader();e.autoDestory=true;e.item=a;e.dataFormat="blob";e.addEventListener("error",b.handleFileError,b);e.addEventListener("progress",b.handleFileProgress,b);e.addEventListener("complete",b.handleFileLoad,b);e.load(d)};$._nextTaskLoop=function(){var b=this;var a=b;var c=a._tasklist;var d=a._taskTaglist;var e=a._taskLoadingList;var f=c.length;var g=d.length;var h=e.length;if(f||g||h){if(f){if(a.maxThread>=h){b._loadFileBase(c.shift())}else{trace("超过允许最大下载数");a._prependItemTag(c[0])}}}else{a.complete=true;a.dispatchEvent(new kisgame.Event("complete"))}};kisgame.LoaderList=kisgame.promote(_,"EventDispatcher")}());var b=kisgame.RManager=new kisgame.EventDispatcher();b.invaliateList=new Object();b.externalLibs=[];b.getBlobUrl=function(_,$,a){var d=this;var c=d.lib;var e=c.getItem(_);if(!e){c.loadFile(_,false)}return c.getBlobUrl(_)};b.getImageResult=function(_,$,a){var d=this;var c=d.lib;var e=c.getItem(_);if(!e){c.loadFile(_,true)}else{e=c.getResult(_)}var f=d.invaliateList[_];if(f){var g=f.indexOf($);if(g==-1){f.push([$,!!a])}}else{d.invaliateList[_]=[[$,!!a]]}return e};b.getImage=function(_,$,a){var d=this;var c=d.lib;var e=c.getItem(_);if(!e){c.loadFile(_,true)}else{e=c.getResult(_)}if(!e){e=c.getItem(_)._loader._tag}var f=d.invaliateList[_];if(f){var g=f.indexOf($);if(g==-1){f.push([$,!!a])}}else{d.invaliateList[_]=[[$,!!a]]}return e};b.handleFileLoad=function(_){var c=this;var $=_.item;if($.isExLib){var a=c.externalLibs;var d=a.length;for(var e=0;e<d;e++){var f=a[e];if($[f.imgid]){f.images[$[f.imgid]]=_.result;break}}}var g=c.invaliateList;var h=_.item.src;var i=g[h];if(i){var d=i.length;for(var e=0;e<d;e++){var j=i[e][0];if(i[e][1]){var k=new kisgame.Event("fileload");k.src=h;j.dispatchEvent(k);if(!k.defaultPrevented){i.splice(e,1);e--;d--}}else{j.draw()}}if(i.length==0){delete g[h]}}};b.handleFileError=function(_){var a=this;var $=a.invaliateList;var c=_.item.src;var d=$[c];if(d){var e=d.length;for(var f=0;f<e;f++){var g=d[f][0];if(d[f][1]){var h=new kisgame.Event("fileerror");h.src=c;g.dispatchEvent(h);if(!h.defaultPrevented){d.splice(f,1);f--;e--}}}if(d.length==0){delete $[c]}}};b.loadManifest=function(_,$,a){var c=this;c.lib.loadManifest(_,$,a)};b.loadExternalLibs=function(_){var d=this;var $=_.length;for(var a=0;a<$;a++){var c=_[a];if(c.isMain){d.loadMainLib(c)}else{d.loadExternalLib(c)}}};b.loadMainLib=function(_){var a=this;var $=_.lib.properties.manifest;if(_.lib.initSpriteSheets){_.lib.initSpriteSheets(_.basePath)}a.lib.loadManifest($,true,_.basePath)};b.loadExternalLib=function(_){var $=this;if($.externalLibs.indexOf(_)==-1){var a=[];var c=[];var d=[".png",".jpg","jpeg",".gif"];var e=[".mp3",".wav"];var f=_.lib.properties.manifest;var g=f.length;_.lib.imgid=_.imgid;if(_.lib.initSpriteSheets){_.lib.initSpriteSheets(_.basePath)}for(var h=0;h<g;h++){var i=f[h];var j=i.src.substr(-4);if(d.indexOf(j)!=-1){i[_.imgid]=i.id;delete i.id;i.isExLib=true;c.push(i)}else if(e.indexOf(j)!=-1){a.push(i);if(i.id.indexOf(_.imgid)!=0){i.id=_.imgid+i.id}}}var k=c.concat(a);$.externalLibs.push(_);$.lib.loadManifest(k,true,_.basePath)}};b.handleProgress=function(_){var a=this;_.stopPropagation();var $=new kisgame.Event(_.type);$.loaded=_.loaded;$.total=_.total;a.dispatchEvent($)};b.handleComplete=function(_){var $=this;_.stopPropagation();$.dispatchEvent(_)};b.getSize=function(){var _=this;return _.lib.getSize()};var lib=b.lib=new kisgame.LoaderList();lib.on("fileload",b.handleFileLoad,b);lib.on("complete",b.handleComplete,b);lib.on("progress",b.handleProgress,b);lib.on("fileerror",b.handleFileError,b);;(function(){function _(a){var b=this;b._super(_.super_p.constructor,a);kisgame.Ticker.framerate=30;kisgame.Ticker.on("tick",b.tickHandler,b);b.autoUpdate=true;b.autoClear=true;b.dirtyRectDistance=100;b.m_invaliate_arr=[];b.invaliate_arr=[];b.dirtyrect_arr=[];b.newDirtyrect_arr=[];b.screenRect=new kisgame.Rectangle();b.on("stagemousedown",b.clearHitTest,b);b.on("stagemouseup",b.clearHitTest,b);b.tickHandler()}var $=KISU.extend(_,kisgame.Stage);$.destory=function(a){var b=this;kisgame.Ticker.off("tick",b.tickHandler,false,b);b.off("stagemousedown",b.clearHitTest,false,b);b.off("stagemouseup",b.clearHitTest,false,b)};$.setFrameRate=function(a){kisgame.Ticker.framerate=a};$.setSize=function(a,b){var c=this;c.canvas.width=a;c.canvas.height=b;c.screenRect.width=a;c.screenRect.height=b};$.tickHandler=function(){var a=this;if(a.autoUpdate){if(!a.unUpdate)a.update()}else{var b=a.dirtyrect_arr;var c=a.dirtyRectDistance;var d=a.screenRect;var e=a.invaliate_arr;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(h.stage){var i=h.getBorderBounds(a);if(i&&d.intersects(i))b.push(i)}}e.length=0;e=a.m_invaliate_arr;var f=e.length;for(var g=0;g<f;g++){var h=e[g];h.kis_invaliated=false}e.length=0;var f=b.length;a.drawRectArr=null;if(f){var j=a.newDirtyrect_arr;j.length=0;var k;for(var g=0;g<f;g++){var l=b[g];if(j.length==0){j.push(l.clone());continue}var m=j.length;for(var n=0;n<m;n++){var o=j[n];if(o.mix(l.x,l.y,l.width,l.height,c)){m=-1;break}}if(m!=-1){j.push(l)}}f=j.length;for(var g=0;g<f;g++){var k=j[g];k.pad(5,5,5,5);k.ceil();if(k.x<0)k.x=0;if(k.y<0)k.y=0;if(k.width>d.width+1){k.width=d.width+1}if(k.height>d.height+1){k.height=d.height+1}}if(f>0){a.drawRectArr=j}if(!a.unUpdate)a.update();if(f&&a.showDirty){var p=a.canvas.getContext("2d");p.setTransform(1,0,0,1,0,0);p.beginPath();p.globalAlpha=1;p.lineWidth=1;p.strokeStyle="#ff0000";for(var g=0;g<f;g++){var q=j[g];p.rect(q.x-1,q.y-1,q.width-2,q.height-2)}p.stroke()}}b.splice(0)}};$.getBorderBounds=function(){var a=this;return a.getBounds()};$.invaliate=function(a){var b=this;if(a&&!a.kis_invaliated){a.kis_invaliated=true;b.m_invaliate_arr.push(a);var c=b.screenRect;var d=b.invaliate_arr;var e=b.dirtyrect_arr;if(a.stage&&a.isVisible()&&a.alpha){var f=a.getBorderBounds(b);if(f&&c.intersects(f))e.push(f)}var g=d.length;for(var h=0;h<g;h++){var i=d[h];if(i==a||i.contains&&i.contains(a)){return}else if(a.contains&&a.contains(i)){d.splice(h,1);h--;g--}}d.push(a)}};$.clearHitTest=function(){var a=kisgame.DisplayObject._hitTestContext;a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,10,10)};$.toString=function(){var a=this;return "[KISStage (name="+a.name+")]"};kisgame.KISStage=_}());(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.width=a.height=60;a.bgImage_x=0;a.bgImage_y=0;a.borderWidth=1;a.borderStyle="solid";a.borderColor="black";a.backgroundColor="white";a.backgroundImage="";a.style=new Object();a.style.graphics={lines:[],images:[]};a.uID=_.unquareID++}_.unquareID=0;var $=KISU.extend(_,kisgame.Container);$.destory=function(a){var b=this;if(TweenMotion.containTarget(b)){TweenMotion.killTweensOf(b)}LaterFrameTable.removeOf(b);b._super(_.super_p.destory,a)};$.setFocus=function(){};$.setVisible=function(a){var b=this;b.visible=a};$.setAlpha=function(a){var b=this;b.alpha=a};$.refreshSize=function(){var a=this;a.setSize(a.width,a.height)};$.setName=function(a){var b=this;b.name=a};$.parseFromPool=function(a,b,c,d){var f=this;var e=d||f;var g=a.length;for(var h=0;h<g;h+=2){var j=c[a[h]];var k=c[a[h+1]];if(k instanceof Array){var l;if(isNaN(c[k[0]])){l={}}else{l=[]}e[j]=l;f.parseFromPool(k,b,c,l)}else{e[j]=k}}if(!d){a.splice(0)}};$.parseProps=function(a){var c=this;for(var b in a){c[b]=a[b]}};$.hitTestPoint=function(a,b){var c=this;if(b){return c._getObjectsUnderPoint(a.x,a.y)}else{var d=c.hitAreaRectangle||c.getBounds();if(d.isFull){return true}else{var a=c.globalToLocal(a.x,a.y);if(d.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>d.radius){return false}else if(a.x<d.x||a.y<d.y||a.x>d.x+d.width||a.y>d.y+d.height){return false}}}return true};$.local2Global=function(a){var b=this;return b.localToGlobal(a.x,a.y,a)};$.addETL=function(a,b,c){var d=this;d.on(a,b,c)};$.removeETL=function(a,b,c){var d=this;d.off(a,b,false,c)};$.getSize=function(){var a=this;return {width:a.width,height:a.height}};$.setSize=function(a,b,c){var d=this;d._super(_.super_p.setSize,a,b,c);if(d.i_l_w!=a||d.i_l_h!=b){d.borderBGDraw();d.updateUseAreaRect()}d.handleChildrenSize(a,b)};$.handleChildrenSize=function(a,b){var c=this;if(c.i_l_w!=a||c.i_l_h!=b)c.fixChildrenSize();c.i_l_w=c.width;c.i_l_h=c.height};$.fixChildrenSize=function(){var a=this;if(a.sizeChildren){var b=a;var c=a.width;var d=a.height;var e=b.children;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(h&&h.posSize){var j=h.fixPosSize(h.posSize,c,d);if(j.x!=h.x||j.y!=h.y)h.move(j.x,j.y);if(j.w!=h.width||j.h!=h.height)h.setSize(j.w,j.h)}}}};$.drawBorder=function(){var b=this;var a=b.style;if(b.border){a.borderStyle=b.borderStyle;a.borderWidth=b.borderWidth;a.borderColor=b.borderColor}else{delete a.borderStyle;delete a.borderWidth;delete a.borderColor;var c=["Left","Top","Right","Bottom"];var d=c.length;for(i=0;i<d;i++){m=c[i];delete a["border"+m+"Style"];delete a["border"+m+"Width"];delete a["border"+m+"Color"]}}var e=b.borderformat;if(e){for(var f in e){var g=e[f];for(var h in g){var j=g[h];a["border"+f+h]=j}}}if(b.width!=-1||b.height!=-1){b.setSize(b.width,b.height)}else{b.borderBGDraw()}};$.setBackgroundColor=function(a){var b=this;b.i_setBackgroundColor(a);b.borderBGDraw()};$.moveBackground=function(a,b){var c=this;if(i_moveBackground(a,b)){c.borderBGDraw()}};$.i_setBackgroundColor=function(a){var b=this;b.backgroundColor=a;b.style.backgroundColor=a};$.i_moveBackground=function(a,b){var c=this;if(a!=c.bgImage_x||b!=c.bgImage_y){c.bgImage_x=a;c.bgImage_y=b;return true}};$.drawBackground=function(){var a=this;if(a.background){a.i_setBackgroundColor(a.backgroundColor);var b=a.bgImage;var c=a.backgroundImage;if(b&&b.url){if(a.i_l_bg!=b.url)a.style.backgroundImage=b.url;a.style.backgroundRepeat=b.repeat||"";a.i_moveBackground(b.x,b.y);a.i_l_bg=b.url}else if(c){if(a.i_l_bg!=c)a.style.backgroundImage=c;a.style.backgroundRepeat=a.bgImage_repeat||"no-repeat";a.i_moveBackground(a.bgImage_x,a.bgImage_y);a.i_l_bg=c}}else{a.style.backgroundImage="";a.style.backgroundColor="";a.i_l_bg=""}a.borderBGDraw()};$.getNextHighestDepth=function(){var a=this;return a.getNumChildren()};$.removeChildrens=function(){var a=this;a.removeAllChildren()};$.setStyle=function(a,b){var c=this;c.style[a]=b};$.getStyle=function(a){var b=this;return b.style[a]};$.getTargetPath=function(){var b=this;var a=b;var c="";while(a){c="."+a.name+c;a=a.parent}return c.substr(1,c.length-1)};$.callLaterFrame=function(a,b,c){var g=this;if(!a)return;var d=[];if(arguments.length>3){var e=arguments.length;for(var f=3;f<e;f++){d.push(arguments[f])}}c=c||g;LaterFrameTable.addOnce(a,b,c,d)};$.callLaterFrame2=function(a,b,c){var g=this;if(!a)return;var d=[];if(arguments.length>3){var e=arguments.length;for(var f=3;f<e;f++){d.push(arguments[f])}}c=c||g;LaterFrameTable.add(a,b,c,d)};$.clearLaterFrame=function(a,b,c){var d=this;b=b||d;LaterFrameTable.remove(a,b,c)};$.setSelectable=function(a){var b=this;b.selectable=a};$.recreateTargetProp=function(a,b){var c=a[b];if(c!=undefined){for(var d in c){delete c[d]}}else{a[b]=new Object()}};$.clonePropsTo=function(a,b){var g=this;if(a instanceof Array){var c=a.length;for(var d=0;d<c;d++){var e=a[d];if(e instanceof Array){var f=b[d];if(f){f.length=0}else{b[d]=[]}g.clonePropsTo(e,b[d])}else if(typeof (e)=="object"){g.recreateTargetProp(b,d);g.clonePropsTo(e,b[d])}else{b[d]=e}}}else{for(var d in a){var e=a[d];if(e instanceof Array){var f=b[d];if(f){f.length=0}else{b[d]=[]}g.clonePropsTo(e,b[d])}else if(typeof (e)=="object"){g.recreateTargetProp(b,d);g.clonePropsTo(e,b[d])}else{b[d]=e}}}};$.setFramePropTo=function(a,b){var f=this;for(var c in a){var d=a[c];if(d instanceof Array){var e=f[c];if(e){e.length=0}else{f[c]=[]}f.clonePropsTo(d,f[c])}else if(typeof (d)=="object"){f.recreateTargetProp(f,c);f.clonePropsTo(d,f[c])}else{if(d==undefined&&f[c]!=undefined){f[c]=null}else{f[c]=d}}}};$.gotoAndStopPFrame=function(a){var b=this;if(!b.pTimeline){return}var c=b.pTimeline.frames;var d=b.pTimeline.selectframe;var e=c.length;if(e>0&&a<e){b.setFramePropTo(c[a],b);b.pTimeline.selectframe=a;var f=b.children;if(f){var e=f.length;for(var g=0;g<e;g++){var h=f[g];if(h.gotoAndStopPFrame){h.gotoAndStopPFrame(0)}}}b.updateUI()}};$.gotoAndStop=function(a){var b=this;b.clearLaterFrame(b.play,b);if(!b.timeline){return}a--;if(a==b.i_l_frame)return;b.i_l_frame=a;var c=b.timeline.frames;var d=b.timeline.selectframe;var e=c.length;if(a>=e)a=e-1;if(e>0&&a<e){b.setFramePropTo(c[a],b);b.timeline.selectframe=a;var f=b.children;var e=f.length;for(var g=0;g<e;g++){var h=f[g];if(h.gotoAndStopPFrame){h.gotoAndStopPFrame(a)}}b.updateUI()}};$.play=function(){var a=this;if(!a.timeline){return}var b=a.timeline.frames;var c=b.length;if(c<2){return}var d=a.timeline.selectframe;if(d+1>c-1){d=0}else{d++}a.gotoAndStop(d+1);a.callLaterFrame(a.play,1,a)};$.stop=function(){var a=this;a.clearLaterFrame(a.play,a)};$.getCurrentFrame=function(){var a=this;if(!a.timeline){return -1}return a.timeline.selectframe+1};$.isVisible=function(){var a=this;if(a.destoryed)return false;var b=a.cacheCanvas||a.children.length||a.style.graphics.has;return !!(a.visible&&a.alpha>0&&a.scaleX!=0&&a.scaleY!=0&&b)};$._getBounds=function(a,b,c,d){var f=this;var e=f.DisplayObject_getBounds();if(e){return f._transformBounds(e,a,b)}var g=null;if(!d||(f.border||f.background)){g=f._rectangle;g.setValues(0,0,f.width,f.height)}var h=f._props.matrix;h=b?h.identity():f.getMatrix(h);if(a&&!b){if(g)g=f._transformBounds(g,a,b)}else if(a){h.prependMatrix(a)}var j=f.children.length;for(var k=0;k<j;k++){var l=f.children[k];if(!l.visible||!(e=l._getBounds(h,false,c,d))){continue}if(g){g.extend(e.x,e.y,e.width,e.height)}else{g=e.clone()}}if(g&&f.border&&c){var n=f.style;var o=["Left","Top","Right","Bottom"];var p=[0.5,0.5,0.5,0.5];var j=o.length;for(k=0;k<j;k++){var q=o[k];var r=n["border"+q+"Width"]||0;p[k]+=p[k]*r}g.pad(p[1],p[0],p[3],p[2])}return g};$.borderBGDraw=function(){var b=this;var a=b.style.graphics;a.has=0;a.lines.length=0;a.images.length=0;a.bgc=null;var c=["Left","Top","Right","Bottom"];var d=c.length;var e=b.style;var f=new Object();var g=0;var h,v;var j=0;var k=false;if(e.borderStyle){for(g=0;g<d;g++){h=c[g];f[h+"Style"]=e.borderStyle;f[h+"Width"]=e.borderWidth;f[h+"Color"]=e.borderColor}j=e.borderWidth||0;k=true}var l=[0.5,0.5,0.5,0.5];for(g=0;g<d;g++){h=c[g];v=e["border"+h+"Style"];var n=j;if(v){k=true;f[h+"Style"]=v;v=e["border"+h+"Width"];if(!isNaN(v)){n=v;f[h+"Width"]=v;v=e["border"+h+"Color"];if(v){f[h+"Color"]=v}}else{e["border"+h+"Width"]=j}}else{e["border"+h+"Width"]=j}l[g]+=l[g]*(n||1)}if(e.backgroundColor||e.backgroundImage){k=true}var o=b.getBounds(null,false,true);if(!o){if(!k){return}else{o=b._rectangle;o.setValues(0,0,b.width,b.height)}}else if(k){o=b._rectangle;o.setValues(0,0,b.width,b.height)}var p=o.x;var q=o.y;var r=o.width;var t=o.height;var u=p;var w=q;var x=p+r;var y=q+t;var z=[u,w,u,y,u,y,x,y,x,y,x,w,x,w,u,w];u+=0.5;w+=0.5;x-=0.5;y-=0.5;var A=[u,w,u,y,u,y,x,y,x,y,x,w,x,w,u,w];v=e.backgroundColor;if(v){a.has=1;a.bgc=v;a.cx=p;a.cy=q;a.cw=r;a.ch=t}if(e.backgroundImage){var B=e.backgroundRepeat;var C=b.getRPath(e.backgroundImage);var D=kisgame.RManager.getImageResult(C,b);if(D){var E=0;var F,G,u,w,x0,y0;x0=-(p+b.bgImage_x);y0=-(q+b.bgImage_y);if(B=="no-repeat"||!B){F=p+b.bgImage_x,G=q+b.bgImage_y,u=F+D.width,w=G+D.height;if(p>F){F=p}if(q>G){G=q}if(p+r<u){u=p+r}if(q+t<w){w=q+t}if(u>D.width){x0=0}if(w>D.height){y0=0}if(!(u<=F||w<=G)){E=1;u=u-F;w=w-G}B=null}else if(B=="repeat-x"){E=1;F=p,G=q,u=r;w=D.height>t?t:D.height}else if(B=="repeat-y"){E=1;F=p,G=q,w=t;u=D.width>r?r:D.width}else if(B=="repeat"){E=1;F=p,G=q,u=r,w=t}if(E){a.has=1;a.images.push([D,B,x0,y0,u,w,F,G,u,w])}}}if(b.beforeDrawBorder){b.beforeDrawBorder()}var H=a.lines;for(g=0;g<d;g++){h=c[g];s=f[h+"Style"];wd=f[h+"Width"];cr=f[h+"Color"];if(s&&wd&&cr){ii=g*4;var I=parseInt(wd);var J;if(I%2==0){J=z}else{J=A}a.has=1;H.push([I,cr,J[ii],J[ii+1],J[ii+2],J[ii+3]])}}var K=b.dumpObjStr(a);if(K!=b.graphicsStr){b.invaliate()}b.graphicsStr=K};$.drawStyleGraphics=function(a){var c=this;var b=c.style.graphics;if(b.has){var d=b.bgc;if(d){a.fillStyle=d;a.fillRect(b.cx,b.cy,b.cw,b.ch)}var e=b.images;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(!h[1]){a.drawImage(h[0],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9])}else{var j=a.createPattern(h[0],h[1]);a.fillStyle=j;a.fillRect(h[6],h[7],h[8],h[9])}}var e=b.lines;var f=e.length;for(var g=0;g<f;g++){var h=e[g];a.beginPath();a.lineWidth=h[0];a.strokeStyle=h[1];a.moveTo(h[2],h[3]);var k=h.length;for(var l=4;l<k;l+=2){a.lineTo(h[l],h[l+1])}a.stroke()}}};$.updateUI=function(){var a=this;a.drawBorder();a.drawBackground()};$.updateUseAreaRect=function(){var a=this;if(a.useAreaRect){var b=a.hitAreaRectangle;if(!b){a.hitAreaRectangle=b=new kisgame.Rectangle(0,0,a.width,a.height)}else{b.width=a.width;b.height=a.height}}};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c.DisplayObject_draw(a,b)){return true}c.drawStyleGraphics(a);if(c.children.length){var d=c.children.slice();for(var e=0,f=d.length;e<f;e++){var g=d[e];if(!g.isVisible()){continue}a.save();g.updateContext(a);g.draw(a);a.restore()}}return true};$._getObjectsUnderPoint=function(a,b,c,d,e,f){var h=this;var g=h._super(_.super_p._getObjectsUnderPoint,a,b,c,d,e,f);if(!g&&!h.mouseIgnoreSelf){var j,k=kisgame.DisplayObject._hitTestContext;var l=h.getConcatenatedDisplayProps(h._props);j=l.matrix;k.setTransform(1,0,0,1,0,0);k.clearRect(0,0,2,2);k.globalAlpha=l.alpha;k.setTransform(j.a,j.b,j.c,j.d,j.tx-a,j.ty-b);h.drawStyleGraphics(k);if(h._testHit(k)){if(c){c.push(h)}else{return h}}}return g};$.dumpObjStr=function(a){var f=this;var b="";var c=a;for(var d in c){var e=c[d];if(typeof (e)=="object"&&e!=null){if(e.src){b+=e.src}else{b+=f.dumpObjStr(e)}}else{b+=e}}return b};$.toString=function(){var a=this;return "[KISContainer (name="+a.name+")]"};kisgame.KISContainer=_}());;(function(){function _(){var c=this;var b=c;b._super(_.super_p.constructor);b.bgImage_x=0;b.bgImage_y=0;b.borderWidth=1;b.borderStyle="solid";b.borderColor="black";b.backgroundColor="white";b.backgroundImage="";b.style=new Object();b.style.graphics={lines:[],images:[]};b.width=100;b.height=20;b.autoSize=true;b.ellipsis=true;b.htmlText="";b.text="";b.selectable=true;b.wordwrap=false;b.multiline=false;b.textWidth=0;b.textHeight=0;b.textColor="black";b._bounds=new kisgame.Rectangle(0,0,b.width,b.height);b.sizeBounds=new kisgame.Rectangle();b.scrollRect=new kisgame.Rectangle(0,0,b._bounds.width,b._bounds.height)}var $=KISU.extend(_,kisgame.Text);var a=kisgame.KISContainer.prototype;$.destory=a.destory;$.setFocus==a.setFocus;$.setVisible=a.setVisible;$.setAlpha=a.setAlpha;$.refreshSize=a.refreshSize;$.setName=a.setName;$.parseProps=a.parseProps;$.hitTestPoint=a.hitTestPoint;$.local2Global=a.local2Global;$.addETL=a.addETL;$.removeETL=a.removeETL;$.getSize=a.getSize;$.drawBorder=a.drawBorder;$.setBackgroundColor=a.setBackgroundColor;$.moveBackground=a.moveBackground;$.i_setBackgroundColor=a.i_setBackgroundColor;$.i_moveBackground=a.i_moveBackground;$.drawBackground=a.drawBackground;$.setStyle=a.setStyle;$.getStyle=a.getStyle;$.getTargetPath=a.getTargetPath;$.callLaterFrame=a.callLaterFrame;$.callLaterFrame2=a.callLaterFrame2;$.clearLaterFrame=a.clearLaterFrame;$.setSelectable=a.setSelectable;$.recreateTargetProp=a.recreateTargetProp;$.clonePropsTo=a.clonePropsTo;$.setFramePropTo=a.setFramePropTo;$.gotoAndStopPFrame=a.gotoAndStopPFrame;$.gotoAndStop=$.gotoAndStop;$.play=a.play;$.stop=a.stop;$.getCurrentFrame=a.getCurrentFrame;$.borderBGDraw=a.borderBGDraw;$.getBorderBounds=a.getBorderBounds;$.drawStyleGraphics=a.drawStyleGraphics;$.parseFromPool=a.parseFromPool;$.dumpObjStr=a.dumpObjStr;$.getBounds=function(b){var d=this;var c=d.DisplayObject_getBounds();if(!c){c=d._rectangle;c.setValues(0,0,d.width,d.height)}if(b){return d.local2TargetRect(b,c)}else{return c}return c};$.getSize=function(){var b=this;return b.scrollRect};$.setTextFormat=function(b){var d=this;if(!b){return}var c=d.dumpObjStr(b);if(c!=d.textformatStr){d.invaliate()}d.textformatStr=c;d.textformat=b;var e="";if(b.italic){e+="italic "}if(b.bold){e+="bold "}if(b.size){e+=b.size;if(!isNaN(b.size)){e+="px "}else{e+=" "}}else{e+="10px "}if(b.font){e+=b.font}else{e+="sans-serif"}d.font=e;d.setTextUnderLine(b.underline?true:false);if(b.align)d.setTextAlign(b.align);if(b.color)d.setTextColor(b.color)};$.getTextFormat=function(){var b=this;return b.textformat};$.setText=function(b){var c=this;if(!b&&isNaN(b)){b=""}if(c.text!=b){c.invaliate();c.text=b;c.updateTextBound()}};$.getText=function(){var b=this;return b.text};$.setTextAlign=function(b){var c=this;c.textAlign=b};$.setTextUnderLine=function(b){var c=this;c.textUnderLine=b};$.appendText=function(b){var c=this;c.text+=b;c.updateTextBound()};$.setTextColor=function(b){var c=this;c.color=b};$.setSelectable=function(b){var c=this;c.selectable=b};$.updateUI=function(){var b=this;b.setTextFormat(b.textformat);b.drawBorder();b.drawBackground()};$.getMeasuredLineHeight=function(){var b=this;return b._getMeasuredWidth("我")*1.2};$._prepContext=function(b){var c=this;b.font=c.font||"10px sans-serif";b.textAlign="left";b.textBaseline="top";return b};$._drawTextLine=function(b,c,d,e){var f=this;if(!e)e=0;if(f.outline){b.strokeText(c,e,d,f.maxWidth||0xFFFF)}else{b.fillText(c,e,d,f.maxWidth||0xFFFF)}};$._drawText=function(b,c,d){var f=this;var e=!!b;if(!e){b=kisgame.Text._workingContext;b.save();f._prepContext(b)}var g=f.textUnderLine?1:0;var h;var i=f.getMeasuredLineHeight();if(!f.multiline&&!f.autoSize&&f.height){h=f.height}else{h=f.lineHeight||i}var j=f.autoSize?null:f.width;var k=0,l=0;var m=String(f.text).split(/(?:\r\n|\r|\n)(?:\r\n|\r|\n)/);var n=f.autoSize?0:kisgame.Text.H_OFFSETS[f.textAlign||"left"];for(var o=0,p=m.length;o<p;o++){var q=m[o];var r=null;if(f.wordwrap&&j!=null&&(r=b.measureText(q).width)>j){var s=q.split("");q=s[0];r=b.measureText(q).width;for(var t=1,u=s.length;t<u;t++){var v=b.measureText(s[t]).width;if(r+v>j){var w=(-j+r)*n;if(e){var x=l*h+(h-i)/2;f._drawTextLine(b,q,x,w);if(g){x+=i;b.beginPath();b.moveTo(w,x);b.lineTo(w+r,x);b.stroke()}}if(d){d.push(q)}if(r>k){k=r}q=s[t];r=b.measureText(q).width;l++}else{q+=s[t];r+=v}}}if(d){d.push(q)}if(c&&r==null){r=b.measureText(q).width}if(e){var w=(-j+r)*n;var x=l*h+(h-i)/2;f._drawTextLine(b,q,x,w);if(c&&g){x+=i;b.beginPath();b.moveTo(w,x);b.lineTo(w+r,x);b.stroke()}}if(r>k){k=r}l++}if(c){if(c==f){f.textWidth=k;f.textHeight=l*h;if(c.autoSize){c.width=c.textWidth;c.height=c.textHeight}}else{c.width=k;c.height=l*h}}if(!e){b.restore()}return c};$.updateTextBound=function(){var c=this;var b=c;if(c.autoSize){b={};c._drawText(null,b);c._bounds.width=c.scrollRect.width=b.width;c._bounds.height=c.scrollRect.height=b.height}c._bounds.width=c.scrollRect.width=b.width;c._bounds.height=c.scrollRect.height=b.height};$.setSize=function(b,c,d){var e=this;e._super(_.super_p.setSize,b,c,d);if(e.i_l_w!=b||e.i_l_h!=c){e.updateTextBound();e.borderBGDraw()}e.i_l_w=e.width;e.i_l_h=e.height};$.draw=function(b,c){var d=this;if(!b){d.updateUI();return}if(d.DisplayObject_draw(b,c)){return true}d.drawStyleGraphics(b);var e=d.color||"#000";if(d.outline){b.strokeStyle=e;b.lineWidth=d.outline}else{b.fillStyle=e}if(d.textUnderLine){b.strokeStyle=e;if(!d.outline)b.lineWidth=1}d._drawText(d._prepContext(b),d);d._bounds.width=d.scrollRect.width=d.width;d._bounds.height=d.scrollRect.height=d.height;return true};$.toString=function(){var b=this;return "[KISText (name="+b.name+")]"};kisgame.KISText=_}());;(function(){function _(b,c,d){var f=this;var e=f;if(!b){b=new kisgame.SpriteSheet()}else if(!(b instanceof kisgame.SpriteSheet)){b=new kisgame.SpriteSheet(b)}b.on("complete",e.onSheetComplete,f);f._super(_.super_p.constructor,b,c);e.scale9Grid=d;e.width=e.height=60}var $=KISU.extend(_,kisgame.Sprite);var a=kisgame.KISContainer.prototype;$.destory=a.destory;$.setFocus==a.setFocus;$.setVisible=a.setVisible;$.setAlpha=a.setAlpha;$.refreshSize=a.refreshSize;$.setName=a.setName;$.parseProps=a.parseProps;$.hitTestPoint=a.hitTestPoint;$.local2Global=a.local2Global;$.addETL=a.addETL;$.removeETL=a.removeETL;$.getSize=a.getSize;$.getTargetPath=a.getTargetPath;$.callLaterFrame=a.callLaterFrame;$.callLaterFrame2=a.callLaterFrame2;$.clearLaterFrame=a.clearLaterFrame;$.setSelectable=a.setSelectable;$.recreateTargetProp=a.recreateTargetProp;$.clonePropsTo=a.clonePropsTo;$.getCurrentFrame=a.getCurrentFrame;$.getBounds=function(b,c){var e=this;var d=e._super(_.super_p.getBounds);if(!d){d=e._rectangle;d.setValues(0,0,e.width,e.height)}if(b){e.local2TargetRect(b,d)}return d};$.parseFromPool=function(b,c,a,d){var e=this;kisgame.KISContainer.prototype.parseFromPool.apply(e,[b,c,a,d]);if(!d&&e.spriteSheetData){e.spriteSheet._parseData(e.spriteSheetData);delete e.spriteSheetData}if(e.useAreaRect){e.hitAreaRectangle=e.getBounds()}if(e.buttonMode){new kisgame.ButtonHelper(e,0,1,2,false)}};$.onSheetComplete=function(b){var c=this;c.invaliate()};$.draw=function(b,c){var d=this;if(!b){d.updateUI();return}if(d.DisplayObject_draw(b,c)){return true}d._normalizeFrame();var e=d.spriteSheet.getFrame(d.currentFrame|0);if(!e){return false}var f=e.rect;if(f.width&&f.height){var g=e.image;var h=d.scale9Grid;var i=e.regX;var j=e.regY;if(h){var k=h.width;var l=h.height;var m=h.x;var n=h.y;var o=f.width-k-m;var p=f.height-l-n;var q=d._width-m-o;var r=d._height-n-p;b.drawImage(g,f.x,f.y,m,n,-i,-j,m,n);b.drawImage(g,f.x+m,f.y,k,n,-i+m,-j,q,n);b.drawImage(g,f.x+m+k,f.y,o,n,-i+m+q,-j,o,n);b.drawImage(g,f.x,f.y+n,m,l,-i,-j+n,m,r);b.drawImage(g,f.x+m,f.y+n,k,l,-i+m,-j+n,q,r);b.drawImage(g,f.x+m+k,f.y+n,o,l,-i+m+q,-j+n,o,r);b.drawImage(g,f.x,f.y+n+l,m,p,-i,-j+n+r,m,p);b.drawImage(g,f.x+m,f.y+n+l,k,p,-i+m,-j+n+r,q,p);b.drawImage(g,f.x+m+k,f.y+n+l,o,p,-i+m+q,-j+n+r,o,p)}else{b.drawImage(g,f.x,f.y,f.width,f.height,-i,-j,f.width,f.height)}}return true};$.toString=function(){var b=this;return "[KISSprite (name="+b.name+")]"};Object.defineProperties($,{scale9Grid:{get:function(){var b=this;return b.kis_scale9Grid},set:function(b){var c=this;c.kis_scale9Grid=b;c.invaliate()}},});kisgame.KISSprite=_}());;(function(){function _(b,c,d,e){var f=this;f._super(_.super .constructor,b,c,d,e);var g=f;g.width=g.height=60}var $=KISU.extend(_,kisgame.MovieClip);var a=kisgame.KISContainer.prototype;$.destory=a.destory;$.setFocus==a.setFocus;$.setVisible=a.setVisible;$.setAlpha=a.setAlpha;$.refreshSize=a.refreshSize;$.setName=a.setName;$.parseProps=a.parseProps;$.hitTestPoint=a.hitTestPoint;$.local2Global=a.local2Global;$.addETL=a.addETL;$.removeETL=a.removeETL;$.getSize=a.getSize;$.getTargetPath=a.getTargetPath;$.callLaterFrame=a.callLaterFrame;$.callLaterFrame2=a.callLaterFrame2;$.clearLaterFrame=a.clearLaterFrame;$.setSelectable=a.setSelectable;$.recreateTargetProp=a.recreateTargetProp;$.clonePropsTo=a.clonePropsTo;$.parseFromPool=a.parseFromPool;$.toString=function(){var b=this;return "[KISMovieClip (name="+b.name+")]"};kisgame.KISMovieClip=_}());;(function(){function _(a){var c=this;var b=c;b._super(_.super_p.constructor);b.width=10;b.height=10;b.oriWidth=0;b.oriHeight=0;b.loaded=false;b.autoSize=true;b.sourceRect=null;if(typeof a=="string"){c.load(a)}else{c.image=a;c.updateImage()}}var $=KISU.extend(_,kisgame.DisplayObject);$.load=function(a){var b=this;b.url=a;if(a!=b.i_l_url){b.i_l_url=a;b.loaded=false;if(!a){b.image=null;b.invaliate()}else{var c=b.getRPath(a);b.image=kisgame.RManager.getImageResult(c,b,true);if(!b.image){b.addETL("fileload",b.onImageLoad,b);b.addETL("fileerror",b.onImageError,b)}else{b.updateImage();b.dispatchEvent(new KEvent("complete"))}}}};$.initialize=_;$.onImageLoad=function(a){var b=this;b.loaded=true;var c=a.src;if(b.getRPath(b.url)==c){b.image=kisgame.RManager.getImageResult(c,b);b.updateImage();b.dispatchEvent(new KEvent("complete"))}};$.onImageError=function(a){var b=this;b.loaded=true;var c=a.src;if(b.url==c){b.image=null;b.invaliate();b.dispatchEvent(new KEvent("error"))}};$.getScaleImageSize=function(a,b,c,d){var e=a/c;var f=b/d;var g=a/b;if(e>f){a=c;b=a/g}else{b=d;a=b*g}return {width:a,height:b}};$.setSize=function(a,b){var c=this;c.width=isNaN(a)?c.width:a;c.height=isNaN(b)?c.height:b;c.updateImage()};$.updateImage=function(){var b=this;var a=b.image;if(a){var c=b.width;var d=b.height;var e=b.sourceRect||a;if(b.autoSize=="scale"){var f=b.getScaleImageSize(e.width,e.height,c,d);c=b.width=f.width;d=b.height=f.height}else if(b.autoSize==true||b.autoSize=="true"){c=b.width=e.width;d=b.height=e.height}b.image_draw_w=c;b.image_draw_h=d}};$.getBounds=function(a,b,c){var e=this;var d=e._super(_.super_p.getBounds);if(!d){d=e._rectangle;d.setValues(0,0,e.width,e.height)}if(a){return e.local2TargetRect(a,d)}else{return d}};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c._super(_.super_p.draw,a,b)){return true}var d=c.image,e=c.sourceRect;if(d){if(e){var f=e.x,g=e.y,h=f+e.width,i=g+e.height,j=0,k=0,l=d.width,m=d.height;if(f<0){j-=f;f=0}if(h>l){h=l}if(g<0){k-=g;g=0}if(i>m){i=m}a.drawImage(d,f,g,h-f,i-g,j,k,c.image_draw_w,c.image_draw_h)}else{a.drawImage(d,0,0,d.width,d.height,0,0,c.image_draw_w,c.image_draw_h)}}};$.updateUI=function(){var a=this;a.load(a.url)};$.toString=function(){var a=this;return "[ImageView (name="+a.name+")]"};kisgame.ImageView=_}());;(function(){function _(a){var c=this;var b=c;b.width=10;b.height=10;b.oriWidth=0;b.oriHeight=0;b.loaded=false;b.autoSize=true;b.sourceRect=null;b.bgImage_x=0;b.bgImage_y=0;b.borderWidth=1;b.borderStyle="solid";b.borderColor="black";b.backgroundColor="white";b.backgroundImage="";b.style=new Object();b.style.graphics={lines:[],images:[]};b._super(_.super_p[0].constructor)}var $=KISU.extend(_,kisgame.ImageView,kisgame.KISContainer);$.initialize=_;$.k_ctor=$.constructor;$.drawStyleGraphics=function(a){var c=this;var b=c.style.graphics;if(b.has){var d=b.bgc;if(d){a.fillStyle=d;a.fillRect(b.cx,b.cy,b.cw,b.ch)}var e=b.images;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(!h[1]){a.drawImage(h[0],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9])}else{var i=a.createPattern(h[0],h[1]);a.fillStyle=i;a.fillRect(h[6],h[7],h[8],h[9])}}}var j=c.image,k=c.sourceRect;if(j){if(k){var l=k.x,m=k.y,n=l+k.width,o=m+k.height,p=0,q=0,r=j.width,s=j.height;if(l<0){p-=l;l=0}if(n>r){n=r}if(m<0){q-=m;m=0}if(o>s){o=s}a.drawImage(j,l,m,n-l,o-m,p,q,c.image_draw_w,c.image_draw_h)}else{a.drawImage(j,0,0,j.width,j.height,0,0,c.image_draw_w,c.image_draw_h)}}if(b.has){var e=b.lines;var f=e.length;for(var g=0;g<f;g++){var h=e[g];a.beginPath();a.lineWidth=h[0];a.strokeStyle=h[1];a.moveTo(h[2],h[3]);var t=h.length;for(var u=4;u<t;u+=2){a.lineTo(h[u],h[u+1])}a.stroke()}}};$.setSize=function(a,b){var c=this;c.width=isNaN(a)?c.width:a;c.height=isNaN(b)?c.height:b;c.borderBGDraw();c.updateImage()};$.setUrl=function(){var a=this;a.load(a.url)};$.updateUI=function(){var a=this;a.load(a.url);a.drawBorder();a.drawBackground()};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c._super(_.super_p[0].draw,a,b)){return true}c.drawStyleGraphics(a)};$.toString=function(){var a=this;return "[Bitmap (name="+a.name+")]"};kisgame.Bitmap=_}());;(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.width=a.height=60;b.selectframe=0;b.bgPosBase_x=0;b.bgPosBase_y=0;b.backgroundColor=""}var $=KISU.extend(_,kisgame.KISContainer);$.setData=function(a){var b=this;if(a.url){b.backgroundImage=a.url}if(!isNaN(a.col)){b.colCount=a.col}if(!isNaN(a.row)){b.rowCount=a.row}if(!isNaN(a.selectframe)){b.selectframe=a.selectframe}b.gotoAndStop(b.selectframe+1)};$.getCurrentFrame=function(){var a=this;return a.selectframe+1};$.gotoAndStop=function(a){var b=this;b.clearLaterFrame(b.play,b);b.clearLaterFrame(b.playOnce,b);a--;if(a==b.i_l_frame)return;b.i_l_frame=a;var c=b.selectframe;var d=b.totalFrames>0?b.totalFrames:b.colCount*b.rowCount;if(a>=d)a=d-1;if(d>0&&a<d){b.selectframe=a;if(b.drawed){b.updateBGPos();b.drawBackground()}else{b.draw();b.drawed=true}}};$.updateBGPos=function(){var b=this;var a=(b.colCount*b.rowCount)-1;var c=b.selectframe;if(c>a){c=a}var d=Math.ceil(c%b.colCount);var e=Math.floor(c/b.colCount);b.bgImage_x=b.bgPosBase_x-d*b.width;b.bgImage_y=b.bgPosBase_y-e*b.height};$.parseFromPool=function(a,b,c,d){var e=this;e._super(_.super_p.parseFromPool,a,b,c,d);if(e.buttonMode){KISU.efun(e,SimpleButton.prototype);e.normalF=1;e.overF=2;e.downF=3;e.selectF=4;e.disableF=5;e.pressing=false;e.buttonOption=1;e.autoRepeatIntervalMS=250;e.repeatInterval=0;e.autoRepeat=false;var f=e.totalFrames>0?e.totalFrames:e.colCount*e.rowCount;if(f==2){e.overF=1;e.downF=2;e.selectF=2;e.disableF=2}e.setEnabled(true)}};$.play=function(a){var b=this;if(!b.backgroundImage){return}var c=b.totalFrames>0?b.totalFrames:b.colCount*b.rowCount;if(c<2){return}var d=b.selectframe;if(d+1>c-1){d=0}else{d++}if(a){b.gotoAndStop(d+1)}b.callLaterFrame(b.play,1,b,true)};$.playOnce=function(a){var b=this;if(!b.backgroundImage){return}var c=b.totalFrames>0?b.totalFrames:b.colCount*b.rowCount;if(c<2){return}var d=b.selectframe;if(d+1<=c-1){d++;if(a){b.gotoAndStop(d+1)}b.callLaterFrame(b.playOnce,1,b,true)}else{b.dispatchEvent(new KEvent("playcomplete"))}};$.updateUI=function(){var a=this;a.updateBGPos();a._super(_.super_p.updateUI)};$.toString=function(){var a=this;return "[BitmapSprite (name="+a.name+")]"};kisgame.BitmapSprite=_}());;(function(){function _(){var b=this;var a=b;a._super(_.super_p[0].constructor);a.width=a.height=60;b.selectframe=0;a.bgImage_x=0;a.bgImage_y=0;a.borderWidth=1;a.borderStyle="solid";a.borderColor="black";a.backgroundColor="white";a.bgImage_repeat="repeat";a.backgroundImage="";a.style=new Object();a.style.graphics={lines:[],images:[]};a.uID=kisgame.KISContainer.unquareID++}var $=KISU.extend(_,kisgame.DisplayObject,kisgame.KISContainer);$.k_ctor=$.constructor;$.setSize=function(a,b,c){var d=this;d._super(_.super_p[0].setSize,a,b,c);if(d.i_l_w!=a||d.i_l_h!=b){d.borderBGDraw();d.updateUseAreaRect()}};$.getBounds=function(a,b,c){var e=this;var d=e._super(_.super_p[0].getBounds);if(!d){d=e._rectangle;d.setValues(0,0,e.width,e.height)}if(a){return e.local2TargetRect(a,d)}else{return d}};$.setScale9Grid=function(a){var b=this;b.scale9Grid=a;b.drawBackground()};$.getScale9Grid=function(){var a=this;return a.scale9Grid};$.drawScale9Grid=function(a,b,c,d,e,f,g,h,i,j,k){if(c){var l=c.width;var m=c.height;var n=c.x;var o=c.y;var p=f-l-n;var q=g-m-o;var r=j-n-p;var s=k-o-q;a.drawImage(b,d,e,n,o,h,i,n,o);a.drawImage(b,d+n,e,l,o,h+n,i,r,o);a.drawImage(b,d+n+l,e,p,o,h+n+r,i,p,o);a.drawImage(b,d,e+o,n,m,h,i+o,n,s);a.drawImage(b,d+n,e+o,l,m,h+n,i+o,r,s);a.drawImage(b,d+n+l,e+o,p,m,h+n+r,i+o,p,s);a.drawImage(b,d,e+o+m,n,q,h,i+o+s,n,q);a.drawImage(b,d+n,e+o+m,l,q,h+n,i+o+s,r,q);a.drawImage(b,d+n+l,e+o+m,p,q,h+n+r,i+o+s,p,q)}else{a.drawImage(b,d,e,f,g,h,i,j,k)}};$.drawBackground=function(){var a=this;if(a.background){a.i_setBackgroundColor(a.backgroundColor);var b=a.bgImage;var c=a.backgroundImage;if(b&&b.url){if(a.i_l_bg!=b.url)a.style.backgroundImage=b.url;a.style.backgroundRepeat=b.repeat||"";a.i_moveBackground(b.x,b.y);a.i_l_bg=b.url}else if(c){if(a.i_l_bg!=c)a.style.backgroundImage=c;a.style.backgroundRepeat=a.bgImage_repeat||"no-repeat";a.i_moveBackground(a.bgImage_x,a.bgImage_y);a.i_l_bg=c}}else{a.style.backgroundImage="";a.style.backgroundColor="";a.i_l_bg=""}a.borderBGDraw()};$.drawStyleGraphics=function(a){var c=this;var b=c.style.graphics;if(b.has){var d=b.bgc;if(d){a.fillStyle=d;a.fillRect(b.cx,b.cy,b.cw,b.ch)}var e=c.scale9Grid;var f=b.images;var g=f.length;for(var h=0;h<g;h++){var i=f[h];if(h==0&&e){var j=i[0];c.drawScale9Grid(a,j,e,i[2],i[3],j.width,j.height,i[6],i[7],i[8],i[9])}else{if(!i[1]){a.drawImage(i[0],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9])}else{var k=a.createPattern(i[0],i[1]);a.fillStyle=k;a.fillRect(i[6],i[7],i[8],i[9])}}}var f=b.lines;var g=f.length;for(var h=0;h<g;h++){var i=f[h];a.beginPath();a.lineWidth=i[0];a.strokeStyle=i[1];a.moveTo(i[2],i[3]);var l=i.length;for(var m=4;m<l;m+=2){a.lineTo(i[m],i[m+1])}a.stroke()}}};$.updateUI=function(){var a=this;a.drawBorder();a.drawBackground()};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c._super(_.super_p[0].draw,a,b)){return true}c.drawStyleGraphics(a)};$.toString=function(){var a=this;return "[BitmapScale9Grid (name="+a.name+")]"};kisgame.BitmapScale9Grid=_}());(function(){"use strict";function _(a,b){var c=this;c.Container_constructor();c.text=a||"";c.spriteSheet=b;c.lineHeight=0;c.letterSpacing=0;c.spaceWidth=0;c._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0}}var $=kisgame.extend(_,kisgame.Container);_.maxPoolSize=100;_._spritePool=[];$.draw=function(a,b){var c=this;if(c.DisplayObject_draw(a,b)){return}c._updateText();c.Container_draw(a,b)};$.getBounds=function(){var a=this;a._updateText();return a.Container_getBounds()};$.isVisible=function(){var b=this;var a=b.cacheImage||(b.spriteSheet&&b.spriteSheet.complete&&b.text);return !!(b.visible&&b.alpha>0&&b.scaleX!==0&&b.scaleY!==0&&a)};$.clone=function(){var a=this;return a._cloneProps(new _(a.text,a.spriteSheet))};$.addChild=$.addChildAt=$.removeChild=$.removeChildAt=$.removeAllChildren=function(){};$._cloneProps=function(a){var b=this;b.Container__cloneProps(a);a.lineHeight=b.lineHeight;a.letterSpacing=b.letterSpacing;a.spaceWidth=b.spaceWidth;return a};$._getFrameIndex=function(a,b){var c,d=b.getAnimation(a);if(!d){(a!=(c=a.toUpperCase()))||(a!=(c=a.toLowerCase()))||(c=null);if(c){d=b.getAnimation(c)}}return d&&d.frames[0]};$._getFrame=function(a,b){var d=this;var c=d._getFrameIndex(a,b);return c==null?c:b.getFrame(c)};$._getLineHeight=function(a){var c=this;var b=c._getFrame("1",a)||c._getFrame("T",a)||c._getFrame("L",a)||a.getFrame(0);return b?b.rect.height:1};$._getSpaceWidth=function(a){var c=this;var b=c._getFrame("1",a)||c._getFrame("l",a)||c._getFrame("e",a)||c._getFrame("a",a)||a.getFrame(0);return b?b.rect.width:1};$._updateText=function(){var d=this;var a=0,b=0,c=d._oldProps,e=false,f=d.spaceWidth,g=d.lineHeight,h=d.spriteSheet;var i=_._spritePool,j=d.children,k=0,l=j.length,sprite;for(var m in c){if(c[m]!=d[m]){c[m]=d[m];e=true}}if(!e){return}var n=!!d._getFrame(" ",h);if(!n&&!f){f=d._getSpaceWidth(h)}if(!g){g=d._getLineHeight(h)}for(var o=0,p=d.text.length;o<p;o++){var q=d.text.charAt(o);if(q==" "&&!n){a+=f;continue}else if(q=="\n"||q=="\r"){if(q=="\r"&&d.text.charAt(o+1)=="\n"){o++}a=0;b+=g;continue}var r=d._getFrameIndex(q,h);if(r==null){continue}if(k<l){sprite=j[k]}else{j.push(sprite=i.length?i.pop():new kisgame.Sprite());sprite.parent=d;l++}sprite.spriteSheet=h;sprite.gotoAndStop(r);sprite.x=a;sprite.y=b;k++;a+=sprite.getBounds().width+d.letterSpacing}while(l>k){i.push(sprite=j.pop());sprite.parent=null;l--}if(i.length>_.maxPoolSize){i.length=_.maxPoolSize}};kisgame.BitmapText=kisgame.promote(_,"Container")}());;(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.listData=null;a.itemList=[];a.listHolder=b}var $=KISU.extend(_,kisgame.KISContainer);$.k_ctor=$.constructor;$.createItem=function(a){return null};$.destoryItem=function(a){a.destory(true);return a};$.setData=function(a){var b=this;b.listData=a;b.updateStatus()};$.getData=function(){var a=this;return a.listData};$.updateStatus=function(){var b=this;var a=b.listData?b.listData.length:0;var c=b.itemList;var d=Math.max(c.length,a);var e=b.listHolder;var f;for(var g=0;g<d;g++){if(g>=a){f=c[a];e.removeChild(f);b.destoryItem(f);c.splice(a,1)}else{if(g>=c.length){f=b.createItem(b.listData[g]);c.push(f);e.addChild(f).draw()}else{f=c[g]}b.setItemData(f,b.listData[g],g,g)}}b.fixChildrenSize()};$.setItemData=function(a,b,c,d){a.setData(b,c,d)};kisgame.List=_}());;(function(){function _(){var a=this;a.group=new GroupManager();a._super(_.super_p.constructor)}var $=KISU.extend(_,kisgame.List);$.k_ctor=$.constructor;$.clickHandler=function(a){var b=this;b.group.setSelectedItem(a.currentTarget);var c=new KEvent("item_select");c.item=a.currentTarget;c.data=c.item.getData();b.dispatchEvent(c)};$.removeCurItem=function(){var b=this;var a=b.listData.indexOf(b.curItem.getData());if(a!=-1){b.listData.splice(a,1);b.setData(b.listData)}};$.setData=function(a){var b=this;b.listData=a;b.updateStatus();b.group.obj_arr=b.itemList};$.createItem=function(a){var c=this;var b=new c.SubItemClass();b.setSelect(false);b.setStyle("overflow","hidden");b.addETL(KISU.md,c.clickHandler,c);return b};$.selectAll=function(){var a=this;a.group.selectAll()};$.setSelectedIndex=function(a){var b=this;b.group.setSelectedIndex(a)};$.getSelectedIndex=function(){var a=this;return a.group.getSelectedIndex()};$.getSelectedValue=function(){var b=this;var a=b.group.getSelectedIndex();if(a>=0){var c=b.itemList[a];if(c){return c.getData()}}return null};$.toString=function(){var a=this;return "[SelectList (name="+a.name+")]"};kisgame.SelectList=_}());;(function(){function _(){var a=this;a._super(_.super_p.constructor);a.maxCol=1;a.oftX=0;a.oftY=0;a.itemMaxWidth=100;a.itemMaxHeight=100;a.direction=kisgame.DirectionType.VERTICAL;a.listHolder=new kisgame.Container();var b=new kisgame.TouchScrollHelper();b.hot_mc=new kisgame.SimpleShape();b.hot_mc.hitAreaRectangle=new kisgame.Rectangle(0,0,a.width,a.height);var c=new kisgame.Rectangle(0,0,a.width,a.height);b.viewRect=c;a.scroller=b;a.addChild(a.scroller.hot_mc);a.addChild(a.listHolder)}var $=KISU.extend(_,kisgame.SelectList);$.k_ctor=$.constructor;$.updateStatus=function(){var a=this;a._super(_.super_p.updateStatus);a.maxItemRow=Math.floor(a.itemList.length/a.maxItemCol);a.refreshScroller()};$.getContentHeight=function(){var a=this;return a.maxItemRow*a.itemMaxHeight+a.oftY};$.getContentWidth=function(){var a=this;return a.maxItemCol*a.itemMaxWidth+a.oftX};$.setScrollDirection=function(a){var b=this;b.direction=a};$.refreshScroller=function(){var a=this;if(a.i_l_row==a.maxItemRow&&a.i_l_col==a.maxItemCol)return;if(a.direction==kisgame.DirectionType.VERTICAL){a.scroller.setParamPage(a.listHolder,a.getContentHeight(),a.direction,a.scroller.viewRect,a.scroller.hot_mc,a.itemMaxHeight,a.maxItemRow,1,0)}else{a.scroller.setParamPage(a.listHolder,a.getContentWidth(),a.direction,a.scroller.viewRect,a.scroller.hot_mc,a.itemMaxWidth,a.maxItemCol,1,0)}a.i_l_row=a.maxItemRow;a.i_l_col=a.maxItemCol};$.updateItemPos=function(){var b=this;var a=b.itemList;var c=a.length;var d=Math.min(b.width,b.itemMaxWidth);var e=b.itemMaxHeight;var f=b.maxItemCol;for(var g=0;g<c;g++){var h=a[g];var i=(g%f)*d;var j=Math.floor(g/f)*e;h.move(b.oftX+i+(d-h.width)/2,j+(e-h.height)/2+b.oftY)}};$.setItemData=function(a,b,c){var e=this;a.setData(b);var d=e.maxItemCol;var f=Math.min(e.width,e.itemMaxWidth);var g=e.itemMaxHeight;var h=(c%d)*f;var i=Math.floor(c/d)*g;a.move(e.oftX+h+(f-a.width)/2,i+(g-a.height)/2+e.oftY)};$.setSize=function(a,b){var c=this;if(c.i_l_w==a&&c.i_l_h==b)return;c._super(_.super_p.setSize,a,b);c.maxItemCol=Math.max(1,Math.floor(a/c.itemMaxWidth));c.maxItemRow=Math.floor(c.itemList.length/c.maxItemCol);c.oftX=(a-c.maxItemCol*c.itemMaxWidth)/2;c.updateItemPos();var d=c.scroller.viewRect;var e=c.scroller.hot_mc;e.hitAreaRectangle.width=d.width=c.width;e.hitAreaRectangle.height=d.height=c.height;c.refreshScroller();c.i_l_w=a;c.i_l_h=b};$.toString=function(){var a=this;return "[PageScrollList (name="+a.name+")]"};kisgame.PageScrollList=_}());;(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.width=a.height=20;a.setSelectable(false);a.bgPosBase_x=0;a.bgPosBase_y=0;a.autoSize=true;a.setStyle("overflow","visible")}var $=KISU.extend(_,kisgame.List);$.setValue=function(a){var b=this;b.i_l_value=b.value=a;b.i_l_rowCount=b.rowCount;b.i_l_colCount=b.colCount;b.i_l_cellBGImage=b.cellBGImage;b.i_l_cellWidth=b.cellWidth;var c=a+"";var d=c.length*b.cellWidth;b.setSize(d,b.height);b.setData(c.split(""));b.invaliate()};$.getValue=function(){var a=this;return a.value};$.setText=$.setValue;$.getText=$.getValue;$.createItem=function(a){var b=new kisgame.BitmapSprite();b.position="static";b.cssFloat="left";return b};$.setItemData=function(a,b,c){var e=this;var d=0;if(e.numberRule){d=e.numberRule.indexOf(b)}else{var f=parseInt(b);if(!isNaN(f)){d=f+1}}if(a.width!=e.cellWidth||a.height!=e.height){if(a.numData!=b){a.width=e.cellWidth;a.height=e.height}else{a.setSize(e.cellWidth,e.height)}}a.move(c*e.cellWidth);if(a.numData!=b){a.numData=b;a.background=e.cellBG;a.backgroundColor=e.cellBGColor;a.setData({col:e.colCount,row:e.rowCount,url:e.cellBGImage,selectframe:d})}};$.fixChildrenSize=function(){};$.parseFromPool=function(a,b,c,d){var e=this;e._super(_.super_p.parseFromPool,a,b,c,d);if(!isNaN(e.value)){e.setValue(e.value)}};$.updateUI=function(){var a=this;if(a.i_l_value!=a.value||a.i_l_cellWidth!=a.cellWidth||a.i_l_cellBGImage!=a.cellBGImage||a.i_l_colCount!=a.colCount||a.i_l_rowCount!=a.rowCount){a.setValue(a.value)}a._super(_.super_p.updateUI)};$.toString=function(){var a=this;return "[BitmapNumber (name="+a.name+")]"};kisgame.BitmapNumber=_}());(function(){"use strict";function _(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.Event_constructor(a,b,c);l.mouseX=d;l.mouseY=e;l.stageX=d;l.stageY=e;l.rawX=(i==null)?d:i;l.rawY=(j==null)?e:j;l.nativeEvent=f;l.pointerID=g;l.primary=!!h;if(f.wheelDelta!=undefined){l.delta=f.wheelDelta/120*3}else{var m=f.detail;if(m==3){m=-3}else{m=3}l.delta=m}l.relatedTarget=k}var $=kisgame.extend(_,kisgame.Event);$._get_localX=function(){var a=this;return a.currentTarget.globalToLocal(a.rawX,a.rawY).x};$._get_localY=function(){var a=this;return a.currentTarget.globalToLocal(a.rawX,a.rawY).y};$._get_isTouch=function(){var a=this;return a.pointerID!==-1};$._get_buttonDown=function(){var a=this;return a.nativeEvent&&a.nativeEvent.buttons>0};$._get_button=function(){var a=this;if(a.nativeEvent){return a.nativeEvent.button}return 0};try{Object.defineProperties($,{localX:{get:$._get_localX},localY:{get:$._get_localY},isTouch:{get:$._get_isTouch},buttonDown:{get:$._get_buttonDown},button:{get:$._get_button}})}catch(e){}$.clone=function(){var a=this;return new _(a.type,a.bubbles,a.cancelable,a.stageX,a.stageY,a.nativeEvent,a.pointerID,a.primary,a.rawX,a.rawY)};$.toString=function(){var a=this;return "[MouseEvent (type="+a.type+" stageX="+a.stageX+" stageY="+a.stageY+")]"};kisgame.MouseEvent=kisgame.promote(_,"Event")}());;(function(){function _(){var c=this;var b=c;b._super(_.super_p.constructor);b.width=b.height=60;b.bgImage_x=0;b.bgImage_y=0;b.borderWidth=1;b.borderStyle="solid";b.borderColor="black";b.backgroundColor="white";b.backgroundImage="";b.style=new Object();b.style.graphics={lines:[],images:[]}}var $=kisgame.KISContainer.prototype;var a=KISU.extend(_,kisgame.DisplayObject);a.hitTestPoint=function($,b){var c=this;if(b){return c.hitTest($.x,$.y)}else{var $=c.globalToLocal($.x,$.y,$);var d=c.hitAreaRectangle||c.getBounds();if(d.radius){return kisgame.GeomUtils.get2PR(0,0,$.x,$.y)<d.radius}else if($.x<d.x||$.y<d.y||$.x>d.x+d.width||$.y>d.y+d.height){return false}}return true};a.local2Global=$.local2Global;a.addETL=$.addETL;a.removeETL=$.removeETL;a.getSize=$.getSize;a.setSize=function(b,c,d){var e=this;e._super(_.super_p.setSize,b,c,d);if(e.i_l_w!=b||e.i_l_h!=c)e.borderBGDraw()};a.setSelectable=$.setSelectable;a.drawBorder=$.drawBorder;a.setBackgroundColor==$.setBackgroundColor;a.moveBackground=$.moveBackground;a.i_setBackgroundColor=$.i_setBackgroundColor;a.i_moveBackground=$.i_moveBackground;a.drawBackground=$.drawBackground;a.setStyle=$.setStyle;a.getStyle=$.getStyle;a.isVisible=function(){var c=this;var b=c.cacheCanvas||c.style.graphics.has;return !!(c.visible&&c.alpha>0&&c.scaleX!=0&&c.scaleY!=0)&&b};a.setVisible=$.setVisible;a.getBorderBounds=function(b){var d=this;var c=d.hitAreaRectangle;if(b&&c){return d.local2TargetRect(b,c)}return c};a.getBounds=function(b,c,d){var f=this;var e=f.hitAreaRectangle;if(b&&e){return f.local2TargetRect(b,e)}return e};a.borderBGDraw=function(){var c=this;var b=c.style.graphics;b.has=0;b.lines.length=0;b.images.length=0;b.bgc=null;var d=["Left","Top","Right","Bottom"];var e=d.length;var f=c.style;var g=new Object();var i=0;var j,v;if(f.borderStyle){for(i=0;i<e;i++){j=d[i];g[j+"Style"]=f.borderStyle;g[j+"Width"]=f.borderWidth;g[j+"Color"]=f.borderColor}}for(i=0;i<e;i++){j=d[i];v=f["border"+j+"Style"];if(v){g[j+"Style"]=v;v=f["border"+j+"Width"];if(v){g[j+"Width"]=v;v=f["border"+j+"Color"];if(v){g[j+"Color"]=v}}}}var k=c.getBorderBounds();var l,y,w,h;if(k.radius){l=-k.radius;y=-k.radius;w=k.radius*2;h=k.radius*2}else{l=k.x;y=k.y;w=k.width;h=k.height}var m=l;var n=y;var o=l+w;var p=y+h;var q=[m,n,m,p,m,p,o,p,o,p,o,n,o,n,m,n];m+=0.5;n+=0.5;o-=0.5;p-=0.5;var r=[m,n,m,p,m,p,o,p,o,p,o,n,o,n,m,n];v=f.backgroundColor;if(v){b.has=1;b.bgc=v;b.cx=l;b.cy=y;b.cw=w;b.ch=h}if(f.backgroundImage){var t=f.backgroundRepeat;var u=kisgame.RManager.getImageResult(f.backgroundImage,c);if(u){var x=0;var z,A,m,n,x0,y0;x0=-(l+c.bgImage_x);y0=-(y+c.bgImage_y);if(t=="no-repeat"||!t){z=l+c.bgImage_x,A=y+c.bgImage_y,m=z+u.width,n=A+u.height;if(l>z){z=l}if(y>A){A=y}if(l+w<m){m=l+w}if(y+h<n){n=y+h}if(m>u.width){x0=0}if(n>u.height){y0=0}if(!(m<=z||n<=A)){x=1;m=m-z;n=n-A}t=null}else if(t=="repeat-x"){x=1;z=l,A=y,m=w;n=u.height>h?h:u.height}else if(t=="repeat-y"){x=1;z=l,A=y,n=h;m=u.width>w?w:u.width}else if(t=="repeat"){x=1;z=l,A=y,m=w,n=h}if(x){b.has=1;b.images.push([u,t,x0,y0,m,n,z,A,m,n])}}}if(c.beforeDrawBorder){c.beforeDrawBorder()}if(k.radius){j=d[0];s=g[j+"Style"];wd=g[j+"Width"];cr=g[j+"Color"];if(s&&wd&&cr){ii=i*4;var B=parseInt(wd);b.has=1;b.lines.push([B,cr,k.radius])}}else{var C=b.lines;for(i=0;i<e;i++){j=d[i];s=g[j+"Style"];wd=g[j+"Width"];cr=g[j+"Color"];if(s&&wd&&cr){ii=i*4;var B=parseInt(wd);var D;if(B%2==0){D=q}else{D=r}b.has=1;C.push([B,cr,D[ii],D[ii+1],D[ii+2],D[ii+3]])}}}c.invaliate()};a.drawStyleGraphics=function(b){var d=this;var c=d.style.graphics;if(c.has){var e=d.hitAreaRectangle&&d.hitAreaRectangle.isFull;if(e){b.save();b.setTransform(1,0,0,1,0,0)}var f=c.bgc;if(f){b.fillStyle=f;if(d.radius){b.beginPath();b.arc(0,0,d.radius,0,2*Math.PI,0);b.closePath();b.fill()}else{b.fillRect(c.cx,c.cy,c.cw,c.ch)}}var g=c.images;var i=g.length;for(var j=0;j<i;j++){var k=g[j];if(!k[1]){b.drawImage(k[0],k[2],k[3],k[4],k[5],k[6],k[7],k[8],k[9])}else{var l=b.createPattern(k[0],k[1]);b.fillStyle=l;b.fillRect(k[6],k[7],k[8],k[9])}}var g=c.lines;var i=g.length;for(var j=0;j<i;j++){var k=g[j];b.beginPath();b.lineWidth=k[0];b.strokeStyle=k[1];if(k.length==3){b.arc(0,0,k[2],0,2*Math.PI,0)}else{b.moveTo(k[2],k[3]);var m=k.length;for(var n=4;n<m;n+=2){b.lineTo(k[n],k[n+1])}}b.stroke()}if(e){b.restore()}}};a.updateUI=function(){var b=this;b.drawBorder();b.drawBackground()};a.draw=function(b,c){var d=this;if(!b){d.updateUI();return}if(d._super(_.super_p.draw,b,c)){return true}d.drawStyleGraphics(b);return true};a.toString=function(){var b=this;return "[SimpleShape (name="+b.name+")]"};kisgame.SimpleShape=kisgame.promote(_,"DisplayObject")}());;(function(){"use strict";var _={};_.POINTS=0;_.LINE_LOOP=2;_.LINE_STRIP=3;_.LINES=1;_.TRIANGLES=4;_.TRIANGLE_STRIP=5;_.TRIANGLE_FAN=6;kisgame.DrawType=_})();;(function(){"use strict";var _={};_.TEXTURE=2;_.FILL=3;_.LINE=4;_.FRAMEBUFFER=5;_.FILL_ONE_COLOR=6;kisgame.FillType=_})();function Vector2(_,$){var a=this;a.x=_||0;a.y=$||0};Object.defineProperties(Vector2.prototype,{"width":{get:function(){var _=this;return _.x},set:function(_){var $=this;$.x=_}},"height":{get:function(){var _=this;return _.y},set:function(_){var $=this;$.y=_}}});Object.assign(Vector2.prototype,{isVector2:true,set:function(_,$){var a=this;a.x=_;a.y=$;return a},setScalar:function(_){var $=this;$.x=_;$.y=_;return $},setX:function(_){var $=this;$.x=_;return $},setY:function(_){var $=this;$.y=_;return $},setComponent:function(_,$){var a=this;switch(_){case 0:a.x=$;break;case 1:a.y=$;break;default:throw new Error('index is out of range: '+_)}return a},getComponent:function(_){var $=this;switch(_){case 0:return $.x;case 1:return $.y;default:throw new Error('index is out of range: '+_)}},clone:function(){var _=this;return new _.constructor(_.x,_.y)},copy:function(_){var $=this;$.x=_.x;$.y=_.y;return $},add:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return a.addVectors(_,$)}a.x+=_.x;a.y+=_.y;return a},addScalar:function(_){var $=this;$.x+=_;$.y+=_;return $},addVectors:function(_,$){var a=this;a.x=_.x+$.x;a.y=_.y+$.y;return a},addScaledVector:function(_,$){var a=this;a.x+=_.x*$;a.y+=_.y*$;return a},sub:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return a.subVectors(_,$)}a.x-=_.x;a.y-=_.y;return a},subScalar:function(_){var $=this;$.x-=_;$.y-=_;return $},subVectors:function(_,$){var a=this;a.x=_.x-$.x;a.y=_.y-$.y;return a},multiply:function(_){var $=this;$.x*=_.x;$.y*=_.y;return $},multiplyScalar:function(_){var $=this;$.x*=_;$.y*=_;return $},divide:function(_){var $=this;$.x/=_.x;$.y/=_.y;return $},divideScalar:function(_){var $=this;return $.multiplyScalar(1/_)},applyMatrix3:function(_){var a=this;var $=a.x,b=a.y;var c=_.elements;a.x=c[0]*$+c[3]*b+c[6];a.y=c[1]*$+c[4]*b+c[7];return a},min:function(_){var $=this;$.x=Math.min($.x,_.x);$.y=Math.min($.y,_.y);return $},max:function(_){var $=this;$.x=Math.max($.x,_.x);$.y=Math.max($.y,_.y);return $},clamp:function(_,$){var a=this;a.x=Math.max(_.x,Math.min($.x,a.x));a.y=Math.max(_.y,Math.min($.y,a.y));return a},clampScalar:function(){var _=new Vector2();var $=new Vector2();return function a(b,c){var d=this;_.set(b,b);$.set(c,c);return d.clamp(_,$)}}(),clampLength:function(_,$){var b=this;var a=b.length();return b.divideScalar(a||1).multiplyScalar(Math.max(_,Math.min($,a)))},floor:function(){var _=this;_.x=Math.floor(_.x);_.y=Math.floor(_.y);return _},ceil:function(){var _=this;_.x=Math.ceil(_.x);_.y=Math.ceil(_.y);return _},round:function(){var _=this;_.x=Math.round(_.x);_.y=Math.round(_.y);return _},roundToZero:function(){var _=this;_.x=(_.x<0)?Math.ceil(_.x):Math.floor(_.x);_.y=(_.y<0)?Math.ceil(_.y):Math.floor(_.y);return _},negate:function(){var _=this;_.x=-_.x;_.y=-_.y;return _},dot:function(_){var $=this;return $.x*_.x+$.y*_.y},lengthSq:function(){var _=this;return _.x*_.x+_.y*_.y},length:function(){var _=this;return Math.sqrt(_.x*_.x+_.y*_.y)},lengthManhattan:function(){var _=this;return Math.abs(_.x)+Math.abs(_.y)},normalize:function(){var _=this;return _.divideScalar(_.length()||1)},angle:function(){var $=this;var _=Math.atan2($.y,$.x);if(_<0)_+=2*Math.PI;return _},distanceTo:function(_){var $=this;return Math.sqrt($.distanceToSquared(_))},distanceToSquared:function(_){var a=this;var $=a.x-_.x,b=a.y-_.y;return $*$+b*b},distanceToManhattan:function(_){var $=this;return Math.abs($.x-_.x)+Math.abs($.y-_.y)},setLength:function(_){var $=this;return $.normalize().multiplyScalar(_)},lerp:function(_,$){var a=this;a.x+=(_.x-a.x)*$;a.y+=(_.y-a.y)*$;return a},lerpVectors:function(_,$,a){var b=this;return b.subVectors($,_).multiplyScalar(a).add(_)},equals:function(_){var $=this;return ((_.x===$.x)&&(_.y===$.y))},fromArray:function(_,$){var a=this;if($===undefined)$=0;a.x=_[$];a.y=_[$+1];return a},toArray:function(_,$){var a=this;if(_===undefined)_=[];if($===undefined)$=0;_[$]=a.x;_[$+1]=a.y;return _},fromBufferAttribute:function(_,$,a){var b=this;if(a!==undefined){console.warn('THREE.Vector2: offset has been removed from .fromBufferAttribute().')}b.x=_.getX($);b.y=_.getY($);return b},rotateAround:function(_,$){var d=this;var a=Math.cos($),b=Math.sin($);var c=d.x-_.x;var e=d.y-_.y;d.x=c*a-e*b+_.x;d.y=c*b+e*a+_.y;return d}});function Vector3(_,$,a){var b=this;b.x=_||0;b.y=$||0;b.z=a||0};Object.assign(Vector3.prototype,{isVector3:true,set:function(_,$,a){var b=this;b.x=_;b.y=$;b.z=a;return b},setScalar:function(_){var $=this;$.x=_;$.y=_;$.z=_;return $},setX:function(_){var $=this;$.x=_;return $},setY:function(_){var $=this;$.y=_;return $},setZ:function(_){var $=this;$.z=_;return $},setComponent:function(_,$){var a=this;switch(_){case 0:a.x=$;break;case 1:a.y=$;break;case 2:a.z=$;break;default:throw new Error('index is out of range: '+_)}return a},getComponent:function(_){var $=this;switch(_){case 0:return $.x;case 1:return $.y;case 2:return $.z;default:throw new Error('index is out of range: '+_)}},clone:function(){var _=this;return new _.constructor(_.x,_.y,_.z)},copy:function(_){var $=this;$.x=_.x;$.y=_.y;$.z=_.z;return $},add:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return a.addVectors(_,$)}a.x+=_.x;a.y+=_.y;a.z+=_.z;return a},addScalar:function(_){var $=this;$.x+=_;$.y+=_;$.z+=_;return $},addVectors:function(_,$){var a=this;a.x=_.x+$.x;a.y=_.y+$.y;a.z=_.z+$.z;return a},addScaledVector:function(_,$){var a=this;a.x+=_.x*$;a.y+=_.y*$;a.z+=_.z*$;return a},sub:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return a.subVectors(_,$)}a.x-=_.x;a.y-=_.y;a.z-=_.z;return a},subScalar:function(_){var $=this;$.x-=_;$.y-=_;$.z-=_;return $},subVectors:function(_,$){var a=this;a.x=_.x-$.x;a.y=_.y-$.y;a.z=_.z-$.z;return a},multiply:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');return a.multiplyVectors(_,$)}a.x*=_.x;a.y*=_.y;a.z*=_.z;return a},multiplyScalar:function(_){var $=this;$.x*=_;$.y*=_;$.z*=_;return $},multiplyVectors:function(_,$){var a=this;a.x=_.x*$.x;a.y=_.y*$.y;a.z=_.z*$.z;return a},applyMatrix3:function(_){var a=this;var $=a.x,b=a.y,c=a.z;var d=_.elements;a.x=d[0]*$+d[3]*b+d[6]*c;a.y=d[1]*$+d[4]*b+d[7]*c;a.z=d[2]*$+d[5]*b+d[8]*c;return a},applyMatrix4:function(_){var a=this;var $=a.x,b=a.y,c=a.z;var d=_.elements;var e=1/(d[3]*$+d[7]*b+d[11]*c+d[15]);a.x=(d[0]*$+d[4]*b+d[8]*c+d[12])*e;a.y=(d[1]*$+d[5]*b+d[9]*c+d[13])*e;a.z=(d[2]*$+d[6]*b+d[10]*c+d[14])*e;return a},applyQuaternion:function(_){var a=this;var $=a.x,b=a.y,c=a.z;var d=_.x,e=_.y,f=_.z,g=_.w;var h=g*$+e*c-f*b;var i=g*b+f*$-d*c;var j=g*c+d*b-e*$;var k=-d*$-e*b-f*c;a.x=h*g+k*-d+i*-f-j*-e;a.y=i*g+k*-e+j*-d-h*-f;a.z=j*g+k*-f+h*-e-i*-d;return a},project:function project(_){var a=this;var $=new Matrix4();$.multiplyMatrices(_.projectionMatrix,$.getInverse(_.matrixWorld));return a.applyMatrix4($)},unproject:function(_){var a=this;var $=new Matrix4();$.multiplyMatrices(_.matrixWorld,$.getInverse(_.projectionMatrix));return a.applyMatrix4($)},transformDirection:function(_){var a=this;var $=a.x,b=a.y,c=a.z;var d=_.elements;a.x=d[0]*$+d[4]*b+d[8]*c;a.y=d[1]*$+d[5]*b+d[9]*c;a.z=d[2]*$+d[6]*b+d[10]*c;return a.normalize()},divide:function(_){var $=this;$.x/=_.x;$.y/=_.y;$.z/=_.z;return $},divideScalar:function(_){var $=this;return $.multiplyScalar(1/_)},min:function(_){var $=this;$.x=Math.min($.x,_.x);$.y=Math.min($.y,_.y);$.z=Math.min($.z,_.z);return $},max:function(_){var $=this;$.x=Math.max($.x,_.x);$.y=Math.max($.y,_.y);$.z=Math.max($.z,_.z);return $},clamp:function(_,$){var a=this;a.x=Math.max(_.x,Math.min($.x,a.x));a.y=Math.max(_.y,Math.min($.y,a.y));a.z=Math.max(_.z,Math.min($.z,a.z));return a},clampScalar:function(){var _=new Vector3();var $=new Vector3();return function a(b,c){var d=this;_.set(b,b,b);$.set(c,c,c);return d.clamp(_,$)}}(),clampLength:function(_,$){var b=this;var a=b.length();return b.divideScalar(a||1).multiplyScalar(Math.max(_,Math.min($,a)))},floor:function(){var _=this;_.x=Math.floor(_.x);_.y=Math.floor(_.y);_.z=Math.floor(_.z);return _},ceil:function(){var _=this;_.x=Math.ceil(_.x);_.y=Math.ceil(_.y);_.z=Math.ceil(_.z);return _},round:function(){var _=this;_.x=Math.round(_.x);_.y=Math.round(_.y);_.z=Math.round(_.z);return _},roundToZero:function(){var _=this;_.x=(_.x<0)?Math.ceil(_.x):Math.floor(_.x);_.y=(_.y<0)?Math.ceil(_.y):Math.floor(_.y);_.z=(_.z<0)?Math.ceil(_.z):Math.floor(_.z);return _},negate:function(){var _=this;_.x=-_.x;_.y=-_.y;_.z=-_.z;return _},dot:function(_){var $=this;return $.x*_.x+$.y*_.y+$.z*_.z},lengthSq:function(){var _=this;return _.x*_.x+_.y*_.y+_.z*_.z},length:function(){var _=this;return Math.sqrt(_.x*_.x+_.y*_.y+_.z*_.z)},lengthManhattan:function(){var _=this;return Math.abs(_.x)+Math.abs(_.y)+Math.abs(_.z)},normalize:function(){var _=this;return _.divideScalar(_.length()||1)},setLength:function(_){var $=this;return $.normalize().multiplyScalar(_)},lerp:function(_,$){var a=this;a.x+=(_.x-a.x)*$;a.y+=(_.y-a.y)*$;a.z+=(_.z-a.z)*$;return a},lerpVectors:function(_,$,a){var b=this;return b.subVectors($,_).multiplyScalar(a).add(_)},cross:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');return a.crossVectors(_,$)}var b=a.x,c=a.y,d=a.z;a.x=c*_.z-d*_.y;a.y=d*_.x-b*_.z;a.z=b*_.y-c*_.x;return a},crossVectors:function(_,$){var g=this;var a=_.x,b=_.y,c=_.z;var d=$.x,e=$.y,f=$.z;g.x=b*f-c*e;g.y=c*d-a*f;g.z=a*e-b*d;return g},projectOnVector:function(_){var a=this;var $=_.dot(a)/_.lengthSq();return a.copy(_).multiplyScalar($)},projectOnPlane:function(){var _=new Vector3();return function $(a){var b=this;_.copy(b).projectOnVector(a);return b.sub(_)}}(),reflect:function(){var _=new Vector3();return function $(a){var b=this;return b.sub(_.copy(a).multiplyScalar(2*b.dot(a)))}}(),angleTo:function(_){var a=this;var $=a.dot(_)/(Math.sqrt(a.lengthSq()*_.lengthSq()));return Math.acos(_Math.clamp($,-1,1))},distanceTo:function(_){var $=this;return Math.sqrt($.distanceToSquared(_))},distanceToSquared:function(_){var a=this;var $=a.x-_.x,b=a.y-_.y,c=a.z-_.z;return $*$+b*b+c*c},distanceToManhattan:function(_){var $=this;return Math.abs($.x-_.x)+Math.abs($.y-_.y)+Math.abs($.z-_.z)},setFromSpherical:function(_){var a=this;var $=Math.sin(_.phi)*_.radius;a.x=$*Math.sin(_.theta);a.y=Math.cos(_.phi)*_.radius;a.z=$*Math.cos(_.theta);return a},setFromCylindrical:function(_){var $=this;$.x=_.radius*Math.sin(_.theta);$.y=_.y;$.z=_.radius*Math.cos(_.theta);return $},setFromMatrixPosition:function(_){var a=this;var $=_.elements;a.x=$[12];a.y=$[13];a.z=$[14];return a},setFromMatrixScale:function(_){var a=this;var $=a.setFromMatrixColumn(_,0).length();var b=a.setFromMatrixColumn(_,1).length();var c=a.setFromMatrixColumn(_,2).length();a.x=$;a.y=b;a.z=c;return a},setFromMatrixColumn:function(_,$){var a=this;return a.fromArray(_.elements,$*4)},equals:function(_){var $=this;return ((_.x===$.x)&&(_.y===$.y)&&(_.z===$.z))},fromArray:function(_,$){var a=this;if($===undefined)$=0;a.x=_[$];a.y=_[$+1];a.z=_[$+2];return a},toArray:function(_,$){var a=this;if(_===undefined)_=[];if($===undefined)$=0;_[$]=a.x;_[$+1]=a.y;_[$+2]=a.z;return _},fromBufferAttribute:function(_,$,a){var b=this;if(a!==undefined){trace('THREE.Vector3: offset has been removed from .fromBufferAttribute().')}b.x=_.getX($);b.y=_.getY($);b.z=_.getZ($);return b},toString:function(){var _=this;return "("+_.x+","+_.y+","+_.z+")"}});function Vector4(_,$,a,b){var c=this;c.x=_||0;c.y=$||0;c.z=a||0;c.w=(b!==undefined)?b:1};Object.assign(Vector4.prototype,{isVector4:true,set:function(_,$,a,b){var c=this;c.x=_;c.y=$;c.z=a;c.w=b;return c},setScalar:function(_){var $=this;$.x=_;$.y=_;$.z=_;$.w=_;return $},setX:function(_){var $=this;$.x=_;return $},setY:function(_){var $=this;$.y=_;return $},setZ:function(_){var $=this;$.z=_;return $},setW:function(_){var $=this;$.w=_;return $},setComponent:function(_,$){var a=this;switch(_){case 0:a.x=$;break;case 1:a.y=$;break;case 2:a.z=$;break;case 3:a.w=$;break;default:throw new Error('index is out of range: '+_)}return a},getComponent:function(_){var $=this;switch(_){case 0:return $.x;case 1:return $.y;case 2:return $.z;case 3:return $.w;default:throw new Error('index is out of range: '+_)}},clone:function(){var _=this;return new _.constructor(_.x,_.y,_.z,_.w)},copy:function(_){var $=this;$.x=_.x;$.y=_.y;$.z=_.z;$.w=(_.w!==undefined)?_.w:1;return $},add:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return a.addVectors(_,$)}a.x+=_.x;a.y+=_.y;a.z+=_.z;a.w+=_.w;return a},addScalar:function(_){var $=this;$.x+=_;$.y+=_;$.z+=_;$.w+=_;return $},addVectors:function(_,$){var a=this;a.x=_.x+$.x;a.y=_.y+$.y;a.z=_.z+$.z;a.w=_.w+$.w;return a},addScaledVector:function(_,$){var a=this;a.x+=_.x*$;a.y+=_.y*$;a.z+=_.z*$;a.w+=_.w*$;return a},sub:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return a.subVectors(_,$)}a.x-=_.x;a.y-=_.y;a.z-=_.z;a.w-=_.w;return a},subScalar:function(_){var $=this;$.x-=_;$.y-=_;$.z-=_;$.w-=_;return $},subVectors:function(_,$){var a=this;a.x=_.x-$.x;a.y=_.y-$.y;a.z=_.z-$.z;a.w=_.w-$.w;return a},multiplyScalar:function(_){var $=this;$.x*=_;$.y*=_;$.z*=_;$.w*=_;return $},applyMatrix4:function(_){var a=this;var $=a.x,b=a.y,c=a.z,d=a.w;var e=_.elements;a.x=e[0]*$+e[4]*b+e[8]*c+e[12]*d;a.y=e[1]*$+e[5]*b+e[9]*c+e[13]*d;a.z=e[2]*$+e[6]*b+e[10]*c+e[14]*d;a.w=e[3]*$+e[7]*b+e[11]*c+e[15]*d;return a},divideScalar:function(_){var $=this;return $.multiplyScalar(1/_)},setAxisAngleFromQuaternion:function(_){var $=this;$.w=2*Math.acos(_.w);var a=Math.sqrt(1-_.w*_.w);if(a<0.0001){$.x=1;$.y=0;$.z=0}else{$.x=_.x/a;$.y=_.y/a;$.z=_.z/a}return $},setAxisAngleFromRotationMatrix:function(_){var m=this;var $,x,y,z,a=0.01,b=0.1,c=_.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10];if((Math.abs(e-g)<a)&&(Math.abs(f-j)<a)&&(Math.abs(i-k)<a)){if((Math.abs(e+g)<b)&&(Math.abs(f+j)<b)&&(Math.abs(i+k)<b)&&(Math.abs(d+h+l-3)<b)){m.set(1,0,0,0);return m}$=Math.PI;var n=(d+1)/2;var o=(h+1)/2;var p=(l+1)/2;var q=(e+g)/4;var r=(f+j)/4;var s=(i+k)/4;if((n>o)&&(n>p)){if(n<a){x=0;y=0.707106781;z=0.707106781}else{x=Math.sqrt(n);y=q/x;z=r/x}}else if(o>p){if(o<a){x=0.707106781;y=0;z=0.707106781}else{y=Math.sqrt(o);x=q/y;z=s/y}}else{if(p<a){x=0.707106781;y=0.707106781;z=0}else{z=Math.sqrt(p);x=r/z;y=s/z}}m.set(x,y,z,$);return m}var t=Math.sqrt((k-i)*(k-i)+(f-j)*(f-j)+(g-e)*(g-e));if(Math.abs(t)<0.001)t=1;m.x=(k-i)/t;m.y=(f-j)/t;m.z=(g-e)/t;m.w=Math.acos((d+h+l-1)/2);return m},min:function(_){var $=this;$.x=Math.min($.x,_.x);$.y=Math.min($.y,_.y);$.z=Math.min($.z,_.z);$.w=Math.min($.w,_.w);return $},max:function(_){var $=this;$.x=Math.max($.x,_.x);$.y=Math.max($.y,_.y);$.z=Math.max($.z,_.z);$.w=Math.max($.w,_.w);return $},clamp:function(_,$){var a=this;a.x=Math.max(_.x,Math.min($.x,a.x));a.y=Math.max(_.y,Math.min($.y,a.y));a.z=Math.max(_.z,Math.min($.z,a.z));a.w=Math.max(_.w,Math.min($.w,a.w));return a},clampScalar:function(){var _,max;return function $(a,b){var c=this;if(_===undefined){_=new Vector4();max=new Vector4()}_.set(a,a,a,a);max.set(b,b,b,b);return c.clamp(_,max)}}(),clampLength:function(_,$){var b=this;var a=b.length();return b.divideScalar(a||1).multiplyScalar(Math.max(_,Math.min($,a)))},floor:function(){var _=this;_.x=Math.floor(_.x);_.y=Math.floor(_.y);_.z=Math.floor(_.z);_.w=Math.floor(_.w);return _},ceil:function(){var _=this;_.x=Math.ceil(_.x);_.y=Math.ceil(_.y);_.z=Math.ceil(_.z);_.w=Math.ceil(_.w);return _},round:function(){var _=this;_.x=Math.round(_.x);_.y=Math.round(_.y);_.z=Math.round(_.z);_.w=Math.round(_.w);return _},roundToZero:function(){var _=this;_.x=(_.x<0)?Math.ceil(_.x):Math.floor(_.x);_.y=(_.y<0)?Math.ceil(_.y):Math.floor(_.y);_.z=(_.z<0)?Math.ceil(_.z):Math.floor(_.z);_.w=(_.w<0)?Math.ceil(_.w):Math.floor(_.w);return _},negate:function(){var _=this;_.x=-_.x;_.y=-_.y;_.z=-_.z;_.w=-_.w;return _},dot:function(_){var $=this;return $.x*_.x+$.y*_.y+$.z*_.z+$.w*_.w},lengthSq:function(){var _=this;return _.x*_.x+_.y*_.y+_.z*_.z+_.w*_.w},length:function(){var _=this;return Math.sqrt(_.x*_.x+_.y*_.y+_.z*_.z+_.w*_.w)},lengthManhattan:function(){var _=this;return Math.abs(_.x)+Math.abs(_.y)+Math.abs(_.z)+Math.abs(_.w)},normalize:function(){var _=this;return _.divideScalar(_.length()||1)},setLength:function(_){var $=this;return $.normalize().multiplyScalar(_)},lerp:function(_,$){var a=this;a.x+=(_.x-a.x)*$;a.y+=(_.y-a.y)*$;a.z+=(_.z-a.z)*$;a.w+=(_.w-a.w)*$;return a},lerpVectors:function(_,$,a){var b=this;return b.subVectors($,_).multiplyScalar(a).add(_)},equals:function(_){var $=this;return ((_.x===$.x)&&(_.y===$.y)&&(_.z===$.z)&&(_.w===$.w))},fromArray:function(_,$){var a=this;if($===undefined)$=0;a.x=_[$];a.y=_[$+1];a.z=_[$+2];a.w=_[$+3];return a},toArray:function(_,$){var a=this;if(_===undefined)_=[];if($===undefined)$=0;_[$]=a.x;_[$+1]=a.y;_[$+2]=a.z;_[$+3]=a.w;return _},fromBufferAttribute:function(_,$,a){var b=this;if(a!==undefined){console.warn('THREE.Vector4: offset has been removed from .fromBufferAttribute().')}b.x=_.getX($);b.y=_.getY($);b.z=_.getZ($);b.w=_.getW($);return b}});function Matrix3(){var _=this;_.elements=[1,0,0,0,1,0,0,0,1];if(arguments.length>0){console.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.')}};Object.assign(Matrix3.prototype,{isMatrix3:true,set:function(_,$,a,b,c,d,e,f,g){var i=this;var h=i.elements;h[0]=_;h[1]=b;h[2]=e;h[3]=$;h[4]=c;h[5]=f;h[6]=a;h[7]=d;h[8]=g;return i},identity:function(){var _=this;_.set(1,0,0,0,1,0,0,0,1);return _},clone:function(){var _=this;return new _.constructor().fromArray(_.elements)},copy:function(_){var a=this;var $=a.elements;var b=_.elements;$[0]=b[0];$[1]=b[1];$[2]=b[2];$[3]=b[3];$[4]=b[4];$[5]=b[5];$[6]=b[6];$[7]=b[7];$[8]=b[8];return a},setFromMatrix4:function(_){var a=this;var $=_.elements;a.set($[0],$[4],$[8],$[1],$[5],$[9],$[2],$[6],$[10]);return a},applyToBufferAttribute:function(){var _=new Vector3();return function $(a){var d=this;for(var b=0,c=a.count;b<c;b++){_.x=a.getX(b);_.y=a.getY(b);_.z=a.getZ(b);_.applyMatrix3(d);a.setXYZ(b,_.x,_.y,_.z)}return a}}(),multiply:function(_){var $=this;return $.multiplyMatrices($,_)},premultiply:function(_){var $=this;return $.multiplyMatrices(_,$)},multiplyMatrices:function(_,$){var d=this;var a=_.elements;var b=$.elements;var c=d.elements;var e=a[0],f=a[3],g=a[6];var h=a[1],i=a[4],j=a[7];var k=a[2],l=a[5],m=a[8];var n=b[0],o=b[3],p=b[6];var q=b[1],r=b[4],s=b[7];var t=b[2],u=b[5],v=b[8];c[0]=e*n+f*q+g*t;c[3]=e*o+f*r+g*u;c[6]=e*p+f*s+g*v;c[1]=h*n+i*q+j*t;c[4]=h*o+i*r+j*u;c[7]=h*p+i*s+j*v;c[2]=k*n+l*q+m*t;c[5]=k*o+l*r+m*u;c[8]=k*p+l*s+m*v;return d},multiplyScalar:function(_){var a=this;var $=a.elements;$[0]*=_;$[3]*=_;$[6]*=_;$[1]*=_;$[4]*=_;$[7]*=_;$[2]*=_;$[5]*=_;$[8]*=_;return a},determinant:function(){var $=this;var _=$.elements;var a=_[0],b=_[1],c=_[2],d=_[3],e=_[4],f=_[5],g=_[6],h=_[7],i=_[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function(_,$){var c=this;if(_&&_.isMatrix4){console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.")}var a=_.elements,b=c.elements,d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=l*h-i*k,n=i*j-l*g,o=k*g-h*j,p=d*m+e*n+f*o;if(p===0){var q="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if($===true){throw new Error(q)}else{console.warn(q)}return c.identity()}var r=1/p;b[0]=m*r;b[1]=(f*k-l*e)*r;b[2]=(i*e-f*h)*r;b[3]=n*r;b[4]=(l*d-f*j)*r;b[5]=(f*g-i*d)*r;b[6]=o*r;b[7]=(e*j-k*d)*r;b[8]=(h*d-e*g)*r;return c},transpose:function(){var a=this;var _,$=a.elements;_=$[1];$[1]=$[3];$[3]=_;_=$[2];$[2]=$[6];$[6]=_;_=$[5];$[5]=$[7];$[7]=_;return a},getNormalMatrix:function(_){var $=this;return $.setFromMatrix4(_).getInverse($).transpose()},transposeIntoArray:function(_){var a=this;var $=a.elements;_[0]=$[0];_[1]=$[3];_[2]=$[6];_[3]=$[1];_[4]=$[4];_[5]=$[7];_[6]=$[2];_[7]=$[5];_[8]=$[8];return a},setUvTransform:function(_,$,a,b,c,d,e){var h=this;var f=Math.cos(c);var g=Math.sin(c);h.set(a*f,a*g,-a*(f*d+g*e)+d+_,-b*g,b*f,-b*(-g*d+f*e)+e+$,0,0,1)},scale:function(_,$){var b=this;var a=b.elements;a[0]*=_;a[3]*=_;a[6]*=_;a[1]*=$;a[4]*=$;a[7]*=$;return b},rotate:function(_){var c=this;var $=Math.cos(_);var a=Math.sin(_);var b=c.elements;var d=b[0],e=b[3],f=b[6];var g=b[1],h=b[4],i=b[7];b[0]=$*d+a*g;b[3]=$*e+a*h;b[6]=$*f+a*i;b[1]=-a*d+$*g;b[4]=-a*e+$*h;b[7]=-a*f+$*i;return c},translate:function(_,$){var b=this;var a=b.elements;a[0]+=_*a[2];a[3]+=_*a[5];a[6]+=_*a[8];a[1]+=$*a[2];a[4]+=$*a[5];a[7]+=$*a[8];return b},equals:function(_){var a=this;var $=a.elements;var b=_.elements;for(var c=0;c<9;c++){if($[c]!==b[c])return false}return true},fromArray:function(_,$){var b=this;if($===undefined)$=0;for(var a=0;a<9;a++){b.elements[a]=_[a+$]}return b},toArray:function(_,$){var b=this;if(_===undefined)_=[];if($===undefined)$=0;var a=b.elements;_[$]=a[0];_[$+1]=a[1];_[$+2]=a[2];_[$+3]=a[3];_[$+4]=a[4];_[$+5]=a[5];_[$+6]=a[6];_[$+7]=a[7];_[$+8]=a[8];return _}});function Matrix4(){var _=this;_.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(arguments.length>0){console.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.')}};Object.assign(Matrix4.prototype,{isMatrix4:true,set:function(_,$,a,b,c,d,e,f,g,h,i,j,k,l,m,n){var p=this;var o=p.elements;o[0]=_;o[4]=$;o[8]=a;o[12]=b;o[1]=c;o[5]=d;o[9]=e;o[13]=f;o[2]=g;o[6]=h;o[10]=i;o[14]=j;o[3]=k;o[7]=l;o[11]=m;o[15]=n;return p},identity:function(){var _=this;_.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return _},clone:function(){var _=this;return new Matrix4().fromArray(_.elements)},copy:function(_){var a=this;var $=a.elements;var b=_.elements;$[0]=b[0];$[1]=b[1];$[2]=b[2];$[3]=b[3];$[4]=b[4];$[5]=b[5];$[6]=b[6];$[7]=b[7];$[8]=b[8];$[9]=b[9];$[10]=b[10];$[11]=b[11];$[12]=b[12];$[13]=b[13];$[14]=b[14];$[15]=b[15];return a},copyPosition:function(_){var a=this;var $=a.elements,b=_.elements;$[12]=b[12];$[13]=b[13];$[14]=b[14];return a},extractBasis:function(_,$,a){var b=this;_.setFromMatrixColumn(b,0);$.setFromMatrixColumn(b,1);a.setFromMatrixColumn(b,2);return b},makeBasis:function(_,$,a){var b=this;b.set(_.x,$.x,a.x,0,_.y,$.y,a.y,0,_.z,$.z,a.z,0,0,0,0,1);return b},extractRotation:function(){var _=new Vector3();return function $(a){var c=this;var b=c.elements;var d=a.elements;var e=1/_.setFromMatrixColumn(a,0).length();var f=1/_.setFromMatrixColumn(a,1).length();var g=1/_.setFromMatrixColumn(a,2).length();b[0]=d[0]*e;b[1]=d[1]*e;b[2]=d[2]*e;b[4]=d[4]*f;b[5]=d[5]*f;b[6]=d[6]*f;b[8]=d[8]*g;b[9]=d[9]*g;b[10]=d[10]*g;return c}}(),makeRotationFromEuler:function(_){var a=this;if(!(_&&_.isEuler)){console.error('THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.')}var $=a.elements;var b=_.x,c=_.y,d=_.z;var e=Math.cos(b),f=Math.sin(b);var g=Math.cos(c),h=Math.sin(c);var i=Math.cos(d),j=Math.sin(d);if(_.order==='XYZ'){var k=e*i,l=e*j,m=f*i,n=f*j;$[0]=g*i;$[4]=-g*j;$[8]=h;$[1]=l+m*h;$[5]=k-n*h;$[9]=-f*g;$[2]=n-k*h;$[6]=m+l*h;$[10]=e*g}else if(_.order==='YXZ'){var o=g*i,p=g*j,q=h*i,r=h*j;$[0]=o+r*f;$[4]=q*f-p;$[8]=e*h;$[1]=e*j;$[5]=e*i;$[9]=-f;$[2]=p*f-q;$[6]=r+o*f;$[10]=e*g}else if(_.order==='ZXY'){var o=g*i,p=g*j,q=h*i,r=h*j;$[0]=o-r*f;$[4]=-e*j;$[8]=q+p*f;$[1]=p+q*f;$[5]=e*i;$[9]=r-o*f;$[2]=-e*h;$[6]=f;$[10]=e*g}else if(_.order==='ZYX'){var k=e*i,l=e*j,m=f*i,n=f*j;$[0]=g*i;$[4]=m*h-l;$[8]=k*h+n;$[1]=g*j;$[5]=n*h+k;$[9]=l*h-m;$[2]=-h;$[6]=f*g;$[10]=e*g}else if(_.order==='YZX'){var s=e*g,t=e*h,u=f*g,v=f*h;$[0]=g*i;$[4]=v-s*j;$[8]=u*j+t;$[1]=j;$[5]=e*i;$[9]=-f*i;$[2]=-h*i;$[6]=t*j+u;$[10]=s-v*j}else if(_.order==='XZY'){var s=e*g,t=e*h,u=f*g,v=f*h;$[0]=g*i;$[4]=-j;$[8]=h*i;$[1]=s*j+v;$[5]=e*i;$[9]=t*j-u;$[2]=u*j-t;$[6]=f*i;$[10]=v*j+s}$[3]=0;$[7]=0;$[11]=0;$[12]=0;$[13]=0;$[14]=0;$[15]=1;return a},makeRotationFromQuaternion:function(_){var a=this;var $=a.elements;var b=_._x,c=_._y,d=_._z,e=_._w;var f=b+b,g=c+c,h=d+d;var i=b*f,j=b*g,k=b*h;var l=c*g,m=c*h,n=d*h;var o=e*f,p=e*g,q=e*h;$[0]=1-(l+n);$[4]=j-q;$[8]=k+p;$[1]=j+q;$[5]=1-(i+n);$[9]=m-o;$[2]=k-p;$[6]=m+o;$[10]=1-(i+l);$[3]=0;$[7]=0;$[11]=0;$[12]=0;$[13]=0;$[14]=0;$[15]=1;return a},lookAt:function(){var _=new Vector3();var $=new Vector3();var a=new Vector3();return function b(c,d,e){var g=this;var f=g.elements;a.subVectors(c,d);if(a.lengthSq()===0){a.z=1}a.normalize();_.crossVectors(e,a);if(_.lengthSq()===0){if(Math.abs(e.z)===1){a.x+=0.0001}else{a.z+=0.0001}a.normalize();_.crossVectors(e,a)}_.normalize();$.crossVectors(a,_);f[0]=_.x;f[4]=$.x;f[8]=a.x;f[1]=_.y;f[5]=$.y;f[9]=a.y;f[2]=_.z;f[6]=$.z;f[10]=a.z;return g}}(),multiply:function(_,$){var a=this;if($!==undefined){console.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');return a.multiplyMatrices(_,$)}return a.multiplyMatrices(a,_)},premultiply:function(_){var $=this;return $.multiplyMatrices(_,$)},multiplyMatrices:function(_,$){var d=this;var a=_.elements;var b=$.elements;var c=d.elements;var e=a[0],f=a[4],g=a[8],h=a[12];var i=a[1],j=a[5],k=a[9],l=a[13];var m=a[2],n=a[6],o=a[10],p=a[14];var q=a[3],r=a[7],s=a[11],t=a[15];var u=b[0],v=b[4],w=b[8],x=b[12];var y=b[1],z=b[5],A=b[9],B=b[13];var C=b[2],D=b[6],E=b[10],F=b[14];var G=b[3],H=b[7],I=b[11],J=b[15];c[0]=e*u+f*y+g*C+h*G;c[4]=e*v+f*z+g*D+h*H;c[8]=e*w+f*A+g*E+h*I;c[12]=e*x+f*B+g*F+h*J;c[1]=i*u+j*y+k*C+l*G;c[5]=i*v+j*z+k*D+l*H;c[9]=i*w+j*A+k*E+l*I;c[13]=i*x+j*B+k*F+l*J;c[2]=m*u+n*y+o*C+p*G;c[6]=m*v+n*z+o*D+p*H;c[10]=m*w+n*A+o*E+p*I;c[14]=m*x+n*B+o*F+p*J;c[3]=q*u+r*y+s*C+t*G;c[7]=q*v+r*z+s*D+t*H;c[11]=q*w+r*A+s*E+t*I;c[15]=q*x+r*B+s*F+t*J;return d},multiplyScalar:function(_){var a=this;var $=a.elements;$[0]*=_;$[4]*=_;$[8]*=_;$[12]*=_;$[1]*=_;$[5]*=_;$[9]*=_;$[13]*=_;$[2]*=_;$[6]*=_;$[10]*=_;$[14]*=_;$[3]*=_;$[7]*=_;$[11]*=_;$[15]*=_;return a},applyToBufferAttribute:function(){var _=new Vector3();return function $(a){var d=this;for(var b=0,c=a.count;b<c;b++){_.x=a.getX(b);_.y=a.getY(b);_.z=a.getZ(b);_.applyMatrix4(d);a.setXYZ(b,_.x,_.y,_.z)}return a}}(),determinant:function(){var $=this;var _=$.elements;var a=_[0],b=_[4],c=_[8],d=_[12];var e=_[1],f=_[5],g=_[9],h=_[13];var i=_[2],j=_[6],k=_[10],l=_[14];var m=_[3],n=_[7],o=_[11],p=_[15];return (m*(+d*g*j-c*h*j-d*f*k+b*h*k+c*f*l-b*g*l)+n*(+a*g*l-a*h*k+d*e*k-c*e*l+c*h*i-d*g*i)+o*(+a*h*j-a*f*l-d*e*j+b*e*l+d*f*i-b*h*i)+p*(-c*f*i-a*g*j+a*f*k+c*e*j-b*e*k+b*g*i))},transpose:function(){var $=this;var _=$.elements;var a;a=_[1];_[1]=_[4];_[4]=a;a=_[2];_[2]=_[8];_[8]=a;a=_[6];_[6]=_[9];_[9]=a;a=_[3];_[3]=_[12];_[12]=a;a=_[7];_[7]=_[13];_[13]=a;a=_[11];_[11]=_[14];_[14]=a;return $},setPosition:function(_){var a=this;var $=a.elements;$[12]=_.x;$[13]=_.y;$[14]=_.z;return a},getInverse:function(_,$){var b=this;var a=b.elements,c=_.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15],t=m*r*k-q*n*k+q*j*o-i*r*o-m*j*s+i*n*s,u=p*n*k-l*r*k-p*j*o+h*r*o+l*j*s-h*n*s,v=l*q*k-p*m*k+p*i*o-h*q*o-l*i*s+h*m*s,w=p*m*j-l*q*j-p*i*n+h*q*n+l*i*r-h*m*r;var x=d*t+e*u+f*v+g*w;if(x===0){var y="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if($===true){throw new Error(y)}else{console.warn(y)}return b.identity()}var z=1/x;a[0]=t*z;a[1]=(q*n*g-m*r*g-q*f*o+e*r*o+m*f*s-e*n*s)*z;a[2]=(i*r*g-q*j*g+q*f*k-e*r*k-i*f*s+e*j*s)*z;a[3]=(m*j*g-i*n*g-m*f*k+e*n*k+i*f*o-e*j*o)*z;a[4]=u*z;a[5]=(l*r*g-p*n*g+p*f*o-d*r*o-l*f*s+d*n*s)*z;a[6]=(p*j*g-h*r*g-p*f*k+d*r*k+h*f*s-d*j*s)*z;a[7]=(h*n*g-l*j*g+l*f*k-d*n*k-h*f*o+d*j*o)*z;a[8]=v*z;a[9]=(p*m*g-l*q*g-p*e*o+d*q*o+l*e*s-d*m*s)*z;a[10]=(h*q*g-p*i*g+p*e*k-d*q*k-h*e*s+d*i*s)*z;a[11]=(l*i*g-h*m*g-l*e*k+d*m*k+h*e*o-d*i*o)*z;a[12]=w*z;a[13]=(l*q*f-p*m*f+p*e*n-d*q*n-l*e*r+d*m*r)*z;a[14]=(p*i*f-h*q*f-p*e*j+d*q*j+h*e*r-d*i*r)*z;a[15]=(h*m*f-l*i*f+l*e*j-d*m*j-h*e*n+d*i*n)*z;return b},scale:function(_){var a=this;var $=a.elements;var b=_.x,c=_.y,d=_.z;$[0]*=b;$[4]*=c;$[8]*=d;$[1]*=b;$[5]*=c;$[9]*=d;$[2]*=b;$[6]*=c;$[10]*=d;$[3]*=b;$[7]*=c;$[11]*=d;return a},getMaxScaleOnAxis:function(){var $=this;var _=$.elements;var a=_[0]*_[0]+_[1]*_[1]+_[2]*_[2];var b=_[4]*_[4]+_[5]*_[5]+_[6]*_[6];var c=_[8]*_[8]+_[9]*_[9]+_[10]*_[10];return Math.sqrt(Math.max(a,b,c))},makeTranslation:function(_,$,a){var b=this;b.set(1,0,0,_,0,1,0,$,0,0,1,a,0,0,0,1);return b},makeRotationX:function(_){var b=this;var $=Math.cos(_),a=Math.sin(_);b.set(1,0,0,0,0,$,-a,0,0,a,$,0,0,0,0,1);return b},makeRotationY:function(_){var b=this;var $=Math.cos(_),a=Math.sin(_);b.set($,0,a,0,0,1,0,0,-a,0,$,0,0,0,0,1);return b},makeRotationZ:function(_){var b=this;var $=Math.cos(_),a=Math.sin(_);b.set($,-a,0,0,a,$,0,0,0,0,1,0,0,0,0,1);return b},makeRotationAxis:function(_,$){var i=this;var a=Math.cos($);var b=Math.sin($);var c=1-a;var d=_.x,e=_.y,f=_.z;var g=c*d,h=c*e;i.set(g*d+a,g*e-b*f,g*f+b*e,0,g*e+b*f,h*e+a,h*f-b*d,0,g*f-b*e,h*f+b*d,c*f*f+a,0,0,0,0,1);return i},makeScale:function(_,$,a){var b=this;b.set(_,0,0,0,0,$,0,0,0,0,a,0,0,0,0,1);return b},makeShear:function(_,$,a){var b=this;b.set(1,$,a,0,_,1,a,0,_,$,1,0,0,0,0,1);return b},compose:function(_,$,a){var b=this;b.makeRotationFromQuaternion($);b.scale(a);b.setPosition(_);return b},decompose:function(){var _=new Vector3();var $=new Matrix4();return function a(b,c,d){var f=this;var e=f.elements;var g=_.set(e[0],e[1],e[2]).length();var h=_.set(e[4],e[5],e[6]).length();var i=_.set(e[8],e[9],e[10]).length();var j=f.determinant();if(j<0)g=-g;b.x=e[12];b.y=e[13];b.z=e[14];$.copy(f);var k=1/g;var l=1/h;var m=1/i;$.elements[0]*=k;$.elements[1]*=k;$.elements[2]*=k;$.elements[4]*=l;$.elements[5]*=l;$.elements[6]*=l;$.elements[8]*=m;$.elements[9]*=m;$.elements[10]*=m;c.setFromRotationMatrix($);d.x=g;d.y=h;d.z=i;return f}}(),makePerspective:function(_,$,a,b,c,d){var f=this;if(d===undefined){console.warn('THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.')}var e=f.elements;var g=2*c/($-_);var h=2*c/(a-b);var i=($+_)/($-_);var j=(a+b)/(a-b);var k=-(d+c)/(d-c);var l=-2*d*c/(d-c);e[0]=g;e[4]=0;e[8]=i;e[12]=0;e[1]=0;e[5]=h;e[9]=j;e[13]=0;e[2]=0;e[6]=0;e[10]=k;e[14]=l;e[3]=0;e[7]=0;e[11]=-1;e[15]=0;return f},makeOrthographic:function(_,$,a,b,c,d){var f=this;var e=f.elements;var g=1.0/($-_);var h=1.0/(a-b);var i=1.0/(d-c);var j=($+_)*g;var k=(a+b)*h;var l=(d+c)*i;e[0]=2*g;e[4]=0;e[8]=0;e[12]=-j;e[1]=0;e[5]=2*h;e[9]=0;e[13]=-k;e[2]=0;e[6]=0;e[10]=-2*i;e[14]=-l;e[3]=0;e[7]=0;e[11]=0;e[15]=1;return f},equals:function(_){var a=this;var $=a.elements;var b=_.elements;for(var c=0;c<16;c++){if($[c]!==b[c])return false}return true},fromArray:function(_,$){var b=this;if($===undefined)$=0;for(var a=0;a<16;a++){b.elements[a]=_[a+$]}return b},toArray:function(_,$){var b=this;if(_===undefined)_=[];if($===undefined)$=0;var a=b.elements;_[$]=a[0];_[$+1]=a[1];_[$+2]=a[2];_[$+3]=a[3];_[$+4]=a[4];_[$+5]=a[5];_[$+6]=a[6];_[$+7]=a[7];_[$+8]=a[8];_[$+9]=a[9];_[$+10]=a[10];_[$+11]=a[11];_[$+12]=a[12];_[$+13]=a[13];_[$+14]=a[14];_[$+15]=a[15];return _}});(function(){"use strict";function _(a,b,c){var d=this;if(typeof a==="undefined"){a=0}if(typeof b==="undefined"){b=0}if(typeof c==="undefined"){c=0}d.x=a;d.y=b;d.z=c}var $=_.prototype;$.getFloatArray=function(){var b=this;var a=b.dst;if(!a)a=b.dst=new Float32Array(3);a[0]=x;a[1]=y;a[2]=z;return a};kisgame.Point3D=_})();function Box2(_,$){var a=this;a.min=(_!==undefined)?_:new Vector2(+Infinity,+Infinity);a.max=($!==undefined)?$:new Vector2(-Infinity,-Infinity)};Object.assign(Box2.prototype,{set:function(_,$){var a=this;a.min.copy(_);a.max.copy($);return a},setFromPoints:function(_){var $=this;$.makeEmpty();for(var a=0,b=_.length;a<b;a++){$.expandByPoint(_[a])}return $},setFromCenterAndSize:function(){var _=new Vector2();return function $(a,b){var d=this;var c=_.copy(b).multiplyScalar(0.5);d.min.copy(a).sub(c);d.max.copy(a).add(c);return d}}(),clone:function(){var _=this;return new _.constructor().copy(_)},copy:function(_){var $=this;$.min.copy(_.min);$.max.copy(_.max);return $},makeEmpty:function(){var _=this;_.min.x=_.min.y=+Infinity;_.max.x=_.max.y=-Infinity;return _},isEmpty:function(){var _=this;return (_.max.x<_.min.x)||(_.max.y<_.min.y)},getCenter:function(_){var a=this;var $=_||new Vector2();return a.isEmpty()?$.set(0,0):$.addVectors(a.min,a.max).multiplyScalar(0.5)},getSize:function(_){var a=this;var $=_||new Vector2();return a.isEmpty()?$.set(0,0):$.subVectors(a.max,a.min)},expandByPoint:function(_){var $=this;$.min.min(_);$.max.max(_);return $},expandByVector:function(_){var $=this;$.min.sub(_);$.max.add(_);return $},expandByScalar:function(_){var $=this;$.min.addScalar(-_);$.max.addScalar(_);return $},containsPoint:function(_){var $=this;return _.x<$.min.x||_.x>$.max.x||_.y<$.min.y||_.y>$.max.y?false:true},containsBox:function(_){var $=this;return $.min.x<=_.min.x&&_.max.x<=$.max.x&&$.min.y<=_.min.y&&_.max.y<=$.max.y},getParameter:function(_,$){var b=this;var a=$||new Vector2();return a.set((_.x-b.min.x)/(b.max.x-b.min.x),(_.y-b.min.y)/(b.max.y-b.min.y))},intersectsBox:function(_){var $=this;return _.max.x<$.min.x||_.min.x>$.max.x||_.max.y<$.min.y||_.min.y>$.max.y?false:true},clampPoint:function(_,$){var b=this;var a=$||new Vector2();return a.copy(_).clamp(b.min,b.max)},distanceToPoint:function(){var _=new Vector2();return function $(a){var c=this;var b=_.copy(a).clamp(c.min,c.max);return b.sub(a).length()}}(),intersect:function(_){var $=this;$.min.max(_.min);$.max.min(_.max);return $},union:function(_){var $=this;$.min.min(_.min);$.max.max(_.max);return $},translate:function(_){var $=this;$.min.add(_);$.max.add(_);return $},equals:function(_){var $=this;return _.min.equals($.min)&&_.max.equals($.max)}});function Box3(_,$){var a=this;a.min=(_!==undefined)?_:new Vector3(+Infinity,+Infinity,+Infinity);a.max=($!==undefined)?$:new Vector3(-Infinity,-Infinity,-Infinity)};Object.assign(Box3.prototype,{isBox3:true,set:function(_,$){var a=this;a.min.copy(_);a.max.copy($);return a},setFromArray:function(_){var k=this;var $=+Infinity;var a=+Infinity;var b=+Infinity;var c=-Infinity;var d=-Infinity;var e=-Infinity;for(var f=0,g=_.length;f<g;f+=3){var h=_[f];var i=_[f+1];var j=_[f+2];if(h<$)$=h;if(i<a)a=i;if(j<b)b=j;if(h>c)c=h;if(i>d)d=i;if(j>e)e=j}k.min.set($,a,b);k.max.set(c,d,e);return k},setFromBufferAttribute:function(_){var k=this;var $=+Infinity;var a=+Infinity;var b=+Infinity;var c=-Infinity;var d=-Infinity;var e=-Infinity;for(var f=0,g=_.count;f<g;f++){var h=_.getX(f);var i=_.getY(f);var j=_.getZ(f);if(h<$)$=h;if(i<a)a=i;if(j<b)b=j;if(h>c)c=h;if(i>d)d=i;if(j>e)e=j}k.min.set($,a,b);k.max.set(c,d,e);return k},setFromPoints:function(_){var $=this;$.makeEmpty();for(var a=0,b=_.length;a<b;a++){$.expandByPoint(_[a])}return $},setFromCenterAndSize:function(){var _=new Vector3();return function $(a,b){var d=this;var c=_.copy(b).multiplyScalar(0.5);d.min.copy(a).sub(c);d.max.copy(a).add(c);return d}}(),setFromObject:function(_){var $=this;$.makeEmpty();return $.expandByObject(_)},clone:function(){var _=this;return new _.constructor().copy(_)},copy:function(_){var $=this;$.min.copy(_.min);$.max.copy(_.max);return $},makeEmpty:function(){var _=this;_.min.x=_.min.y=_.min.z=+Infinity;_.max.x=_.max.y=_.max.z=-Infinity;return _},isEmpty:function(){var _=this;return (_.max.x<_.min.x)||(_.max.y<_.min.y)||(_.max.z<_.min.z)},getCenter:function(_){var a=this;var $=_||new Vector3();return a.isEmpty()?$.set(0,0,0):$.addVectors(a.min,a.max).multiplyScalar(0.5)},getSize:function(_){var a=this;var $=_||new Vector3();return a.isEmpty()?$.set(0,0,0):$.subVectors(a.max,a.min)},expandByPoint:function(_){var $=this;$.min.min(_);$.max.max(_);return $},expandByVector:function(_){var $=this;$.min.sub(_);$.max.add(_);return $},expandByScalar:function(_){var $=this;$.min.addScalar(-_);$.max.addScalar(_);return $},expandByObject:function(){var _=new Vector3();return function $(a){var c=this;var b=c;a.updateMatrixWorld(true);a.traverse(function(d){var e,h;var f=d.geometry;if(f!==undefined){if(f.isGeometry){var g=f.vertices;for(e=0,h=g.length;e<h;e++){_.copy(g[e]);_.applyMatrix4(d.matrixWorld);b.expandByPoint(_)}}else if(f.isBufferGeometry){var i=f.attributes.position;if(i!==undefined){for(e=0,h=i.count;e<h;e++){_.fromBufferAttribute(i,e).applyMatrix4(d.matrixWorld);b.expandByPoint(_)}}}}});return c}}(),containsPoint:function(_){var $=this;return _.x<$.min.x||_.x>$.max.x||_.y<$.min.y||_.y>$.max.y||_.z<$.min.z||_.z>$.max.z?false:true},containsBox:function(_){var $=this;return $.min.x<=_.min.x&&_.max.x<=$.max.x&&$.min.y<=_.min.y&&_.max.y<=$.max.y&&$.min.z<=_.min.z&&_.max.z<=$.max.z},getParameter:function(_,$){var b=this;var a=$||new Vector3();return a.set((_.x-b.min.x)/(b.max.x-b.min.x),(_.y-b.min.y)/(b.max.y-b.min.y),(_.z-b.min.z)/(b.max.z-b.min.z))},intersectsBox:function(_){var $=this;return _.max.x<$.min.x||_.min.x>$.max.x||_.max.y<$.min.y||_.min.y>$.max.y||_.max.z<$.min.z||_.min.z>$.max.z?false:true},intersectsSphere:(function(){var _=new Vector3();return function $(a){var b=this;b.clampPoint(a.center,_);return _.distanceToSquared(a.center)<=(a.radius*a.radius)}})(),intersectsPlane:function(_){var a=this;var $,max;if(_.normal.x>0){$=_.normal.x*a.min.x;max=_.normal.x*a.max.x}else{$=_.normal.x*a.max.x;max=_.normal.x*a.min.x}if(_.normal.y>0){$+=_.normal.y*a.min.y;max+=_.normal.y*a.max.y}else{$+=_.normal.y*a.max.y;max+=_.normal.y*a.min.y}if(_.normal.z>0){$+=_.normal.z*a.min.z;max+=_.normal.z*a.max.z}else{$+=_.normal.z*a.max.z;max+=_.normal.z*a.min.z}return ($<=_.constant&&max>=_.constant)},clampPoint:function(_,$){var b=this;var a=$||new Vector3();return a.copy(_).clamp(b.min,b.max)},distanceToPoint:function(){var _=new Vector3();return function $(a){var c=this;var b=_.copy(a).clamp(c.min,c.max);return b.sub(a).length()}}(),getBoundingSphere:function(){var _=new Vector3();return function $(a){var c=this;var b=a||new Sphere();c.getCenter(b.center);b.radius=c.getSize(_).length()*0.5;return b}}(),intersect:function(_){var $=this;$.min.max(_.min);$.max.min(_.max);if($.isEmpty())$.makeEmpty();return $},union:function(_){var $=this;$.min.min(_.min);$.max.max(_.max);return $},applyMatrix4:function(){var _=[new Vector3(),new Vector3(),new Vector3(),new Vector3(),new Vector3(),new Vector3(),new Vector3(),new Vector3()];return function $(a){var b=this;if(b.isEmpty())return b;_[0].set(b.min.x,b.min.y,b.min.z).applyMatrix4(a);_[1].set(b.min.x,b.min.y,b.max.z).applyMatrix4(a);_[2].set(b.min.x,b.max.y,b.min.z).applyMatrix4(a);_[3].set(b.min.x,b.max.y,b.max.z).applyMatrix4(a);_[4].set(b.max.x,b.min.y,b.min.z).applyMatrix4(a);_[5].set(b.max.x,b.min.y,b.max.z).applyMatrix4(a);_[6].set(b.max.x,b.max.y,b.min.z).applyMatrix4(a);_[7].set(b.max.x,b.max.y,b.max.z).applyMatrix4(a);b.setFromPoints(_);return b}}(),translate:function(_){var $=this;$.min.add(_);$.max.add(_);return $},equals:function(_){var $=this;return _.min.equals($.min)&&_.max.equals($.max)}});function Plane(_,$){var a=this;a.normal=(_!==undefined)?_:new Vector3(1,0,0);a.constant=($!==undefined)?$:0};Object.assign(Plane.prototype,{set:function(_,$){var a=this;a.normal.copy(_);a.constant=$;return a},setComponents:function(_,$,a,b){var c=this;c.normal.set(_,$,a);c.constant=b;return c},setFromNormalAndCoplanarPoint:function(_,$){var a=this;a.normal.copy(_);a.constant=-$.dot(a.normal);return a},setFromCoplanarPoints:function(){var _=new Vector3();var $=new Vector3();return function a(b,c,d){var f=this;var e=_.subVectors(d,c).cross($.subVectors(b,c)).normalize();f.setFromNormalAndCoplanarPoint(e,b);return f}}(),clone:function(){var _=this;return new _.constructor().copy(_)},copy:function(_){var $=this;$.normal.copy(_.normal);$.constant=_.constant;return $},normalize:function(){var $=this;var _=1.0/$.normal.length();$.normal.multiplyScalar(_);$.constant*=_;return $},negate:function(){var _=this;_.constant*=-1;_.normal.negate();return _},distanceToPoint:function(_){var $=this;return $.normal.dot(_)+$.constant},distanceToSphere:function(_){var $=this;return $.distanceToPoint(_.center)-_.radius},projectPoint:function(_,$){var b=this;var a=$||new Vector3();return a.copy(b.normal).multiplyScalar(-b.distanceToPoint(_)).add(_)},intersectLine:function(){var _=new Vector3();return function $(a,b){var f=this;var c=b||new Vector3();var d=a.delta(_);var e=f.normal.dot(d);if(e===0){if(f.distanceToPoint(a.start)===0){return c.copy(a.start)}return undefined}var g=-(a.start.dot(f.normal)+f.constant)/e;if(g<0||g>1){return undefined}return c.copy(d).multiplyScalar(g).add(a.start)}}(),intersectsLine:function(_){var a=this;var $=a.distanceToPoint(_.start);var b=a.distanceToPoint(_.end);return ($<0&&b>0)||(b<0&&$>0)},intersectsBox:function(_){var $=this;return _.intersectsPlane($)},intersectsSphere:function(_){var $=this;return _.intersectsPlane($)},coplanarPoint:function(_){var a=this;var $=_||new Vector3();return $.copy(a.normal).multiplyScalar(-a.constant)},applyMatrix4:function(){var _=new Vector3();var $=new Matrix3();return function a(b,c){var f=this;var d=c||$.getNormalMatrix(b);var e=f.coplanarPoint(_).applyMatrix4(b);var g=f.normal.applyMatrix3(d).normalize();f.constant=-e.dot(g);return f}}(),translate:function(_){var $=this;$.constant-=_.dot($.normal);return $},equals:function(_){var $=this;return _.normal.equals($.normal)&&(_.constant===$.constant)}});function Ray(_,$){var a=this;a.origin=(_!==undefined)?_:new Vector3();a.direction=($!==undefined)?$:new Vector3()};Object.assign(Ray.prototype,{set:function(_,$){var a=this;a.origin.copy(_);a.direction.copy($);return a},clone:function(){var _=this;return new _.constructor().copy(_)},copy:function(_){var $=this;$.origin.copy(_.origin);$.direction.copy(_.direction);return $},at:function(_,$){var b=this;var a=$||new Vector3();return a.copy(b.direction).multiplyScalar(_).add(b.origin)},lookAt:function(_){var $=this;$.direction.copy(_).sub($.origin).normalize();return $},recast:function(){var _=new Vector3();return function $(a){var b=this;b.origin.copy(b.at(a,_));return b}}(),closestPointToPoint:function(_,$){var b=this;var a=$||new Vector3();a.subVectors(_,b.origin);var c=a.dot(b.direction);if(c<0){return a.copy(b.origin)}return a.copy(b.direction).multiplyScalar(c).add(b.origin)},distanceToPoint:function(_){var $=this;return Math.sqrt($.distanceSqToPoint(_))},distanceSqToPoint:function(){var _=new Vector3();return function $(a){var c=this;var b=_.subVectors(a,c.origin).dot(c.direction);if(b<0){return c.origin.distanceToSquared(a)}_.copy(c.direction).multiplyScalar(b).add(c.origin);return _.distanceToSquared(a)}}(),distanceSqToSegment:function(){var _=new Vector3();var $=new Vector3();var a=new Vector3();return function b(c,d,e,f){var g=this;_.copy(c).add(d).multiplyScalar(0.5);$.copy(d).sub(c).normalize();a.copy(g.origin).sub(_);var h=c.distanceTo(d)*0.5;var i=-g.direction.dot($);var j=a.dot(g.direction);var k=-a.dot($);var l=a.lengthSq();var m=Math.abs(1-i*i);var n,s1,sqrDist,extDet;if(m>0){n=i*k-j;s1=i*j-k;extDet=h*m;if(n>=0){if(s1>=-extDet){if(s1<=extDet){var o=1/m;n*=o;s1*=o;sqrDist=n*(n+i*s1+2*j)+s1*(i*n+s1+2*k)+l}else{s1=h;n=Math.max(0,-(i*s1+j));sqrDist=-n*n+s1*(s1+2*k)+l}}else{s1=-h;n=Math.max(0,-(i*s1+j));sqrDist=-n*n+s1*(s1+2*k)+l}}else{if(s1<=-extDet){n=Math.max(0,-(-i*h+j));s1=(n>0)?-h:Math.min(Math.max(-h,-k),h);sqrDist=-n*n+s1*(s1+2*k)+l}else if(s1<=extDet){n=0;s1=Math.min(Math.max(-h,-k),h);sqrDist=s1*(s1+2*k)+l}else{n=Math.max(0,-(i*h+j));s1=(n>0)?h:Math.min(Math.max(-h,-k),h);sqrDist=-n*n+s1*(s1+2*k)+l}}}else{s1=(i>0)?-h:h;n=Math.max(0,-(i*s1+j));sqrDist=-n*n+s1*(s1+2*k)+l}if(e){e.copy(g.direction).multiplyScalar(n).add(g.origin)}if(f){f.copy($).multiplyScalar(s1).add(_)}return sqrDist}}(),intersectSphere:function(){var _=new Vector3();return function $(a,b){var c=this;_.subVectors(a.center,c.origin);var d=_.dot(c.direction);var e=_.dot(_)-d*d;var f=a.radius*a.radius;if(e>f)return null;var g=Math.sqrt(f-e);var h=d-g;var i=d+g;if(h<0&&i<0)return null;if(h<0)return c.at(i,b);return c.at(h,b)}}(),intersectsSphere:function(_){var $=this;return $.distanceToPoint(_.center)<=_.radius},distanceToPlane:function(_){var a=this;var $=_.normal.dot(a.direction);if($===0){if(_.distanceToPoint(a.origin)===0){return 0}return null}var b=-(a.origin.dot(_.normal)+_.constant)/$;return b>=0?b:null},intersectPlane:function(_,$){var b=this;var a=b.distanceToPlane(_);if(a===null){return null}return b.at(a,$)},intersectsPlane:function(_){var a=this;var $=_.distanceToPoint(a.origin);if($===0){return true}var b=_.normal.dot(a.direction);if(b*$<0){return true}return false},intersectBox:function(_,$){var c=this;var a,tmax,tymin,tymax,tzmin,tzmax;var b=1/c.direction.x,d=1/c.direction.y,e=1/c.direction.z;var f=c.origin;if(b>=0){a=(_.min.x-f.x)*b;tmax=(_.max.x-f.x)*b}else{a=(_.max.x-f.x)*b;tmax=(_.min.x-f.x)*b}if(d>=0){tymin=(_.min.y-f.y)*d;tymax=(_.max.y-f.y)*d}else{tymin=(_.max.y-f.y)*d;tymax=(_.min.y-f.y)*d}if((a>tymax)||(tymin>tmax))return null;if(tymin>a||a!==a)a=tymin;if(tymax<tmax||tmax!==tmax)tmax=tymax;if(e>=0){tzmin=(_.min.z-f.z)*e;tzmax=(_.max.z-f.z)*e}else{tzmin=(_.max.z-f.z)*e;tzmax=(_.min.z-f.z)*e}if((a>tzmax)||(tzmin>tmax))return null;if(tzmin>a||a!==a)a=tzmin;if(tzmax<tmax||tmax!==tmax)tmax=tzmax;if(tmax<0)return null;return c.at(a>=0?a:tmax,$)},intersectsBox:(function(){var _=new Vector3();return function $(a){var b=this;return b.intersectBox(a,_)!==null}})(),intersectTriangle:function(){var _=new Vector3();var $=new Vector3();var a=new Vector3();var b=new Vector3();return function c(d,e,f,g,h){var j=this;$.subVectors(e,d);a.subVectors(f,d);b.crossVectors($,a);var i=j.direction.dot(b);var k;if(i>0){if(g)return null;k=1}else if(i<0){k=-1;i=-i}else{return null}_.subVectors(j.origin,d);var l=k*j.direction.dot(a.crossVectors(_,a));if(l<0){return null}var m=k*j.direction.dot($.cross(_));if(m<0){return null}if(l+m>i){return null}var n=-k*_.dot(b);if(n<0){return null}return j.at(n/i,h)}}(),applyMatrix4:function(_){var $=this;$.origin.applyMatrix4(_);$.direction.transformDirection(_);return $},equals:function(_){var $=this;return _.origin.equals($.origin)&&_.direction.equals($.direction)}});function Sphere(_,$){var a=this;a.center=(_!==undefined)?_:new Vector3();a.radius=($!==undefined)?$:0};Object.assign(Sphere.prototype,{set:function(_,$){var a=this;a.center.copy(_);a.radius=$;return a},setFromPoints:function(){var _=new Box3();return function $(a,b){var d=this;var c=d.center;if(b!==undefined){c.copy(b)}else{_.setFromPoints(a).getCenter(c)}var e=0;for(var f=0,g=a.length;f<g;f++){e=Math.max(e,c.distanceToSquared(a[f]))}d.radius=Math.sqrt(e);return d}}(),clone:function(){var _=this;return new _.constructor().copy(_)},copy:function(_){var $=this;$.center.copy(_.center);$.radius=_.radius;return $},empty:function(){var _=this;return (_.radius<=0)},containsPoint:function(_){var $=this;return (_.distanceToSquared($.center)<=($.radius*$.radius))},distanceToPoint:function(_){var $=this;return (_.distanceTo($.center)-$.radius)},intersectsSphere:function(_){var a=this;var $=a.radius+_.radius;return _.center.distanceToSquared(a.center)<=($*$)},intersectsBox:function(_){var $=this;return _.intersectsSphere($)},intersectsPlane:function(_){var $=this;return Math.abs(_.distanceToPoint($.center))<=$.radius},clampPoint:function(_,$){var b=this;var a=b.center.distanceToSquared(_);var c=$||new Vector3();c.copy(_);if(a>(b.radius*b.radius)){c.sub(b.center).normalize();c.multiplyScalar(b.radius).add(b.center)}return c},getBoundingBox:function(_){var a=this;var $=_||new Box3();$.set(a.center,a.center);$.expandByScalar(a.radius);return $},applyMatrix4:function(_){var $=this;$.center.applyMatrix4(_);$.radius=$.radius*_.getMaxScaleOnAxis();return $},translate:function(_){var $=this;$.center.add(_);return $},equals:function(_){var $=this;return _.center.equals($.center)&&(_.radius===$.radius)}});function Raycaster(_,$,a,b){var c=this;c.ray=new Ray(_,$);c.near=a||0;c.far=b||Infinity;c.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(c.params,{PointCloud:{get:function(){var c=this;console.warn('THREE.Raycaster: params.PointCloud has been renamed to params.Points.');return c.Points}}})};function ascSort(_,$){return _.distance-$.distance}function intersectObject(_,$,a,b){if(!child.isVisible()){return}_.raycast($,a);if(b===true){var c=_.children;for(var d=0,e=c.length;d<e;d++){intersectObject(c[d],$,a,true)}}}Object.assign(Raycaster.prototype,{linePrecision:1,set:function(_,$){var a=this;a.ray.set(_,$)},unproject:function(_,$){var a=$.unproject(_.x,_.y,_.z);_.set(a[0],a[1],a[2]);return _},setFromCamera:function(_,$,a){var c=this;var b=a.localToGlobal3D();c.ray.origin.set(b[0],b[1],b[2]);c.ray.direction.set(_,$,.5);var d=c.unproject(c.ray.direction,a).sub(c.ray.origin);if(a.rightHand){d.z=-d.z;c.ray.origin.z=-c.ray.origin.z}d.normalize()},intersectObject:function(_,$){var b=this;var a=[];intersectObject(_,b,a,$);a.sort(ascSort);return a},intersectObjects:function(_,$){var d=this;var a=[];for(var b=0,c=_.length;b<c;b++){intersectObject(_[b],d,a,$)}a.sort(ascSort);return a}});(function(){"use strict";function _(a,b,c,d,e){var f=this;f.setValues(a,b,c,d,e)}var $=_.prototype;$.setValues=function(a,b,c,d,e){var f=this;f.vertices=a;f.indices=b;f.uv=c;f.normals=d;f.pointSize=e;f.boundingSphere=null;f.boundingBox=null;return f};$.copy=function(a){var b=this;b.vertices.set(a.vertices);b.indices.set(a.indices);b.uv.set(a.uv);b.normals.set(a.normals);b.pointSize=a.pointSize;return b};$.clone=function(){var c=this;var a=new _();var b=new Float32Array(c.vertices);var d=new Uint16Array(c.indices);var e=new Float32Array(c.uv);var f=new Float32Array(c.normals);a.setValues(b,d,e,f,c.pointSize);return a};$.toString=function(){return "[Geometry]"};$.computeBoundingBox=function(){var a=this;if(a.boundingBox===null){a.boundingBox=new Box3()}var b=a.vertices;if(b!==undefined){a.boundingBox.setFromPoints(b)}else{a.boundingBox.makeEmpty()}if(isNaN(a.boundingBox.min.x)||isNaN(a.boundingBox.min.y)||isNaN(a.boundingBox.min.z)){trace('computeBoundingBox: NaN',a)}},$.computeBoundingSphere=function(){var b=this;var a=new Box3();if(b.boundingSphere===null){b.boundingSphere=new Sphere()}var c=b.vertices;var d=b.boundingSphere.center;a.setFromArray(c);a.getCenter(d);var e=0;var f=new Vector3();for(var g=0,h=c.length;g<h;g+=3){f.x=c[g];f.y=c[g+1];f.z=c[g+2];e=Math.max(e,d.distanceToSquared(f))}b.boundingSphere.radius=Math.sqrt(e);if(isNaN(b.boundingSphere.radius)){trace('computeBoundingSphere: radius is NaN',b)}};kisgame.Geometry=_}());(function(){"use strict";function _(a,b,c){var d=this;if(c==undefined)c=true;d.drawType=a;d.useLight=c;d.setValues(a,b)}var $=_.prototype;$.setValues=function(a,b,c){var d=this;if(c==undefined)c=true;d.drawType=a;d.useLight=c;d.side=b;return d};$.copy=function(a){var b=this;b.drawType=a.drawType;b.side=a.side;return b};$.clone=function(){var b=this;var a=new _(b.drawType,b.side);return a};$.toString=function(){return "[Material]"};kisgame.Material=_}());(function(){"use strict";var _=kisgame.FillType;function $(b,c,d,e){var f=this;f._super($.super_p.constructor,c,d,e);f.init(b)}var a=KISU.extend($,kisgame.Material);a.init=function(b){var c=this;c.fillType=_.FILL_ONE_COLOR;c.setColor(b||c.randomColorString())};a.setColor=function(b){var c=this;c.color=b;c.convertToColorRate()};a.randomColorString=function(){var b="#";b+=Math.ceil(Math.random()*255).toString(16);b+=Math.ceil(Math.random()*255).toString(16);b+=Math.ceil(Math.random()*255).toString(16);return b};a.convertToColorRate=function(){var b=this;b.colorRate=b.color2RGBRate(b.color)};a.copy=function(b){var c=this;c._super($.super_p.copy,b);c.color=b.color;return c};a.color2RGBRate=function(b){var c,g,a,d=1;c=parseInt("0x"+b.substr(1,2))||0;g=parseInt("0x"+b.substr(3,2))||0;a=parseInt("0x"+b.substr(5,2))||0;if(b.length>8){d=(parseInt("0x"+b.substr(7,2))||255)/255}c/=255;g/=255;a/=255;return {r:c,g:g,b:a,a:d}};a.clone=function(){var c=this;var b=new $(c.color,c.drawType,c.side);return b};a.toString=function(){return "[FillMaterial]"};kisgame.FillMaterial=$}());(function(){"use strict";var _=kisgame.FillType;function $(b,c,d,e){var f=this;f._super($.super_p.constructor,b,c,d,e)}var a=KISU.extend($,kisgame.FillMaterial);a.init=function(b){var c=this;c._super($.super_p.init,b);c.fillType=_.FILL;c.uv=null};a.setSegmentColor=function(b,c,d){var f=this;var e=f.segmentList;if(!e){e=f.segmentList=[]}var g=f.colorList;if(!g){g=f.colorList=[]}g.push(f.color2RGBRate(d));e.push(b,c)};a.createUV=function(b){var d=this;var c=d.colorList;var e=b.vertices;var f=d;if(c&&e){var g=f.uv;var h=e.length/3;var i=h*4;if(!g){g=f.uv=new Float32Array(i)}else if(g.length!=i){g=f.uv=new Float32Array(i)}var j=d.colorRate;if(j){for(var k=0;k<i;k+=4){g[k]=j.r;g[k+1]=j.g;g[k+2]=j.b;g[k+3]=j.a}}var l=c.length;var m=d.segmentList;for(k=0;k<l;k++){var n=c[k];var o=m[k*2];var p=m[k*2+1];for(var q=o;q<=p;q++){var r=q*4;g[r]=n.r;g[r+1]=n.g;g[r+2]=n.b;g[r+3]=n.a}}}};a.copy=function(b){var c=this;c._super($.super_p.copy,b);c.colorList=b.colorList?b.colorList.concat():null;c.segmentList=b.segmentList?b.segmentList.concat():null;return c};a.clone=function(){var c=this;var b=new $(c.color,c.drawType,c.side);b.copy(c);return b};a.toString=function(){return "[MultiFillMaterial]"};kisgame.MultiFillMaterial=$}());(function(){"use strict";var _=kisgame.FillType;function $(b,c,d){var e=this;e._super($.super_p.constructor,obj);e.setValues(c);e.fillType=_.TEXTURE}var a=KISU.extend($,kisgame.Material);a.copy=function(b){var c=this;c._super($.super_p.copy,b);c.image=b.image;return c};a.clone=function(){var c=this;var b=new $(c.image,c.side);return b};a.toString=function(){return "[ImageMaterial]"};kisgame.ImageMaterial=$}());(function(){"use strict";var _=kisgame.Matrix3D;function $(){var b=this;b.x=0;b.y=0;b.z=0;b.regX=0;b.regY=0;b.regZ=0;b.rotationX=0;b.rotationY=0;b.rotationZ=0;b.scaleX=1;b.scaleY=1;b.scaleZ=1;b.matrix3d=_.identity()}var a=$.prototype;a.localToGlobal3D=function(b,c){var e=this;var d=e.getConcatenatedMatrix();if(b){return _.transformPoint(d,b,c)}else{return _.transformXYZ(d,0,0,0,c)}};a.globalToLocal3D=function(b,c){var e=this;var d=e.getConcatenatedMatrix();_.inverse(d,d);if(b){return _.transformPoint(d,b,c)}else{return _.transformXYZ(d,0,0,0,c)}};a.local2Target3D=function(b,c,d){var f=this;var e=f.getConcatenatedMatrix();var g=b.getConcatenatedMatrix();_.inverse(g,g);var h=_.multiply(g,e);return _.transformPoint(h,c,d)};a.localToGlobal3Ds=function(b,c){var e=this;var d=e.getConcatenatedMatrix();var f=[];var g=b.length;for(i=0;i<g;i++){var h=b[i];var j=c?c[i]:null;f.push(_.transformPoint(d,h,j))}return f};a.globalToLocal3Ds=function(b,c){var e=this;var d=e.getConcatenatedMatrix();_.inverse(d,d);var f=[];var g=b.length;for(i=0;i<g;i++){var h=b[i];var j=c?c[i]:null;f.push(_.transformPoint(d,h,j))}return f};a.local2Target3Ds=function(b,c,d){var f=this;var e=f.getConcatenatedMatrix();var g=b.getConcatenatedMatrix();_.inverse(g,g);var h=_.multiply(g,e);var j=[];var k=c.length;for(i=0;i<k;i++){var l=c[i];var m=d?d[i]:null;j.push(_.transformPoint(h,l,m))}return j};a.roundRegTransform=function(b,c,d,e,f,g,h,j,k,l){var n=this;var m=n,o=_.identity(b);m.transformMatrix?_.copy(m.transformMatrix,o):_.appendTransform(o,m.x,m.y,m.z,m.scaleX,m.scaleY,m.scaleZ,m.rotationX,m.rotationY,m.rotationZ,j,k,l,o);return o};a.setTransform=function(b,c,d,e,f,g,h,j,k,l,m,n){var o=this;o.x=b||0;o.y=c||0;o.z=d||0;o.scaleX=e==null?1:e;o.scaleY=f==null?1:f;o.scaleZ=g==null?1:g;o.rotationX=h||0;o.rotationY=j||0;o.rotationZ=k||0;o.regX=l||0;o.regY=m||0;o.regZ=n||0;return o};a.getMatrix3D=function(b){var d=this;var c=d,e=_.identity(b);return c.transformMatrix?_.copy(c.transformMatrix,e):_.appendTransform(e,c.x,c.y,c.z,c.scaleX,c.scaleY,c.scaleZ,c.rotationX,c.rotationY,c.rotationZ,c.regX,c.regY,c.regZ,e)};a.getConcatenatedMatrix=function(b,c){var e=this;var d=e,f=e.getMatrix3D(b);if(c){_.multiply(f,c,f)}while(d=d.parent){_.multiply(d.getMatrix3D(),f,f)}return f};a.clone=function(){var b=this;return b._cloneProps(new $())};a._cloneProps=function(b){var c=this;b.name=c.name;b.regX=c.regX;b.regY=c.regY;b.regZ=c.regZ;b.scaleX=c.scaleX;b.scaleY=c.scaleY;b.scaleZ=c.scaleZ;b.rotationX=c.rotationX;b.rotationY=c.rotationY;b.rotationZ=c.rotationZ;b.x=c.x;b.y=c.y;b.z=c.z;return b};a.toString=function(){var b=this;return "[Object3D (name="+b.name+")]"};a.move=function(b,c,d){var e=this;if(!isNaN(b)){e.x=b;e._x=b}if(!isNaN(c)){e.y=c;e._y=c}if(!isNaN(d)){e.z=d;e._z=d}};a.scale=function(b,c,d){var e=this;if(!isNaN(b)){e.scaleX=b}if(!isNaN(c)){e.scaleY=c}if(!isNaN(d)){e.scaleZ=d}};kisgame.Object3D=$}());(function(){"use strict";var _=kisgame.Matrix3D;var $=kisgame.Vector3D;var a=$.create();function b(){var d=this;d._super(b.super_p.constructor);d.targetPosition=null;d.targetUpPosition=$.create(0.0,1.0,0.0);d.vpMatrix=_.identity();d.vMatrix=_.identity();d.pMatrix=_.identity();d.rayGlMatrix=_.identity();d.orthographicScale=0;d.stage=null;d.fovy=45*Math.PI/360;d.fovy_tan=Math.tan(d.fovy);d.rightHand=false;d.viewWidth=0;d.viewHeight=0}var c=KISU.extend(b,kisgame.Object3D);c.setView=function(d,e){var f=this;f.near=d;f.far=e;f.maxRenderDistance=e};c.setViewSize=function(d,e){var f=this;if(d==undefined)d=0;if(e==undefined)e=0;f.viewWidth=d;f.viewHeight=e};c.refreshMVPMatrix=function(){var e=this;var d=_.identity(e.vMatrix);e.getConcatenatedMatrix(d);_.inverse(d,d);_.copy(d,e.rayGlMatrix);if(e.rightHand){_.scale(d,1,1,-1,d)}var f=e.viewWidth;var g=e.viewHeight;if(e.viewWidth==0||e.viewWidth==undefined){f=e.stage.width;g=e.stage.height}_.perspective(e.fovy_tan,f/g,e.near/g,e.far/g,e.pMatrix);_.multiply(e.pMatrix,e.rayGlMatrix,e.rayGlMatrix)};c.unproject=function(d,e,f){var i=this;var g=_.identity();var h=i.rayGlMatrix;_.inverse(h,g);return _.transformXYZ(g,d,e,f)};c.getVMatrix=function(){var d=this;return d.vMatrix};c.getProjectMatrix=function(){var d=this;return d.pMatrix};c.setTargetPosition=function(d){var e=this;e.targetPosition=d;e.refreshTransform()};c.setTargetUpPosition=function(d){var e=this;e.targetUpPosition=d;e.refreshTransform()};c.refreshTransform=function(){var d=this;if(d.targetPosition&&d.targetUpPosition){$.set(a,d.x,d.y,d.z);_.lookAt(a,d.targetPosition,d.targetUpPosition,d.matrix3d);var e=$.create();var f=$.create();var g=$.create();_.decompose(e,f,g,d.matrix3d);d.setTransform(e[0],e[1],e[2],g[0],g[1],g[2],f[0]*KISU.R2D,f[1]*KISU.R2D,f[2]*KISU.R2D,0,0,0)}};c._cloneProps=function(d){var e=this;e._super(b.super_p._cloneProps,d);if(e.targetPosition){d.targetPosition=$.fromValues(e.targetPosition)}if(e.targetUpPosition){d.targetUpPosition=$.fromValues(e.targetUpPosition)}d.setView(e.near,e.far)};c.clone=function(){var d=this;return d._cloneProps(new b())};c.toString=function(){var d=this;return "[Camera3D (name="+d.name+")]"};kisgame.Camera3D=b}());(function(){"use strict";var _=kisgame.DirectionType;var $=kisgame.Matrix3D;function a(){var d=this;d._super(a.super_p[0].constructor);d._super(a.super_p[1].constructor);d.regZ=0;d.z=0;d.hitBoxs=null;d.rotation=NaN;d.rotationX=0;d.rotationY=0;d.rotationZ=0;d.scaleZ=1;d.geometrys=[];d.matrix3d=$.identity()}var b=KISU.extend(a,kisgame.Object3D,kisgame.DisplayObject);b._setRefObj=function(d){var e=this;e.stage=d?d.stage:null;e.scene=d?d.scene:null};b.isVisible=function(){var d=this;return !!(d.visible&&d.alpha>0&&d.scaleX!=0&&d.scaleY!=0&&d.scaleZ!=0)};b.getGeometrys=function(){var d=this;return d.geometrys};b.setGeometrys=function(d){var e=this;e.geometrys=d};b.addGeometry=function(d){var e=this;if(e.geometrys.indexOf(d)==-1){e.geometrys.push(d)}};b.updateContext=function(d){var f=this;var e=f,g=f.matrix3d;g=f.getMatrix3D(g);d.globalAlpha*=e.alpha;d.appendMatrix3D(g)};b.draw=function(d,e){var g=this;var f=g.getGeometrys();var h=f.length;for(var i=0;i<h;i++){d.drawGeometry(f[i],g.material)}return null};b._testHit=function(d){return false};b.getConcatenatedDisplayProps=function(d){return null};b._hitTestBoxes=function(d,e,f){};b._hitTestRay=function(d,e,f){var g=this;if(!g.isVisible()){return false}var h=g.hitBoxs;var i=e?e.length:0;if(h&&!f){}else{g.raycast(d,e)}var j=e?e.length:0;return j>i};b.hitTestObject=function(d){return false};b.clone=function(){var d=this;return d._cloneProps(new a())};b.toString=function(){var d=this;return "[DisplayObject3D (name="+d.name+")]"};b._cloneProps=function(d){var e=this;d.alpha=e.alpha;d.mouseEnabled=e.mouseEnabled;d.tickEnabled=e.tickEnabled;d.name=e.name;d.regX=e.regX;d.regY=e.regY;d.regZ=e.regZ;d.rotation=e.rotation;d.scaleX=e.scaleX;d.scaleY=e.scaleY;d.scaleZ=e.scaleZ;d.shadow=e.shadow;d.rotationX=e.rotationX;d.rotationY=e.rotationY;d.rotationZ=e.rotationZ;d.visible=e.visible;d.x=e.x;d.y=e.y;d.z=e.z;d.compositeOperation=e.compositeOperation;d.snapToPixel=e.snapToPixel;d.filters=e.filters==null?null:e.filters.slice(0);d.mask=e.mask;d.hitArea=e.hitArea;d.cursor=e.cursor;d._bounds=e._bounds;return d};b._getBounds=function(d,e,f,g){return null};b.raycast=function(d,e){var x=this;var f=new Matrix4();var g=new Ray();var h=new Sphere();var i=new Vector3();var j=new Vector3();var k=new Vector3();var l=new Vector3();var m=new Vector3();var n=new Vector3();var o=new Vector2();var p=new Vector2();var q=new Vector2();var r=new Vector3();var s=new Vector3();function t(H,I,J,K,L,M,N){var O=new Vector3();Triangle.barycoordFromPoint(H,I,J,K,O);L.multiplyScalar(O.x);M.multiplyScalar(O.y);N.multiplyScalar(O.z);L.add(M).add(N);return L.clone()}function u(H,w,d,g,I,J,K,L,y){var M;if(w.side==="font"){M=g.intersectTriangle(K,J,I,true,L)}else{M=g.intersectTriangle(I,J,K,w.side!=="frontandback",L)}if(M===null)return null;s.copy(L);s.applyMatrix4(y);var N=d.ray.origin.distanceTo(s);if(N<d.near||N>d.far)return null;return {distance:N,point:s.clone(),object:H}}function v(H,d,g,F,G,D,b,I,y){i.fromArray(F,D*3);j.fromArray(F,b*3);k.fromArray(F,I*3);var C=u(H,H.material,d,g,i,j,k,r,y);if(C){if(G){o.fromArray(G,D*4);p.fromArray(G,b*4);q.fromArray(G,I*4);C.uv=t(r,i,j,k,o,p,q)}C.faceIndex=D}return C}var w=x.material;var y=new Matrix4().fromArray(x.getConcatenatedMatrix());var z=x.geometrys.length;f.getInverse(y);g.copy(d.ray).applyMatrix4(f);for(var A=0;A<z;A++){var B=x.geometrys[A];if(B.boundingSphere===null)B.computeBoundingSphere();h.copy(B.boundingSphere);h.applyMatrix4(y);if(d.ray.intersectsSphere(h)===false)continue;if(B.boundingBox!==null){if(g.intersectsBox(B.boundingBox)===false)continue}var C;var D,b,c;var E=B.indices;var F=B.vertices;var G=null;var A,z;if(E!==null){for(A=0,z=E.length;A<z;A+=3){D=E[A];b=E[A+1];c=E[A+2];C=v(x,d,g,F,G,D,b,c,y);if(C){C.faceIndex=Math.floor(A/3);e.push(C)}}}else if(F!==undefined){for(A=0,z=F.length;A<z;A+=3){C=v(x,d,g,F,G,A,A+1,A+2,y);if(C){C.index=D;e.push(C)}}}}};kisgame.DisplayObject3D=a}());(function(){"use strict";var _=kisgame.DirectionType;var $=kisgame.Matrix3D;function a(){var c=this;c._super(a.super_p.constructor);c.regZ=0;c.z=0;c.hitBoxs=null;c.rotation=NaN;c.rotationX=0;c.rotationY=0;c.rotationZ=0;c.scaleZ=1;c.geometrys=[];c.matrix3d=$.identity()}var b=KISU.extend(a,kisgame.DisplayObject3D);b.draw=function(c,d){var f=this;var e=f.getGeometrys();var g=e.length;for(var h=0;h<g;h++){c.drawGeometry(e[h],f.material)}return null};b.clone=function(){var c=this;return c._cloneProps(new a())};b.toString=function(){var c=this;return "[Mesh (name="+c.name+")]"};kisgame.Mesh=a}());(function(){"use strict";function _(){var a=this;a._super(_.super_p[0].constructor);a._super(_.super_p[1].constructor)}var $=KISU.extend(_,kisgame.DisplayObject3D,kisgame.Container);$.isVisible=function(){var b=this;var a=b.children.length;return !!(b.visible&&b.alpha>0&&b.scaleX!=0&&b.scaleY!=0&&a)};$.draw=function(a,b){var d=this;var c=d.children.slice();for(var e=0,f=c.length;e<f;e++){var g=c[e];if(!g.isVisible()){continue}a.save();g.updateContext(a);g.draw(a);a.restore()}return true};$.hitTest=function(a,b){var c=this;return (c.getObjectUnderPoint(a,b)!=null)};$.getObjectsUnderPoint=function(a,b,c){var f=this;var d=[];var e=f.localToGlobal(a,b);f._getObjectsUnderPoint(e.x,e.y,d,c>0,c==1);return d};$.getObjectUnderPoint=function(a,b,c){var e=this;var d=e.localToGlobal(a,b);return e._getObjectsUnderPoint(d.x,d.y,null,c>0,c==1)};$.clone=function(a){var c=this;var b=c._cloneProps(new _());if(a){c._cloneChildren(b)}return b};$.toString=function(){var a=this;return "[Container3D (name="+a.name+")]"};$._setRefObj=function(a){var d=this;var b=a?a.stage:null;var c=a?a.scene:null;d.stage=b;d.scene=c;var e=d.children;if(!e)return;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(h._setRefObj){h._setRefObj(a)}else{h.stage=b;h.scene=c}}};$._getObjectsUnderPoint=function(a,b,c,d,e,f,g){var i=this;if(!g){var h=i.scene;g=h.getRayCaster(a,b)}if(i.hitBoxs){}e=e||(d&&i._hasMouseEventListener());var j,k=kisgame.DisplayObject._hitTestContext;var l=i.children,m=l.length;for(var n=m-1;n>=0;n--){var o=l[n];if(!o.visible||!o.isVisible()||(d&&(!o.mouseEnabled||(o.mouseIgnoreSelf&&!o.mouseChildren)))){continue}if((o.mouseIgnoreSelf)&&o instanceof kisgame.Container){var p=o._getObjectsUnderPoint(a,b,c,d,e,f+1,g);if(!c&&p){return (d&&!i.mouseChildren)?i:p}}else{if(d&&!e&&!o._hasMouseEventListener()){continue}if(!o._hitTestRay(g,c)){continue}if(c){}else{return (d&&!i.mouseChildren)?i:o}}}return null};$._testMask=function(a,b,c){return true};$._getBounds=function(a,b,c,d){return null};kisgame.Container3D=_}());(function(){"use strict";function _(){var a=this;a._super(_.super_p.constructor)}_.LINE=0;_.DOT=0;var $=KISU.extend(_,kisgame.Object3D);$.setType=function(a){var b=this;b.type=a};$.setTargetPosition=function(a){var b=this;b.targetPosition.set(a)};$._cloneProps=function(a){};$.clone=function(){var a=this;return a._cloneProps(new _())};$.toString=function(){var a=this;return "[Light3D (name="+a.name+")]"};kisgame.Light3D=_}());(function(){"use strict";var _=kisgame.Matrix3D;function $(d,c){return d.distance-c.distance}function a(d,e,f,g){if(!d.isVisible()){return}d.raycast(e,f);if(g===true){var h=d.children;for(var i=0,j=h.length;i<j;i++){a(h[i],e,f,true)}}}function b(){var d=this;d._super(b.super_p.constructor);d.camera=null;d.view=null;d.lightList=[];d._raycaster=new Raycaster()}var c=KISU.extend(b,kisgame.Container3D);c.setCameraAndView=function(d,e){var f=this;if(f.camera){f.camera.stage=null}f.camera=d;e.setScene(f);f.view=e;f.camera.stage=f.view.stage;f.camera.setViewSize(f.view.width,f.view.height)};c.setView=function(d){var e=this;e.view=d};c.addLight=function(d){var f=this;var e=f.lightList;if(!e){f.lightList=e=[]}if(e.indexOf(d)==-1){e.push(d)}};c.draw=function(d,e){var g=this;var f=false;if(!g.camera){return}if(!g.camera.stage){g.camera.stage=g.view.stage}d.setCamera(g.camera,d.getTransform());if(g.lightList){f=true;d.setLights(g.lightList)}var h=g.children.slice();for(var i=0,j=h.length;i<j;i++){var k=h[i];if(!k.isVisible()){continue}d.save();k.updateContext(d);k.draw(d);d.restore()}if(f){d.removeLights(g.lightList)}return true};c.getRayCaster=function(d,e){var g=this;var f=g._raycaster;var h=g.camera;if(h){d=(d/g.stage.width)*2-1;e=-(e/g.stage.height)*2+1;f.near=h.near;f.far=h.far;f.setFromCamera(d,e,h)}return f};c._setRefObj=function(d){var g=this;var e=d?d.stage:null;var f=g;g.stage=e;g.scene=f;var h=g.children;if(!h)return;var i=h.length;for(var j=0;j<i;j++){var k=h[j];if(k._setRefObj){k._setRefObj(d)}else{k.stage=e;k.scene=f}}};c._getObjectsUnderPoint=function(d,e,f,g,h,i,j){var m=this;var k=f;var l=false;if(!f){k=[];l=true}m._super(b.super_p._getObjectsUnderPoint,d,e,k,false,h,i,j);var n=k.length;if(l&&n){if(n>1)k.sort($);return k[0].object}};c.clone=function(){var d=this;return d._cloneProps(new b())};c.toString=function(){var d=this;return "[Scene3D (name="+d.name+")]"};kisgame.Scene3D=b}());(function(){function _(){var b=this;var a=b;b.scene=null;b._super(_.super_p.constructor)}var $=KISU.extend(_,kisgame.Container3D);Object.defineProperties($,{scene:{get:function(){var a=this;return a._scene},set:function(a){var b=this;b._scene=a}}});$.setScene=function(a){var b=this;b.scene=a};$._setRefObj=function(a){var b=this;b.stage=a?a.stage:null;b.root=a?a.root:null;var c=b.scene;if(c){c._setRefObj(a)}};$._getObjectsUnderPoint=function(a,b,c,d,e,f,g){var i=this;var h=i.scene;if(!h){return false}h._getObjectsUnderPoint(a,b,c,d,e,f,g)};$.isVisible=function(){var a=this;return a.scene?true:false};$.draw=function(a,b){var d=this;var c=d.scene;if(!c){return false}if(!c.isVisible()){return false}a.save();c.updateContext(a);c.draw(a);a.restore();return true};kisgame.CameraView=_}());(function(){"use strict";var _=kisgame.Vector3D;function $(b,c,d){var e=this;e._smoothRate=0.1;e._moveStep=50;e._moveSpeed=5;e._rotateStep=45;e._rotateSpeed=1;e._oldMouseX;e._oldMouseY;e._targetRotationX=-90;e._targetRotationY=0;e._cachedPosition;e._cachedRotation;e._controlTime;e._timeStep=16;e._started=false;e.moveEnable=true;e.scaleEnable=true;e.rotateEnable=true;e.sockTopView=false;e._isGetMoveEvent=false;e._viewArea=d;e._stage=c;e._camera=b;e.reset()}var a=$.prototype;a.onEnterFrameStage=function(b){var d=this;var c=getTimer();if(d._controlTime<c-1000){while(d._controlTime<c){d.onEnterFrame(b);d._controlTime+=d._timeStep}}else{d.onEnterFrame(b);d._controlTime=c}};a.onEnterFrame=function(b){};a.addEvent=function(){var b=this;b._stage.on("tick",b.onEnterFrameStage,b);b._viewArea.on(KISU.md,b.onViewMouseDown,b);b._viewArea.on(KISU.mw,b.onViewMouseWheel,b);b._controlTime=getTimer()};a.removeEvent=function(){var b=this;b._stage.off("tick",b.onEnterFrameStage,false,b);b._viewArea.off(KISU.md,b.onViewMouseDown,false,b);b._viewArea.off(KISU.mw,b.onViewMouseWheel,false,b);b.onMoveStageMouseUp(null);b.onRotateStageMouseUp(null)};a.onViewMouseDown=function(b){var c=this;if(!c.moveEnable)return;if(b){var d=b.nativeEvent;if(d.button==2){c.onViewRightMouseDown(b)}else{c.onViewLeftMouseDown(b)}}};a.onViewLeftMouseDown=function(b){var c=this;if(!c.moveEnable)return;c._oldMouseX=c._stage.mouseX;c._oldMouseY=c._stage.mouseY;c._stage.on(KISU.mm,c.onMoveStageMouseMove,c);c._stage.on(KISU.mu,c.onMoveStageMouseUp,c);c._stage.focus=null};a.onMoveStageMouseMove=function(b){};a.onMoveStageMouseUp=function(b){var c=this;c._stage.off(KISU.mm,c.onMoveStageMouseMove,false,c);c._stage.off(KISU.mu,c.onMoveStageMouseUp,false,c)};a.onViewRightMouseDown=function(b){var c=this;if(!c.rotateEnable)return;c._oldMouseX=c._stage.mouseX;c._oldMouseY=c._stage.mouseY;c._stage.on(KISU.mm,c.onRotateStageMouseMove,c);c._stage.on(KISU.mu,c.onRotateStageMouseUp,c)};a.onRotateStageMouseMove=function(b){var c=this;if(!b.buttonDown){c.onRotateStageMouseUp(b);return}if(!c.sockTopView)c._targetRotationX-=(c._stage.mouseY-c._oldMouseY)*0.3*c._rotateSpeed;c._targetRotationY-=(c._stage.mouseX-c._oldMouseX)*0.3*c._rotateSpeed;if(c._targetRotationX>90)c._targetRotationX=90;else if(c._targetRotationX<-90)c._targetRotationX=-90;c._oldMouseX=c._stage.mouseX;c._oldMouseY=c._stage.mouseY};a.onRotateStageMouseUp=function(b){var c=this;c._stage.off(KISU.mm,c.onRotateStageMouseMove,false,c);c._stage.off(KISU.mu,c.onRotateStageMouseUp,false,c)};a.onViewMouseWheel=function(b){if(!scaleEnable)return };a.startEvent=function(){var b=this;if(b._started)return;var c=b._camera;var d=b._cachedPosition;var e=b._cachedRotation;c.x=d[0];c.y=d[1];c.z=d[2];c.rotationX=e[0];c.rotationY=e[1];c.rotationY=e[2];b.addEvent();b._stage.focus=null;b._started=true};a.endEvent=function(){var c=this;var b=c._camera;c._cachedPosition=_.fromValues(b.x,b.y,b.z);c._cachedRotation=_.fromValues(b.rotationX,b.rotationY,b.rotationY);c.removeEvent();c._started=false};a.reset=function(){};a.moveCamera=function(b,c,d){var e=this;if(d==undefined)d=0;if(!e.moveEnable)return };a.build=function(){};a.dispose=function(){var b=this;b.removeEvent();b._cachedPosition=null;b._cachedRotation=null;b._camera=null;b._viewArea=null;b._stage=null};a.setCameraDirect=function(b,c,d,e,f){var g=this;g._camera.x=b;g._camera.y=c;g._camera.z=d;g._targetRotationX=g._camera.rotationX=e;g._camera.rotationZ=0;g._targetRotationY=g._camera.rotationY=f};a.getTargetRotationX=function(){var b=this;return b._targetRotationX};a.setTargetRotationX=function(b){var c=this;c._targetRotationX=b};a.getTargetRotationY=function(){var b=this;return b._targetRotationY};a.setTargetRotationY=function(b){var c=this;c._targetRotationY=b};a.getSmoothRate=function(){var b=this;return b._smoothRate};a.setSmoothRate=function(b){var c=this;c._smoothRate=b};a.getMoveStep=function(){var b=this;return b._moveStep};a.setMoveStep=function(b){var c=this;c._moveStep=b};a.getRotateStep=function(){var b=this;return b._rotateStep};a.setRotateStep=function(b){var c=this;c._rotateStep=b};a.setMoveSpeed=function(b){var c=this;c._moveSpeed=b};a.getRotateSpeed=function(){var b=this;return b._rotateSpeed};a.setRotateSpeed=function(b){var c=this;c._rotateSpeed=b};a.isGetMoveEvent=function(){var b=this;return b._isGetMoveEvent};a.isGetMoveEvent=function(b){var c=this;c._isGetMoveEvent=b};kisgame.CameraControlBase=$}());(function(){"use strict";var _=kisgame.Vector3D;var $=kisgame.Matrix3D;var a=$.identity();var b=_.create();function c(e,f,g,h,i,j,k,l){var m=this;if(h==undefined)h=45;if(i==undefined)i=4000;if(j==undefined)j=10;if(k==undefined)k=1000;if(l==undefined)l=0;m.initThirdPersonPX=0;m.initThirdPersonPY=0;m.initThirdPersonPZ=50;m.initThirdPersonRY=0;m._maxScale=100;m._minScale=0.01;m._initScale=1;m._interestPoint=_.fromValues(0,0,50);m._targetInterertPoint=_.fromValues(0,0,50);m._targetScale=1;m._percent=0;m._super(c.super_p.constructor,e,f,g);m._type=l;m._maxRadius=i;m._minRadius=j;m._initRadius=m._radius=m._targetRadius=k;m._targetRotationX=m._initRotationX=-h-90;m._cachedPosition=_.fromValues(0,-500,-650);m._cachedRotation=_.fromValues(m._initRotationX,0,0)}var d=KISU.extend(c,kisgame.CameraControlBase);d.onEnterFrame=function(e){var g=this;var f=g._interestPoint;var h=g._smoothRate;var i=g._camera;var j=b;_.subtract(j,g._targetInterertPoint,f);_.scale(j,j,h);_.add(f,f,j);g._radius+=(g._targetRadius-g._radius)*h;i.orthographicScale+=(g._targetScale-i.orthographicScale)*h;i.rotationX+=(g._targetRotationX-i.rotationX)*h;i.rotationY+=(g._targetRotationY-i.rotationY)*h;var k=a;$.identity(k);$.appendTransform(k,f[0],f[1],f[2],i.scaleX,i.scaleY,i.scaleZ,i.rotationX,i.rotationY,i.rotationY,0,0,0,k);j=b;_.set(j,0,0,g._radius);$.transformPoint(k,j,j);i.x=j[0];i.y=j[1];i.z=j[2]};d.addEvent=function(){var e=this;e._super(c.super_p.addEvent)};d.onViewMouseDown=function(e){var f=this;if(f._type==0){f._super(c.super_p.onViewMouseDown,e)}else{f.onViewRightMouseDown(e)}};d.onMoveStageMouseUp=function(e){var f=this;f._super(c.super_p.onMoveStageMouseUp,e)};d.removeEvent=function(){var e=this;e._super(c.super_p.removeEvent)};d.onScaleToStage=function(e){var f=this;if(!f.scaleEnable)return;if(e.data[0]){f.targetRadius=f._targetRadius+(f._maxRadius-f._minRadius)*Number(e.data[0])}else{f.targetRadius=(e.data[1])*(f._maxRadius-f._minRadius)+f._minRadius}};d.onMoveStageMouseMove=function(e){var f=this;if(!e.buttonDown){f.onMoveStageMouseUp(e);return}var g=f._oldMouseX-f._stage.mouseX;var h=f._oldMouseY-f._stage.mouseY;if(f._camera.rotationX<-90||f._camera.orthographic){f.moveCamera(g,-h)}else{f.moveCamera(g,h)}f._oldMouseX=f._stage.mouseX;f._oldMouseY=f._stage.mouseY};d.onViewMouseWheel=function(e){var f=this;if(!f.scaleEnable)return;if(f._camera.orthographic){if(KeyManager.keysDown[Keyboard.SHIFT]){f.setTargetRadius(f._targetRadius-f._targetRadius*e.delta*f._moveSpeed*0.005)}else{f.setTargetScale(f._targetScale-f._targetScale*e.delta*f._moveSpeed*0.005)}}else{f.setTargetRadius(f._targetRadius-f._targetRadius*e.delta*f._moveSpeed*0.005)}};d.reset=function(){var e=this;_.set(e._targetInterertPoint,e.initThirdPersonPX,e.initThirdPersonPY,e.initThirdPersonPZ);e._targetRadius=e._initRadius;e._targetScale=e._initScale;e._targetRotationX=e._initRotationX;e._targetRotationY=e.initThirdPersonRY;var f=e._camera.rotationY+360*100+180;f%=360;e._camera.rotationY=f-180};d.moveCamera=function(e,f,g){var h=this;if(!h.moveEnable)return;if(g==undefined)g=0;var i;var j=h._camera;var k=Math.abs(h._radius)*0.001;if(k<0.0001)k=0.0001;if(e!=0||f!=0){e*=k;f*=k;i=b;var l=j.rotationX*KISU.D2R;_.set(i,e,0,f);j.localToGlobal3D(i,i);_.subtractValue(i,j.x,j.y,j.z);_.add(h._targetInterertPoint,h._targetInterertPoint,i)}};d.setCameraTarget=function(e){var g=this;var f=g._camera;var h=_.create();e.localToGlobal3D(h,h);_.copy(g._targetInterertPoint,h);_.set(b,f.x,f.y,f.z);var i=$.identity();$.lookAt(b,h,f.targetUpPosition,i);var j=_.create();var k=_.create();var l=_.create();$.decompose(j,k,l,i);g._targetRotationX=k[0]*KISU.R2D;g._targetRotationY=k[1]*KISU.R2D;f.globalToLocal3D(h,h);var m=_.length(h);g.setTargetRadius(m)};d.getCameraFocusToTargetTransform=function(e){var g=this;var f=g._camera;var h=_.create();e.localToGlobal3D(h,h);_.set(b,f.x,f.y,f.z);var i=$.identity();$.lookAt(b,h,f.targetUpPosition,i);var j=_.create();var k=_.create();var l=_.create();$.decompose(j,k,l,i)};d.getInterestPoint=function(){var e=this;return e._interestPoint};d.setInterestPoint=function(e){var f=this;_.copy(f._interestPoint,e);_.copy(f._targetInterertPoint,e)};d.getTargetInterertPoint=function(){var e=this;return e._targetInterertPoint};d.setTargetInterertPoint=function(e){var f=this;_.copy(f._targetInterertPoint,e)};d.getTargetRadius=function(){var e=this;return e._targetRadius};d.setTargetRadius=function(e){var f=this;f._targetRadius=e;if(f._targetRadius<f._minRadius){f._targetRadius=f._minRadius}else if(f._targetRadius>f._maxRadius){f._targetRadius=f._maxRadius}};d.getTargetScale=function(){var e=this;return e._targetScale};d.setTargetScale=function(e){var f=this;f._targetScale=e;if(f._targetScale<f._minScale){f._targetScale=f._minScale}else if(f._targetScale>f._maxScale){f._targetScale=f._maxScale}};kisgame.ThirdPersonController=c}());;(function(){"use strict";var _=kisgame.FillType;var $=kisgame.DrawType;function a(c){var d=this;d.stage=c;d.texture=null;d.fillType=0;d.drawType=-1;d.norepeat=false;d.cullface=""}var b=a.prototype;b.reset=function(){var c=this;c.texture=null;c.fillType=0;c.drawType=-1;c.cullface=""};b.force2drawbuffer=function(c,d,e,f,g){var i=this;var h=i.stage;var j=h.context;var k=i;h._draw2dBufferArrays();k.texture=c;k.fillType=d;k.drawType=f;k.norepeat=e;k.cullFace(g)};b.checkStatus2Draw=function(c,d,e,f,g){var i=this;var h=i;var j=h.stage;var k=j.context;var l=h.cullface!=g||h.drawType!=f||h.norepeat!=e;if(c){if(h.fillType!=_.TEXTURE||l){j._draw2dBufferArrays();h.fillType=_.TEXTURE;h.texture=c;l=true}else if(h.texture!=c){j._draw2dBufferArrays();h.texture=c;l=true}}else{if(h.fillType!=d||l){j._draw2dBufferArrays();h.fillType=d;h.texture=null;l=true}}if(!l){if(h.drawType==f&&f==$.TRIANGLE_STRIP){j.fixTwoTriangleStrip()}}if(h.cullface!=g){i.cullFace(g)}h.drawType=f;h.norepeat=e;return };b.cullFace=function(c){var e=this;var d=e;var f=d.stage;var g=f.context;if(c){if(!g.isEnabled(g.CULL_FACE))g.enable(g.CULL_FACE);var h=0;switch(c){case "back":h=g.BACK;break;case "frontandback":h=g.FRONT_AND_BACK;break;default:h=g.FRONT;break}g.cullFace(h)}else{if(g.isEnabled(g.CULL_FACE))g.disable(g.CULL_FACE)}d.cullface=c};kisgame.DrawStatus=a})();(function(){var _=kisgame.Matrix3D;var $=kisgame.Vector3D;var a=kisgame.FillType;var b=kisgame.DrawType;var c=Math.PI/180;var d=1.0;var e=$.create();var f=$.create();var h=$.create();function i(m){var n=this;n._super(i.super_p[0].constructor,m);n._super(i.super_p[1].constructor,m);n.context=null;n._webGLErrorDetected=false;n._clearColor=null;n._maxLightCount=20;n._maxTexturesPerDraw=1;n._maxTrianglePerDraw=null;n._maxVerticeCount=null;n._currentShaderProgram=null;n._2d_shaderProgram=null;n._3d_shaderProgram=null;n._2dVertices=null;n._normals=null;n._2dUvColors=null;n._2dVerticesBuffer=null;n._2dUvColorBuffer=null;n._normalsBuffer=null;n._2dIndices=null;n._2dIndicesBuffer=null;n._drawstatus=new kisgame.DrawStatus(n);n._programStatus=new Object();n._curClipCodeValue=0;n._2dVerti_buffer_index=0;n._2dColor_buffer_index=0;n._2dIndices_buffer_index=0;n._2dDisplayMatrix=_.identity();n._3dDisplayMatrix=_.identity();n.baseScaleMatrix=_.identity();n.screenView2dMatrix=_.identity();n._initializeWebGL();n.simuDrawer=new kisgame.SimulateDrawer(n);n.graphics_2d_ctx=kisgame.Graphics._ctx;kisgame.Graphics._ctx=n.simuDrawer;kisgame.Ticker.framerate=30;kisgame.Ticker.on("tick",n.tickHandler,n);n.childlist=[];n.autoUpdate=true;n.onceUpdate=false;n.child_autoUpdate=false;n.fixNoBoundErr();n.on("stagemousedown",n.clearHitTest,n);n.on("stagemouseup",n.clearHitTest,n)}var j={start:0,left:0,center:-0.5,end:-1,right:-1};var k={top:0,hanging:-0.01,middle:-0.4,alphabetic:-0.8,ideographic:-0.85,bottom:-1};var l=KISU.extend(i,kisgame.Stage,kisgame.Object3D);l.destory=function(m){var n=this;kisgame.Ticker.off("tick",n.tickHandler,false,n);n.off("stagemousedown",n.clearHitTest,false,n);n.off("stagemouseup",n.clearHitTest,false,n)};l.setFrameRate=function(m){kisgame.Ticker.framerate=m};l.fixNoBoundErr=function(){var n=this;var m=n.context;n.emptyColorTexture=m.createTexture();m.bindTexture(m.TEXTURE_2D,n.emptyColorTexture);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,kisgame.DisplayObject._hitTestContext.canvas)};l.tickHandler=function(){var m=this;if(m.autoUpdate){m.update()}};l.getBorderBounds=function(){var m=this;return m.getBounds()};l.invaliate=function(){};l.clearHitTest=function(){var m=kisgame.DisplayObject._hitTestContext;m.setTransform(1,0,0,1,0,0);m.clearRect(0,0,10,10)};l.toString=function(){var m=this;return "[KISWebGLStage (name="+m.name+")]"};l.setSize=function(m,n){var o=this;o.width=m;o.height=n;o.canvas.width=m;o.canvas.height=n;o.updateViewport(m,n)};l._initializeWebGL=function(){var m=this;m._clearColor={r:1.0,g:1.0,b:1.0,a:1.0};if(m.canvas){if(!m.context||m.context.canvas!==m.canvas){m._initializeWebGLContext()}}else{m.context=null}};l._initializeWebGLContext=function(){var o=this;var m={depth:true,alpha:true,antialias:false,premultipliedAlpha:false,stencil:false};var n=o.context=o.canvas.getContext("webgl",m)||o.canvas.getContext("experimental-webgl",m);if(!n){return}o._maxTexturesPerDraw=1;n.clearColor(o._clearColor.r,o._clearColor.g,o._clearColor.b,o._clearColor.a);n.enable(n.DEPTH_TEST);n.depthFunc(n.LEQUAL);n.enable(n.SCISSOR_TEST);n.enable(n.BLEND);n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);o._create2dShaderProgram(n);if(o._webGLErrorDetected){o.context=null;return}o.init2dAttribute(n,o._2d_shaderProgram);o._create3dShaderProgram(n)};l.init2dAttribute=function(m,n){var o=this;o._2dVerticesBuffer=o._createArrayBuffer(m,null,3,m.FLOAT);o._2dUvColorBuffer=o._createArrayBuffer(m,null,4,m.FLOAT);o._2dIndicesBuffer=m.createBuffer();o._maxTrianglePerDraw=20000;o._maxVerticeCount=o._maxTrianglePerDraw*3*3;o._maxVerticeIndexCount=o._maxTrianglePerDraw*3;o._2dVertices=new Float32Array(o._maxVerticeCount);o._2dUvColors=new Float32Array(o._maxTrianglePerDraw*3*4);o._2dIndices=new Uint16Array(o._maxTrianglePerDraw*3);o.updateViewport(o.canvas.width,o.canvas.height)};l.clear=function(){var n=this;var m=n.context;if(m){m.clearDepth(1.0);m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT|m.STENCIL_BUFFER_BIT)}};l.setClearColor=function(m,n){var p=this;var o=p.color2RGBRate(m);o.a*=n;p._clearColor=o;if(p.context){p.context.clearColor(o.r,o.g,o.b,o.a)}};l._create2dShaderProgram=function(m){var o=this;var n=o._createShader(m,m.FRAGMENT_SHADER,"precision mediump float;precision mediump int;uniform sampler2D uSampler0;varying vec4 cUV;varying float diffuse;uniform bool useFillColor;uniform bool useNoRepeat;void main(void) {vec4 color;if(useFillColor){color = cUV;}else{if(useNoRepeat && (cUV.x<0.0 || cUV.x>1.0||cUV.y<0.0 || cUV.y>1.0)){discard;}color = texture2D(uSampler0, cUV.xy);color = vec4(color.rgb, color.a * cUV.z);}gl_FragColor = color;}");var p=o._createShader(m,m.VERTEX_SHADER,"precision mediump float;precision mediump int;attribute vec3 position;attribute vec4 coloruv;uniform bool usePoint;uniform bool useOneColor;uniform vec4 oneColor;varying vec4 cUV;varying float diffuse;void main(void) {if(useOneColor){cUV = oneColor;}else{cUV = coloruv;}gl_Position = vec4(position, 1.0);if(usePoint){   gl_PointSize = 4.0;}}");if(o._webGLErrorDetected||!n||!p){return}var q=m.createProgram();q.name="2dProgram";m.attachShader(q,n);m.attachShader(q,p);m.linkProgram(q);if(!m.getProgramParameter(q,m.LINK_STATUS)){trace("Could not link program. "+m.getProgramInfoLog(q));o._webGLErrorDetected=true;return}q.vertexPositionAttribute=m.getAttribLocation(q,"position");q.textureCoordAttribute=m.getAttribLocation(q,"coloruv");q.sampler0uniform=m.getUniformLocation(q,"uSampler0");q.usefillcoloruniform=m.getUniformLocation(q,"useFillColor");q.usenorepeatuniform=m.getUniformLocation(q,"useNoRepeat");q.usePointUniform=m.getUniformLocation(q,"usePoint");q.useOneColorUniform=m.getUniformLocation(q,"useOneColor");q.oneColorUniform=m.getUniformLocation(q,"oneColor");o._2d_shaderProgram=q};l._create3dShaderProgram=function(m){var o=this;var n=o._createShader(m,m.FRAGMENT_SHADER,"precision mediump float;precision mediump int;uniform sampler2D uSampler0;varying vec4 cUV;varying float diffuse;varying float useLight;uniform bool useFillColor;uniform bool useNoRepeat;uniform vec4 ambient;void main(void) {vec4 color;if(useFillColor){color = cUV;}else{if(useNoRepeat && (cUV.x<0.0 || cUV.x>1.0||cUV.y<0.0 || cUV.y>1.0)){discard;}color = texture2D(uSampler0, cUV.xy);color = vec4(color.rgb, color.a * cUV.z);}if(useLight>0.0){gl_FragColor = color * vec4(vec3(diffuse), 1.0) + ambient;}else{gl_FragColor = color;}}");var p=o._createShader(m,m.VERTEX_SHADER,"precision mediump float;precision mediump int;attribute vec3 position;attribute vec3 normal;attribute vec4 coloruv;uniform struct LightVO{bool active;vec3 position;}lightList["+o._maxLightCount+"];uniform mat4 _2dMatrix;uniform mat4 mMatrix;uniform mat4 vMatrix;uniform mat4 pMatrix;uniform bool usePoint;uniform bool useOneColor;uniform vec4 oneColor;varying vec4 cUV;varying float diffuse;varying float useLight;void main(void) {if(useOneColor){cUV = oneColor;}else{cUV = coloruv;}vec4 globalPoint = mMatrix * vec4(position, 1.0);			const int lightLen = "+o._maxLightCount+";			float activeCount = 0.0;			float maxDiffuse = 0.0;			vec3 nLight;			for(int i = 0;i< lightLen;i++)			{				LightVO light = lightList[i];				if(light.active)				{					nLight.x = light.position.x-globalPoint.x;					nLight.y = light.position.y-globalPoint.y;					nLight.z = light.position.z-globalPoint.z;					float tDiffuse = clamp(dot(normalize(nLight),normal), 0.0, 1.0);					if(tDiffuse > maxDiffuse)					{						maxDiffuse = tDiffuse;					}					activeCount+=1.0;				}			}			if(activeCount > 0.0)			{				useLight = 1.0;				diffuse = maxDiffuse;			}			else			{				useLight = 0.0;				diffuse = 1.0;			}gl_Position = _2dMatrix * pMatrix *vMatrix * mMatrix * vec4(position, 1.0);if(usePoint){gl_PointSize = 4.0;}}");if(o._webGLErrorDetected||!n||!p){return}var q=m.createProgram();q.name="3dProgram";m.attachShader(q,n);m.attachShader(q,p);m.linkProgram(q);if(!m.getProgramParameter(q,m.LINK_STATUS)){trace("Could not link program. "+m.getProgramInfoLog(q));o._webGLErrorDetected=true;return}q.vertexPositionAttribute=m.getAttribLocation(q,"position");q.textureCoordAttribute=m.getAttribLocation(q,"coloruv");q.vertexNormalAttribute=m.getAttribLocation(q,"normal");q.sampler0uniform=m.getUniformLocation(q,"uSampler0");q.usefillcoloruniform=m.getUniformLocation(q,"useFillColor");q.usenorepeatuniform=m.getUniformLocation(q,"useNoRepeat");q._2dMatrixUniform=m.getUniformLocation(q,"_2dMatrix");q.mMatrixUniform=m.getUniformLocation(q,"mMatrix");q.vMatrixUniform=m.getUniformLocation(q,"vMatrix");q.pMatrixUniform=m.getUniformLocation(q,"pMatrix");q.usePointUniform=m.getUniformLocation(q,"usePoint");q.useLightUniform=m.getUniformLocation(q,"useLight");q.useOneColorUniform=m.getUniformLocation(q,"useOneColor");q.oneColorUniform=m.getUniformLocation(q,"oneColor");q.ambientUniform=m.getUniformLocation(q,"ambient");o._3d_shaderProgram=q};l.disableProgram=function(m,n){if(n){m.bindTexture(m.TEXTURE_2D,null);m.bindBuffer(m.ARRAY_BUFFER,null);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,null)}};l.useProgram=function(m,n){var o=this;if(o._currentShaderProgram!=n){var p=o._currentShaderProgram;if(p){o.disableProgram(p);o._programStatus._indicesBuffer=null;o._programStatus._verticesBuffer=null;o._programStatus._normalsBuffer=null}m.useProgram(n);m.activeTexture(m.TEXTURE0);m.uniform1i(n.sampler0uniform,0);o._currentShaderProgram=n}};l.startMask=function(m,n,o){var p=this;p._draw2dBufferArrays();var q=p.context;var r=p._curClipCodeValue;if(!q.isEnabled(q.STENCIL_TEST)){r=1;q.clear(q.STENCIL_BUFFER_BIT);q.clearStencil(0);q.stencilMask(255);q.enable(q.STENCIL_TEST);q.stencilFunc(q.ALWAYS,r,255);q.stencilOp(q.KEEP,q.KEEP,q.REPLACE)}else{q.stencilFunc(q.EQUAL,r,255);q.stencilOp(q.KEEP,q.KEEP,q.INCR);r++}q.colorMask(false,false,false,false);p.fillPath(m,"#000000",n,o);p._draw2dBufferArrays();q.stencilFunc(q.EQUAL,r,255);q.stencilOp(q.KEEP,q.KEEP,q.KEEP);q.colorMask(true,true,true,true);p._curClipCodeValue=r};l.stopMask=function(){var m=this;m._draw2dBufferArrays();var n=m.context;var o=m._curClipCodeValue;o--;if(o==0){n.disable(n.STENCIL_TEST)}else{n.stencilFunc(n.GEQUAL,o,255);n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}m._curClipCodeValue=o};l._createFramebuffer=function(m,n){var p=this;var o=p.context;var q=o.createFramebuffer();var r=o.createRenderbuffer();var s=o.createTexture();var t={type:5,framebuffer:q,render:r,texture:s,width:m,height:n};return p._setFramebufferSize(t,m,n,true)};l._setFramebufferSize=function(m,n,o,p){var r=this;var q=r.context;var s=m.framebuffer;q.bindFramebuffer(q.FRAMEBUFFER,s);var t=m.render;q.bindRenderbuffer(q.RENDERBUFFER,t);q.renderbufferStorage(q.RENDERBUFFER,q.STENCIL_INDEX8,n,o);if(p){q.framebufferRenderbuffer(q.FRAMEBUFFER,q.STENCIL_ATTACHMENT,q.RENDERBUFFER,t)}var u=m.texture;q.bindTexture(q.TEXTURE_2D,u);q.texImage2D(q.TEXTURE_2D,0,q.RGBA,n,o,0,q.RGBA,q.UNSIGNED_BYTE,null);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);if(p){q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,u,0)}m.width=n;m.height=o;return m};l._useFrameBuffer=function(m){var o=this;var n=o.context;if(m){n.bindTexture(n.TEXTURE_2D,m.texture);n.bindRenderbuffer(n.RENDERBUFFER,m.render);n.bindFramebuffer(n.FRAMEBUFFER,m.framebuffer)}else{n.bindTexture(n.TEXTURE_2D,o.emptyColorTexture);n.bindRenderbuffer(n.RENDERBUFFER,null);n.bindFramebuffer(n.FRAMEBUFFER,null)}};l._createShader=function(m,n,o){var q=this;var p=m.createShader(n);m.shaderSource(p,o);m.compileShader(p);if(!m.getShaderParameter(p,m.COMPILE_STATUS)){trace("Could not compile shader. "+m.getShaderInfoLog(p));q._webGLErrorDetected=true;return null}return p};l.clearImageTexture=function(m){var o=this;var n=m.__webgl_texture;if(n){delete n.context;delete n._sourceImage;if(o._drawstatus.texture==n){o._drawstatus.texture=null}delete m.__webgl_texture;o.context.deleteTexture(n)}};l.updateViewport=function(m,n){var p=this;var o=p.context;if(o){o.viewport(0,0,m,n);_.translation(-1,1,0,p._2dDisplayMatrix);_.scale(p._2dDisplayMatrix,2/m,-2/n,2/n,p._2dDisplayMatrix);p.setCartCoord(p.useCartCoord);p.scissorRect([0,0,m,n])}};l.setCartCoord=function(m){var o=this;var n=o.width;var p=o.height;var q=o._3dDisplayMatrix;if(m){_.identity(q);_.scale(q,2/n,2/n,2/n,q)}else{_.translation(-1,1,0,q);_.scale(q,2/n,-2/n,2/n,q)}o.useCartCoord=m};l.update=function(m){var n=this;if(!n.canvas){return}if(n.tickOnUpdate){n.tick(m)}n.dispatchEvent("drawstart");var o=n.context;if(o){if(n.autoClear){n.clear()}n.draw(o,false);n.firstDrawed=1;o.flush()}n.dispatchEvent("drawend")};l._createArrayBuffer=function(m,n,o,p,q){var r=m.createBuffer();if(n){m.bindBuffer(m.ARRAY_BUFFER,r);m.bufferData(m.ARRAY_BUFFER,n,q)}r.num=o;r.type=p;return r};l._enableAttributeVariable=function(m,n,o,p,q,r){if(p==undefined)p=false;if(q==undefined)q=0;if(r==undefined)r=0;m.bindBuffer(m.ARRAY_BUFFER,o);m.vertexAttribPointer(n,o.num,o.type,p,q,r);m.enableVertexAttribArray(n)};l.draw=function(m,n){var o=this;o._draw2dTimeCount=0;o.simuDrawer.reset();o._super(i.super_p[0].draw,o.simuDrawer,n);o._draw2dBufferArrays()};l.getTextureByImage=function(m,n,o,p,q){if(n&&n.naturalWidth&&n.naturalHeight&&n.complete){var r=n.__webgl_texture;if(!r){r=n.__webgl_texture=m.createTexture();r._sourceImage=n;r.context=m;q=true}if(n.updateTextureOnce){n.updateTextureOnce=false;q=true}if(q){m.bindTexture(m.TEXTURE_2D,r);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,n);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,p?m.NEAREST:m.LINEAR);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,p?m.NEAREST:m.LINEAR);var s=m.CLAMP_TO_EDGE;var t=m.CLAMP_TO_EDGE;if(o=="repeat-x"){s=m.REPEAT}else if(o=="repeat-y"){t=m.REPEAT}else if(o=="repeat"){s=m.REPEAT;t=m.REPEAT}m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,t)}return r}};l.getTextureByView=function(m,n,o,p,q){if(n&&n.width&&n.height){var r=n.__webgl_texture;if(!r){r=n.__webgl_texture=m.createTexture();r.context=m;r._sourceImage=n;q=true}if(n.updateTextureOnce){n.updateTextureOnce=false;q=true}if(q){m.bindTexture(m.TEXTURE_2D,r);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,n);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,p?m.NEAREST:m.LINEAR);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,p?m.NEAREST:m.LINEAR);var s=m.CLAMP_TO_EDGE;var t=m.CLAMP_TO_EDGE;if(o=="repeat-x"){s=m.REPEAT}else if(o=="repeat-y"){t=m.REPEAT}else if(o=="repeat"){s=m.REPEAT;t=m.REPEAT}m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,t)}return r}};l.updateTextureByView=function(m,n,o,p,q){m.bindTexture(m.TEXTURE_2D,n);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,o);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,q?m.NEAREST:m.LINEAR);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,q?m.NEAREST:m.LINEAR);var r=m.CLAMP_TO_EDGE;var s=m.CLAMP_TO_EDGE;if(p=="repeat-x"){r=m.REPEAT}else if(p=="repeat-y"){s=m.REPEAT}else if(p=="repeat"){r=m.REPEAT;s=m.REPEAT}m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,r);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s);return n};l.color2RGBRate=function(m){var n,g,l,o=1;n=parseInt("0x"+m.substr(1,2))||0;g=parseInt("0x"+m.substr(3,2))||0;l=parseInt("0x"+m.substr(5,2))||0;if(m.length>8){o=(parseInt("0x"+m.substr(7,2))||255)/255}n/=255;g/=255;l/=255;return {r:n,g:g,b:l,a:o}};l.clearRect=function(m,n,o,p){var r=this;var q=r.context;var s=q.getParameter(q.SCISSOR_BOX);q.scissor(m,r.canvas.height-n-p,o,p);r.clear();q.scissor(s[0],s[1],s[2],s[3])};l.scissorRect=function(m,n){var o=this;o._draw2dBufferArrays();var p=o.context;var q=p.getParameter(p.SCISSOR_BOX);if(n){p.scissor(m[0],o.canvas.height-m[1]-m[3],m[2],m[3])}else{p.scissor(m[0],m[1],m[2],m[3])}return q};l.measureText=function(m,n){var p=this;var o=p.graphics_2d_ctx;o.font=m;return o.measureText(n)};l.fillText=function(m,n,o,p,q,r,s,t,u,v){var x=this;var w=x.context;var y=x._2dVertices,z=x._2dUvColors;var A=x.graphics_2d_ctx;A.setTransform(1,0,0,1,0,0);A.clearRect(0,0,A.canvas.width+1,A.canvas.height+1);A.font=q;var B=A.measureText(m).width;if(p!=undefined&&p<B){B=p}var C=B*j[r||"left"];var D=Math.ceil(A.measureText("我").width*1.2);var E=D*k[s||"top"];var F=n+C;var G=o+E;A.canvas.width=B;A.canvas.height=D;A.font=q;var H=t;var I=H.type;if(I==1){A.fillStyle=A.createPattern(H.image,H.repeat)}else if(I==2||I==3){var J;if(I==2){J=A.createLinearGradient(H.x-F,H.y-G,H.x1-F,H.y1-G)}else{J=A.createRadialGradient(H.x0+H.x-F,H.y0+H.y-G,H.r0,H.x1+H.x-F,H.y1+H.y-G,H.r1)}var K=H.colors;var L=K.length;for(var M=0;M<L;M+=2){J.addColorStop(K[M],K[M+1])}A.fillStyle=J}else{A.fillStyle=H}A.textAlign="left";A.textBaseline="top";A.fillText(m,0,0,p);var N=A.getImageData(0,0,B,D);var O=x.fillTextTexture;if(!O){O=x.fillTextTexture=w.createTexture()}x.updateTextureByView(w,O,N);x._drawstatus.force2drawbuffer(O,a.TEXTURE,true,w.TRIANGLES,"");var P=u;P=_.multiply(x._2dDisplayMatrix,P);var Q=P[0],l=P[1],R=P[4],S=P[5],T=P[12],U=P[13];n=F;o=G;var V=n+B;var W=o+D;var X=x._2dVerti_buffer_index;y[X]=n*Q+o*R+T;y[X+1]=n*l+o*S+U;y[X+2]=d;y[X+3]=n*Q+W*R+T;y[X+4]=n*l+W*S+U;y[X+5]=d;y[X+6]=V*Q+W*R+T;y[X+7]=V*l+W*S+U;y[X+8]=d;y[X+9]=V*Q+o*R+T;y[X+10]=V*l+o*S+U;y[X+11]=d;var X=x._2dColor_buffer_index;z[X+0]=z[X+4]=0;z[X+1]=z[X+13]=0;z[X+5]=z[X+9]=1;z[X+8]=z[X+12]=1;z[X+2]=z[X+6]=z[X+10]=z[X+14]=v;var X=x._2dIndices_buffer_index;var Y=x._2dVerti_buffer_index/3;var Z=x._2dIndices;Z[X]=Y;Z[X+1]=Y+1;Z[X+2]=Y+2;Z[X+3]=Y;Z[X+4]=Y+2;Z[X+5]=Y+3;x._2dVerti_buffer_index+=12;x._2dColor_buffer_index+=16;x._2dIndices_buffer_index+=6};l.fillPath=function(m,n,o,p){var r=this;var q=r.context;var s=r._2dVertices,t=r._2dUvColors,u=r._2dIndices;var v=n.type;var w,x=null;var y=true;if(v==1){x=r.getTextureByImage(q,n.image,n.repeat,n.unsmooth);if(!x)return;n.width=n.image.naturalWidth;n.height=n.image.naturalHeight;y=n.repeat=="no-repeat"?true:false}else if(v==5){x=n.texture;if(!x)return;y=true}else if(v==2||v==3){var z=r.graphics_2d_ctx;z.canvas.width=n.width;z.canvas.height=n.height;z.setTransform(1,0,0,1,0,0);z.clearRect(0,0,z.canvas.width+1,z.canvas.height+1);var A;if(v==2){A=z.createLinearGradient(0,0,n.width,0)}else{A=z.createRadialGradient(n.x0,n.y0,n.r0,n.x1,n.y1,n.r1)}var B=n.colors;var C=B.length;for(var D=0;D<C;D+=2){A.addColorStop(B[D],B[D+1])}z.fillStyle=A;z.fillRect(0,0,n.width,n.height);var E=z.getImageData(0,0,n.width,n.height);E._temp_to_remove=true;x=r.getTextureByView(q,E,n.repeat,n.unsmooth);if(!x)return;if(n.radian){o=_.copy(o);_.translate(o,n.x,n.y,0,o);_.zRotate(o,n.radian/c,o)}y=false}else{w=r.color2RGBRate(n);w.a=p}r._drawstatus.checkStatus2Draw(x,x?a.TEXTURE:a.FILL,y,q.TRIANGLES,"");var C=m.length;var F=h;var G=null;var H=r._2dVerti_buffer_index;var I=r._2dColor_buffer_index;var J=r._2dIndices_buffer_index;for(var D=0;D<C;D++){var K=m[D];var L=K.length;var M=K.matrix||o;var N=null;if(o&&M!=o){if(!G){G=_.inverse(o)}N=_.copy(M);_.multiply(G,N,N)}var O=L/2-2;var P=H/3;for(var Q=0;Q<O;Q++,J+=3){u[J]=P;u[J+1]=P+Q+1;u[J+2]=P+Q+2}M=_.multiply(r._2dDisplayMatrix,M);var R=M[0],l=M[1],S=M[4],T=M[5],U=M[12],V=M[13];for(var Q=0;Q<L;Q+=2,H+=3,I+=4){var W=K[Q];var X=K[Q+1];s[H]=W*R+X*S+U;s[H+1]=W*l+X*T+V;s[H+2]=d;if(v==1){if(N){$.set(F,W,X,0);_.transformPoint(N,F,F);t[I]=F[0]/n.width;t[I+1]=F[1]/n.height;t[I+2]=p}else{t[I]=W/n.width;t[I+1]=X/n.height;t[I+2]=p}}else if(v==5){t[I]=W/n.width;t[I+1]=X/n.height;t[I+2]=p}else if(v==2||v==3){if(N){$.set(F,W,X,0);_.transformPoint(N,F,F);t[I]=F[0]/n.width;t[I+1]=F[1]/n.height;t[I+2]=p}else{t[I]=(W-n.x)/n.width;t[I+1]=(X-n.y)/n.height;t[I+2]=p}}else{t[I]=w.r;t[I+1]=w.g;t[I+2]=w.b;t[I+3]=w.a}}}r._2dVerti_buffer_index=H;r._2dColor_buffer_index=I;r._2dIndices_buffer_index=J};l.fixTwoTriangleStrip=function(){var m=this;if(m._2dIndices_buffer_index&&m._drawstatus.drawType==b.TRIANGLE_STRIP){m._2dIndices[m._2dIndices_buffer_index]=m._2dIndices[m._2dIndices_buffer_index-1];m._2dIndices[m._2dIndices_buffer_index+1]=m._2dVerti_buffer_index/3;m._2dIndices_buffer_index+=2}};l._draw2dBufferArrays=function(m){var n=this;if(n._2dColor_buffer_index<=0)return;var o=n.context;var p=n._drawstatus.drawType;var q=n._drawstatus.texture;var r=n._2d_shaderProgram;n.useProgram(o,r);o.bindBuffer(o.ARRAY_BUFFER,n._2dVerticesBuffer);o.bufferData(o.ARRAY_BUFFER,n._2dVertices,o.STATIC_DRAW);o.bindBuffer(o.ARRAY_BUFFER,n._2dUvColorBuffer);o.bufferData(o.ARRAY_BUFFER,n._2dUvColors,o.STATIC_DRAW);if(q){o.uniform1i(r.usefillcoloruniform,false);o.bindTexture(o.TEXTURE_2D,q);o.uniform1i(r.usenorepeatuniform,n._drawstatus.norepeat)}else{o.uniform1i(r.usefillcoloruniform,true);o.bindTexture(o.TEXTURE_2D,n.emptyColorTexture)}o.uniform1i(r.usePointUniform,p==b.POINTS);if(n._programStatus._verticesBuffer!=n._2dVerticesBuffer){n._enableAttributeVariable(o,r.vertexPositionAttribute,n._2dVerticesBuffer);n._programStatus._verticesBuffer=n._2dVerticesBuffer}if(n._programStatus._uvColorBuffer!=n._2dUvColorBuffer){n._enableAttributeVariable(o,r.textureCoordAttribute,n._2dUvColorBuffer);n._programStatus._uvColorBuffer=n._2dUvColorBuffer}if(n._2dIndices_buffer_index>0){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n._2dIndicesBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,n._2dIndices,o.STATIC_DRAW);o.drawElements(p,n._2dIndices_buffer_index,o.UNSIGNED_SHORT,0);n._programStatus._indicesBuffer=n._2dIndicesBuffer}else{o.drawArrays(p,0,n._2dColor_buffer_index/4)}n._draw2dTimeCount++;n._2dVerti_buffer_index=0;n._2dColor_buffer_index=0;n._2dIndices_buffer_index=0;if(q){var s=q._sourceImage;if(s&&s._temp_to_remove){delete s.__webgl_texture;delete q.context;delete q._sourceImage;o.deleteTexture(q);n._drawstatus.texture=null}}};l.drawPath=function(m,n,o,p){var r=this;var q=r.context;var s=n.type;var t;if(s==1){return}else if(s==2){return}else if(s==3){return}else{r._drawstatus.checkStatus2Draw(null,a.LINE,true,q.LINES,"");t=r.color2RGBRate(n);t.a=p}var u=r._2dVertices,v=r._2dUvColors,w=r._2dIndices;var x=m.length;var y={x:0,y:0};var z=r._2dVerti_buffer_index;var A=r._2dColor_buffer_index;var B=r._2dIndices_buffer_index;for(var C=0;C<x;C++){var D=m[C];var E=D.length;var F=D.matrix||o;F=_.multiply(r._2dDisplayMatrix,F);var G=F[0],l=F[1],H=F[4],I=F[5],J=F[12],K=F[13];var L=E/2-1;var M=z/3;for(var N=0;N<L;N++,B+=2,M++){w[B]=M;w[B+1]=M+1}for(var N=0;N<E;N+=2,z+=3,A+=4){var O=D[N];var P=D[N+1];u[z]=O*G+P*H+J;u[z+1]=O*l+P*I+K;u[z+2]=d;v[A]=t.r;v[A+1]=t.g;v[A+2]=t.b;v[A+3]=t.a}}r._2dVerti_buffer_index=z;r._2dColor_buffer_index=A;r._2dIndices_buffer_index=B};l.drawImage=function(m,n,o,p,q,r,s,t,u,v,w,x,y){var A=this;var z=A.context;var B=null;var C=m.width;var D=m.height;var E=x=="no-repeat";B=A.getTextureByImage(z,m,x,y);if(!B){return}A._drawstatus.checkStatus2Draw(B,a.TEXTURE,E,z.TRIANGLES,"");var F=A._2dVertices,G=A._2dUvColors;var H=0,I=1,J=0,K=1;var L=t+v;var M=u+w;H=p/C;J=q/D;I=H+(r/C);K=J+(s/D);n=_.multiply(A._2dDisplayMatrix,n);var N=n[0],l=n[1],O=n[4],P=n[5],Q=n[12],R=n[13];var S=A._2dVerti_buffer_index;F[S]=t*N+u*O+Q;F[S+1]=t*l+u*P+R;F[S+2]=d;F[S+3]=t*N+M*O+Q;F[S+4]=t*l+M*P+R;F[S+5]=d;F[S+6]=L*N+M*O+Q;F[S+7]=L*l+M*P+R;F[S+8]=d;F[S+9]=L*N+u*O+Q;F[S+10]=L*l+u*P+R;F[S+11]=d;var S=A._2dColor_buffer_index;G[S+0]=G[S+4]=H;G[S+8]=G[S+12]=I;G[S+1]=G[S+13]=J;G[S+5]=G[S+9]=K;G[S+2]=G[S+6]=G[S+10]=G[S+14]=o;var S=A._2dIndices_buffer_index;var T=A._2dVerti_buffer_index/3;var U=A._2dIndices;U[S]=T;U[S+1]=T+1;U[S+2]=T+2;U[S+3]=T;U[S+4]=T+2;U[S+5]=T+3;A._2dVerti_buffer_index+=12;A._2dColor_buffer_index+=16;A._2dIndices_buffer_index+=6};l.screenToWebGLMatrix=function(m,n){var o=this;if(m){return _.multiply(o._3dDisplayMatrix,m,n)}else{return o._3dDisplayMatrix}};l.drawGeometry=function(m,n,o,p,q){var s=this;var r=s.context;var t=m.vertices,u=m.uv,v=m.normals,w=m.indices;var x=s._3d_shaderProgram;var y=n.fillType;var z,A=null;var B=true;if(q){var C=q.getVMatrix();var D=_.multiply(C,o);var E=$.create();_.transformPoint(D,E,E);if(q.maxRenderDistance>0){if($.length(E)>q.maxRenderDistance){return}}$.normalize(E,E);var F=$.dot(E,$.ZAxis);if(F>-0.60){return}}if(y==a.TEXTURE){A=s.getTextureByImage(r,n.image,m.repeat,m.unsmooth);if(!A)return;m.width=n.image.naturalWidth;m.height=n.image.naturalHeight;B=m.repeat=="no-repeat"?true:false}else if(y==a.FRAMEBUFFER){A=n.image;if(!A)return;B=true}s._drawstatus.cullFace(n.side);r.uniformMatrix4fv(x.mMatrixUniform,false,o);var G=false;var H=false;if(A){H=false;r.bindTexture(r.TEXTURE_2D,A);r.uniform1i(x.usenorepeatuniform,B)}else{H=true;r.bindTexture(r.TEXTURE_2D,s.emptyColorTexture);if(n.fillType==a.FILL_ONE_COLOR){G=true;var I=n.colorRate;r.uniform4f(x.oneColorUniform,I.r,I.g,I.b,I.a)}}r.uniform1i(x.usefillcoloruniform,H);r.uniform1i(x.useOneColorUniform,G);r.uniform1i(x.usePointUniform,J==b.POINTS);r.uniform1i(x.useLightUniform,n.useLight);s.fixMaterialBuffer(m,n);s.fixGeometryBuffer(m);var J=n.drawType;r.drawElements(J,m.indices.length,r.UNSIGNED_SHORT,0)};l.fixMaterialBuffer=function(m,n){var p=this;var o=p.context;var q=p._3d_shaderProgram;var r=n.uv?n:m;if(n.fillType==a.FILL&&r.uv){if(!r._uvColorBuffer){r._uvColorBuffer=p._createArrayBuffer(o,r.uv,4,o.FLOAT,o.DYNAMIC_DRAW);p._enableAttributeVariable(o,q.textureCoordAttribute,r._uvColorBuffer)}else if(p._programStatus._uvColorBuffer!=r._uvColorBuffer){p._enableAttributeVariable(o,q.textureCoordAttribute,r._uvColorBuffer)}p._programStatus._uvColorBuffer=r._uvColorBuffer}else{o.disableVertexAttribArray(q.textureCoordAttribute);p._programStatus._uvColorBuffer=null}};l.fixGeometryBuffer=function(m){var o=this;var n=o.context;var p=o._3d_shaderProgram;if(!m._verticesBuffer){m._verticesBuffer=o._createArrayBuffer(n,m.vertices,3,n.FLOAT,n.DYNAMIC_DRAW);o._enableAttributeVariable(n,p.vertexPositionAttribute,m._verticesBuffer);if(m.normals){m._normalsBuffer=o._createArrayBuffer(n,m.normals,3,n.FLOAT,n.DYNAMIC_DRAW);o._enableAttributeVariable(n,p.vertexNormalAttribute,m._normalsBuffer)}m._indicesBuffer=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,m._indicesBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,m.indices,n.STATIC_DRAW)}else{if(o._programStatus._verticesBuffer!=m._verticesBuffer){o._enableAttributeVariable(n,p.vertexPositionAttribute,m._verticesBuffer)}if(o._programStatus._normalsBuffer!=m._normalsBuffer){o._enableAttributeVariable(n,p.vertexNormalAttribute,m._normalsBuffer)}if(o._programStatus._indicesBuffer!=m._indicesBuffer){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,m._indicesBuffer)}}o._programStatus._indicesBuffer=m._indicesBuffer;o._programStatus._verticesBuffer=m._verticesBuffer;o._programStatus._normalsBuffer=m._normalsBuffer};l.setLights=function(m){var o=this;var n=o.context;var p=o._3d_shaderProgram;var q=o._maxLightCount;var r=m.length;var s=$.create();var t=_.identity();for(var u=0;u<q;u++){var v=n.getUniformLocation(p,"lightList["+u+"].active");var w=n.getUniformLocation(p,"lightList["+u+"].position");if(u<r){var x=m[u];x.getConcatenatedMatrix(t);_.transformPoint(t,s,s);n.uniform1i(v,true);n.uniform3fv(w,s)}else{n.uniform1i(v,false);n.uniform3f(w,0.0,0.0,0.0)}}};l.setCamera=function(m,n){var o=this;if(m){o._draw2dBufferArrays();var p=o.context;var q=o._3d_shaderProgram;o.useProgram(p,q);var r=_.multiply(o._3dDisplayMatrix,m.getVMatrix());p.uniformMatrix4fv(q._2dMatrixUniform,false,o.screenView2dMatrix);p.uniformMatrix4fv(q.pMatrixUniform,false,m.getProjectMatrix());p.uniformMatrix4fv(q.vMatrixUniform,false,r)}};kisgame.KISWebGLStage=i}());;(function(){function _(a,b){var c=this;if(!b){b="canvas"}c.callSuperMethod(_.super_p.k_ctor,b);c.canvasStage=kisgame.getGameStage(a,c.MCTarget)}var $=_.prototype;$.setAutoUpdate=function(a){var b=this;b.canvasStage.autoUpdate=a};$.update=function(){var a=this;a.canvasStage.update()};$.setSize=function(a,b){var c=this;c.callSuperMethod(_.super_p.setSize,a,b);c.canvasStage.setSize(a,b)};$.addChild=function(a){var b=this;return b.canvasStage.addChild(a)};$.addChildAt=function(a,b){var c=this;return c.canvasStage.addChildAt(a,b)};$.removeChild=function(a){var b=this;return b.canvasStage.removeChild(a)};$.removeChildAt=function(a,b){var c=this;return c.canvasStage.removeChildAt(a,b)};$.getNumChildren=function(){var a=this;return a.canvasStage.getNumChildren()};$.getChildAt=function(a){var b=this;return b.canvasStage.getChildAt(a)};KISU.extend(_,MCProxy);kisgame.GameStage=_}());