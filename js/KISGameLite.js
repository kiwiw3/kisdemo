this.kisgame=this.kisgame||{};this.kisgame.getGameStage=function(_,$){var a;if(_&&_.toLowerCase()=="webgl"){a=new kisgame.KISWebGLStage($)}else{a=new kisgame.KISStage($)}return a};this.kisgame=this.kisgame||{};(function(){"use strict";var _={};_.LEFT=2;_.RIGHT=4;_.TOP=8;_.BOTTOM=16;_.CENTER=32;_.MIDDLE=64;_.HORIZONTAL=128;_.VERTICAL=256;_.OFFSET_X=512;_.OFFSET_Y=1024;_.FONT=2048;_.BACK=4096;_.COMBINE=8192;_.SEPARATE=16384;kisgame.DirectionType=_})();kisgame.extend=function(_,$){"use strict";function a(){var b=this;b.constructor=_}a.prototype=$.prototype;return (_.prototype=new a())};kisgame.promote=function(_,$){"use strict";var a=_.prototype,b=(Object.getPrototypeOf&&Object.getPrototypeOf(a))||a.__proto__;if(b){a[($+="_")+"constructor"]=b.constructor;for(var c in b){if(a.hasOwnProperty(c)&&(typeof b[c]=="function" )){a[$+c]=b[c]}}}return _};(function(){"use strict";function _(a,b,c){var d=this;d.type=a;d.target=null;d.currentTarget=null;d.eventPhase=0;d.bubbles=!!b;d.cancelable=!!c;d.timeStamp=(new Date()).getTime();d.defaultPrevented=false;d.propagationStopped=false;d.immediatePropagationStopped=false;d.removed=false}var $=_.prototype;$.preventDefault=function(){var a=this;a.defaultPrevented=a.cancelable&&true};$.stopPropagation=function(){var a=this;a.propagationStopped=true};$.stopImmediatePropagation=function(){var a=this;a.immediatePropagationStopped=a.propagationStopped=true};$.remove=function(){var a=this;a.removed=true};$.clone=function(){var a=this;return new _(a.type,a.bubbles,a.cancelable)};$.set=function(a){var c=this;for(var b in a){c[b]=a[b]}return c};$.toString=function(){var a=this;return "[Event (type="+a.type+")]"};$.stop=function(){var a=this;a.stopImmediatePropagation();a.preventDefault()};kisgame.Event=_}());(function(){"use strict";function _(){var a=this;a._listeners=null;a._captureListeners=null}var $=_.prototype;_.initialize=function(a){a.addEventListener=$.addEventListener;a.on=$.on;a.removeEventListener=$.removeEventListener;a.off=$.off;a.removeAllEventListeners=$.removeAllEventListeners;a.hasEventListener=$.hasEventListener;a.dispatchEvent=$.dispatchEvent;a._dispatchEvent=$._dispatchEvent;a.willTrigger=$.willTrigger};$.addEventListener=function(a,b,c){var e=this;var d;if(c){d=e._captureListeners=e._captureListeners||{}}else{d=e._listeners=e._listeners||{}}var f=d[a];if(f){e.removeEventListener(a,b,c)}f=d[a];if(!f){d[a]=[b]}else{f.push(b);f.sortOn("priority",Array.NUMERIC|Array.DESCENDING)}return b};$.on=function(a,b,c,d,e,f,g){var i=this;var h;if(b.handleEvent){c=c||b;h=b.handleEvent}else{h=b;c=c||i}var j;if(f){j=i._captureListeners=i._captureListeners||{}}else{j=i._listeners=i._listeners||{}}var k=j[a];var l=null;if(k){var m=k.length;for(var n=0;n<m;n++){var o=k[n];if(o.type==a&&o.olistener==b&&o.scope==c){l=o;break}}}else{k=j[a]=[]}if(!l){l={handleEvent:function(p){var i=this;i.listener.call(i.scope,p,i.data);i.once&&p.remove()},once:d,data:e,listener:h,olistener:b,type:a,scope:c,priority:g};k.push(l);k.sortOn("priority",Array.NUMERIC|Array.DESCENDING)}return l};$.off=function(a,b,c,d){var f=this;var e=c?f._captureListeners:f._listeners;if(!e){return}var g=e[a];if(g){var h;if(b.olistener){d=d||b.scope;h=b.olistener}else{h=b;d=d||f}var i=g.length;var j=null;for(var k=0;k<i;k++){var l=g[k];if(l.type==a&&l.olistener==h&&l.scope==d){if(i==1){delete (e[a])}else{g.splice(k,1)}break}}}};$.removeEventListener=function(a,b,c){var e=this;var d=c?e._captureListeners:e._listeners;if(!d){return}var f=d[a];if(!f){return}for(var g=0,h=f.length;g<h;g++){if(f[g]==b){if(h==1){delete (d[a])}else{f.splice(g,1)}break}}};$.removeAllEventListeners=function(a){var b=this;if(!a){b._listeners=b._captureListeners=null}else{if(b._listeners){delete (b._listeners[a])}if(b._captureListeners){delete (b._captureListeners[a])}}};$.dispatchEvent=function(a,b,c){var e=this;if(typeof a=="string"){var d=e._listeners;if(!b&&(!d||!d[a])){return true}a=new kisgame.Event(a,b,c)}else if(a.target&&a.clone){a=a.clone()}a.target=e;if(!a.bubbles||!e.parent){e._dispatchEvent(a,2)}else{var f=e,g=[f];while(f.parent){g.push(f=f.parent)}var h,i=g.length;for(h=i-1;h>=0&&!a.propagationStopped;h--){g[h]._dispatchEvent(a,1+(h==0))}for(h=1;h<i&&!a.propagationStopped;h++){g[h]._dispatchEvent(a,3)}}return !a.defaultPrevented};$.hasEventListener=function(a){var c=this;var b=c._listeners,d=c._captureListeners;return !!((b&&b[a])||(d&&d[a]))};$.willTrigger=function(a){var c=this;var b=c;while(b){if(b.hasEventListener(a)){return true}b=b.parent}return false};$.toString=function(){return "[EventDispatcher]"};$._dispatchEvent=function(a,b){var e=this;var c,d=(b==1)?e._captureListeners:e._listeners;if(a&&d){var f=d[a.type];if(!f||!(c=f.length)){return}a.currentTarget=e;a.eventPhase=b;a.removed=false;f=f.slice();for(var g=0;g<c&&!a.immediatePropagationStopped;g++){var h=f[g];if(h.handleEvent){h.handleEvent(a)}else{h(a)}if(a.removed){e.off(a.type,h,b==1);a.removed=false}}}};$.addETL=$.on;$.removeETL=function(a,b,c){var d=this;d.off(a,b,false,c)};kisgame.EventDispatcher=_}());(function(){"use strict";function _(){throw "Ticker cannot be instantiated."}_.RAF_SYNCHED="synched";_.RAF="raf";_.TIMEOUT="timeout";_.useRAF=false;_.timingMode=null;_.maxDelta=0;_.paused=false;_.removeEventListener=null;_.removeAllEventListeners=null;_.dispatchEvent=null;_.hasEventListener=null;_._listeners=null;kisgame.EventDispatcher.initialize(_);_._addEventListener=_.addEventListener;_.addEventListener=function(){!_._inited&&_.init();return _._addEventListener.apply(_,arguments)};_._on=_.on;_.on=function(){!_._inited&&_.init();return _._on.apply(_,arguments)};_._inited=false;_._startTime=0;_._pausedTime=0;_._ticks=0;_._pausedTicks=0;_._interval=50;_._lastTime=0;_._times=null;_._tickTimes=null;_._timerId=null;_._raf=true;_.setInterval=function(a){_._interval=a;if(!_._inited){return}_._setupTick()};_.getInterval=function(){return _._interval};_.setFPS=function(a){_.setInterval(1000/a)};_.getFPS=function(){return 1000/_._interval};try{Object.defineProperties(_,{interval:{get:_.getInterval,set:_.setInterval},framerate:{get:_.getFPS,set:_.setFPS}})}catch(e){console.log(e)}_.init=function(){if(_._inited){return}_._inited=true;_._times=[];_._tickTimes=[];_._startTime=_._getTime();_._times.push(_._lastTime=0);_.interval=_._interval};_.reset=function(){if(_._raf){var a=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;a&&a(_._timerId)}else{clearTimeout(_._timerId)}_.removeAllEventListeners("tick");_._timerId=_._times=_._tickTimes=null;_._startTime=_._lastTime=_._ticks=0;_._inited=false};_.getMeasuredTickTime=function(a){var b=0,c=_._tickTimes;if(!c||c.length<1){return -1}a=Math.min(c.length,a||(_.getFPS()|0));for(var d=0;d<a;d++){b+=c[d]}return b/a};_.getMeasuredFPS=function(a){var b=_._times;if(!b||b.length<2){return -1}a=Math.min(b.length-1,a||(_.getFPS()|0));return 1000/((b[0]-b[a])/a)};_.setPaused=function(a){_.paused=a};_.getPaused=function(){return _.paused};_.getTime=function(a){return _._startTime?_._getTime()-(a?_._pausedTime:0):-1};_.getEventTime=function(a){return _._startTime?(_._lastTime||_._startTime)-(a?_._pausedTime:0):-1};_.getTicks=function(a){return _._ticks-(a?_._pausedTicks:0)};_._handleSynch=function(){_._timerId=null;_._setupTick();if(_._getTime()-_._lastTime>=(_._interval-1)*0.97){_._tick()}};_._handleRAF=function(){_._timerId=null;_._setupTick();_._tick()};_._handleTimeout=function(){_._timerId=null;_._setupTick();_._tick()};_._setupTick=function(){if(_._timerId!=null){return}var a=_.timingMode||(_.useRAF&&_.RAF_SYNCHED);if(a==_.RAF_SYNCHED||a==_.RAF){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(b){_._timerId=b(a==_.RAF?_._handleRAF:_._handleSynch);_._raf=true;return}}_._raf=false;_._timerId=setTimeout(_._handleTimeout,_._interval)};_._tick=function(){var a=_.paused;var b=_._getTime();var c=b-_._lastTime;_._lastTime=b;_._ticks++;if(a){_._pausedTicks++;_._pausedTime+=c}if(_.hasEventListener("tick")){var d=new kisgame.Event("tick");var e=_.maxDelta;d.delta=(e&&c>e)?e:c;d.paused=a;d.time=b;d.runTime=b-_._pausedTime;_.dispatchEvent(d)}_._tickTimes.unshift(_._getTime()-b);while(_._tickTimes.length>100){_._tickTimes.pop()}_._times.unshift(b);while(_._times.length>100){_._times.pop()}};var $=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);_._getTime=function(){return (($&&$.call(performance))||(new Date().getTime()))-_._startTime};kisgame.Ticker=_}());(function(){"use strict";function _(){throw "UID cannot be instantiated"}_._nextID=0;_.get=function(){return _._nextID++};kisgame.UID=_}());(function(){"use strict";var _=new Object();var $=_;$.ht=[];$.intervalID=-1;$.lastTimer=0;$.framerate=30;$.checkAllFrame=function(){var a=_;var b=a.ht.slice(0);var c=b.length;for(var d=0;d<c;d++){var e=b[d];if(e&&e.length==4){var f=e[3];if(f<=0){var g=e[0];var h=e[1];var i=e[2];e[0]=0;e[1]=0;e[2]=0;e[4]=true;g.apply(h,i)}else{f--;e[3]=f}}}b.splice(0,b.length);var b=a.ht;var c=b.length;for(var d=0;d<c;d++){var e=b[d];if(e&&e.length==5){b.splice(d,1);c--;d--}}if(b.length<=0){a.lastTimer=0;a.intervalID=-1}else{var j=0;if(a.lastTimer>0){j=getTimer()-a.lastTimer}a.lastTimer=getTimer();var k=2000/a.framerate-j;if(k<=5){k=5}a.intervalID=setTimeout(a.checkAllFrame,k)}};$.containTarget=function(a,b){var d=this;var c=d.ht;var e=c.length;for(var f=0;f<e;f++){var g=c[f];if(g[0]==a&&g[1]==b){return g}}return false};$.addOnce=function(a,b,c,d){var f=this;var e=f.containTarget(a,c);if(e){e[2]=d;e[3]=b}else{f.add(a,b,c,d)}};$.add=function(a,b,c,d){var e=this;e.ht.push([a,c,d,b]);if(e.intervalID==-1){e.intervalID=setTimeout(e.checkAllFrame,1000/e.framerate)}};$.remove=function(a,b,c){var e=this;var d=e.ht;var f=d.length;for(var g=0;g<f;g++){var h=d[g];if(h[0]==a&&h[1]==b){d.splice(g,1);h.splice(0,h.length);if(!c){return}}}};$.removeOf=function(a){var c=this;var b=c.ht;var d=b.length;for(var e=0;e<d;e++){var f=b[e];if(f[1]==a){b.splice(e,1);f.splice(0,f.length);e--;d--}}};kiscore.LaterFrameTable=_}());this.kisgame=this.kisgame||{};(function(){function _(){}_.get2PR=function($,a,b,c){var d=c-a;var e=b-$;return Math.sqrt(d*d+e*e)};_.get3PRandian=function($,a,b){var c=0,d=0,e=0;var f=a.x-$.x;var g=a.y-$.y;var h=b.x-$.x;var i=b.y-$.y;c=f*h+g*i;e=(f*f+g*g)*(h*h+i*i);c/=Math.sqrt(e);if(c>=1.0)return 0;if(c<=-1.0)return Math.PI;return Math.acos(c)};_.normalize=function($,a,b){var c=Math.sqrt($*$+a*a);var d=$/c;var e=a/c;return {x:b*d,y:b*e}};_.getBezierControlPoints=function($,a){var b=$[0].x,c=$[0].y;var d=$[1].x,e=$[1].y;var f=$[2].x,g=$[2].y;var h=$[3].x,i=$[3].y;var j=(b+d)/2.0;var k=(c+e)/2.0;var l=(d+f)/2.0;var m=(e+g)/2.0;var n=(f+h)/2.0;var o=(g+i)/2.0;var p=Math.sqrt((d-b)*(d-b)+(e-c)*(e-c));var q=Math.sqrt((f-d)*(f-d)+(g-e)*(g-e));var r=Math.sqrt((h-f)*(h-f)+(i-g)*(i-g));var s=p/(p+q);var t=q/(q+r);var u=j+(l-j)*s;var v=k+(m-k)*s;var w=l+(n-l)*t;var x=m+(o-m)*t;var y=u+(l-u)*a+d-u;var z=v+(m-v)*a+e-v;var A=w+(l-w)*a+f-w;var B=x+(m-x)*a+g-x;return [{x:y,y:z},{x:A,y:B}]};_.get2PRadian=function($,a,b,c){var d=c-a;var e=b-$;if(e==0){if(d<0){return Math.PI*3/2}else{return Math.PI/2}}var f=d/e;var g=Math.atan(f);g=e>=0?d<0?g+Math.PI*2:g:g+Math.PI;return g};_.drawXuline=function($,a,b,c,d,e){var f=_.get2PRadian(a,b,c,d);var g=_.get2PR(a,b,c,d);var h=Math.ceil(g/e);for(var i=0;i<h;i+=2){$.moveTo(a+i*e*Math.cos(f),b+i*e*Math.sin(f));$.lineTo(a+(i+1)*e*Math.cos(f),b+(i+1)*e*Math.sin(f))}$.moveTo(c,d);$.lineTo(c+e/3*Math.cos(f+Math.PI),d+e/3*Math.sin(f+Math.PI))};_.getLine=function($,a,b,c){var d,_b;if(b==$){d=NaN;_b=$}else{d=(c-a)/(b-$);_b=a-d*$}return {k:d,b:_b}};_.getCircle=function($,a,b){return {x:$,y:a,r:b}};_.getLineSamePoint=function($,a){var b=new kisgame.Point();if($.k==a.k||(isNaN($.k)&&isNaN(a.k))){if($.b==a.b){return 1}return null}else if(isNaN($.k)){b.x=$.b;b.y=a.k*b.x+a.b}else if(isNaN(a.k)){b.x=a.b;b.y=$.k*b.x+$.b}else{b.x=(a.b-$.b)/($.k-a.k);b.y=(a.k*$.b-$.k*a.b)/(a.k-$.k)}return b};_.getCircleLineSamePoint=function($,a){var b=$.x;var c=$.y;var d=$.r;var e=a.k;var f=a.b;var g=Math.pow(2*(b-e*f+c*e)/(1+e*e),2)+4*(d*d-b*b-c*c-f*f+2*c*f)/(1+e*e);if(g<0){return null}else if(g>0){var h=new Array(2);h[0]=new kisgame.Point();h[0].x=(b-e*f+c*e)/(1+e*e)+Math.sqrt((d*d-b*b-c*c-f*f+2*c*f)/(1+e*e)+Math.pow((b-e*f+c*e)/(1+e*e),2));h[0].y=e*h[0].x+f;h[1]=new kisgame.Point();h[1].x=(b-e*f+c*e)/(1+e*e)-Math.sqrt((d*d-b*b-c*c-f*f+2*c*f)/(1+e*e)+Math.pow((b-e*f+c*e)/(1+e*e),2));h[1].y=e*h[1].x+f;return h}return null};kisgame.GeomUtils=_}());(function(){var $=this;var _=$.kisgame.ColorUtils=new Object();_.alpha=1;_.str2Color=function(a){var $=this;$.alpha=1;var b=a.toLowerCase();if(b=="black"){a="#000000"}else if(b=="red"){a="#ff0000"}else if(b=="green"){a="#008000"}else if(b=="blue"){a="#0000ff"}else if(b=="yellow"){a="#ffff00"}else if(b=="gray"){a="#808080"}else if(b=="brown"){a="#A52A2A"}else if(b=="white"){a="#ffffff"}else{var c=a.substr(1);if(c.length==3){a="#"+c.charAt(0)+c.charAt(0)+c.charAt(1)+c.charAt(1)+c.charAt(2)+c.charAt(2)}else{c=a.substr(0,4);if(c=="rgba"){c=a.substr(5,a.length-6);var d=c.split(",");var e=d.length;for(var f=0;f<e;f++){var g;if(f<e-1){g=parseInt(d[f]);var h=g.toString(16);if(h.length==1){d[f]="0"+h}else{d[f]=h}}else{$.alpha=Number(d[f])}}a="#"+d[0]+d[1]+d[2]}}}return a}}());(function(){"use strict";function _(a,b,c,d,e,f){var g=this;g.setValues(a,b,c,d,e,f)}var $=_.prototype;_.DEG_TO_RAD=Math.PI/180;_.identity=null;$.setValues=function(a,b,c,d,e,f){var g=this;g.a=(a==null)?1:a;g.b=b||0;g.c=c||0;g.d=(d==null)?1:d;g.tx=e||0;g.ty=f||0;return g};$.append=function(a,b,c,d,e,f){var h=this;var g=h.a;var i=h.b;var j=h.c;var k=h.d;if(a!=1||b!=0||c!=0||d!=1){h.a=g*a+j*b;h.b=i*a+k*b;h.c=g*c+j*d;h.d=i*c+k*d}h.tx=g*e+j*f+h.tx;h.ty=i*e+k*f+h.ty;return h};$.prepend=function(a,b,c,d,e,f){var h=this;var g=h.a;var i=h.c;var j=h.tx;h.a=a*g+c*h.b;h.b=b*g+d*h.b;h.c=a*i+c*h.d;h.d=b*i+d*h.d;h.tx=a*j+c*h.ty+e;h.ty=b*j+d*h.ty+f;return h};$.appendMatrix=function(a){var b=this;return b.append(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.prependMatrix=function(a){var b=this;return b.prepend(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.appendTransform=function(a,b,c,d,e,f,g,h,i){var m=this;if(e%360){var j=e*_.DEG_TO_RAD;var k=Math.cos(j);var l=Math.sin(j)}else{k=1;l=0}if(f||g){f*=_.DEG_TO_RAD;g*=_.DEG_TO_RAD;m.append(Math.cos(g),Math.sin(g),-Math.sin(f),Math.cos(f),a,b);m.append(k*c,l*c,-l*d,k*d,0,0)}else{m.append(k*c,l*c,-l*d,k*d,a,b)}if(h||i){m.tx-=h*m.a+i*m.c;m.ty-=h*m.b+i*m.d}return m};$.prependTransform=function(a,b,c,d,e,f,g,h,i){var m=this;if(e%360){var j=e*_.DEG_TO_RAD;var k=Math.cos(j);var l=Math.sin(j)}else{k=1;l=0}if(h||i){m.tx-=h;m.ty-=i}if(f||g){f*=_.DEG_TO_RAD;g*=_.DEG_TO_RAD;m.prepend(k*c,l*c,-l*d,k*d,0,0);m.prepend(Math.cos(g),Math.sin(g),-Math.sin(f),Math.cos(f),a,b)}else{m.prepend(k*c,l*c,-l*d,k*d,a,b)}return m};$.rotate=function(a){var e=this;a=a*_.DEG_TO_RAD;var b=Math.cos(a);var c=Math.sin(a);var d=e.a;var f=e.b;e.a=d*b+e.c*c;e.b=f*b+e.d*c;e.c=-d*c+e.c*b;e.d=-f*c+e.d*b;return e};$.skew=function(a,b){var c=this;a=a*_.DEG_TO_RAD;b=b*_.DEG_TO_RAD;c.append(Math.cos(b),Math.sin(b),-Math.sin(a),Math.cos(a),0,0);return c};$.scale=function(a,b){var c=this;c.a*=a;c.b*=a;c.c*=b;c.d*=b;return c};$.translate=function(a,b){var c=this;c.tx+=c.a*a+c.c*b;c.ty+=c.b*a+c.d*b;return c};$.identity=function(){var a=this;a.a=a.d=1;a.b=a.c=a.tx=a.ty=0;return a};$.invert=function(){var b=this;var a=b.a;var c=b.b;var d=b.c;var e=b.d;var f=b.tx;var g=a*e-c*d;b.a=e/g;b.b=-c/g;b.c=-d/g;b.d=a/g;b.tx=(d*b.ty-e*f)/g;b.ty=-(a*b.ty-c*f)/g;return b};$.isIdentity=function(){var a=this;return a.tx===0&&a.ty===0&&a.a===1&&a.b===0&&a.c===0&&a.d===1};$.equals=function(a){var b=this;return b.tx===a.tx&&b.ty===a.ty&&b.a===a.a&&b.b===a.b&&b.c===a.c&&b.d===a.d};$.transformPoint=function(a,b,c){var d=this;c=c||{};c.x=a*d.a+b*d.c+d.tx;c.y=a*d.b+b*d.d+d.ty;return c};$.decompose=function(a){var b=this;if(a==null){a={}}a.x=b.tx;a.y=b.ty;a.scaleX=Math.sqrt(b.a*b.a+b.b*b.b);a.scaleY=Math.sqrt(b.c*b.c+b.d*b.d);var c=Math.atan2(-b.c,b.d);var d=Math.atan2(b.b,b.a);var e=Math.abs(1-c/d);if(e<0.00001){a.rotation=d/_.DEG_TO_RAD;if(b.a<0&&b.d>=0){a.rotation+=(a.rotation<=0)?180:-180}a.skewX=a.skewY=0}else{a.skewX=c/_.DEG_TO_RAD;a.skewY=d/_.DEG_TO_RAD}return a};$.copy=function(a){var b=this;return b.setValues(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.clone=function(){var a=this;return new _(a.a,a.b,a.c,a.d,a.tx,a.ty)};$.toString=function(){var a=this;return "[Matrix2D (a="+a.a+" b="+a.b+" c="+a.c+" d="+a.d+" tx="+a.tx+" ty="+a.ty+")]"};_.identity=new _();kisgame.Matrix2D=_}());(function(){"use strict";var _={};_.create=function(){var $=new Float32Array(2);$[0]=0;$[1]=0;return $};_.clone=function($){var a=new Float32Array(2);a[0]=$[0];a[1]=$[1];return a};_.fromValues=function($,a){var b=new Float32Array(2);b[0]=$;b[1]=a;return b};_.copy=function($,a){$[0]=a[0];$[1]=a[1];return $};_.set=function($,a,b){$[0]=a;$[1]=b;return $};_.add=function($,a,b){$[0]=a[0]+b[0];$[1]=a[1]+b[1];return $};_.subtract=function($,a,b){$[0]=a[0]-b[0];$[1]=a[1]-b[1];return $};_.sub=_.subtract;_.multiply=function($,a,b){$[0]=a[0]*b[0];$[1]=a[1]*b[1];return $};_.mul=_.multiply;_.divide=function($,a,b){$[0]=a[0]/b[0];$[1]=a[1]/b[1];return $};_.div=_.divide;_.ceil=function($,a){$[0]=Math.ceil(a[0]);$[1]=Math.ceil(a[1]);return $};_.floor=function($,a){$[0]=Math.floor(a[0]);$[1]=Math.floor(a[1]);return $};_.min=function($,a,b){$[0]=Math.min(a[0],b[0]);$[1]=Math.min(a[1],b[1]);return $};_.max=function($,a,b){$[0]=Math.max(a[0],b[0]);$[1]=Math.max(a[1],b[1]);return $};_.round=function($,a){$[0]=Math.round(a[0]);$[1]=Math.round(a[1]);return $};_.scale=function($,a,b){$[0]=a[0]*b;$[1]=a[1]*b;return $};_.scaleAndAdd=function($,a,b,c){$[0]=a[0]+(b[0]*c);$[1]=a[1]+(b[1]*c);return $};_.distance=function($,a){var b=a[0]-$[0],c=a[1]-$[1];return Math.sqrt(b*b+c*c)};_.dist=_.distance;_.squaredDistance=function($,a){var b=a[0]-$[0],c=a[1]-$[1];return b*b+c*c};_.sqrDist=_.squaredDistance;_.length=function($){var a=$[0],b=$[1];return Math.sqrt(a*a+b*b)};_.len=_.length;_.squaredLength=function($){var a=$[0],b=$[1];return a*a+b*b};_.sqrLen=_.squaredLength;_.negate=function($,a){$[0]=-a[0];$[1]=-a[1];return $};_.inverse=function($,a){$[0]=1.0/a[0];$[1]=1.0/a[1];return $};_.normalize=function($,a){var b=a[0],c=a[1];var d=b*b+c*c;if(d>0){d=1/Math.sqrt(d);$[0]=a[0]*d;$[1]=a[1]*d}return $};_.dot=function($,a){return $[0]*a[0]+$[1]*a[1]};_.cross=function($,a,b){var c=a[0]*b[1]-a[1]*b[0];$[0]=$[1]=0;$[2]=c;return $};_.lerp=function($,a,b,c){var d=a[0],e=a[1];$[0]=d+c*(b[0]-d);$[1]=e+c*(b[1]-e);return $};_.random=function($,a){a=a||1.0;var b=glMatrix.RANDOM()*2.0*Math.PI;$[0]=Math.cos(b)*a;$[1]=Math.sin(b)*a;return $};_.transformMat2=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[2]*d;$[1]=b[1]*c+b[3]*d;return $};_.transformMat2d=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[2]*d+b[4];$[1]=b[1]*c+b[3]*d+b[5];return $};_.transformMat3=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[3]*d+b[6];$[1]=b[1]*c+b[4]*d+b[7];return $};_.transformMat4=function($,a,b){var c=a[0],d=a[1];$[0]=b[0]*c+b[4]*d+b[12];$[1]=b[1]*c+b[5]*d+b[13];return $};_.forEach=(function(){var $=_.create();return function(a,b,c,d,e,f){var g,l;if(!b){b=2}if(!c){c=0}if(d){l=Math.min((d*b)+c,a.length)}else{l=a.length}for(g=c;g<l;g+=b){$[0]=a[g];$[1]=a[g+1];e($,$,f);a[g]=$[0];a[g+1]=$[1]}return a}})();_.str=function($){return 'Vector2D('+$[0]+', '+$[1]+')'};_.exactEquals=function($,a){return $[0]===a[0]&&$[1]===a[1]};_.equals=function($,a){var b=$[0],c=$[1];var d=a[0],e=a[1];return (Math.abs(b-d)<=glMatrix.EPSILON*Math.max(1.0,Math.abs(b),Math.abs(d))&&Math.abs(c-e)<=glMatrix.EPSILON*Math.max(1.0,Math.abs(c),Math.abs(e)))};kisgame.Vector2D=_}());var HitTestUtils=(function(){function _(){}_.hitTestPoints=function($,a,b){if(b){if(_.checkInside($,a)){return true}else if(_.checkInside(a,$)){return true}}var c=$.length;var d=a.length;var e=[];for(var f=0;f<d-1;f++){var g=a[f].x;var h=a[f].y;var i=a[f+1].x;var j=a[f+1].y;var k=new Object();if(i==g){k.k=NaN;k.b=g}else{k.k=(j-h)/(i-g);k.b=h-k.k*g}if(g>i){var l=g;g=i;i=l}if(h>j){l=h;h=j;j=l}k.x1=g;k.x2=i;k.y1=h;k.y2=j;e.push(k)}d=e.length;for(f=0;f<c-1;f++){g=$[f].x;h=$[f].y;i=$[f+1].x;j=$[f+1].y;if(i==g){var m=NaN;var n=g}else{m=(j-h)/(i-g);n=h-m*g}if(g>i){l=g;g=i;i=l}if(h>j){l=h;h=j;j=l}for(var o=0;o<d;o++){k=e[o];if(i<k.x1||k.x2<g){continue}if(j<k.y1||k.y2<h){continue}if(m==k.k||(isNaN(m)&&isNaN(k.k))){if(n==k.b){trace("重合");if(isNaN(m)){if(j<k.y1||k.y2<h){continue}var p=h;if(p<k.y1){p=k.y1}var q=j;if(q>k.y2){q=k.y2}return true}else{if(i<k.x1||k.x2<g){continue}p=g;if(p<k.x1){p=k.x1}q=i;if(q>k.x2){q=k.x2}return true}}}else{if(isNaN(m)){var r=n;var s=k.k*n+k.b}else if(isNaN(k.k)){r=k.b;s=m*k.b+n}else{r=(k.b-n)/(m-k.k);s=(k.k*n-m*k.b)/(k.k-m)}if(r-g<-0.01||r-k.x1<-0.01||r-i>0.01||r-k.x2>0.01||s-h<-0.01||s-k.y1<-0.01||s-j>0.01||s-k.y2>0.01){continue}return true}}}return false};_.checkInside=function($,a){var b=$.length;for(var c=0;c<b-1;c++){if(!_.isPointInside($[c].x,$[c].y,a)){return false}}return true};_.isPointInside=function($,a,b){var c,Y1,X2,Y2,X3,Y3,r1,min_l;var d=b.length;for(var e=0;e<d-1;e++){var f=b[e].x;var g=b[e].y;var h=b[e+1].x;var i=b[e+1].y;if(h==f){var j=NaN;var k=h}else{j=(i-g)/(h-f);k=g-j*f}var l=i-g;var m=h-f;if(m==0){if(l<0){n=Math.PI*3/2}else{n=Math.PI/2}}else{var n=Math.atan(l/m);n=m>=0?l<0?n+Math.PI*2:n:n+Math.PI}var o=$+10*Math.cos(n-Math.PI/2);var p=a+10*Math.sin(n-Math.PI/2);if(o==$){var q=NaN;var r=o}else{q=(p-a)/(o-$);r=a-q*$}var s,y4;var t=false;if((j==q)||(isNaN(j)&&isNaN(q))){if(k==r){}}else if(isNaN(j)){s=k;y4=q*s+r;t=true}else if(isNaN(q)){s=r;y4=j*s+k;t=true}else{s=(r-k)/(j-q);y4=(q*k-j*r)/(q-j);t=true}if(t){var u=Math.sqrt((y4-a)*(y4-a)+(s-$)*(s-$));if(isNaN(min_l)||u<min_l){min_l=u;r1=n;c=f;Y1=g;X2=h;Y2=i;X3=s;Y3=y4}}}if(!isNaN(min_l)){l=a-Y1;m=$-c;if(m==0){if(l<0){v=Math.PI*3/2}else{v=Math.PI/2}}else{var v=Math.atan(l/m);v=m>=0?l<0?v+Math.PI*2:v:v+Math.PI}var w=v-r1;if(w<0){w+=Math.PI*2}if(w>Math.PI){return false}var x=c<X2?c:X2;var y=c>X2?c:X2;var z=Y1<Y2?Y1:Y2;var A=Y1>Y2?Y1:Y2;if(X3-x<-0.01||X3-y>0.01||Y3-z<-0.01||Y3-A>0.01){return false}return true}return false};return _})();(function(){"use strict";function _(){throw "Touch cannot be instantiated"}_.isSupported=function(){return !!(('ontouchstart' in window)||(window.navigator['msPointerEnabled']&&window.navigator['msMaxTouchPoints']>0)||(window.navigator['pointerEnabled']&&window.navigator['maxTouchPoints']>0))};_.enable=function($,a,b){if(!$||!$.canvas||!_.isSupported()){return false}if($.__touch){return true}$.__touch={pointers:{},multitouch:!a,preventDefault:!b,count:0};if('ontouchstart' in window){_._IOS_enable($)}else if(window.navigator['msPointerEnabled']||window.navigator["pointerEnabled"]){_._IE_enable($)}return true};_.disable=function($){if(!$){return}if('ontouchstart' in window){_._IOS_disable($)}else if(window.navigator['msPointerEnabled']||window.navigator["pointerEnabled"]){_._IE_disable($)}delete $.__touch};_._IOS_enable=function($){var a=$.canvas;var b=$.__touch.f=function(c){_._IOS_handleEvent($,c)};a.addEventListener("touchstart",b,false);a.addEventListener("touchmove",b,false);a.addEventListener("touchend",b,false);a.addEventListener("touchcancel",b,false)};_._IOS_disable=function($){var a=$.canvas;if(!a){return}var b=$.__touch.f;a.removeEventListener("touchstart",b,false);a.removeEventListener("touchmove",b,false);a.removeEventListener("touchend",b,false);a.removeEventListener("touchcancel",b,false)};_._IOS_handleEvent=function($,a){var h=this;if(!$){return}if($.__touch.preventDefault){a.preventDefault&&a.preventDefault()}var b=a.changedTouches;var c=a.type;for(var d=0,e=b.length;d<e;d++){var f=b[d];var g=f.identifier;if(f.target!=$.canvas){continue}if(c=="touchstart"){h._handleStart($,g,a,f.pageX,f.pageY)}else if(c=="touchmove"){h._handleMove($,g,a,f.pageX,f.pageY)}else if(c=="touchend"||c=="touchcancel"){h._handleEnd($,g,a)}}};_._IE_enable=function($){var a=$.canvas;var b=$.__touch.f=function(c){_._IE_handleEvent($,c)};if(window.navigator["pointerEnabled"]===undefined){a.addEventListener("MSPointerDown",b,false);window.addEventListener("MSPointerMove",b,false);window.addEventListener("MSPointerUp",b,false);window.addEventListener("MSPointerCancel",b,false);if($.__touch.preventDefault){a.style.msTouchAction="none"}}else{a.addEventListener("pointerdown",b,false);window.addEventListener("pointermove",b,false);window.addEventListener("pointerup",b,false);window.addEventListener("pointercancel",b,false);if($.__touch.preventDefault){a.style.touchAction="none"}}$.__touch.activeIDs={}};_._IE_disable=function($){var a=$.__touch.f;if(window.navigator["pointerEnabled"]===undefined){window.removeEventListener("MSPointerMove",a,false);window.removeEventListener("MSPointerUp",a,false);window.removeEventListener("MSPointerCancel",a,false);if($.canvas){$.canvas.removeEventListener("MSPointerDown",a,false)}}else{window.removeEventListener("pointermove",a,false);window.removeEventListener("pointerup",a,false);window.removeEventListener("pointercancel",a,false);if($.canvas){$.canvas.removeEventListener("pointerdown",a,false)}}};_._IE_handleEvent=function($,a){var e=this;if(!$){return}if($.__touch.preventDefault){a.preventDefault&&a.preventDefault()}var b=a.type;var c=a.pointerId;var d=$.__touch.activeIDs;if(b=="MSPointerDown"||b=="pointerdown"){if(a.srcElement!=$.canvas){return}d[c]=true;e._handleStart($,c,a,a.pageX,a.pageY)}else if(d[c]){if(b=="MSPointerMove"||b=="pointermove"){e._handleMove($,c,a,a.pageX,a.pageY)}else if(b=="MSPointerUp"||b=="MSPointerCancel"||b=="pointerup"||b=="pointercancel"){delete (d[c]);e._handleEnd($,c,a)}}};_._handleStart=function($,a,b,c,d){var e=$.__touch;if(!e.multitouch&&e.count){return}var f=e.pointers;if(f[a]){return}f[a]=true;e.count++;$._handlePointerDown(a,b,c,d)};_._handleMove=function($,a,b,c,d){if(!$.__touch.pointers[a]){return}$._handlePointerMove(a,b,c,d)};_._handleEnd=function($,a,b){var c=$.__touch;var d=c.pointers;if(!d[a]){return}c.count--;$._handlePointerUp(a,b,true);delete (d[a])};kisgame.Touch=_}());(function(){"use strict";function _(a,b,c,d,e){var f=this;f.setValues(a,b,c,d,e)}var $=_.prototype;$.setValues=function(a,b,c,d,e){var f=this;f.visible=a==null?true:!!a;f.alpha=b==null?1:b;f.shadow=c;f.compositeOperation=d;f.matrix=e||(f.matrix&&f.matrix.identity())||new kisgame.Matrix2D();return f};$.append=function(a,b,c,d,e){var f=this;f.alpha*=b;f.shadow=c||f.shadow;f.compositeOperation=d||f.compositeOperation;f.visible=f.visible&&a;e&&f.matrix.appendMatrix(e);return f};$.prepend=function(a,b,c,d,e){var f=this;f.alpha*=b;f.shadow=f.shadow||c;f.compositeOperation=f.compositeOperation||d;f.visible=f.visible&&a;e&&f.matrix.prependMatrix(e);return f};$.identity=function(){var a=this;a.visible=true;a.alpha=1;a.shadow=a.compositeOperation=null;a.matrix.identity();return a};$.clone=function(){var a=this;return new _(a.alpha,a.shadow,a.compositeOperation,a.visible,a.matrix.clone())};kisgame.DisplayProps=_}());(function(){"use strict";var _=kisgame.DirectionType;function $(){var d=this;d.EventDispatcher_constructor();d.cacheImage=null;d.cacheID=0;d.id=kisgame.UID.get();d.mouseEnabled=true;d.tickEnabled=true;d.name=null;d.regX=0;d.regY=0;d.skewX=0;d.skewY=0;d.shadow=null;d.visible=true;d.x=0;d.y=0;d.parent=null;d.rotation=0;d.scaleX=1;d.scaleY=1;d.alpha=1;d.transformMatrix=null;d.compositeOperation=null;d.snapToPixel=true;d.filters=null;d.mask=null;d.hitArea=null;d.cursor=null;d._cacheOffsetX=0;d._cacheOffsetY=0;d._filterOffsetX=0;d._filterOffsetY=0;d._cacheScale=1;d._cacheDataURLID=0;d._cacheDataURL=null;d._props=new kisgame.DisplayProps();d._rectangle=new kisgame.Rectangle();d._bounds=null}var a=kisgame.extend($,kisgame.EventDispatcher);$._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"];$.suppressCrossDomainErrors=false;$._snapToPixelEnabled=false;$._dragtable=new Array();var c=document.createElement("canvas");$._hitTestCanvas=c;$._hitTestContext=c.getContext("2d");c.width=c.height=1;$._nextCacheID=1;a._setRefObj=function(d){var e=this;e.stage=d?d.stage:null;e.root=d?d.root:null};if(kisgame.enableDirty){Object.defineProperties(a,{parent:{get:function(){var d=this;return d.kis_parent},set:function(d){var e=this;if(e.kis_parent!=d){e.invaliate();e.kis_parent=d}}},visible:{get:function(){var d=this;return d.kis_visible},set:function(d){var e=this;if(e.kis_visible!=d){e.invaliate();e.kis_visible=d}}},alpha:{get:function(){var d=this;return d.kis_alpha},set:function(d){var e=this;if(e.kis_alpha!=d){e.invaliate();e.kis_alpha=d}}},rotation:{get:function(){var d=this;return d.kis_rotation},set:function(d){var e=this;if(e.kis_rotation!=d){e.invaliate();e.kis_rotation=d}}},x:{get:function(){var d=this;return d.kis_x},set:function(d){var e=this;if(e.kis_x!=d){e.invaliate();e.kis_x=d}}},y:{get:function(){var d=this;return d.kis_y},set:function(d){var e=this;if(e.kis_y!=d){e.invaliate();e.kis_y=d}}},scaleX:{get:function(){var d=this;return d.kis_scaleX},set:function(d){var e=this;if(e.kis_scaleX!=d){e.invaliate();e.kis_scaleX=d}}},scaleY:{get:function(){var d=this;return d.kis_scaleY},set:function(d){var e=this;if(e.kis_scaleY!=d){e.invaliate();e.kis_scaleY=d}}},skewX:{get:function(){var d=this;return d.kis_skewX},set:function(d){var e=this;if(e.kis_skewX!=d){e.invaliate();e.kis_skewX=d}}},skewY:{get:function(){var d=this;return d.kis_skewY},set:function(d){var e=this;if(e.kis_skewY!=d){e.invaliate();e.kis_skewY=d}}}})}a.isVisible=function(){var d=this;if(d.destoryed)return false;var e=d.scrollRect;if(e&&(e.width<=0||e.height<=0)){return false}return !!(d.visible&&d.alpha>0&&d.scaleX!=0&&d.scaleY!=0)};a.draw=function(d,e){var g=this;var f=g.cacheImage;if(e||!f){return false}var h=g._cacheScale;if(f.width&&f.complete){d.drawImage(f,g._cacheOffsetX+g._filterOffsetX,g._cacheOffsetY+g._filterOffsetY,f.width/h,f.height/h)}return true};a.updateContext=function(d){var f=this;var e=f.scrollRect;var g=f,h=g.mask,i=g._props.matrix;if(h&&h.graphics&&!h.graphics.isEmpty()){h.getMatrix(i);d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);h.graphics.drawAsPath(d);d.clip();i.invert();d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}f.getMatrix(i);if(e){var j=i.tx,k=i.ty;if(kisgame.DisplayObject._snapToPixelEnabled&&g.snapToPixel){j=j+(j<0?-0.5:0.5)|0;k=k+(k<0?-0.5:0.5)|0;i.tx=j;i.ty=k}d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);d.beginPath();d.rect(0,0,e.width,e.height);d.clip();i.invert();d.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}f.getMatrix(i);if(e){i.translate(-e.x,-e.y)}var j=i.tx,k=i.ty;if(kisgame.DisplayObject._snapToPixelEnabled&&g.snapToPixel){j=j+(j<0?-0.5:0.5)|0;k=k+(k<0?-0.5:0.5)|0}d.transform(i.a,i.b,i.c,i.d,j,k);d.globalAlpha*=g.alpha;if(g.compositeOperation){d.globalCompositeOperation=g.compositeOperation}if(g.shadow){f._applyShadow(d,g.shadow)}};a.cache=function(d,e,f,g,h){var i=this;h=h||1;i._cacheWidth=f;i._cacheHeight=g;i._cacheOffsetX=d;i._cacheOffsetY=e;i._cacheScale=h;i.updateCache()};a.updateCache=function(d){var g=this;var e=kisgame.cacheCanvas;var f=g._cacheScale,h=g._cacheOffsetX*f,i=g._cacheOffsetY*f;var j=g._cacheWidth,k=g._cacheHeight,l=e.getContext("2d");var m=g._getFilterBounds();h+=(g._filterOffsetX=m.x);i+=(g._filterOffsetY=m.y);j=Math.ceil(j*f)+m.width;k=Math.ceil(k*f)+m.height;if(j!=e.width||k!=e.height){e.width=j;e.height=k}l.clearRect(0,0,j+1,k+1);if(d){var n=g.cacheImage;if(n){l.drawImage(n,0,0)}}l.save();l.globalCompositeOperation=d;l.setTransform(f,0,0,f,-h,-i);g.draw(l,true);g._applyFilters(l,j,k);l.restore();var n=g.cacheImage;if(!n){n=g.cacheImage=new Image()}n.updateTextureOnce=true;n.width=j;n.height=k;n.src=e.toDataURL();g.cacheID=$._nextCacheID++};a.uncache=function(){var d=this;if(d.cacheImage){var e=d.cacheImage.__webgl_texture;if(e){e._sourceImage=null;d.cacheImage.__webgl_texture=null;e._webGLContext.deleteTexture(e);e._webGLContext=null}}d._cacheDataURL=d.cacheImage=null;d.cacheID=d._cacheOffsetX=d._cacheOffsetY=d._filterOffsetX=d._filterOffsetY=0;d._cacheScale=1};a.getCacheDataURL=function(){var d=this;if(!d.cacheImage){return null}if(d.cacheID!=d._cacheDataURLID){d._cacheDataURL=d.cacheImage.src}return d._cacheDataURL};a.localToGlobal=function(d,e,f,g){var i=this;var h=i.getConcatenatedMatrix();if(g){var j=[];var k=g.length;for(var l=0;l<k;l++){var m=g[l];j.push(h.transformPoint(m.x,m.y))}return j}else{return h.transformPoint(d,e,f||new kisgame.Point())}};a.globalToLocal=function(d,e,f,g){var i=this;var h=i.getConcatenatedMatrix().invert();if(g){var j=[];var k=g.length;for(var l=0;l<k;l++){var m=g[l];j.push(h.transformPoint(m.x,m.y))}return j}else{return h.transformPoint(d,e,f||new kisgame.Point())}};a.local2Target=function(d,e,f){var h=this;if(f){var g=h.getConcatenatedMatrix();var i=d.getConcatenatedMatrix().invert();g.prependMatrix(i);var j=[];var k=f.length;for(var l=0;l<k;l++){var m=f[l];j.push(g.transformPoint(m.x,m.y))}return j}else{if(!e){e={x:0,y:0}}var n=h.localToGlobal(e.x,e.y,e);return d.globalToLocal(n.x,n.y,e)}};a.localToLocal=function(d,e,f,g){var h=this;g=h.localToGlobal(d,e,g);return f.globalToLocal(g.x,g.y,g)};a.roundRegTransform=function(d,e,f,g,h,i){var k=this;var j=k,l=d&&d.identity()||new kisgame.Matrix2D();j.transformMatrix?l.copy(j.transformMatrix):l.appendTransform(j.x,j.y,j.scaleX,j.scaleY,j.rotation,j.skewX,j.skewY,h,i);l.rotate(g);l.scale(e,f);return m};a.setTransform=function(d,e,f,g,h,i,j,k,l){var m=this;m.x=d||0;m.y=e||0;m.scaleX=f==null?1:f;m.scaleY=g==null?1:g;m.rotation=h||0;m.skewX=i||0;m.skewY=j||0;m.regX=k||0;m.regY=l||0;return m};a.getMatrix=function(d){var f=this;var e=f,g=d&&d.identity()||new kisgame.Matrix2D();return e.transformMatrix?g.copy(e.transformMatrix):g.appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY)};a.getConcatenatedMatrix=function(d,e){var g=this;var f=g,h=g.getMatrix(d);var i=f.scrollRect;if(i){h.translate(-i.x,-i.y)}if(e){h=e.clone().prependMatrix(h)}while(f=f.parent){var i=f.scrollRect;if(i){h.translate(-i.x,-i.y)}h.prependMatrix(f.getMatrix(f._props.matrix))}return h};a.getConcatenatedDisplayProps=function(d){var f=this;d=d?d.identity():new kisgame.DisplayProps();var e=f,g=e.getMatrix(d.matrix);do{d.prepend(e.visible,e.alpha,e.shadow,e.compositeOperation);var h=e.scrollRect;if(h){g.translate(-h.x,-h.y)}if(e!=f){g.prependMatrix(e.getMatrix(e._props.matrix))}}while(e=e.parent);return d};a.hitTest=function(d,e){var g=this;var f=$._hitTestContext;f.setTransform(1,0,0,1,0,0);f.clearRect(0,0,2,2);f.setTransform(1,0,0,1,-d,-e);g.draw(f);var h=g._testHit(f);return h};a._hitTestSelf=function(d,e,f){var h=this;var g=h.hitArea;var i=h.getConcatenatedDisplayProps(h._props);var j=i.matrix;if(g){j.appendMatrix(g.getMatrix(g._props.matrix));i.alpha=g.alpha}d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,2,2);d.globalAlpha=i.alpha;d.setTransform(j.a,j.b,j.c,j.d,j.tx-e,j.ty-f);(g||h).draw(d);if(!h._testHit(d)){return false}return true};a.hitTestPoint=function(a,d){var e=this;if(d){return e.hitTest(a.x,a.y)}else{var f=e.hitAreaRectangle||e.getBounds();if(f.isFull){return true}else{var a=e.globalToLocal(a.x,a.y,a);if(f.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>f.radius){return false}else if(a.x<f.x||a.y<f.y||a.x>f.x+f.width||a.y>f.y+f.height){return false}}}return true};a.hitTestObject=function(d){var h=this;var e=d.hitAreaRectangle||d.getBounds();var f=d.localToGlobal(0,0,null,[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]);var g=h.hitAreaRectangle||h.getBounds();var i=h.localToGlobal(0,0,null,[{x:g.x,y:g.y},{x:g.x+g.width,y:g.y},{x:g.x+g.width,y:g.y+g.height},{x:g.x,y:g.y+g.height}]);f.push(f[0]);i.push(i[0]);return HitTestUtils.hitTestPoints(f,i,true)};a.set=function(d){var f=this;for(var e in d){f[e]=d[e]}return f};a.getBounds=function(d,e,f){var g=this;if(g._bounds){return g._rectangle.copy(g._bounds)}var h=g.cacheImage;if(h){var i=g._cacheScale;return g._rectangle.setValues(g._cacheOffsetX,g._cacheOffsetY,h.width/i,h.height/i)}return null};a.getBorderBounds=function(d){var e=this;return e.getBounds(d,true,true)};a.getSizeBounds=function(d){var e=this;return e.getBounds(d,true,false)};a.setBounds=function(d,e,f,g){var h=this;if(d==null){h._bounds=d}h._bounds=(h._bounds||new kisgame.Rectangle()).setValues(d,e,f,g)};a.clone=function(){var d=this;return d._cloneProps(new $())};a.toString=function(){var d=this;return "[DisplayObject (name="+d.name+")]"};a._cloneProps=function(d){var e=this;d.alpha=e.alpha;d.mouseEnabled=e.mouseEnabled;d.tickEnabled=e.tickEnabled;d.name=e.name;d.regX=e.regX;d.regY=e.regY;d.rotation=e.rotation;d.scaleX=e.scaleX;d.scaleY=e.scaleY;d.shadow=e.shadow;d.skewX=e.skewX;d.skewY=e.skewY;d.visible=e.visible;d.x=e.x;d.y=e.y;d.compositeOperation=e.compositeOperation;d.snapToPixel=e.snapToPixel;d.filters=e.filters==null?null:e.filters.slice(0);d.mask=e.mask;d.hitArea=e.hitArea;d.cursor=e.cursor;d._bounds=e._bounds;return d};a._applyShadow=function(d,e){e=e||Shadow.identity;d.shadowColor=e.color;d.shadowOffsetX=e.offsetX;d.shadowOffsetY=e.offsetY;d.shadowBlur=e.blur};a._tick=function(d){var f=this;var e=f._listeners;if(e&&e["tick"]){d.target=null;d.propagationStopped=d.immediatePropagationStopped=false;f.dispatchEvent(d)}};a._testHit=function(d){try{var e=d.getImageData(0,0,1,1).data[3]>1}catch(e){if(!$.suppressCrossDomainErrors){throw "An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}}return e};a._applyFilters=function(d,e,f){var g=this;if(!d)return;if(!g.filters||g.filters.length==0){return}var h=g.filters.length;for(var i=0;i<h;i++){g.filters[i].applyFilter(d,0,0,e,f)}};a._getFilterBounds=function(d){var g=this;var e,f=g.filters,h=g._rectangle.setValues(0,0,0,0);if(!f||!(e=f.length)){return h}for(var i=0;i<e;i++){var j=g.filters[i];j.getBounds&&j.getBounds(h)}return h};a._getBounds=function(d,e,f){var h=this;var g=h.getBounds();return h._transformBounds(g?g.clone():null,d,e)};a._transformBounds=function(d,e,f){var l=this;if(!d){return d}var g=d.x,h=d.y,i=d.width,j=d.height,k=l._props.matrix;k=f?k.identity():l.getMatrix(k);if(g||h){k.appendTransform(0,0,1,1,0,0,0,-g,-h)}if(e){k.prependMatrix(e)}var m=i*k.a,n=i*k.b;var o=j*k.c,p=j*k.d;var q=k.tx,r=k.ty;var s=q,u=q,v=r,w=r;if((g=m+q)<s){s=g}else if(g>u){u=g}if((g=m+o+q)<s){s=g}else if(g>u){u=g}if((g=o+q)<s){s=g}else if(g>u){u=g}if((h=n+r)<v){v=h}else if(h>w){w=h}if((h=n+p+r)<v){v=h}else if(h>w){w=h}if((h=p+r)<v){v=h}else if(h>w){w=h}return d.setValues(s,v,u-s,w-v)};a._hasMouseEventListener=function(){var g=this;var d=$._MOUSE_EVENTS;for(var e=0,f=d.length;e<f;e++){if(g.hasEventListener(d[e])){return true}}return !!g.cursor};a.removeSelf=function(){var d=this;if(d.parent)d.parent.removeChild(d)};a.initRRect=function(d,e,f){var g=this;if(!d){if(g.parent){if(!isNaN(g.parent._width)&&!isNaN(g.parent._height)){d=new kisgame.Rectangle(g.parent.x,g.parent.y,g.parent._width,g.parent._height)}else{d=g.parent.getBounds()}}}var h=e;if(!h){h=g.getBounds(g.parent);h.width+=h.x-g.x;h.height+=h.y-g.y}if(d){if(h){g.bottom=d.height-g.y-h.height;g.right=d.width-g.x-h.width}}g.left=g.x;g.top=g.y;if(h){g.oriWidth=g._width=g.width=h.width;g.oriHeight=g._height=g.height=h.height}};a.alignSize=function(d,e,f,g,h){var k=this;var i=NaN;var j=NaN;if((f&_.CENTER)>0){i=(d-k._width)/2}else if((f&_.RIGHT)>0){i=d-k.right-k._width}if((f&_.MIDDLE)>0){j=(e-k._height)/2}else if((f&_.BOTTOM)>0){j=e-k.bottom-k._height}if(!isNaN(i)||!isNaN(j)){if(h){h.x=i;h.y=j}else{k.move(i,j)}}var l=NaN;var m=NaN;if((f&_.HORIZONTAL)>0){l=d-k.left-k.right}if((f&_.VERTICAL)>0){m=e-k.bottom-k.top}if(!isNaN(l)||!isNaN(m)){if(h){h.width=l;h.height=m}else{k.setSize(l,m,g)}}};a.alignTarget=function(d,e,f){var i=this;var g=NaN;var h=NaN;if((e&_.LEFT)>0){g=d._x+d._width+i.left-d.left-d.oriWidth}else if((e&_.RIGHT)>0){g=d._x+i.left-d.left}if((e&_.TOP)>0){h=d._y+d._height+i.top-d.top-d.oriHeight}else if((e&_.BOTTOM)>0){h=d._y+i.top-d.top}if((e&_.OFFSET_X)>0){g=d._x+i.left-d.left}if((e&_.OFFSET_Y)>0){h=d._y+i.top-d.top}if(!isNaN(g)||!isNaN(h)){if(f){f.x=g;f.y=h}else{i.move(g,h)}}};a.invaliate=function(){var e=this;var d=e.stage;d&&!d.autoUpdate&&d.invaliate(e)};a.updateUI=function(){};a.setSize=function(d,e,f){var h=this;var g;if(!isNaN(d)){h.width=d;h._width=d;if(f){var i=h.oriWidth;if(i==undefined){g=h.getBounds();i=g.width}h.scaleX=d/i}}if(!isNaN(e)){h.height=e;h._height=e;if(f){var j=h.oriHeight;if(j==undefined){g=g||h.getBounds();j=g.height}h.scaleY=e/j}}};a.move=function(d,e){var f=this;if(!isNaN(d)){f.x=d;f._x=d}if(!isNaN(e)){f.y=e;f._y=e}};a.startDrag=function(d,e,f,g){var i=this;if(typeof d==="undefined"){d=false}if(typeof e==="undefined"){e=null}if(typeof f==="undefined"){f=null}var h=i.stage;var j=$._dragtable;var k=j.length;var l=null;for(var m=0;m<k;m++){var n=j[m];if(n[0]==i){l=n;break}}var o=i.parent.getConcatenatedMatrix().invert().clone();if(!l){l=new Array();l[0]=i;j.push(l);if(!d){var p=h.mouseX;var q=h.mouseY;if(g){p=g.stageX;q=g.stageY}var a=o.transformPoint(p,q,new kisgame.Point());l[3]=a;a.x-=i.x;a.y-=i.y}}l[1]=d;l[2]=e;l[4]=f;l[6]=o;l[7]=new kisgame.Point();l[8]={x:i.x,y:i.y};l[9]=g?g.pointerID:-1;h.on("stagemousemove",$._dragRectHandler,$,false)};$._dragRectHandler=function(d){var e=$._dragtable;var f=e.length;for(var g=0;g<f;g++){var h=e[g];var i=h[0];var j=h[1];var k=h[2];var l=h[4];var m=h[9];if(d.pointerID!=m){continue}var n;var o;var p=h[6];var q=h[7];var a=p.transformPoint(d.stageX,d.stageY,q);if(j){n=a.x;o=a.y}else{n=a.x-h[3].x;o=a.y-h[3].y}if(k){var r,t,rr,b;r=k.x;t=k.y;rr=k.x+k.width;b=k.y+k.height;if(n<r){n=r}else if(n>rr){n=rr}if(o<t){o=t}else if(o>b){o=b}}if(l){var s=l.scope||i;if(l.dragfun){var a=l.dragfun.apply(s,[n,o]);if(a){n=a.x;o=a.y}}if(!l.nomove){i.move(n,o)}if(!l.dragmoved&&(l.minmoveoft==0||kisgame.GeomUtils.get2PR(h[8].x,h[8].y,n,o)>(l.minmoveoft||4))){l.dragmoved=true}if(l.endfun){l.endfun.apply(s,[n,o])}}else{i.move(n,o)}}};a.isDragging=function(){var h=this;var d=$._dragtable;var e=d.length;for(var f=0;f<e;f++){var g=d[f];if(g&&g[0]==h){return true;break}}return false};a.stopDrag=function(){var h=this;var d=$._dragtable;var e=d.length;for(var f=0;f<e;f++){var g=d[f];if(g&&g[0]==h){d.splice(f,1);f--;e--}}if(d.length==0){var i=h.stage;i.off("stagemousemove",$._dragRectHandler,false,$)}};a.fixPosSize=function(d,e,f){var i=this;var g={l:d.left,r:d.right,t:d.top,b:d.bottom};var h=KISU.percent;if(e>0){g.l=h(g.l,e);g.r=h(g.r,e)}if(f>0){g.t=h(g.t,f);g.b=h(g.b,f)}var a={x:i.x,y:i.y,w:i.width,h:i.height};if(!isNaN(g.l)&&!isNaN(g.r)){a.x=g.l;if(e>0){a.w=e-g.r-g.l}else{a.w=-1}}else{if(!isNaN(g.l)){a.x=g.l}else if(!isNaN(g.r)){if(e>0){a.x=e-i.width-g.r}else{a.x=0}}}if(!isNaN(g.t)&&!isNaN(g.b)){a.y=g.t;if(f>0){a.h=f-g.b-g.t}else{a.h=-1}}else{if(!isNaN(g.t)){a.y=g.t}else if(!isNaN(g.b)){if(f>0){a.y=f-i.height-g.b}else{a.y=0}}}return a};a.destory=function(){var d=this;d.removeAllEventListeners();d.uncache();if(d.parent){d.parent.removeChild(d)}d.destoryed=true};a.local2TargetRect=function(d,e){var g=this;e=e.clone();var f=g.local2Target(d,null,[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]);var h=f[0].x,i=f[0].y;var j=h,k=i;var l=f.length;for(var m=1;m<l;m++){var a=f[m];if(a.x<h){h=a.x}if(a.x>j){j=a.x}if(a.y<i){i=a.y}if(a.y>k){k=a.y}}e.setValues(h,i,j-h,k-i);return e};a.setHitTestRect=function(d){var e=this;e.hitAreaRectangle=(d==null?null:(d||e.getBounds().clone()))};a.setProData=function(d){var e=this;e.i_pro_data=d};a.getProData=function(d){var e=this;var a;if(e.i_pro_data){a=e.i_pro_data}else if(e.root&&e.root.i_pro_data){a=e.root.i_pro_data}return a};a.getRPath=function(d,e){var f=this;var a;if(f.i_pro_data){a=f.i_pro_data}else if(f.root&&f.root.i_pro_data){a=f.root.i_pro_data}if(a){if(d.charAt(0)=="#"){if(e==1){return a.sFolder+d.substr(1)}else if(e==2){return a.folder+d.substr(1)}else{return a.rFolder+d.substr(1)}}}return d};kisgame.cacheCanvas=document.createElement("canvas");kisgame.DisplayObject=kisgame.promote($,"EventDispatcher")}());(function(){"use strict";var _=kisgame.DirectionType;function $(){var b=this;b.DisplayObject_constructor();b.children=[];b.mouseChildren=true;b.isContainer=true;b.tickChildren=true}var a=kisgame.extend($,kisgame.DisplayObject);a.getNumChildren=function(){var b=this;return b.children.length};try{Object.defineProperties(a,{numChildren:{get:a.getNumChildren}})}catch(e){}a.initialize=$;a.isVisible=function(){var b=this;if(b.destoryed)return false;var c=b.scrollRect;if(c&&(c.width<=0||c.height<=0)){return false}var d=b.cacheImage||b.children.length;return !!(b.visible&&b.alpha>0&&b.scaleX!=0&&b.scaleY!=0&&d)};a.draw=function(b,c){var d=this;if(d.DisplayObject_draw(b,c)){return true}var e=d.children.slice();for(var f=0,g=e.length;f<g;f++){var h=e[f];if(!h.isVisible()){continue}b.save();h.updateContext(b);h.draw(b);b.restore()}return true};a.addChild=function(b){var e=this;if(b==null){return b}var c=arguments.length;if(c>1){for(var d=0;d<c;d++){e.addChild(arguments[d])}return arguments[c-1]}if(b.parent){b.parent.removeChild(b)}b.parent=e;b._setRefObj(e);e.children.push(b);b.dispatchEvent("added");return b};a._setRefObj=function(b){var e=this;var c=b?b.stage:null;var d=b?b.root:null;e.stage=c;e.root=d;var f=e.children;if(!f)return;var g=f.length;for(var h=0;h<g;h++){var i=f[h];if(i._setRefObj){i._setRefObj(b)}else{i.stage=c;i.root=d}}};a.addChildAt=function(b,c){var f=this;var d=arguments.length;var e=arguments[d-1];if(e<0||e>f.children.length){return arguments[d-2]}if(d>2){for(var g=0;g<d-1;g++){f.addChildAt(arguments[g],e+g)}return arguments[d-2]}if(b.parent){b.parent.removeChild(b)}b.parent=f;if(!b._setRefObj)trace(b,b.MCTarget.type);b._setRefObj(f);f.children.splice(c,0,b);b.dispatchEvent("added");return b};a.removeChild=function(b){var f=this;var c=arguments.length;if(c>1){var d=true;for(var e=0;e<c;e++){d=d&&f.removeChild(arguments[e])}return d}return f.removeChildAt(f.children.indexOf(b))};a.removeChildAt=function(b){var g=this;var c=arguments.length;if(c>1){var d=[];for(var e=0;e<c;e++){d[e]=arguments[e]}d.sort(function(d,i){return i-d});var f=true;for(var e=0;e<c;e++){f=f&&g.removeChildAt(d[e])}return f}if(b<0||b>g.children.length-1){return false}var h=g.children[b];if(h){h.parent=null;h._setRefObj(null)}g.children.splice(b,1);h.dispatchEvent("removed");return true};a.removeAllChildren=function(){var b=this;b.invaliate();var c=b.children;while(c.length){b.removeChildAt(0)}};a.getChildAt=function(b){var c=this;return c.children[b]};a.getChildByName=function(b){var d=this;var c=d.children;for(var e=0,f=c.length;e<f;e++){if(c[e].name==b){return c[e]}}return null};a.sortChildren=function(b){var c=this;c.invaliate();c.children.sort(b)};a.getChildIndex=function(b){var c=this;return c.children.indexOf(b)};a.swapChildrenAt=function(b,c){var e=this;var d=e.children;var f=d[b];var g=d[c];if(!f||!g){return}g.invaliate();f.invaliate();d[b]=g;d[c]=f};a.swapChildren=function(b,c){var e=this;b.invaliate();c.invaliate();var d=e.children;var f,index2;for(var g=0,h=d.length;g<h;g++){if(d[g]==b){f=g}if(d[g]==c){index2=g}if(f!=null&&index2!=null){break}}if(g==h){return}d[f]=c;d[index2]=b};a.setChildIndex=function(b,c){var e=this;b.invaliate();var d=e.children,f=d.length;if(b.parent!=e||c<0||c>=f){return}for(var g=0;g<f;g++){if(d[g]==b){break}}if(g==f||g==c){return}d.splice(g,1);d.splice(c,0,b)};a.contains=function(b){var c=this;while(b){if(b==c){return true}b=b.parent}return false};a.hitTest=function(b,c){var d=this;return (d.getObjectUnderPoint(b,c)!=null)};a.getObjectsUnderPoint=function(b,c,d){var g=this;var e=[];var f=g.localToGlobal(b,c);g._getObjectsUnderPoint(f.x,f.y,e,d>0,d==1);return e};a.getObjectUnderPoint=function(b,c,d){var f=this;var e=f.localToGlobal(b,c);return f._getObjectsUnderPoint(e.x,e.y,null,d>0,d==1)};a.clone=function(b){var d=this;var c=d._cloneProps(new $());if(b){d._cloneChildren(c)}return c};a.toString=function(){var b=this;return "[Container (name="+b.name+")]"};a._tick=function(b){var c=this;if(c.tickChildren){for(var d=c.children.length-1;d>=0;d--){var e=c.children[d];if(e.tickEnabled&&e._tick){e._tick(b)}}}c.DisplayObject__tick(b)};a._cloneChildren=function(b){var f=this;if(b.children.length){b.removeAllChildren()}var c=b.children;for(var d=0,e=f.children.length;d<e;d++){var g=f.children[d].clone(true);g.parent=b;g.stage=b.stage;c.push(g)}};a._getObjectsUnderPoint=function(b,c,d,e,f,g){var h=this;g=g||0;if(!g&&!h._testMask(h,b,c)){return null}f=f||(e&&h._hasMouseEventListener());var i=kisgame.DisplayObject._hitTestContext;var j=h.children,k=j.length;for(var l=k-1;l>=0;l--){var m=j[l];var n=m.hitArea;var o=m.hitAreaRectangle;if(!m.visible||(!n&&!o&&!m.isVisible())||(e&&(!m.mouseEnabled||(m.mouseIgnoreSelf&&!m.mouseChildren)))){continue}if(!n&&!o&&!h._testMask(m,b,c)){continue}if((m.mouseIgnoreSelf||!n&&(!o||o.isBottom))&&m.isContainer){var p=m._getObjectsUnderPoint(b,c,d,e,f,g+1);if(!p&&o&&o.isBottom&&!m.mouseIgnoreSelf){if(o.isFull){}else{var a=m.globalToLocal(b,c);if(o.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>o.radius){continue}else if(a.x<o.x||a.y<o.y||a.x>o.x+o.width||a.y>o.y+o.height){continue}}if(d){d.push(m)}else{return (e&&!h.mouseChildren)?h:m}}else if(!d&&p){return (e&&!h.mouseChildren)?h:p}}else{if(e&&!f&&!m._hasMouseEventListener()){continue}if(o){if(o.isFull){}else{var a=m.globalToLocal(b,c);if(o.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>o.radius){continue}else if(a.x<o.x||a.y<o.y||a.x>o.x+o.width||a.y>o.y+o.height){continue}}}else{if(!m._hitTestSelf(i,b,c)){continue}}if(d){d.push(m)}else{return (e&&!h.mouseChildren)?h:m}}}return null};a._testMask=function(b,c,d){var g=this;var e=b.scrollRect;if(e){var f=g._props.matrix,h=b.parent;f=h?h.getConcatenatedMatrix(f):f.identity();f=b.getMatrix(b._props.matrix).prependMatrix(f);var i=kisgame.DisplayObject._hitTestContext;i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,2,2);i.setTransform(f.a,f.b,f.c,f.d,f.tx-c,f.ty-d);i.beginPath();i.rect(0,0,e.width,e.height);i.fillStyle="#000";i.fill();if(!g._testHit(i)){return false}return true}var j=b.mask;if(!j||!j.graphics||j.graphics.isEmpty()){return true}var f=g._props.matrix,h=b.parent;f=h?h.getConcatenatedMatrix(f):f.identity();f=j.getMatrix(j._props.matrix).prependMatrix(f);var i=kisgame.DisplayObject._hitTestContext;i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,2,2);i.setTransform(f.a,f.b,f.c,f.d,f.tx-c,f.ty-d);j.graphics.drawAsPath(i);i.fillStyle="#000";i.fill();if(!g._testHit(i)){return false}return true};a.initChildsRect=function(b){var c=this;if(!b){b=c.children}var d=b.length;for(var e=0;e<d;e++){var f=b[e];if(f){f.initRRect()}}};a.alignDirection=function(b,c,d,e){var f=this;if(isNaN(f._width)||isNaN(f._height)){var g=f.getBounds();if(g){f._width=g.width;f._height=g.height}}var h=NaN;var i=NaN;if((c&_.CENTER)>0){h=(f._width-b._width)/2}else if((c&_.RIGHT)>0){h=f._width-b.right-b._width}if((c&_.MIDDLE)>0){i=(f._height-b._height)/2}else if((c&_.BOTTOM)>0){i=f._height-b.bottom-b._height}if(!isNaN(h)||!isNaN(i)){if(e){if(!isNaN(h))e.x=h;if(!isNaN(i))e.y=i}else{b.move(h,i)}}var j=NaN;var k=NaN;if((c&_.HORIZONTAL)>0){j=f._width-b.left-b.right}if((c&_.VERTICAL)>0){k=f._height-b.bottom-b.top}if(!isNaN(j)||!isNaN(k)){if(e){e.width=j;e.height=k}else{b.setSize(j,k,d)}}};a.destory=function(b){var c=this;c.removeAllEventListeners();if(b){var d=c.children.slice(0);var e=d.length;for(var f=0;f<e;f++){d[f].destory(b)}d.splice(0)}c._kis_last_props=null;c.uncache();c.destoryed=true;if(c.parent){c.parent.removeChild(c)}};a.getBounds=function(b,c,d){var f=this;var e=f._getBounds(null,true,c,d);if(b&&e){return f.local2TargetRect(b,e)}return e};a._getBounds=function(b,c,d,e){var g=this;var f=g.DisplayObject_getBounds();if(f){return g._transformBounds(f,b,c)}var h=g._props.matrix;h=c?h.identity():g.getMatrix(h);if(b){h.prependMatrix(b)}var i=g.children.length,j=null;for(var k=0;k<i;k++){var l=g.children[k];if(!l.visible||!(f=l._getBounds(h,false,d,e))){continue}if(j){j.extend(f.x,f.y,f.width,f.height)}else{j=f.clone()}}return j};kisgame.Container=kisgame.promote($,"DisplayObject")}());(function(){"use strict";function _(a){var b=this;b.Container_constructor();b.stage=b;b.autoClear=true;b.canvas=(typeof a=="string")?document.getElementById(a):a;b.mouseX=0;b.mouseY=0;b.drawRect=null;b.snapToPixelEnabled=false;b.mouseInBounds=false;b.tickOnUpdate=true;b.mouseMoveOutside=false;b.preventSelection=true;b._pointerData={};b._pointerCount=0;b._primaryPointerID=null;b._mouseOverIntervalID=null;b.enableDOMEvents(true)}var $=kisgame.extend(_,kisgame.Container);$.update=function(a){var b=this;if(!b.canvas){return}if(b.tickOnUpdate){b.tick(a)}if(b.dispatchEvent("drawstart",false,true)===false){return}kisgame.DisplayObject._snapToPixelEnabled=b.snapToPixelEnabled;var c=b.drawRectArr,d=b.canvas.getContext("2d");d.setTransform(1,0,0,1,0,0);if(b.autoClear){if(c){var e=c.length;for(var f=0;f<e;f++){var g=c[f];d.clearRect(g.x,g.y,g.width,g.height)}}else{d.clearRect(0,0,b.canvas.width+1,b.canvas.height+1)}}d.save();if(c){d.beginPath();var e=c.length;for(var f=0;f<e;f++){var g=c[f];d.rect(g.x,g.y,g.width,g.height)}d.closePath();d.clip()}b.updateContext(d);b.draw(d,false);d.restore();b.dispatchEvent("drawend")};$.tick=function(a){var b=this;if(!b.tickEnabled||b.dispatchEvent("tickstart",false,true)===false){return}var c=new kisgame.Event("tick");if(a){for(var d in a){if(a.hasOwnProperty(d)){c[d]=a[d]}}}b._tick(c);b.dispatchEvent("tickend")};$.handleEvent=function(a){var b=this;if(a.type=="tick"){b.update(a)}};$.clear=function(){var a=this;if(!a.canvas){return}var b=a.canvas.getContext("2d");b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,a.canvas.width+1,a.canvas.height+1)};$.toDataURL=function(a,b){var e=this;var c,d=e.canvas.getContext('2d'),f=e.canvas.width,g=e.canvas.height;if(a){c=d.getImageData(0,0,f,g);var h=d.globalCompositeOperation;d.globalCompositeOperation="destination-over";d.fillStyle=a;d.fillRect(0,0,f,g)}var j=e.canvas.toDataURL(b||"image/png");if(a){d.putImageData(c,0,0);d.globalCompositeOperation=h}return j};$.enableMouseOver=function(a){var b=this;if(b._mouseOverIntervalID){clearInterval(b._mouseOverIntervalID);b._mouseOverIntervalID=null;if(a==0){b._testMouseOver(true)}}if(a==null){a=20}else if(a<=0){return}var c=b;b._mouseOverIntervalID=setInterval(function(){c._testMouseOver()},1000/Math.min(50,a))};$.enableDOMEvents=function(a){var d=this;if(a==null){a=true}var b,o,c=d._eventListeners;if(!a&&c){for(b in c){o=c[b];o.t.removeEventListener(b,o.f,false)}d._eventListeners=null}else if(a&&!c&&d.canvas){var e=window.addEventListener?window:document;var f=d;c=d._eventListeners={};c["mouseup"]={t:e,f:function(g){f._handleMouseUp(g)}};c["mousewheel"]={t:d.canvas,f:function(g){f._handleMouseWheel(g)}};c["mousemove"]={t:e,f:function(g){f._handleMouseMove(g)}};c["dblclick"]={t:d.canvas,f:function(g){f._handleDoubleClick(g)}};c["mousedown"]={t:d.canvas,f:function(g){f._handleMouseDown(g)}};for(b in c){o=c[b];o.t.addEventListener(b,o.f,false)}}};$.clone=function(){throw ("Stage cannot be cloned.")};$.toString=function(){var a=this;return "[Stage (name="+a.name+")]"};$._getElementRect=function(a){var b;try{b=a.getBoundingClientRect()}catch(err){b={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}}var c=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0);var d=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0);var e=window.getComputedStyle?getComputedStyle(a,null):a.currentStyle;var f=parseInt(e.paddingLeft)+parseInt(e.borderLeftWidth);var g=parseInt(e.paddingTop)+parseInt(e.borderTopWidth);var h=parseInt(e.paddingRight)+parseInt(e.borderRightWidth);var j=parseInt(e.paddingBottom)+parseInt(e.borderBottomWidth);return {left:b.left+c+f,right:b.right+c-h,top:b.top+d+g,bottom:b.bottom+d-j}};$._getPointerData=function(a){var c=this;var b=c._pointerData[a];if(!b){b=c._pointerData[a]={x:0,y:0}}return b};$._handleMouseMove=function(a){var b=this;if(!a){a=window.event}b._handlePointerMove(-1,a,a.pageX,a.pageY)};$._handlePointerMove=function(a,b,c,d,e){var f=this;if(!f.canvas){return}var g=f._getPointerData(a);var h=g.inBounds;f._updatePointerPosition(a,b,c,d);if(h||g.inBounds||f.mouseMoveOutside){if(a===-1&&g.inBounds==!h){f._dispatchMouseEvent(f,(h?"mouseleave":"mouseenter"),false,a,g,b)}f._dispatchMouseEvent(f,"stagemousemove",false,a,g,b);f._dispatchMouseEvent(g.target,"pressmove",true,a,g,b)}};$._updatePointerPosition=function(a,b,c,d){var f=this;var e=f._getElementRect(f.canvas);c-=e.left;d-=e.top;var g=f.canvas.width;var h=f.canvas.height;c/=(e.right-e.left)/g;d/=(e.bottom-e.top)/h;var j=f._getPointerData(a);if(j.inBounds=(c>=0&&d>=0&&c<=g-1&&d<=h-1)){j.x=c;j.y=d}else if(f.mouseMoveOutside){j.x=c<0?0:(c>g-1?g-1:c);j.y=d<0?0:(d>h-1?h-1:d)}j.posEvtObj=b;j.rawX=c;j.rawY=d;if(a===f._primaryPointerID||a===-1){f.mouseX=j.x;f.mouseY=j.y;f.mouseInBounds=j.inBounds}};$._handleMouseUp=function(a){var b=this;b._handlePointerUp(-1,a,false)};$._handleMouseWheel=function(a){var b=this;b._handlePointerWheel(-1,a,a.pageX,a.pageY)};$._handlePointerWheel=function(a,b,c,d,e){var f=this;if(f.preventSelection){b.preventDefault()}if(f._primaryPointerID==null||a===-1){f._primaryPointerID=a}if(d!=null){f._updatePointerPosition(a,b,c,d)}var g=null,h=f._getPointerData(a);if(!e){g=h.target=f._getObjectsUnderPoint(h.x,h.y,null,true)}if(g&&g.stage){var j=h.targetParentList;if(!j){j=h.targetParentList=[]}else{j.splice(0)}var k=g.parent;while(k&&k!=g.stage){j.push(k);k=k.parent}}var l;if(b.wheelDelta!=undefined){l=b.wheelDelta/120*3}else{var m=b.detail;if(m==3){m=-3}else{m=3}l=m}if(h.inBounds){f._dispatchMouseEvent(f,"stagemousewheel",false,a,h,b,g,l);h.down=true}f._dispatchMouseEvent(g,"mousewheel",true,a,h,b,g,l)};$._handlePointerUp=function(a,b,c,d){var f=this;var e=f._getPointerData(a);var g=null,h=e.target;if(!d&&h){g=f._getObjectsUnderPoint(e.x,e.y,null,true)}if(e.down){f._dispatchMouseEvent(f,"stagemouseup",false,a,e,b,g);e.down=false}if(g==h){f._dispatchMouseEvent(h,"click",true,a,e,b)}if(h&&!h.stage){h=null;var j=e.targetParentList;var k=j.length;for(var l=0;l<k;l++){var m=j[l];if(m.stage){h=m;break}}}e.targetParentList&&e.targetParentList.splice(0);f._dispatchMouseEvent(h,"pressup",true,a,e,b);f._dispatchMouseEvent(f,KISU.mu,true,a,e,b);if(c){if(a==f._primaryPointerID){f._primaryPointerID=null}delete (f._pointerData[a])}else{e.target=null}};$._handleMouseDown=function(a){var b=this;b._handlePointerDown(-1,a,a.pageX,a.pageY)};$._handlePointerDown=function(a,b,c,d,e){var f=this;if(f.preventSelection){b.preventDefault()}if(f._primaryPointerID==null||a===-1){f._primaryPointerID=a}if(d!=null){f._updatePointerPosition(a,b,c,d)}var g=null,h=f._getPointerData(a);if(!e){g=h.target=f._getObjectsUnderPoint(h.x,h.y,null,true)}if(g&&g.stage){var j=h.targetParentList;if(!j){j=h.targetParentList=[]}else{j.splice(0)}var k=g.parent;while(k&&k!=g.stage){j.push(k);k=k.parent}}if(h.inBounds){f._dispatchMouseEvent(f,"stagemousedown",false,a,h,b,g);h.down=true}f._dispatchMouseEvent(g,"mousedown",true,a,h,b)};$._testMouseOver=function(a,b,c){var d=this;if(!d._mouseOverIntervalID){return}var e=d._getPointerData(-1);if(!e||(!a&&d.mouseX==d._mouseOverX&&d.mouseY==d._mouseOverY&&d.mouseInBounds)){return}var f=e.posEvtObj;var g=c||f&&(f.target==d.canvas);var h=null,j=-1,k="",t,i,p;if(!b&&(a||d.mouseInBounds&&g)){h=d._getObjectsUnderPoint(d.mouseX,d.mouseY,null,true);d._mouseOverX=d.mouseX;d._mouseOverY=d.mouseY}var l=d._mouseOverTarget||[];var m=l[l.length-1];var n=d._mouseOverTarget=[];t=h;while(t){n.unshift(t);if(!k){k=t.cursor}t=t.parent}d.canvas.style.cursor=k;if(!b&&c){c.canvas.style.cursor=k}for(i=0,p=n.length;i<p;i++){if(n[i]!=l[i]){break}j=i}if(m!=h){d._dispatchMouseEvent(m,"mouseout",true,-1,e,f,h)}for(i=l.length-1;i>j;i--){d._dispatchMouseEvent(l[i],"rollout",false,-1,e,f,h)}for(i=n.length-1;i>j;i--){d._dispatchMouseEvent(n[i],"rollover",false,-1,e,f,m)}if(m!=h){d._dispatchMouseEvent(h,"mouseover",true,-1,e,f,m)}};$._handleDoubleClick=function(a,b){var e=this;var c=null,d=e._getPointerData(-1);if(!b){c=e._getObjectsUnderPoint(d.x,d.y,null,true);e._dispatchMouseEvent(c,"dblclick",true,-1,d,a)}};$._dispatchMouseEvent=function(a,b,c,d,e,f,g,h){var k=this;if(!a||(!c&&!a.hasEventListener(b))){return}var j=new kisgame.MouseEvent(b,c,false,e.x,e.y,f,d,d===k._primaryPointerID||d===-1,e.rawX,e.rawY,g,h);a.dispatchEvent(j)};kisgame.Stage=kisgame.promote(_,"Container")}());(function(){"use strict";function _(b,c,d){var e=this;e.DisplayObject_constructor();e.text=b;e.font=c;e.color=d;e.textAlign="left";e.textBaseline="top";e.maxWidth=null;e.outline=0;e.lineHeight=0;e.lineWidth=null}var $=kisgame.extend(_,kisgame.DisplayObject);var a=(kisgame.createCanvas?kisgame.createCanvas():document.createElement("canvas"));if(a.getContext){_._workingContext=a.getContext("2d");a.width=a.height=1}_.H_OFFSETS={start:0,left:0,center:-0.5,end:-1,right:-1};_.V_OFFSETS={top:0,hanging:-0.01,middle:-0.4,alphabetic:-0.8,ideographic:-0.85,bottom:-1};$.isVisible=function(){var c=this;var b=c.cacheImage||(c.text!=null&&c.text!=="");return !!(c.visible&&c.alpha>0&&c.scaleX!=0&&c.scaleY!=0&&b)};$.draw=function(b,c){var d=this;if(d.DisplayObject_draw(b,c)){return true}var e=d.color||"#000";if(d.outline){b.strokeStyle=e;b.lineWidth=d.outline*1}else{b.fillStyle=e}d._drawText(d._prepContext(b));return true};$.getMeasuredWidth=function(){var b=this;return b._getMeasuredWidth(b.text)};$.getMeasuredLineHeight=function(){var b=this;return b._getMeasuredWidth("M")*1.2};$.getMeasuredHeight=function(){var b=this;return b._drawText(null,{}).height};$.getBounds=function(){var c=this;var b=c.DisplayObject_getBounds();if(b){return b}if(c.text==null||c.text===""){return null}var d=c._drawText(null,{});var e=(c.maxWidth&&c.maxWidth<d.width)?c.maxWidth:d.width;var f=e*_.H_OFFSETS[c.textAlign||"left"];var g=c.lineHeight||c.getMeasuredLineHeight();var h=g*_.V_OFFSETS[c.textBaseline||"top"];return c._rectangle.setValues(f,h,e,d.height)};$.getMetrics=function(){var c=this;var b={lines:[]};b.lineHeight=c.lineHeight||c.getMeasuredLineHeight();b.vOffset=b.lineHeight*_.V_OFFSETS[c.textBaseline||"top"];return c._drawText(null,b,b.lines)};$.clone=function(){var b=this;return b._cloneProps(new _(b.text,b.font,b.color))};$.toString=function(){var b=this;return "[Text (text="+(b.text.length>20?b.text.substr(0,17)+"...":b.text)+")]"};$._cloneProps=function(b){var c=this;c.DisplayObject__cloneProps(b);b.textAlign=c.textAlign;b.textBaseline=c.textBaseline;b.maxWidth=c.maxWidth;b.outline=c.outline;b.lineHeight=c.lineHeight;b.lineWidth=c.lineWidth;return b};$._prepContext=function(b){var c=this;b.font=c.font||"10px sans-serif";b.textAlign=c.textAlign||"left";b.textBaseline=c.textBaseline||"top";return b};$._drawText=function(b,c,d){var f=this;var e=!!b;if(!e){b=_._workingContext;b.save();f._prepContext(b)}var g=f.lineHeight||f.getMeasuredLineHeight();var h=0,i=0;var j=String(f.text).split(/(?:\r\n|\r|\n)/);for(var k=0,l=j.length;k<l;k++){var m=j[k];var n=null;if(f.lineWidth!=null&&(n=b.measureText(m).width)>f.lineWidth){var o=m.split(/(\s)/);m=o[0];n=b.measureText(m).width;for(var p=1,q=o.length;p<q;p+=2){var r=b.measureText(o[p]+o[p+1]).width;if(n+r>f.lineWidth){if(e){f._drawTextLine(b,m,i*g)}if(d){d.push(m)}if(n>h){h=n}m=o[p+1];n=b.measureText(m).width;i++}else{m+=o[p]+o[p+1];n+=r}}}if(e){f._drawTextLine(b,m,i*g)}if(d){d.push(m)}if(c&&n==null){n=b.measureText(m).width}if(n>h){h=n}i++}if(c){c.width=h;c.height=i*g}if(!e){b.restore()}return c};$._drawTextLine=function(b,c,d){var e=this;if(e.outline){b.strokeText(c,0,d,e.maxWidth||0xFFFF)}else{b.fillText(c,0,d,e.maxWidth||0xFFFF)}};$._getMeasuredWidth=function(b){var e=this;var c=_._workingContext;c.save();var d=e._prepContext(c).measureText(b).width;c.restore();return d};kisgame.Text=kisgame.promote(_,"DisplayObject")}());this.kisgame=this.kisgame||{};(function(){function _(a){var c=this;var b=c;b._super(_.super_p.constructor);b.width=10;b.height=10;b.oriWidth=0;b.oriHeight=0;b.loaded=false;b.autoSize=true;b.sourceRect=null;if(typeof a=="string"){c.load(a)}else{c.image=a;c.updateImage()}}var $=KISU.extend(_,kisgame.DisplayObject);$.load=function(a){var b=this;b.url=a;if(a!=b.i_l_url){b.i_l_url=a;b.loaded=false;if(!a){b.image=null;b.invaliate()}else{var c=b.getRPath(a);b.image=kisgame.RManager.getImageResult(c,b,true);if(!b.image){b.addETL("fileload",b.onImageLoad,b);b.addETL("fileerror",b.onImageError,b)}else{b.updateImage();b.dispatchEvent(new KEvent("complete"))}}}};$.initialize=_;$.onImageLoad=function(a){var b=this;b.loaded=true;var c=a.src;if(b.getRPath(b.url)==c){b.image=kisgame.RManager.getImageResult(c,b);b.updateImage();b.dispatchEvent(new KEvent("complete"))}};$.onImageError=function(a){var b=this;b.loaded=true;var c=a.src;if(b.url==c){b.image=null;b.invaliate();b.dispatchEvent(new KEvent("error"))}};$.getScaleImageSize=function(a,b,c,d){var e=a/c;var f=b/d;var g=a/b;if(e>f){a=c;b=a/g}else{b=d;a=b*g}return {width:a,height:b}};$.setSize=function(a,b){var c=this;c.width=isNaN(a)?c.width:a;c.height=isNaN(b)?c.height:b;c.updateImage()};$.updateImage=function(){var b=this;var a=b.image;if(a){var c=b.width;var d=b.height;var e=b.sourceRect||a;if(b.autoSize=="scale"){var f=b.getScaleImageSize(e.width,e.height,c,d);c=b.width=f.width;d=b.height=f.height}else if(b.autoSize==true||b.autoSize=="true"){c=b.width=e.width;d=b.height=e.height}b.image_draw_w=c;b.image_draw_h=d}};$.getBounds=function(a,b,c){var e=this;var d=e._super(_.super_p.getBounds);if(!d){d=e._rectangle;d.setValues(0,0,e.width,e.height)}if(a){return e.local2TargetRect(a,d)}else{return d}};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c._super(_.super_p.draw,a,b)){return true}var d=c.image,e=c.sourceRect;if(d){if(e){var f=e.x,g=e.y,h=f+e.width,i=g+e.height,j=0,k=0,l=d.width,m=d.height;if(f<0){j-=f;f=0}if(h>l){h=l}if(g<0){k-=g;g=0}if(i>m){i=m}a.drawImage(d,f,g,h-f,i-g,j,k,c.image_draw_w,c.image_draw_h)}else{a.drawImage(d,0,0,d.width,d.height,0,0,c.image_draw_w,c.image_draw_h)}}};$.updateUI=function(){var a=this;a.load(a.url)};$.toString=function(){var a=this;return "[ImageView (name="+a.name+")]"};kisgame.ImageView=_}());this.kisgame=this.kisgame||{};(function(){var _=kisgame.DirectionType;function $(){var b=this;b.last_y=0;b.last_last_y=0;b.down_y=0;b.last_x=0;b.last_last_x=0;b.down_x=0;b.last_time=0;b.last_value=0;b.rate_scrol=1;b.maxValue=0;b.tValue=0;b.limitScrollValue=false;b.pageMode=true;b.pageIndex=0;b.pageMin=0;b.pageCell=0;b.pageMax=0;b.pageSize=1;b.vscrollTweenObj=new Object();b.vscrollTweenObj.velocity=0;b.hotDownMatrix}var a=$.prototype;a.valiateValue=function(b,c){var d=this;if(typeof c==="undefined"){c=false}if(d.limitScrollValue||c){if(b<0){b=0}else if(b>d.maxValue){b=d.maxValue}}return b};a.reset=function(){var b=this;b.pageIndex=0;b.setValue(0)};a.setParam=function(b,c,d,e,f){var g=this;g.container_mc=b;g.maxValue=c;g.direction=d;g.viewRect=e;g.pageMode=false;b.scrollRect=e;if(g.hot_mc&&g.hot_mc!=f){g.hot_mc.off("mousedown",g.onMouseDown,false,g)}g.hot_mc=f;g.hot_mc.on("mousedown",g.onMouseDown,g)};a.setParamPage=function(b,c,d,e,f,g,h,i,j){var k=this;if(typeof g==="undefined"){g=0}if(typeof h==="undefined"){h=0}if(typeof i==="undefined"){i=1}if(typeof j==="undefined"){j=0}k.pageCell=g||(d==_.HORIZONTAL?e.width:e.height);k.pageMax=h;k.pageSize=i;k.pageMin=j;k.setParam(b,c,d,e,f);k.pageMode=true};a.onMouseDown=function(b){var c=this;c.hotDownMatrix=c.hot_mc.parent.getConcatenatedMatrix().invert().clone();var d=c.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());if(c.direction==_.HORIZONTAL){var e=d.x;c.last_last_x=e;c.last_x=e;c.down_x=e}else{var f=d.y;c.last_last_y=f;c.last_y=f;c.down_y=f}c.stopScrollTween();c.last_time=getTimer();c.last_value=c.tValue;var g=c.vscrollTweenObj;g.endTValue=NaN;if(c.isOverflow()){c.container_mc.stage.on("pressmove",c.onStageMouseMove,c);c.container_mc.stage.on("pressup",c.onStageMouseUp,c);g.time=getTimer()}else{c.container_mc.stage.off("pressmove",c.onStageMouseMove,false,c);c.container_mc.stage.off("pressup",c.onStageMouseUp,false,c)}};a.isOverflow=function(){return true};a.setValue=function(b){var c=this;b=c.valiateValue(b);c.tValue=b;if(c.direction==_.HORIZONTAL){c.viewRect.x=c.getScrollLength()*b/c.maxValue}else{c.viewRect.y=c.getScrollLength()*b/c.maxValue}c.container_mc.scrollRect=c.viewRect;c.container_mc.dispatchEvent(new kisgame.Event("updateScroll"))};a.getScrollLength=function(){var d=this;var b;var c=d.maxValue;var e;if(d.direction==_.HORIZONTAL){e=d.viewRect.width;b=(c-e>0?c-e:e)}else{e=d.viewRect.height;b=(c-e>0?c-e:e)}return b};a.getValue=function(){var b=this;return b.tValue};a.getValiateValue=function(){var b=this;return b.valiateValue(b.tValue,true)};a.stopScrollTween=function(){var b=this;TweenMotion.killTweensOf(b.vscrollTweenObj)};a.onStageMouseMove=function(b){var d=this;var c=d.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());var e=d.vscrollTweenObj;var f=0;if(d.direction==_.HORIZONTAL){var g=c.x;f=g-d.last_x}else{var h=c.y;f=h-d.last_y}if(d.isOverflow()){var i=f>0?-1:1;if(e.sign!=i){e.velocity=0}e.tValue=d.tValue;e.sign=i;var j=d.tValue-f;e.endTValue=NaN;e.tValue=j;d.updateVScrollHandler2()}d.last_last_y=d.last_y;d.last_last_x=d.last_x;if(d.direction==_.HORIZONTAL){d.last_x=g}else{d.last_y=h}d.last_time=getTimer()};a.updateVScrollHandler3=function(){var b=this;b.vscrollTweenObj.endTValue=NaN;b.updateVScrollHandler2()};a.updateVScrollHandler2=function(){var b=this;b.setValue(b.vscrollTweenObj.tValue)};a.onStageMouseUp=function(b){var c=this;c.container_mc.stage.off("pressmove",c.onStageMouseMove,false,c);c.container_mc.stage.off("pressup",c.onStageMouseUp,false,c);if(c.pageMode){c.onPageMUP(b)}else{c.onUnPageMUP(b)}};a.removeMEvents=function(){var b=this;b.container_mc.stage.off("pressmove",b.onStageMouseMove,false,b);b.container_mc.stage.off("pressup",b.onStageMouseUp,false,b)};a.onUnPageMUP=function(b){var d=this;var c=d.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());var e=d.vscrollTweenObj;var f=d.tValue;var g=Math.abs(f-d.last_value)>0.05;var h=c.x-d.last_last_x;var i=c.y-d.last_last_y;var j=0;if(d.direction==_.HORIZONTAL){j=h}else{j=i}var k=Math.sqrt(h*h+i*i);var l=(getTimer()-e.time)/1000;var m=d.maxValue;if(d.isOverflow()&&g){if(l>0.5&&f<m&&f>0){e.velocity=0}if(l>0.4){l=0.9;e.velocity=0}if(d.getScrollLength()>m){e.velocity+=k*1.5}else if(f<m&&f>0){if(l<=0.5){e.velocity+=k*4*(1-l)}}else{e.velocity=1}if(e.velocity>100){e.velocity=100}e.sign=j>0?-1:1;e.damping=k*0.05;e.endTValue=NaN;TweenMotion.to(e,100,{overwrite:1,forceAdd:true,apply:d}).tick(d.updateVScrollHandler)}};a.onPageMUP=function(b){var d=this;var c=d.hotDownMatrix.transformPoint(b.stageX,b.stageY,new kisgame.Point());var e=d.vscrollTweenObj;var f=0;if(d.direction==_.HORIZONTAL){var g=c.x;f=g-d.down_x}else{var h=c.y;f=h-d.down_y}var i=(getTimer()-d.last_time)/1000;var j=f>0?-1:1;var k=Math.abs(d.tValue-d.last_value)>0.05;if((i<0.1&&k)||Math.abs(f)>d.pageCell*1/3){if(j>0){d.setPageIndex(d.pageIndex+d.pageSize)}else{d.setPageIndex(d.pageIndex-d.pageSize)}}else{d.setPageIndex(d.pageIndex)}e.velocity=0;e.damping=0;e.endTValue=NaN};a.updateVScrollHandler=function(){var c=this;var b=c.vscrollTweenObj;var d=c.maxValue;var e=false;if(b.velocity<=0.005){b.velocity=0;if(f>d||(c.getScrollLength()>d&&f>0)){c.setValue(d)}else if(f<0){c.setValue(0)}c.stopScrollTween()}else{var f=c.tValue+b.sign*b.velocity;var g=0;if(f>d){b.sign=-1;if(c.getScrollLength()>d){g=f}else{g=d-f}e=true}else if(f<0){e=true;b.sign=1;g=-f}else if(f>0&&(c.getScrollLength()>d)){b.sign=-1;g=f;e=true}if(e){b.velocity=Math.abs(g)*0.3;b.damping=Math.abs(g)*0.05}c.setValue(f);b.velocity-=b.damping;if(b.damping>1){b.damping*=0.05}}};a.easeCircOut=function(b,a,c,d){return c*Math.sqrt(1-(b=b/d-1)*b)+a};a.setPageIndex=function(b,c){var e=this;if(typeof c==="undefined"){c=false}var d=e.pageIndex;if(b<e.pageMin){d=e.pageMin}else if(b>e.pageMax){d=e.pageMax}else{d=b}e.pageIndex=d;var f=d*e.pageCell*e.maxValue/e.getScrollLength();if(Math.abs(f-e.tValue)>10&&!c){e.vscrollTweenObj.tValue=e.tValue;TweenMotion.to(e.vscrollTweenObj,0.5,{overwrite:1,tValue:f,ease:e.easeCircOut,apply:e}).tick(e.updateVScrollHandler4).call(e.updateVScrollHandler4)}else{if(c){e.stopScrollTween()}e.vscrollTweenObj.tValue=f;e.updateVScrollHandler4()}var g=new kisgame.Event("changepage",false,true);g.data=e.pageIndex;e.container_mc.dispatchEvent(g)};a.isScrolling=function(){var b=this;return TweenMotion.containTweens(b.vscrollTweenObj)};a.updateVScrollHandler4=function(){var b=this;b.setValue(b.vscrollTweenObj.tValue)};kisgame.TouchScrollHelper=$}());(function(){"use strict";function _(a,b){var c=this;c.setValues(a,b)}var $=_.prototype;$.setValues=function(a,b){var c=this;c.x=a||0;c.y=b||0;return c};$.copy=function(a){var b=this;b.x=a.x;b.y=a.y;return b};$.clone=function(){var a=this;return new _(a.x,a.y)};$.toString=function(){var a=this;return "[Point (x="+a.x+" y="+a.y+")]"};kisgame.Point=_}());(function(){"use strict";function _(a,b,c,d){var e=this;e.setValues(a,b,c,d)}var $=_.prototype;$.setValues=function(a,b,c,d){var e=this;e.x=a||0;e.y=b||0;e.width=c||0;e.height=d||0;return e};$.extend=function(a,b,c,d){var e=this;c=c||0;d=d||0;if(a+c>e.x+e.width){e.width=a+c-e.x}if(b+d>e.y+e.height){e.height=b+d-e.y}if(a<e.x){e.width+=e.x-a;e.x=a}if(b<e.y){e.height+=e.y-b;e.y=b}return e};$.pad=function(a,b,c,d){var e=this;e.x-=b;e.y-=a;e.width+=b+d;e.height+=a+c;return e};$.copy=function(a){var b=this;return b.setValues(a.x,a.y,a.width,a.height)};$.contains=function(a,b,c,d){var e=this;c=c||0;d=d||0;return (a>=e.x&&a+c<=e.x+e.width&&b>=e.y&&b+d<=e.y+e.height)};$.union=function(a){var b=this;return b.clone().extend(a.x,a.y,a.width,a.height)};$.intersection=function(a){var f=this;var b=a.x,c=a.y,d=b+a.width,e=c+a.height;if(f.x>b){b=f.x}if(f.y>c){c=f.y}if(f.x+f.width<d){d=f.x+f.width}if(f.y+f.height<e){e=f.y+f.height}return (d<=b||e<=c)?null:new _(b,c,d-b,e-c)};$.intersects=function(a){var b=this;return (a.x<=b.x+b.width&&b.x<=a.x+a.width&&a.y<=b.y+b.height&&b.y<=a.y+a.height)};$.isEmpty=function(){var a=this;return a.width<=0||a.height<=0};$.clone=function(){var a=this;return new _(a.x,a.y,a.width,a.height)};$.toString=function(){var a=this;return "[Rectangle (x="+a.x+" y="+a.y+" width="+a.width+" height="+a.height+")]"};$.mix=function(a,b,c,d,e){var j=this;var f=false;var g=a+c;var h=b+d;var i=j.x;var k=j.y;var l=j.x+j.width;var m=j.y+j.height;if(a<=l&&i<=g&&b<=m&&k<=h){f=true}else if(a>=i&&g<=l&&b>=k&&h<=m||i>=a&&l<=g&&k>=b&&m<=h){return true}else{if(Math.abs(i-g)<e&&Math.abs(k-h)<e||Math.abs(a-l)<e&&Math.abs(b-m)<e){f=true}}if(f){j.extend(a,b,c,d)}return f};$.ceil=function(){var a=this;a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.width=Math.ceil(a.width);a.height=Math.ceil(a.height)};$.equals=function(a){var b=this;return b.x==a.x&&b.y==a.y&&b.width==a.width&&b.height==a.height};kisgame.Rectangle=_}());(function(){"use strict";function _(a,b,c){var d=this;d.EventDispatcher_constructor();var $=d;$.paused=true;$.complete=false;$._taskLoadingList=[];$._tasklist=[];$._taskTaglist=[];$._tasktotallist=[];$.maxThread=2}var $=kisgame.extend(_,kisgame.EventDispatcher);_._totallist=[];$.getSize=function(){var a=this;return a._tasktotallist.length};$.reset=function(){var a=this;a._taskLoadingList.splice(0);trace("LoaderList reset");a._tasklist.splice(0);a._taskTaglist.splice(0);a._tasktotallist.splice(0);a.complete=false;a.paused=true};$.getItem=function(a){if(!a)return;var b=_._totallist;var c=b.length;for(var d=0;d<c;d++){var e=b[d];if(e.id==a||e.src==a||e.url==a){return e}}return null};$.getBlobUrl=function(a){var c=this;if(!a)return;var b=c.getItem(a);if(b){return b.bloburl}return null};$.getResult=function(a){var c=this;if(!a)return;var b=c.getItem(a);if(b&&b._loader&&b._loader._tag&&b._loader._tag.loaded){return b._loader._tag}return null};$.handleTagLoad=function(a){var b=a.currentTarget;var c=b.manager;b.removeEventListener("load",c.handleTagLoad);b.removeEventListener("error",c.handleTagError);var d=b.item;c._removeLoadingItem(d);var e=new kisgame.Event("fileload");e.item=d;e.result=b;b.manager=null;b.item=null;b.loaded=true;var f=c._taskTaglist.indexOf(d);if(f!=-1){c._taskTaglist.splice(f,1)}c.dispatchEvent(e);if(!c.paused){c._nextTaskLoop()}};$.handleTagError=function(a){var b=a.currentTarget;var c=b.manager;b.removeEventListener("load",c.handleTagLoad);b.removeEventListener("error",c.handleTagError);var d=b.item;c._removeLoadingItem(d);var e=new kisgame.Event("fileerror");e.item=d;b.manager=null;b.item=null;b.loaded=false;var f=c._taskTaglist.indexOf(d);if(f!=-1){c._taskTaglist.splice(f,1)}c.dispatchEvent(e);if(!c.paused){c._nextTaskLoop()}};$.handleFileLoad=function(a){var c=this;var b=c;var d=a.currentTarget;var e=d.item;if(!e)return;c._removeLoadingItem(e);d.item=null;var f=d.data;if(f){var g=URL.createObjectURL(f);var h=e._loader._tag;e.bloburl=g;if(h){b._addLoadingItem(e);h.manager=c;h.item=e;h.addEventListener("load",c.handleTagLoad);h.addEventListener("error",c.handleTagError);h.src=g;if(b._taskTaglist.indexOf(e)==-1)b._taskTaglist.push(e)}else{var i=new kisgame.Event("fileload");i.item=e;b.dispatchEvent(i);if(!b.paused){b._nextTaskLoop()}}return}};$.handleFileProgress=function(a){var c=this;var b=c;var d=a.currentTarget;var e=d.item;e.progress=a.loaded/a.total;var f=new kisgame.Event("progress");f.loaded=c._getProgress();f.total=c._tasktotallist.length;b.dispatchEvent(f)};$.handleFileError=function(a){var c=this;var b=c;var d=a.currentTarget;var e=d.item;b._removeLoadingItem(e);var f=new kisgame.Event("fileerror");f.item=e;if(!b.paused){b._nextTaskLoop()}};$.setPaused=function(a){var b=this;b.paused=a};$.loadFile=function(a,b,c){var f=this;if(b==undefined){b=true}if(typeof (a)=="string"){a={id:a,src:a}}var d=(a.basePath||c||"")+a.src;var e=f.getItem(a.id||a.src);if(e&&a.src==e.src){if(e.bloburl){return e}var g=f._tasklist.indexOf(e);if(g!=-1){f._tasklist.splice(g,1);f._tasklist.unshift(e)}}else{if(e){f._deleteItem(e)}var h=f._tasklist;var i={};for(var j in a){i[j]=a[j]}i.url=d;i.progress=0;if(c&&!i.basePath){i.basePath=c}if(!i.type){var k=[".png",".jpg","jpeg",".gif"];var l=[".mp3",".wav"];var m=d.substr(-4);if(k.indexOf(m)!=-1){i.type="image"}else if(l.indexOf(m)!=-1){i.type="sound"}}h.unshift(i);f._addItem(i)}if(b){f._nextTaskLoop()}};$._removeLoadingItem=function(a){var c=this;var b=c._taskLoadingList.indexOf(a);if(b!=-1){c._taskLoadingList.splice(b,1)}};$._addLoadingItem=function(a){var c=this;var b=c._taskLoadingList.indexOf(a);if(b!=-1){c._taskLoadingList.splice(b,1)}c._taskLoadingList.push(a)};$._addItem=function(a){var d=this;var b=_._totallist;var c=b.indexOf(a);if(c==-1){b.push(a);d._tasktotallist.push(a)}};$._deleteItem=function(a){var d=this;if(a._loader){a._loader._tag=null;a._loader.item=null}var b=_._totallist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._tasktotallist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._tasklist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._taskTaglist;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}var b=d._taskLoadingList;var c=b.indexOf(a);if(c!=-1){b.splice(c,1)}};$._getProgress=function(){var b=this;var a=b._tasktotallist;var c=a.length;var d=0;for(var e=0;e<c;e++){var f=a[e];d+=f.progress}return d};$.loadManifest=function(a,b,c){var f=this;if(b==undefined){b=true}if(typeof (a)=="string"){}else{var d=a.length;for(var e=d-1;e>=0;e--){f.loadFile(a[e],false,c)}if(b&&f.paused){f._nextTaskLoop()}}};$._prependItemTag=function(a){var c=this;var b=c;if(!a._loader){a._loader={};if(a.type=="image"){a._loader._tag=new Image()}}};$._loadFileBase=function(a){var c=this;var b=c;var d=new URLRequest(a.url);if(a.method)d.method=a.method||"GET";if(a.params)d.data=a.params;b._prependItemTag(a);b.paused=false;b._addLoadingItem(a);var e=new URLLoader();e.autoDestory=true;e.item=a;e.dataFormat="blob";e.addEventListener("error",b.handleFileError,b);e.addEventListener("progress",b.handleFileProgress,b);e.addEventListener("complete",b.handleFileLoad,b);e.load(d)};$._nextTaskLoop=function(){var b=this;var a=b;var c=a._tasklist;var d=a._taskTaglist;var e=a._taskLoadingList;var f=c.length;var g=d.length;var h=e.length;if(f||g||h){if(f){if(a.maxThread>=h){b._loadFileBase(c.shift())}else{trace("超过允许最大下载数");a._prependItemTag(c[0])}}}else{a.complete=true;a.dispatchEvent(new kisgame.Event("complete"))}};kisgame.LoaderList=kisgame.promote(_,"EventDispatcher")}());var b=kisgame.RManager=new kisgame.EventDispatcher();b.invaliateList=new Object();b.externalLibs=[];b.getBlobUrl=function(_,$,a){var d=this;var c=d.lib;var e=c.getItem(_);if(!e){c.loadFile(_,false)}return c.getBlobUrl(_)};b.getImageResult=function(_,$,a){var d=this;var c=d.lib;var e=c.getItem(_);if(!e){c.loadFile(_,true)}else{e=c.getResult(_)}var f=d.invaliateList[_];if(f){var g=f.indexOf($);if(g==-1){f.push([$,!!a])}}else{d.invaliateList[_]=[[$,!!a]]}return e};b.getImage=function(_,$,a){var d=this;var c=d.lib;var e=c.getItem(_);if(!e){c.loadFile(_,true)}else{e=c.getResult(_)}if(!e){e=c.getItem(_)._loader._tag}var f=d.invaliateList[_];if(f){var g=f.indexOf($);if(g==-1){f.push([$,!!a])}}else{d.invaliateList[_]=[[$,!!a]]}return e};b.handleFileLoad=function(_){var c=this;var $=_.item;if($.isExLib){var a=c.externalLibs;var d=a.length;for(var e=0;e<d;e++){var f=a[e];if($[f.imgid]){f.images[$[f.imgid]]=_.result;break}}}var g=c.invaliateList;var h=_.item.src;var i=g[h];if(i){var d=i.length;for(var e=0;e<d;e++){var j=i[e][0];if(i[e][1]){var k=new kisgame.Event("fileload");k.src=h;j.dispatchEvent(k);if(!k.defaultPrevented){i.splice(e,1);e--;d--}}else{j.draw()}}if(i.length==0){delete g[h]}}};b.handleFileError=function(_){var a=this;var $=a.invaliateList;var c=_.item.src;var d=$[c];if(d){var e=d.length;for(var f=0;f<e;f++){var g=d[f][0];if(d[f][1]){var h=new kisgame.Event("fileerror");h.src=c;g.dispatchEvent(h);if(!h.defaultPrevented){d.splice(f,1);f--;e--}}}if(d.length==0){delete $[c]}}};b.loadManifest=function(_,$,a){var c=this;c.lib.loadManifest(_,$,a)};b.loadExternalLibs=function(_){var d=this;var $=_.length;for(var a=0;a<$;a++){var c=_[a];if(c.isMain){d.loadMainLib(c)}else{d.loadExternalLib(c)}}};b.loadMainLib=function(_){var a=this;var $=_.lib.properties.manifest;if(_.lib.initSpriteSheets){_.lib.initSpriteSheets(_.basePath)}a.lib.loadManifest($,true,_.basePath)};b.loadExternalLib=function(_){var $=this;if($.externalLibs.indexOf(_)==-1){var a=[];var c=[];var d=[".png",".jpg","jpeg",".gif"];var e=[".mp3",".wav"];var f=_.lib.properties.manifest;var g=f.length;_.lib.imgid=_.imgid;if(_.lib.initSpriteSheets){_.lib.initSpriteSheets(_.basePath)}for(var h=0;h<g;h++){var i=f[h];var j=i.src.substr(-4);if(d.indexOf(j)!=-1){i[_.imgid]=i.id;delete i.id;i.isExLib=true;c.push(i)}else if(e.indexOf(j)!=-1){a.push(i);if(i.id.indexOf(_.imgid)!=0){i.id=_.imgid+i.id}}}var k=c.concat(a);$.externalLibs.push(_);$.lib.loadManifest(k,true,_.basePath)}};b.handleProgress=function(_){var a=this;_.stopPropagation();var $=new kisgame.Event(_.type);$.loaded=_.loaded;$.total=_.total;a.dispatchEvent($)};b.handleComplete=function(_){var $=this;_.stopPropagation();$.dispatchEvent(_)};b.getSize=function(){var _=this;return _.lib.getSize()};var lib=b.lib=new kisgame.LoaderList();lib.on("fileload",b.handleFileLoad,b);lib.on("complete",b.handleComplete,b);lib.on("progress",b.handleProgress,b);lib.on("fileerror",b.handleFileError,b);this.kisgame=this.kisgame||{};(function(){function _(a){var b=this;b._super(_.super_p.constructor,a);kisgame.Ticker.framerate=30;kisgame.Ticker.on("tick",b.tickHandler,b);b.autoUpdate=true;b.autoClear=true;b.dirtyRectDistance=100;b.m_invaliate_arr=[];b.invaliate_arr=[];b.dirtyrect_arr=[];b.newDirtyrect_arr=[];b.screenRect=new kisgame.Rectangle();b.on("stagemousedown",b.clearHitTest,b);b.on("stagemouseup",b.clearHitTest,b);b.tickHandler()}var $=KISU.extend(_,kisgame.Stage);$.destory=function(a){var b=this;kisgame.Ticker.off("tick",b.tickHandler,false,b);b.off("stagemousedown",b.clearHitTest,false,b);b.off("stagemouseup",b.clearHitTest,false,b)};$.setFrameRate=function(a){kisgame.Ticker.framerate=a};$.setSize=function(a,b){var c=this;c.canvas.width=a;c.canvas.height=b;c.screenRect.width=a;c.screenRect.height=b};$.tickHandler=function(){var a=this;if(a.autoUpdate){if(!a.unUpdate)a.update()}else{var b=a.dirtyrect_arr;var c=a.dirtyRectDistance;var d=a.screenRect;var e=a.invaliate_arr;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(h.stage){var i=h.getBorderBounds(a);if(i&&d.intersects(i))b.push(i)}}e.length=0;e=a.m_invaliate_arr;var f=e.length;for(var g=0;g<f;g++){var h=e[g];h.kis_invaliated=false}e.length=0;var f=b.length;a.drawRectArr=null;if(f){var j=a.newDirtyrect_arr;j.length=0;var k;for(var g=0;g<f;g++){var l=b[g];if(j.length==0){j.push(l.clone());continue}var m=j.length;for(var n=0;n<m;n++){var o=j[n];if(o.mix(l.x,l.y,l.width,l.height,c)){m=-1;break}}if(m!=-1){j.push(l)}}f=j.length;for(var g=0;g<f;g++){var k=j[g];k.pad(5,5,5,5);k.ceil();if(k.x<0)k.x=0;if(k.y<0)k.y=0;if(k.width>d.width+1){k.width=d.width+1}if(k.height>d.height+1){k.height=d.height+1}}if(f>0){a.drawRectArr=j}if(!a.unUpdate)a.update();if(f&&a.showDirty){var p=a.canvas.getContext("2d");p.setTransform(1,0,0,1,0,0);p.beginPath();p.globalAlpha=1;p.lineWidth=1;p.strokeStyle="#ff0000";for(var g=0;g<f;g++){var q=j[g];p.rect(q.x-1,q.y-1,q.width-2,q.height-2)}p.stroke()}}b.splice(0)}};$.getBorderBounds=function(){var a=this;return a.getBounds()};$.invaliate=function(a){var b=this;if(a&&!a.kis_invaliated){a.kis_invaliated=true;b.m_invaliate_arr.push(a);var c=b.screenRect;var d=b.invaliate_arr;var e=b.dirtyrect_arr;if(a.stage&&a.isVisible()&&a.alpha){var f=a.getBorderBounds(b);if(f&&c.intersects(f))e.push(f)}var g=d.length;for(var h=0;h<g;h++){var i=d[h];if(i==a||i.contains&&i.contains(a)){return}else if(a.contains&&a.contains(i)){d.splice(h,1);h--;g--}}d.push(a)}};$.clearHitTest=function(){var a=kisgame.DisplayObject._hitTestContext;a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,10,10)};$.toString=function(){var a=this;return "[KISStage (name="+a.name+")]"};kisgame.KISStage=_}());(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.width=a.height=60;a.bgImage_x=0;a.bgImage_y=0;a.borderWidth=1;a.borderStyle="solid";a.borderColor="black";a.backgroundColor="white";a.backgroundImage="";a.style=new Object();a.style.graphics={lines:[],images:[]};a.uID=_.unquareID++}_.unquareID=0;var $=KISU.extend(_,kisgame.Container);$.destory=function(a){var b=this;if(TweenMotion.containTarget(b)){TweenMotion.killTweensOf(b)}LaterFrameTable.removeOf(b);b._super(_.super_p.destory,a)};$.setFocus=function(){};$.setVisible=function(a){var b=this;b.visible=a};$.setAlpha=function(a){var b=this;b.alpha=a};$.refreshSize=function(){var a=this;a.setSize(a.width,a.height)};$.setName=function(a){var b=this;b.name=a};$.parseFromPool=function(a,b,c,d){var f=this;var e=d||f;var g=a.length;for(var h=0;h<g;h+=2){var j=c[a[h]];var k=c[a[h+1]];if(k instanceof Array){var l;if(isNaN(c[k[0]])){l={}}else{l=[]}e[j]=l;f.parseFromPool(k,b,c,l)}else{e[j]=k}}if(!d){a.splice(0)}};$.parseProps=function(a){var c=this;for(var b in a){c[b]=a[b]}};$.hitTestPoint=function(a,b){var c=this;if(b){return c._getObjectsUnderPoint(a.x,a.y)}else{var d=c.hitAreaRectangle||c.getBounds();if(d.isFull){return true}else{var a=c.globalToLocal(a.x,a.y);if(d.radius&&Math.sqrt(a.y*a.y+a.x*a.x)>d.radius){return false}else if(a.x<d.x||a.y<d.y||a.x>d.x+d.width||a.y>d.y+d.height){return false}}}return true};$.local2Global=function(a){var b=this;return b.localToGlobal(a.x,a.y,a)};$.addETL=function(a,b,c){var d=this;d.on(a,b,c)};$.removeETL=function(a,b,c){var d=this;d.off(a,b,false,c)};$.getSize=function(){var a=this;return {width:a.width,height:a.height}};$.setSize=function(a,b,c){var d=this;d._super(_.super_p.setSize,a,b,c);if(d.i_l_w!=a||d.i_l_h!=b){d.borderBGDraw();d.updateUseAreaRect()}d.handleChildrenSize(a,b)};$.handleChildrenSize=function(a,b){var c=this;if(c.i_l_w!=a||c.i_l_h!=b)c.fixChildrenSize();c.i_l_w=c.width;c.i_l_h=c.height};$.fixChildrenSize=function(){var a=this;if(a.sizeChildren){var b=a;var c=a.width;var d=a.height;var e=b.children;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(h&&h.posSize){var j=h.fixPosSize(h.posSize,c,d);if(j.x!=h.x||j.y!=h.y)h.move(j.x,j.y);if(j.w!=h.width||j.h!=h.height)h.setSize(j.w,j.h)}}}};$.drawBorder=function(){var b=this;var a=b.style;if(b.border){a.borderStyle=b.borderStyle;a.borderWidth=b.borderWidth;a.borderColor=b.borderColor}else{delete a.borderStyle;delete a.borderWidth;delete a.borderColor;var c=["Left","Top","Right","Bottom"];var d=c.length;for(i=0;i<d;i++){m=c[i];delete a["border"+m+"Style"];delete a["border"+m+"Width"];delete a["border"+m+"Color"]}}var e=b.borderformat;if(e){for(var f in e){var g=e[f];for(var h in g){var j=g[h];a["border"+f+h]=j}}}if(b.width!=-1||b.height!=-1){b.setSize(b.width,b.height)}else{b.borderBGDraw()}};$.setBackgroundColor=function(a){var b=this;b.i_setBackgroundColor(a);b.borderBGDraw()};$.moveBackground=function(a,b){var c=this;if(i_moveBackground(a,b)){c.borderBGDraw()}};$.i_setBackgroundColor=function(a){var b=this;b.backgroundColor=a;b.style.backgroundColor=a};$.i_moveBackground=function(a,b){var c=this;if(a!=c.bgImage_x||b!=c.bgImage_y){c.bgImage_x=a;c.bgImage_y=b;return true}};$.drawBackground=function(){var a=this;if(a.background){a.i_setBackgroundColor(a.backgroundColor);var b=a.bgImage;var c=a.backgroundImage;if(b&&b.url){if(a.i_l_bg!=b.url)a.style.backgroundImage=b.url;a.style.backgroundRepeat=b.repeat||"";a.i_moveBackground(b.x,b.y);a.i_l_bg=b.url}else if(c){if(a.i_l_bg!=c)a.style.backgroundImage=c;a.style.backgroundRepeat=a.bgImage_repeat||"no-repeat";a.i_moveBackground(a.bgImage_x,a.bgImage_y);a.i_l_bg=c}}else{a.style.backgroundImage="";a.style.backgroundColor="";a.i_l_bg=""}a.borderBGDraw()};$.getNextHighestDepth=function(){var a=this;return a.getNumChildren()};$.removeChildrens=function(){var a=this;a.removeAllChildren()};$.setStyle=function(a,b){var c=this;c.style[a]=b};$.getStyle=function(a){var b=this;return b.style[a]};$.getTargetPath=function(){var b=this;var a=b;var c="";while(a){c="."+a.name+c;a=a.parent}return c.substr(1,c.length-1)};$.callLaterFrame=function(a,b,c){var g=this;if(!a)return;var d=[];if(arguments.length>3){var e=arguments.length;for(var f=3;f<e;f++){d.push(arguments[f])}}c=c||g;LaterFrameTable.addOnce(a,b,c,d)};$.callLaterFrame2=function(a,b,c){var g=this;if(!a)return;var d=[];if(arguments.length>3){var e=arguments.length;for(var f=3;f<e;f++){d.push(arguments[f])}}c=c||g;LaterFrameTable.add(a,b,c,d)};$.clearLaterFrame=function(a,b,c){var d=this;b=b||d;LaterFrameTable.remove(a,b,c)};$.setSelectable=function(a){var b=this;b.selectable=a};$.recreateTargetProp=function(a,b){var c=a[b];if(c!=undefined){for(var d in c){delete c[d]}}else{a[b]=new Object()}};$.clonePropsTo=function(a,b){var g=this;if(a instanceof Array){var c=a.length;for(var d=0;d<c;d++){var e=a[d];if(e instanceof Array){var f=b[d];if(f){f.length=0}else{b[d]=[]}g.clonePropsTo(e,b[d])}else if(typeof (e)=="object"){g.recreateTargetProp(b,d);g.clonePropsTo(e,b[d])}else{b[d]=e}}}else{for(var d in a){var e=a[d];if(e instanceof Array){var f=b[d];if(f){f.length=0}else{b[d]=[]}g.clonePropsTo(e,b[d])}else if(typeof (e)=="object"){g.recreateTargetProp(b,d);g.clonePropsTo(e,b[d])}else{b[d]=e}}}};$.setFramePropTo=function(a,b){var f=this;for(var c in a){var d=a[c];if(d instanceof Array){var e=f[c];if(e){e.length=0}else{f[c]=[]}f.clonePropsTo(d,f[c])}else if(typeof (d)=="object"){f.recreateTargetProp(f,c);f.clonePropsTo(d,f[c])}else{if(d==undefined&&f[c]!=undefined){f[c]=null}else{f[c]=d}}}};$.gotoAndStopPFrame=function(a){var b=this;if(!b.pTimeline){return}var c=b.pTimeline.frames;var d=b.pTimeline.selectframe;var e=c.length;if(e>0&&a<e){b.setFramePropTo(c[a],b);b.pTimeline.selectframe=a;var f=b.children;if(f){var e=f.length;for(var g=0;g<e;g++){var h=f[g];if(h.gotoAndStopPFrame){h.gotoAndStopPFrame(0)}}}b.updateUI()}};$.gotoAndStop=function(a){var b=this;b.clearLaterFrame(b.play,b);if(!b.timeline){return}a--;if(a==b.i_l_frame)return;b.i_l_frame=a;var c=b.timeline.frames;var d=b.timeline.selectframe;var e=c.length;if(a>=e)a=e-1;if(e>0&&a<e){b.setFramePropTo(c[a],b);b.timeline.selectframe=a;var f=b.children;var e=f.length;for(var g=0;g<e;g++){var h=f[g];if(h.gotoAndStopPFrame){h.gotoAndStopPFrame(a)}}b.updateUI()}};$.play=function(){var a=this;if(!a.timeline){return}var b=a.timeline.frames;var c=b.length;if(c<2){return}var d=a.timeline.selectframe;if(d+1>c-1){d=0}else{d++}a.gotoAndStop(d+1);a.callLaterFrame(a.play,1,a)};$.stop=function(){var a=this;a.clearLaterFrame(a.play,a)};$.getCurrentFrame=function(){var a=this;if(!a.timeline){return -1}return a.timeline.selectframe+1};$.isVisible=function(){var a=this;if(a.destoryed)return false;var b=a.cacheCanvas||a.children.length||a.style.graphics.has;return !!(a.visible&&a.alpha>0&&a.scaleX!=0&&a.scaleY!=0&&b)};$._getBounds=function(a,b,c,d){var f=this;var e=f.DisplayObject_getBounds();if(e){return f._transformBounds(e,a,b)}var g=null;if(!d||(f.border||f.background)){g=f._rectangle;g.setValues(0,0,f.width,f.height)}var h=f._props.matrix;h=b?h.identity():f.getMatrix(h);if(a&&!b){if(g)g=f._transformBounds(g,a,b)}else if(a){h.prependMatrix(a)}var j=f.children.length;for(var k=0;k<j;k++){var l=f.children[k];if(!l.visible||!(e=l._getBounds(h,false,c,d))){continue}if(g){g.extend(e.x,e.y,e.width,e.height)}else{g=e.clone()}}if(g&&f.border&&c){var n=f.style;var o=["Left","Top","Right","Bottom"];var p=[0.5,0.5,0.5,0.5];var j=o.length;for(k=0;k<j;k++){var q=o[k];var r=n["border"+q+"Width"]||0;p[k]+=p[k]*r}g.pad(p[1],p[0],p[3],p[2])}return g};$.borderBGDraw=function(){var b=this;var a=b.style.graphics;a.has=0;a.lines.length=0;a.images.length=0;a.bgc=null;var c=["Left","Top","Right","Bottom"];var d=c.length;var e=b.style;var f=new Object();var g=0;var h,v;var j=0;var k=false;if(e.borderStyle){for(g=0;g<d;g++){h=c[g];f[h+"Style"]=e.borderStyle;f[h+"Width"]=e.borderWidth;f[h+"Color"]=e.borderColor}j=e.borderWidth||0;k=true}var l=[0.5,0.5,0.5,0.5];for(g=0;g<d;g++){h=c[g];v=e["border"+h+"Style"];var n=j;if(v){k=true;f[h+"Style"]=v;v=e["border"+h+"Width"];if(!isNaN(v)){n=v;f[h+"Width"]=v;v=e["border"+h+"Color"];if(v){f[h+"Color"]=v}}else{e["border"+h+"Width"]=j}}else{e["border"+h+"Width"]=j}l[g]+=l[g]*(n||1)}if(e.backgroundColor||e.backgroundImage){k=true}var o=b.getBounds(null,false,true);if(!o){if(!k){return}else{o=b._rectangle;o.setValues(0,0,b.width,b.height)}}else if(k){o=b._rectangle;o.setValues(0,0,b.width,b.height)}var p=o.x;var q=o.y;var r=o.width;var t=o.height;var u=p;var w=q;var x=p+r;var y=q+t;var z=[u,w,u,y,u,y,x,y,x,y,x,w,x,w,u,w];u+=0.5;w+=0.5;x-=0.5;y-=0.5;var A=[u,w,u,y,u,y,x,y,x,y,x,w,x,w,u,w];v=e.backgroundColor;if(v){a.has=1;a.bgc=v;a.cx=p;a.cy=q;a.cw=r;a.ch=t}if(e.backgroundImage){var B=e.backgroundRepeat;var C=b.getRPath(e.backgroundImage);var D=kisgame.RManager.getImageResult(C,b);if(D){var E=0;var F,G,u,w,x0,y0;x0=-(p+b.bgImage_x);y0=-(q+b.bgImage_y);if(B=="no-repeat"||!B){F=p+b.bgImage_x,G=q+b.bgImage_y,u=F+D.width,w=G+D.height;if(p>F){F=p}if(q>G){G=q}if(p+r<u){u=p+r}if(q+t<w){w=q+t}if(u>D.width){x0=0}if(w>D.height){y0=0}if(!(u<=F||w<=G)){E=1;u=u-F;w=w-G}B=null}else if(B=="repeat-x"){E=1;F=p,G=q,u=r;w=D.height>t?t:D.height}else if(B=="repeat-y"){E=1;F=p,G=q,w=t;u=D.width>r?r:D.width}else if(B=="repeat"){E=1;F=p,G=q,u=r,w=t}if(E){a.has=1;a.images.push([D,B,x0,y0,u,w,F,G,u,w])}}}if(b.beforeDrawBorder){b.beforeDrawBorder()}var H=a.lines;for(g=0;g<d;g++){h=c[g];s=f[h+"Style"];wd=f[h+"Width"];cr=f[h+"Color"];if(s&&wd&&cr){ii=g*4;var I=parseInt(wd);var J;if(I%2==0){J=z}else{J=A}a.has=1;H.push([I,cr,J[ii],J[ii+1],J[ii+2],J[ii+3]])}}var K=b.dumpObjStr(a);if(K!=b.graphicsStr){b.invaliate()}b.graphicsStr=K};$.drawStyleGraphics=function(a){var c=this;var b=c.style.graphics;if(b.has){var d=b.bgc;if(d){a.fillStyle=d;a.fillRect(b.cx,b.cy,b.cw,b.ch)}var e=b.images;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(!h[1]){a.drawImage(h[0],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9])}else{var j=a.createPattern(h[0],h[1]);a.fillStyle=j;a.fillRect(h[6],h[7],h[8],h[9])}}var e=b.lines;var f=e.length;for(var g=0;g<f;g++){var h=e[g];a.beginPath();a.lineWidth=h[0];a.strokeStyle=h[1];a.moveTo(h[2],h[3]);var k=h.length;for(var l=4;l<k;l+=2){a.lineTo(h[l],h[l+1])}a.stroke()}}};$.updateUI=function(){var a=this;a.drawBorder();a.drawBackground()};$.updateUseAreaRect=function(){var a=this;if(a.useAreaRect){var b=a.hitAreaRectangle;if(!b){a.hitAreaRectangle=b=new kisgame.Rectangle(0,0,a.width,a.height)}else{b.width=a.width;b.height=a.height}}};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c.DisplayObject_draw(a,b)){return true}c.drawStyleGraphics(a);if(c.children.length){var d=c.children.slice();for(var e=0,f=d.length;e<f;e++){var g=d[e];if(!g.isVisible()){continue}a.save();g.updateContext(a);g.draw(a);a.restore()}}return true};$._getObjectsUnderPoint=function(a,b,c,d,e,f){var h=this;var g=h._super(_.super_p._getObjectsUnderPoint,a,b,c,d,e,f);if(!g&&!h.mouseIgnoreSelf){var j,k=kisgame.DisplayObject._hitTestContext;var l=h.getConcatenatedDisplayProps(h._props);j=l.matrix;k.setTransform(1,0,0,1,0,0);k.clearRect(0,0,2,2);k.globalAlpha=l.alpha;k.setTransform(j.a,j.b,j.c,j.d,j.tx-a,j.ty-b);h.drawStyleGraphics(k);if(h._testHit(k)){if(c){c.push(h)}else{return h}}}return g};$.dumpObjStr=function(a){var f=this;var b="";var c=a;for(var d in c){var e=c[d];if(typeof (e)=="object"&&e!=null){if(e.src){b+=e.src}else{b+=f.dumpObjStr(e)}}else{b+=e}}return b};$.toString=function(){var a=this;return "[KISContainer (name="+a.name+")]"};kisgame.KISContainer=_}());this.kisgame=this.kisgame||{};(function(){function _(){var c=this;var b=c;b._super(_.super_p.constructor);b.bgImage_x=0;b.bgImage_y=0;b.borderWidth=1;b.borderStyle="solid";b.borderColor="black";b.backgroundColor="white";b.backgroundImage="";b.style=new Object();b.style.graphics={lines:[],images:[]};b.width=100;b.height=20;b.autoSize=true;b.ellipsis=true;b.htmlText="";b.text="";b.selectable=true;b.wordwrap=false;b.multiline=false;b.textWidth=0;b.textHeight=0;b.textColor="black";b._bounds=new kisgame.Rectangle(0,0,b.width,b.height);b.sizeBounds=new kisgame.Rectangle();b.scrollRect=new kisgame.Rectangle(0,0,b._bounds.width,b._bounds.height)}var $=KISU.extend(_,kisgame.Text);var a=kisgame.KISContainer.prototype;$.destory=a.destory;$.setFocus==a.setFocus;$.setVisible=a.setVisible;$.setAlpha=a.setAlpha;$.refreshSize=a.refreshSize;$.setName=a.setName;$.parseProps=a.parseProps;$.hitTestPoint=a.hitTestPoint;$.local2Global=a.local2Global;$.addETL=a.addETL;$.removeETL=a.removeETL;$.getSize=a.getSize;$.drawBorder=a.drawBorder;$.setBackgroundColor=a.setBackgroundColor;$.moveBackground=a.moveBackground;$.i_setBackgroundColor=a.i_setBackgroundColor;$.i_moveBackground=a.i_moveBackground;$.drawBackground=a.drawBackground;$.setStyle=a.setStyle;$.getStyle=a.getStyle;$.getTargetPath=a.getTargetPath;$.callLaterFrame=a.callLaterFrame;$.callLaterFrame2=a.callLaterFrame2;$.clearLaterFrame=a.clearLaterFrame;$.setSelectable=a.setSelectable;$.recreateTargetProp=a.recreateTargetProp;$.clonePropsTo=a.clonePropsTo;$.setFramePropTo=a.setFramePropTo;$.gotoAndStopPFrame=a.gotoAndStopPFrame;$.gotoAndStop=$.gotoAndStop;$.play=a.play;$.stop=a.stop;$.getCurrentFrame=a.getCurrentFrame;$.borderBGDraw=a.borderBGDraw;$.getBorderBounds=a.getBorderBounds;$.drawStyleGraphics=a.drawStyleGraphics;$.parseFromPool=a.parseFromPool;$.dumpObjStr=a.dumpObjStr;$.getBounds=function(b){var d=this;var c=d.DisplayObject_getBounds();if(!c){c=d._rectangle;c.setValues(0,0,d.width,d.height)}if(b){return d.local2TargetRect(b,c)}else{return c}return c};$.getSize=function(){var b=this;return b.scrollRect};$.setTextFormat=function(b){var d=this;if(!b){return}var c=d.dumpObjStr(b);if(c!=d.textformatStr){d.invaliate()}d.textformatStr=c;d.textformat=b;var e="";if(b.italic){e+="italic "}if(b.bold){e+="bold "}if(b.size){e+=b.size;if(!isNaN(b.size)){e+="px "}else{e+=" "}}else{e+="10px "}if(b.font){e+=b.font}else{e+="sans-serif"}d.font=e;d.setTextUnderLine(b.underline?true:false);if(b.align)d.setTextAlign(b.align);if(b.color)d.setTextColor(b.color)};$.getTextFormat=function(){var b=this;return b.textformat};$.setText=function(b){var c=this;if(!b&&isNaN(b)){b=""}if(c.text!=b){c.invaliate();c.text=b;c.updateTextBound()}};$.getText=function(){var b=this;return b.text};$.setTextAlign=function(b){var c=this;c.textAlign=b};$.setTextUnderLine=function(b){var c=this;c.textUnderLine=b};$.appendText=function(b){var c=this;c.text+=b;c.updateTextBound()};$.setTextColor=function(b){var c=this;c.color=b};$.setSelectable=function(b){var c=this;c.selectable=b};$.updateUI=function(){var b=this;b.setTextFormat(b.textformat);b.drawBorder();b.drawBackground()};$.getMeasuredLineHeight=function(){var b=this;return b._getMeasuredWidth("我")*1.2};$._prepContext=function(b){var c=this;b.font=c.font||"10px sans-serif";b.textAlign="left";b.textBaseline="top";return b};$._drawTextLine=function(b,c,d,e){var f=this;if(!e)e=0;if(f.outline){b.strokeText(c,e,d,f.maxWidth||0xFFFF)}else{b.fillText(c,e,d,f.maxWidth||0xFFFF)}};$._drawText=function(b,c,d){var f=this;var e=!!b;if(!e){b=kisgame.Text._workingContext;b.save();f._prepContext(b)}var g=f.textUnderLine?1:0;var h;var i=f.getMeasuredLineHeight();if(!f.multiline&&!f.autoSize&&f.height){h=f.height}else{h=f.lineHeight||i}var j=f.autoSize?null:f.width;var k=0,l=0;var m=String(f.text).split(/(?:\r\n|\r|\n)/);var n=f.autoSize?0:kisgame.Text.H_OFFSETS[f.textAlign||"left"];for(var o=0,p=m.length;o<p;o++){var q=m[o];var r=null;if(f.wordwrap&&j!=null&&(r=b.measureText(q).width)>j){var s=q.split("");q=s[0];r=b.measureText(q).width;for(var t=1,u=s.length;t<u;t++){var v=b.measureText(s[t]).width;if(r+v>j){var w=(-j+r)*n;if(e){var x=l*h+(h-i)/2;f._drawTextLine(b,q,x,w);if(g){x+=i;b.beginPath();b.moveTo(w,x);b.lineTo(w+r,x);b.stroke()}}if(d){d.push(q)}if(r>k){k=r}q=s[t];r=b.measureText(q).width;l++}else{q+=s[t];r+=v}}}if(d){d.push(q)}if(c&&r==null){r=b.measureText(q).width}if(e){var w=(-j+r)*n;var x=l*h+(h-i)/2;f._drawTextLine(b,q,x,w);if(c&&g){x+=i;b.beginPath();b.moveTo(w,x);b.lineTo(w+r,x);b.stroke()}}if(r>k){k=r}l++}if(c){if(c==f){f.textWidth=k;f.textHeight=l*h;if(c.autoSize){c.width=c.textWidth;c.height=c.textHeight}}else{c.width=k;c.height=l*h}}if(!e){b.restore()}return c};$.updateTextBound=function(){var c=this;var b=c;if(c.autoSize){b={};c._drawText(null,b);c._bounds.width=c.scrollRect.width=b.width;c._bounds.height=c.scrollRect.height=b.height}c._bounds.width=c.scrollRect.width=b.width;c._bounds.height=c.scrollRect.height=b.height};$.setSize=function(b,c,d){var e=this;e._super(_.super_p.setSize,b,c,d);if(e.i_l_w!=b||e.i_l_h!=c){e.updateTextBound();e.borderBGDraw()}e.i_l_w=e.width;e.i_l_h=e.height};$.draw=function(b,c){var d=this;if(!b){d.updateUI();return}if(d.DisplayObject_draw(b,c)){return true}d.drawStyleGraphics(b);var e=d.color||"#000";if(d.outline){b.strokeStyle=e;b.lineWidth=d.outline}else{b.fillStyle=e}if(d.textUnderLine){b.strokeStyle=e;if(!d.outline)b.lineWidth=1}d._drawText(d._prepContext(b),d);d._bounds.width=d.scrollRect.width=d.width;d._bounds.height=d.scrollRect.height=d.height;return true};$.toString=function(){var b=this;return "[KISText (name="+b.name+")]"};kisgame.KISText=_}());this.kisgame=this.kisgame||{};(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.width=a.height=60;b.selectframe=0;b.bgPosBase_x=0;b.bgPosBase_y=0;b.backgroundColor=""}var $=KISU.extend(_,kisgame.KISContainer);$.setData=function(a){var b=this;if(a.url){b.backgroundImage=a.url}if(!isNaN(a.col)){b.colCount=a.col}if(!isNaN(a.row)){b.rowCount=a.row}if(!isNaN(a.selectframe)){b.selectframe=a.selectframe}b.gotoAndStop(b.selectframe+1)};$.getCurrentFrame=function(){var a=this;return a.selectframe+1};$.gotoAndStop=function(a){var b=this;b.clearLaterFrame(b.play,b);b.clearLaterFrame(b.playOnce,b);a--;if(a==b.i_l_frame)return;b.i_l_frame=a;var c=b.selectframe;var d=b.totalFrames>0?b.totalFrames:b.colCount*b.rowCount;if(a>=d)a=d-1;if(d>0&&a<d){b.selectframe=a;if(b.drawed){b.updateBGPos();b.drawBackground()}else{b.draw();b.drawed=true}}};$.updateBGPos=function(){var b=this;var a=(b.colCount*b.rowCount)-1;var c=b.selectframe;if(c>a){c=a}var d=Math.ceil(c%b.colCount);var e=Math.floor(c/b.colCount);b.bgImage_x=b.bgPosBase_x-d*b.width;b.bgImage_y=b.bgPosBase_y-e*b.height};$.parseFromPool=function(a,b,c,d){var e=this;e._super(_.super_p.parseFromPool,a,b,c,d);if(e.buttonMode){KISU.efun(e,SimpleButton.prototype);e.normalF=1;e.overF=2;e.downF=3;e.selectF=4;e.disableF=5;e.pressing=false;e.buttonOption=1;e.autoRepeatIntervalMS=250;e.repeatInterval=0;e.autoRepeat=false;var f=e.totalFrames>0?e.totalFrames:e.colCount*e.rowCount;if(f==2){e.overF=1;e.downF=2;e.selectF=2;e.disableF=2}e.setEnabled(true)}};$.play=function(a){var b=this;if(!b.backgroundImage){return}var c=b.totalFrames>0?b.totalFrames:b.colCount*b.rowCount;if(c<2){return}var d=b.selectframe;if(d+1>c-1){d=0}else{d++}if(a){b.gotoAndStop(d+1)}b.callLaterFrame(b.play,1,b,true)};$.playOnce=function(a){var b=this;if(!b.backgroundImage){return}var c=b.totalFrames>0?b.totalFrames:b.colCount*b.rowCount;if(c<2){return}var d=b.selectframe;if(d+1<=c-1){d++;if(a){b.gotoAndStop(d+1)}b.callLaterFrame(b.playOnce,1,b,true)}else{b.dispatchEvent(new KEvent("playcomplete"))}};$.updateUI=function(){var a=this;a.updateBGPos();a._super(_.super_p.updateUI)};$.toString=function(){var a=this;return "[BitmapSprite (name="+a.name+")]"};kisgame.BitmapSprite=_}());this.kisgame=this.kisgame||{};(function(){function _(a){var c=this;var b=c;b.width=10;b.height=10;b.oriWidth=0;b.oriHeight=0;b.loaded=false;b.autoSize=true;b.sourceRect=null;b.bgImage_x=0;b.bgImage_y=0;b.borderWidth=1;b.borderStyle="solid";b.borderColor="black";b.backgroundColor="white";b.backgroundImage="";b.style=new Object();b.style.graphics={lines:[],images:[]};b._super(_.super_p[0].constructor)}var $=KISU.extend(_,kisgame.ImageView,kisgame.KISContainer);$.initialize=_;$.k_ctor=$.constructor;$.drawStyleGraphics=function(a){var c=this;var b=c.style.graphics;if(b.has){var d=b.bgc;if(d){a.fillStyle=d;a.fillRect(b.cx,b.cy,b.cw,b.ch)}var e=b.images;var f=e.length;for(var g=0;g<f;g++){var h=e[g];if(!h[1]){a.drawImage(h[0],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9])}else{var i=a.createPattern(h[0],h[1]);a.fillStyle=i;a.fillRect(h[6],h[7],h[8],h[9])}}}var j=c.image,k=c.sourceRect;if(j){if(k){var l=k.x,m=k.y,n=l+k.width,o=m+k.height,p=0,q=0,r=j.width,s=j.height;if(l<0){p-=l;l=0}if(n>r){n=r}if(m<0){q-=m;m=0}if(o>s){o=s}a.drawImage(j,l,m,n-l,o-m,p,q,c.image_draw_w,c.image_draw_h)}else{a.drawImage(j,0,0,j.width,j.height,0,0,c.image_draw_w,c.image_draw_h)}}if(b.has){var e=b.lines;var f=e.length;for(var g=0;g<f;g++){var h=e[g];a.beginPath();a.lineWidth=h[0];a.strokeStyle=h[1];a.moveTo(h[2],h[3]);var t=h.length;for(var u=4;u<t;u+=2){a.lineTo(h[u],h[u+1])}a.stroke()}}};$.setSize=function(a,b){var c=this;c.width=isNaN(a)?c.width:a;c.height=isNaN(b)?c.height:b;c.borderBGDraw();c.updateImage()};$.setUrl=function(){var a=this;a.load(a.url)};$.updateUI=function(){var a=this;a.load(a.url);a.drawBorder();a.drawBackground()};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c._super(_.super_p[0].draw,a,b)){return true}c.drawStyleGraphics(a)};$.toString=function(){var a=this;return "[Bitmap (name="+a.name+")]"};kisgame.Bitmap=_}());this.kisgame=this.kisgame||{};(function(){function _(){var b=this;var a=b;a._super(_.super_p[0].constructor);a.width=a.height=60;b.selectframe=0;a.bgImage_x=0;a.bgImage_y=0;a.borderWidth=1;a.borderStyle="solid";a.borderColor="black";a.backgroundColor="white";a.bgImage_repeat="repeat";a.backgroundImage="";a.style=new Object();a.style.graphics={lines:[],images:[]};a.uID=kisgame.KISContainer.unquareID++}var $=KISU.extend(_,kisgame.DisplayObject,kisgame.KISContainer);$.k_ctor=$.constructor;$.setSize=function(a,b,c){var d=this;d._super(_.super_p[0].setSize,a,b,c);if(d.i_l_w!=a||d.i_l_h!=b){d.borderBGDraw();d.updateUseAreaRect()}};$.getBounds=function(a,b,c){var e=this;var d=e._super(_.super_p[0].getBounds);if(!d){d=e._rectangle;d.setValues(0,0,e.width,e.height)}if(a){return e.local2TargetRect(a,d)}else{return d}};$.setScale9Grid=function(a){var b=this;b.scale9Grid=a;b.drawBackground()};$.getScale9Grid=function(){var a=this;return a.scale9Grid};$.drawScale9Grid=function(a,b,c,d,e,f,g,h,i,j,k){if(c){var l=c.width;var m=c.height;var n=c.x;var o=c.y;var p=f-l-n;var q=g-m-o;var r=j-n-p;var s=k-o-q;a.drawImage(b,d,e,n,o,h,i,n,o);a.drawImage(b,d+n,e,l,o,h+n,i,r,o);a.drawImage(b,d+n+l,e,p,o,h+n+r,i,p,o);a.drawImage(b,d,e+o,n,m,h,i+o,n,s);a.drawImage(b,d+n,e+o,l,m,h+n,i+o,r,s);a.drawImage(b,d+n+l,e+o,p,m,h+n+r,i+o,p,s);a.drawImage(b,d,e+o+m,n,q,h,i+o+s,n,q);a.drawImage(b,d+n,e+o+m,l,q,h+n,i+o+s,r,q);a.drawImage(b,d+n+l,e+o+m,p,q,h+n+r,i+o+s,p,q)}else{a.drawImage(b,d,e,f,g,h,i,j,k)}};$.drawBackground=function(){var a=this;if(a.background){a.i_setBackgroundColor(a.backgroundColor);var b=a.bgImage;var c=a.backgroundImage;if(b&&b.url){if(a.i_l_bg!=b.url)a.style.backgroundImage=b.url;a.style.backgroundRepeat=b.repeat||"";a.i_moveBackground(b.x,b.y);a.i_l_bg=b.url}else if(c){if(a.i_l_bg!=c)a.style.backgroundImage=c;a.style.backgroundRepeat=a.bgImage_repeat||"no-repeat";a.i_moveBackground(a.bgImage_x,a.bgImage_y);a.i_l_bg=c}}else{a.style.backgroundImage="";a.style.backgroundColor="";a.i_l_bg=""}a.borderBGDraw()};$.drawStyleGraphics=function(a){var c=this;var b=c.style.graphics;if(b.has){var d=b.bgc;if(d){a.fillStyle=d;a.fillRect(b.cx,b.cy,b.cw,b.ch)}var e=c.scale9Grid;var f=b.images;var g=f.length;for(var h=0;h<g;h++){var i=f[h];if(h==0&&e){var j=i[0];c.drawScale9Grid(a,j,e,i[2],i[3],j.width,j.height,i[6],i[7],i[8],i[9])}else{if(!i[1]){a.drawImage(i[0],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9])}else{var k=a.createPattern(i[0],i[1]);a.fillStyle=k;a.fillRect(i[6],i[7],i[8],i[9])}}}var f=b.lines;var g=f.length;for(var h=0;h<g;h++){var i=f[h];a.beginPath();a.lineWidth=i[0];a.strokeStyle=i[1];a.moveTo(i[2],i[3]);var l=i.length;for(var m=4;m<l;m+=2){a.lineTo(i[m],i[m+1])}a.stroke()}}};$.updateUI=function(){var a=this;a.drawBorder();a.drawBackground()};$.draw=function(a,b){var c=this;if(!a){c.updateUI();return}if(c._super(_.super_p[0].draw,a,b)){return true}c.drawStyleGraphics(a)};$.toString=function(){var a=this;return "[BitmapScale9Grid (name="+a.name+")]"};kisgame.BitmapScale9Grid=_}());this.kisgame=this.kisgame||{};(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.listData=null;a.itemList=[];a.listHolder=b}var $=KISU.extend(_,kisgame.KISContainer);$.k_ctor=$.constructor;$.createItem=function(a){return null};$.destoryItem=function(a){a.destory(true);return a};$.setData=function(a){var b=this;b.listData=a;b.updateStatus()};$.getData=function(){var a=this;return a.listData};$.updateStatus=function(){var b=this;var a=b.listData?b.listData.length:0;var c=b.itemList;var d=Math.max(c.length,a);var e=b.listHolder;var f;for(var g=0;g<d;g++){if(g>=a){f=c[a];e.removeChild(f);b.destoryItem(f);c.splice(a,1)}else{if(g>=c.length){f=b.createItem(b.listData[g]);c.push(f);e.addChild(f).draw()}else{f=c[g]}b.setItemData(f,b.listData[g],g,g)}}b.fixChildrenSize()};$.setItemData=function(a,b,c,d){a.setData(b,c,d)};kisgame.List=_}());this.kisgame=this.kisgame||{};(function(){function _(){var a=this;a.group=new GroupManager();a._super(_.super_p.constructor)}var $=KISU.extend(_,kisgame.List);$.k_ctor=$.constructor;$.clickHandler=function(a){var b=this;b.group.setSelectedItem(a.currentTarget);var c=new KEvent("item_select");c.item=a.currentTarget;c.data=c.item.getData();b.dispatchEvent(c)};$.removeCurItem=function(){var b=this;var a=b.listData.indexOf(b.curItem.getData());if(a!=-1){b.listData.splice(a,1);b.setData(b.listData)}};$.setData=function(a){var b=this;b.listData=a;b.updateStatus();b.group.obj_arr=b.itemList};$.createItem=function(a){var c=this;var b=new c.SubItemClass();b.setSelect(false);b.setStyle("overflow","hidden");b.addETL(KISU.md,c.clickHandler,c);return b};$.selectAll=function(){var a=this;a.group.selectAll()};$.setSelectedIndex=function(a){var b=this;b.group.setSelectedIndex(a)};$.getSelectedIndex=function(){var a=this;return a.group.getSelectedIndex()};$.getSelectedValue=function(){var b=this;var a=b.group.getSelectedIndex();if(a>=0){var c=b.itemList[a];if(c){return c.getData()}}return null};$.toString=function(){var a=this;return "[SelectList (name="+a.name+")]"};kisgame.SelectList=_}());this.kisgame=this.kisgame||{};(function(){function _(){var a=this;a._super(_.super_p.constructor);a.maxCol=1;a.oftX=0;a.oftY=0;a.itemMaxWidth=100;a.itemMaxHeight=100;a.direction=kisgame.DirectionType.VERTICAL;a.listHolder=new kisgame.Container();var b=new kisgame.TouchScrollHelper();b.hot_mc=new kisgame.SimpleShape();b.hot_mc.hitAreaRectangle=new kisgame.Rectangle(0,0,a.width,a.height);var c=new kisgame.Rectangle(0,0,a.width,a.height);b.viewRect=c;a.scroller=b;a.addChild(a.scroller.hot_mc);a.addChild(a.listHolder)}var $=KISU.extend(_,kisgame.SelectList);$.k_ctor=$.constructor;$.updateStatus=function(){var a=this;a._super(_.super_p.updateStatus);a.maxItemRow=Math.floor(a.itemList.length/a.maxItemCol);a.refreshScroller()};$.getContentHeight=function(){var a=this;return a.maxItemRow*a.itemMaxHeight+a.oftY};$.getContentWidth=function(){var a=this;return a.maxItemCol*a.itemMaxWidth+a.oftX};$.setScrollDirection=function(a){var b=this;b.direction=a};$.refreshScroller=function(){var a=this;if(a.i_l_row==a.maxItemRow&&a.i_l_col==a.maxItemCol)return;if(a.direction==kisgame.DirectionType.VERTICAL){a.scroller.setParamPage(a.listHolder,a.getContentHeight(),a.direction,a.scroller.viewRect,a.scroller.hot_mc,a.itemMaxHeight,a.maxItemRow,1,0)}else{a.scroller.setParamPage(a.listHolder,a.getContentWidth(),a.direction,a.scroller.viewRect,a.scroller.hot_mc,a.itemMaxWidth,a.maxItemCol,1,0)}a.i_l_row=a.maxItemRow;a.i_l_col=a.maxItemCol};$.updateItemPos=function(){var b=this;var a=b.itemList;var c=a.length;var d=Math.min(b.width,b.itemMaxWidth);var e=b.itemMaxHeight;var f=b.maxItemCol;for(var g=0;g<c;g++){var h=a[g];var i=(g%f)*d;var j=Math.floor(g/f)*e;h.move(b.oftX+i+(d-h.width)/2,j+(e-h.height)/2+b.oftY)}};$.setItemData=function(a,b,c){var e=this;a.setData(b);var d=e.maxItemCol;var f=Math.min(e.width,e.itemMaxWidth);var g=e.itemMaxHeight;var h=(c%d)*f;var i=Math.floor(c/d)*g;a.move(e.oftX+h+(f-a.width)/2,i+(g-a.height)/2+e.oftY)};$.setSize=function(a,b){var c=this;if(c.i_l_w==a&&c.i_l_h==b)return;c._super(_.super_p.setSize,a,b);c.maxItemCol=Math.max(1,Math.floor(a/c.itemMaxWidth));c.maxItemRow=Math.floor(c.itemList.length/c.maxItemCol);c.oftX=(a-c.maxItemCol*c.itemMaxWidth)/2;c.updateItemPos();var d=c.scroller.viewRect;var e=c.scroller.hot_mc;e.hitAreaRectangle.width=d.width=c.width;e.hitAreaRectangle.height=d.height=c.height;c.refreshScroller();c.i_l_w=a;c.i_l_h=b};$.toString=function(){var a=this;return "[PageScrollList (name="+a.name+")]"};kisgame.PageScrollList=_}());this.kisgame=this.kisgame||{};(function(){function _(){var b=this;var a=b;a._super(_.super_p.constructor);a.width=a.height=20;a.setSelectable(false);a.bgPosBase_x=0;a.bgPosBase_y=0;a.autoSize=true;a.setStyle("overflow","visible")}var $=KISU.extend(_,kisgame.List);$.setValue=function(a){var b=this;b.i_l_value=b.value=a;b.i_l_rowCount=b.rowCount;b.i_l_colCount=b.colCount;b.i_l_cellBGImage=b.cellBGImage;b.i_l_cellWidth=b.cellWidth;var c=a+"";var d=c.length*b.cellWidth;b.setSize(d,b.height);b.setData(c.split(""));b.invaliate()};$.getValue=function(){var a=this;return a.value};$.setText=$.setValue;$.getText=$.getValue;$.createItem=function(a){var b=new kisgame.BitmapSprite();b.position="static";b.cssFloat="left";return b};$.setItemData=function(a,b,c){var e=this;var d=0;if(e.numberRule){d=e.numberRule.indexOf(b)}else{var f=parseInt(b);if(!isNaN(f)){d=f+1}}if(a.width!=e.cellWidth||a.height!=e.height){if(a.numData!=b){a.width=e.cellWidth;a.height=e.height}else{a.setSize(e.cellWidth,e.height)}}a.move(c*e.cellWidth);if(a.numData!=b){a.numData=b;a.background=e.cellBG;a.backgroundColor=e.cellBGColor;a.setData({col:e.colCount,row:e.rowCount,url:e.cellBGImage,selectframe:d})}};$.fixChildrenSize=function(){};$.parseFromPool=function(a,b,c,d){var e=this;e._super(_.super_p.parseFromPool,a,b,c,d);if(!isNaN(e.value)){e.setValue(e.value)}};$.updateUI=function(){var a=this;if(a.i_l_value!=a.value||a.i_l_cellWidth!=a.cellWidth||a.i_l_cellBGImage!=a.cellBGImage||a.i_l_colCount!=a.colCount||a.i_l_rowCount!=a.rowCount){a.setValue(a.value)}a._super(_.super_p.updateUI)};$.toString=function(){var a=this;return "[BitmapNumber (name="+a.name+")]"};kisgame.BitmapNumber=_}());(function(){"use strict";function _(a,b,c,d,e,f,g,h,i,j,k,l){var m=this;m.Event_constructor(a,b,c);m.mouseX=d;m.mouseY=e;m.delta=l;m.stageX=d;m.stageY=e;m.rawX=(i==null)?d:i;m.rawY=(j==null)?e:j;m.nativeEvent=f;m.pointerID=g;m.primary=!!h;m.relatedTarget=k}var $=kisgame.extend(_,kisgame.Event);$._get_localX=function(){var a=this;return a.currentTarget.globalToLocal(a.rawX,a.rawY).x};$._get_localY=function(){var a=this;return a.currentTarget.globalToLocal(a.rawX,a.rawY).y};$._get_isTouch=function(){var a=this;return a.pointerID!==-1};try{Object.defineProperties($,{localX:{get:$._get_localX},localY:{get:$._get_localY},isTouch:{get:$._get_isTouch}})}catch(e){}$.clone=function(){var a=this;return new _(a.type,a.bubbles,a.cancelable,a.stageX,a.stageY,a.nativeEvent,a.pointerID,a.primary,a.rawX,a.rawY,a,relatedTarget,a.delta)};$.toString=function(){var a=this;return "[MouseEvent (type="+a.type+" stageX="+a.stageX+" stageY="+a.stageY+")]"};kisgame.MouseEvent=kisgame.promote(_,"Event")}());this.kisgame=this.kisgame||{};(function(){function _(){var c=this;var b=c;b._super(_.super_p.constructor);b.width=b.height=60;b.bgImage_x=0;b.bgImage_y=0;b.borderWidth=1;b.borderStyle="solid";b.borderColor="black";b.backgroundColor="white";b.backgroundImage="";b.style=new Object();b.style.graphics={lines:[],images:[]}}var $=kisgame.KISContainer.prototype;var a=KISU.extend(_,kisgame.DisplayObject);a.hitTestPoint=function($,b){var c=this;if(b){return c.hitTest($.x,$.y)}else{var $=c.globalToLocal($.x,$.y,$);var d=c.hitAreaRectangle||c.getBounds();if(d.radius){return kisgame.GeomUtils.get2PR(0,0,$.x,$.y)<d.radius}else if($.x<d.x||$.y<d.y||$.x>d.x+d.width||$.y>d.y+d.height){return false}}return true};a.local2Global=$.local2Global;a.addETL=$.addETL;a.removeETL=$.removeETL;a.getSize=$.getSize;a.setSize=function(b,c,d){var e=this;e._super(_.super_p.setSize,b,c,d);if(e.i_l_w!=b||e.i_l_h!=c)e.borderBGDraw()};a.setSelectable=$.setSelectable;a.drawBorder=$.drawBorder;a.setBackgroundColor==$.setBackgroundColor;a.moveBackground=$.moveBackground;a.i_setBackgroundColor=$.i_setBackgroundColor;a.i_moveBackground=$.i_moveBackground;a.drawBackground=$.drawBackground;a.setStyle=$.setStyle;a.getStyle=$.getStyle;a.isVisible=function(){var c=this;var b=c.cacheCanvas||c.style.graphics.has;return !!(c.visible&&c.alpha>0&&c.scaleX!=0&&c.scaleY!=0)&&b};a.setVisible=$.setVisible;a.getBorderBounds=function(b){var d=this;var c=d.hitAreaRectangle;if(b&&c){return d.local2TargetRect(b,c)}return c};a.getBounds=function(b,c,d){var f=this;var e=f.hitAreaRectangle;if(b&&e){return f.local2TargetRect(b,e)}return e};a.borderBGDraw=function(){var c=this;var b=c.style.graphics;b.has=0;b.lines.length=0;b.images.length=0;b.bgc=null;var d=["Left","Top","Right","Bottom"];var e=d.length;var f=c.style;var g=new Object();var i=0;var j,v;if(f.borderStyle){for(i=0;i<e;i++){j=d[i];g[j+"Style"]=f.borderStyle;g[j+"Width"]=f.borderWidth;g[j+"Color"]=f.borderColor}}for(i=0;i<e;i++){j=d[i];v=f["border"+j+"Style"];if(v){g[j+"Style"]=v;v=f["border"+j+"Width"];if(v){g[j+"Width"]=v;v=f["border"+j+"Color"];if(v){g[j+"Color"]=v}}}}var k=c.getBorderBounds();var l,y,w,h;if(k.radius){l=-k.radius;y=-k.radius;w=k.radius*2;h=k.radius*2}else{l=k.x;y=k.y;w=k.width;h=k.height}var m=l;var n=y;var o=l+w;var p=y+h;var q=[m,n,m,p,m,p,o,p,o,p,o,n,o,n,m,n];m+=0.5;n+=0.5;o-=0.5;p-=0.5;var r=[m,n,m,p,m,p,o,p,o,p,o,n,o,n,m,n];v=f.backgroundColor;if(v){b.has=1;b.bgc=v;b.cx=l;b.cy=y;b.cw=w;b.ch=h}if(f.backgroundImage){var t=f.backgroundRepeat;var u=kisgame.RManager.getImageResult(f.backgroundImage,c);if(u){var x=0;var z,A,m,n,x0,y0;x0=-(l+c.bgImage_x);y0=-(y+c.bgImage_y);if(t=="no-repeat"||!t){z=l+c.bgImage_x,A=y+c.bgImage_y,m=z+u.width,n=A+u.height;if(l>z){z=l}if(y>A){A=y}if(l+w<m){m=l+w}if(y+h<n){n=y+h}if(m>u.width){x0=0}if(n>u.height){y0=0}if(!(m<=z||n<=A)){x=1;m=m-z;n=n-A}t=null}else if(t=="repeat-x"){x=1;z=l,A=y,m=w;n=u.height>h?h:u.height}else if(t=="repeat-y"){x=1;z=l,A=y,n=h;m=u.width>w?w:u.width}else if(t=="repeat"){x=1;z=l,A=y,m=w,n=h}if(x){b.has=1;b.images.push([u,t,x0,y0,m,n,z,A,m,n])}}}if(c.beforeDrawBorder){c.beforeDrawBorder()}if(k.radius){j=d[0];s=g[j+"Style"];wd=g[j+"Width"];cr=g[j+"Color"];if(s&&wd&&cr){ii=i*4;var B=parseInt(wd);b.has=1;b.lines.push([B,cr,k.radius])}}else{var C=b.lines;for(i=0;i<e;i++){j=d[i];s=g[j+"Style"];wd=g[j+"Width"];cr=g[j+"Color"];if(s&&wd&&cr){ii=i*4;var B=parseInt(wd);var D;if(B%2==0){D=q}else{D=r}b.has=1;C.push([B,cr,D[ii],D[ii+1],D[ii+2],D[ii+3]])}}}c.invaliate()};a.drawStyleGraphics=function(b){var d=this;var c=d.style.graphics;if(c.has){var e=d.hitAreaRectangle&&d.hitAreaRectangle.isFull;if(e){b.save();b.setTransform(1,0,0,1,0,0)}var f=c.bgc;if(f){b.fillStyle=f;if(d.radius){b.beginPath();b.arc(0,0,d.radius,0,2*Math.PI,0);b.closePath();b.fill()}else{b.fillRect(c.cx,c.cy,c.cw,c.ch)}}var g=c.images;var i=g.length;for(var j=0;j<i;j++){var k=g[j];if(!k[1]){b.drawImage(k[0],k[2],k[3],k[4],k[5],k[6],k[7],k[8],k[9])}else{var l=b.createPattern(k[0],k[1]);b.fillStyle=l;b.fillRect(k[6],k[7],k[8],k[9])}}var g=c.lines;var i=g.length;for(var j=0;j<i;j++){var k=g[j];b.beginPath();b.lineWidth=k[0];b.strokeStyle=k[1];if(k.length==3){b.arc(0,0,k[2],0,2*Math.PI,0)}else{b.moveTo(k[2],k[3]);var m=k.length;for(var n=4;n<m;n+=2){b.lineTo(k[n],k[n+1])}}b.stroke()}if(e){b.restore()}}};a.updateUI=function(){var b=this;b.drawBorder();b.drawBackground()};a.draw=function(b,c){var d=this;if(!b){d.updateUI();return}if(d._super(_.super_p.draw,b,c)){return true}d.drawStyleGraphics(b);return true};a.toString=function(){var b=this;return "[SimpleShape (name="+b.name+")]"};kisgame.SimpleShape=kisgame.promote(_,"DisplayObject")}());kisgame=kisgame||{};(function(){function _(a,b){var c=this;if(!b){b="canvas"}c.callSuperMethod(_.super_p.k_ctor,b);c.canvasStage=kisgame.getGameStage(a,c.MCTarget)}var $=_.prototype;$.setAutoUpdate=function(a){var b=this;b.canvasStage.autoUpdate=a};$.update=function(){var a=this;a.canvasStage.update()};$.setSize=function(a,b){var c=this;c.callSuperMethod(_.super_p.setSize,a,b);c.canvasStage.setSize(a,b)};$.addChild=function(a){var b=this;return b.canvasStage.addChild(a)};$.addChildAt=function(a,b){var c=this;return c.canvasStage.addChildAt(a,b)};$.removeChild=function(a){var b=this;return b.canvasStage.removeChild(a)};$.removeChildAt=function(a,b){var c=this;return c.canvasStage.removeChildAt(a,b)};$.getNumChildren=function(){var a=this;return a.canvasStage.getNumChildren()};$.getChildAt=function(a){var b=this;return b.canvasStage.getChildAt(a)};KISU.extend(_,MCProxy);kisgame.GameStage=_}());